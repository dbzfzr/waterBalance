<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zy.gis.mapper.devAndFacility.NetworkPointInfoMapper">
  <resultMap id="BaseResultMap" type="com.zy.gis.pojo.devAndFacility.NetworkPointInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Sep 04 15:15:47 CST 2021.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="point_no" jdbcType="VARCHAR" property="pointNo" />
    <result column="address_name" jdbcType="VARCHAR" property="addressName" />
    <result column="address_id" jdbcType="VARCHAR" property="addressId" />
    <result column="network_type" jdbcType="VARCHAR" property="networkType" />
    <result column="network_level" jdbcType="VARCHAR" property="networkLevel" />
    <result column="point_class" jdbcType="VARCHAR" property="pointClass" />
    <result column="point_type" jdbcType="VARCHAR" property="pointType" />
    <result column="system_type" jdbcType="VARCHAR" property="systemType" />
    <result column="material" jdbcType="VARCHAR" property="material" />
    <result column="specs" jdbcType="VARCHAR" property="specs" />
    <result column="longitude" jdbcType="VARCHAR" property="longitude" />
    <result column="latitude" jdbcType="VARCHAR" property="latitude" />
    <result column="top_depth" jdbcType="VARCHAR" property="topDepth" />
    <result column="bottom_depth" jdbcType="VARCHAR" property="bottomDepth" />
    <result column="completion_date" jdbcType="VARCHAR" property="completionDate" />
    <result column="create_time" jdbcType="VARCHAR" property="createTime" />
    <result column="update_time" jdbcType="VARCHAR" property="updateTime" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Sep 04 15:15:47 CST 2021.
    -->
    id, point_no, point_name,point_class, next_link_point_no, belong_divide_area, direction, address_name, address_id, network_type, network_level, point_type,
    system_type, material, specs, longitude, latitude, top_depth, bottom_depth, completion_date, 
    create_time, update_time
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Sep 04 15:15:47 CST 2021.
    -->
    select 
    <include refid="Base_Column_List" />
    from network_point_info
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Sep 04 15:15:47 CST 2021.
    -->
    delete from network_point_info
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.zy.gis.pojo.devAndFacility.NetworkPointInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Sep 04 15:15:47 CST 2021.
    -->
    insert into network_point_info (id, point_no, point_name,point_Class, next_link_point_no, belong_divide_area, direction,address_name,
      address_id, network_type, network_level, 
      point_type, system_type, material, 
      specs, longitude, latitude, 
      top_depth, bottom_depth, completion_date, 
      create_time, update_time)
    values (#{id,jdbcType=INTEGER}, #{pointNo,jdbcType=VARCHAR},#{pointName,jdbcType=VARCHAR},#{pointClass,jdbcType=VARCHAR}, #{nextLinkPointNo,jdbcType=VARCHAR},#{belongDivideArea,jdbcType=VARCHAR},
    #{direction,jdbcType=VARCHAR}, #{addressName,jdbcType=VARCHAR},
      #{addressId,jdbcType=VARCHAR}, #{networkType,jdbcType=VARCHAR}, #{networkLevel,jdbcType=VARCHAR}, 
      #{pointType,jdbcType=VARCHAR}, #{systemType,jdbcType=VARCHAR}, #{material,jdbcType=VARCHAR}, 
      #{specs,jdbcType=VARCHAR}, #{longitude,jdbcType=VARCHAR}, #{latitude,jdbcType=VARCHAR}, 
      #{topDepth,jdbcType=VARCHAR}, #{bottomDepth,jdbcType=VARCHAR}, #{completionDate,jdbcType=VARCHAR}, 
      #{createTime,jdbcType=VARCHAR}, #{updateTime,jdbcType=VARCHAR})
  </insert>

  <insert id="insertSelective" parameterType="com.zy.gis.pojo.devAndFacility.NetworkPointInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Sep 04 15:15:47 CST 2021.
    -->
    insert into network_point_info
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="pointNo != null">
        point_no,
      </if>
      <if test="nextLinkPointNo != null">
        next_link_point_no,
      </if>
      <if test="pointName != null">
      point_name,
    </if>
      <if test="pointClass != null">
        point_class,
      </if>
      <if test="addressName != null">
        address_name,
      </if>
      <if test="addressId != null">
        address_id,
      </if>
      <if test="networkType != null">
        network_type,
      </if>
      <if test="networkLevel != null">
        network_level,
      </if>
      <if test="pointType != null">
        point_type,
      </if>
      <if test="systemType != null">
        system_type,
      </if>
      <if test="material != null">
        material,
      </if>
      <if test="specs != null">
        specs,
      </if>
      <if test="longitude != null">
        longitude,
      </if>
      <if test="latitude != null">
        latitude,
      </if>
      <if test="topDepth != null">
        top_depth,
      </if>
      <if test="bottomDepth != null">
        bottom_depth,
      </if>
      <if test="completionDate != null">
        completion_date,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="updateTime != null">
        update_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="pointNo != null">
        #{pointNo,jdbcType=VARCHAR},
      </if>
      <if test="nextLinkPointNo != null">
        #{nextLinkPointNo,jdbcType=VARCHAR},
      </if>
      <if test="pointName != null">
        #{pointName, jdbcType=VARCHAR},
      </if>
      <if test="pointClass != null">
        #{pointClass, jdbcType=VARCHAR},
      </if>
      <if test="addressName != null">
        #{addressName,jdbcType=VARCHAR},
      </if>
      <if test="addressId != null">
        #{addressId,jdbcType=VARCHAR},
      </if>
      <if test="networkType != null">
        #{networkType,jdbcType=VARCHAR},
      </if>
      <if test="networkLevel != null">
        #{networkLevel,jdbcType=VARCHAR},
      </if>
      <if test="pointType != null">
        #{pointType,jdbcType=VARCHAR},
      </if>
      <if test="systemType != null">
        #{systemType,jdbcType=VARCHAR},
      </if>
      <if test="material != null">
        #{material,jdbcType=VARCHAR},
      </if>
      <if test="specs != null">
        #{specs,jdbcType=VARCHAR},
      </if>
      <if test="longitude != null">
        #{longitude,jdbcType=VARCHAR},
      </if>
      <if test="latitude != null">
        #{latitude,jdbcType=VARCHAR},
      </if>
      <if test="topDepth != null">
        #{topDepth,jdbcType=VARCHAR},
      </if>
      <if test="bottomDepth != null">
        #{bottomDepth,jdbcType=VARCHAR},
      </if>
      <if test="completionDate != null">
        #{completionDate,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=VARCHAR},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.zy.gis.pojo.devAndFacility.NetworkPointInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Sep 04 15:15:47 CST 2021.
    -->
    update network_point_info
    <set>
      <if test="pointNo != null">
        point_no = #{pointNo,jdbcType=VARCHAR},
      </if>
      <if test="nextLinkPointNo != null">
        next_link_point_no = #{nextLinkPointNo,jdbcType=VARCHAR},
      </if>
      <if test="pointName != null">
        point_name = #{pointName, jdbcType=VARCHAR},
      </if>
      <if test="belongDivideArea != null">
        belong_divide_area = #{belongDivideArea,jdbcType=VARCHAR},
      </if>
      <if test="direction != null">
        direction = #{direction, jdbcType=VARCHAR},
      </if>
      <if test="addressName != null">
        address_name = #{addressName,jdbcType=VARCHAR},
      </if>
      <if test="addressId != null">
        address_id = #{addressId,jdbcType=VARCHAR},
      </if>
      <if test="networkType != null">
        network_type = #{networkType,jdbcType=VARCHAR},
      </if>
      <if test="networkLevel != null">
        network_level = #{networkLevel,jdbcType=VARCHAR},
      </if>
      <if test="pointType != null">
        point_type = #{pointType,jdbcType=VARCHAR},
      </if>
      <if test="systemType != null">
        system_type = #{systemType,jdbcType=VARCHAR},
      </if>
      <if test="material != null">
        material = #{material,jdbcType=VARCHAR},
      </if>
      <if test="specs != null">
        specs = #{specs,jdbcType=VARCHAR},
      </if>
      <if test="longitude != null">
        longitude = #{longitude,jdbcType=VARCHAR},
      </if>
      <if test="latitude != null">
        latitude = #{latitude,jdbcType=VARCHAR},
      </if>
      <if test="topDepth != null">
        top_depth = #{topDepth,jdbcType=VARCHAR},
      </if>
      <if test="bottomDepth != null">
        bottom_depth = #{bottomDepth,jdbcType=VARCHAR},
      </if>
      <if test="completionDate != null">
        completion_date = #{completionDate,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=VARCHAR},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.zy.gis.pojo.devAndFacility.NetworkPointInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Sep 04 15:15:47 CST 2021.
    -->
    update network_point_info
    set point_no = #{pointNo,jdbcType=VARCHAR},
      address_name = #{addressName,jdbcType=VARCHAR},
      address_id = #{addressId,jdbcType=VARCHAR},
      network_type = #{networkType,jdbcType=VARCHAR},
      network_level = #{networkLevel,jdbcType=VARCHAR},
      point_type = #{pointType,jdbcType=VARCHAR},
      system_type = #{systemType,jdbcType=VARCHAR},
      material = #{material,jdbcType=VARCHAR},
      specs = #{specs,jdbcType=VARCHAR},
      longitude = #{longitude,jdbcType=VARCHAR},
      latitude = #{latitude,jdbcType=VARCHAR},
      top_depth = #{topDepth,jdbcType=VARCHAR},
      bottom_depth = #{bottomDepth,jdbcType=VARCHAR},
      completion_date = #{completionDate,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=VARCHAR},
      update_time = #{updateTime,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>

  <select id="getAllNetworkPoint" parameterType="com.zy.gis.pojo.devAndFacility.NetworkPointInfo" resultType="com.zy.gis.pojo.devAndFacility.NetworkPointInfo">
    select * from network_point_info
    <where>
      <if test="pointNo != null">
        and point_no = #{pointNo,jdbcType=VARCHAR}
      </if>
      <if test="longitude != null">
        and longitude = #{longitude,jdbcType=VARCHAR}
      </if>
      <if test="latitude != null">
        and latitude = #{latitude,jdbcType=VARCHAR}
      </if>
      <if test="addressId != null">
        and address_id = #{addressId,jdbcType=VARCHAR}
      </if>
    </where>
    order by create_time desc
    <if test="limit != null and offset != null ">
      limit #{offset},#{limit}
    </if>
  </select>

  <select id="getAllNetworkPointCount" parameterType="com.zy.gis.pojo.devAndFacility.NetworkPointInfo" resultType="Integer">
    select count(*) from network_point_info
  </select>

  <!--20211203 Wangchong 查询可以安装设备的点位，点位名称不为无 系统类型不为无-->
<!--  <select id="selectCanInstallDeviceNetworkPointInfoList" parameterType="com.zy.gis.pojo.devAndFacility.NetworkPointInfo" resultType="com.zy.gis.pojo.devAndFacility.NetworkPointInfo">-->
<!--    select <include refid="Base_Column_List" /> from network_point_info-->
<!--    <where>-->
<!--      system_type &lt;&gt; '无' and point_name &lt;&gt; '无'-->
<!--      <if test="pointNo != null">-->
<!--        and point_no = #{pointNo,jdbcType=VARCHAR}-->
<!--      </if>-->
<!--      <if test="addressId != null">-->
<!--        and address_id = #{addressId,jdbcType=VARCHAR}-->
<!--      </if>-->
<!--    </where>-->
<!--    order by create_time desc-->
<!--  </select>-->

  <!--20211118 Wangchong 查询有繁易屏设备的管网点位的信息，用于3维地图-->
  <select id="selectGisPointHaveFlexemList" resultType="com.zy.gis.orm.vo.GisPointHaveFlexemInfo">
        select networkPointInfo.id, networkPointInfo.point_no, networkPointInfo.address_name, networkPointInfo.address_id,
         networkPointInfo.network_type, networkPointInfo.network_level, networkPointInfo.point_type,
         networkPointInfo.system_type, networkPointInfo.material, networkPointInfo.specs, networkPointInfo.longitude,
         networkPointInfo.latitude, networkPointInfo.top_depth, networkPointInfo.bottom_depth, networkPointInfo.completion_date,
         networkPointInfo.create_time, networkPointInfo.update_time, flexem.box_no, flexem.alarm_state
         from gis_network_point_info networkPointInfo,
        (
          select flexState.box_no, flexState.alarm_state, panelInfo.facility_no from flex_state flexState,
          (
             select box_no, facility_no from dev_control_panel_info
          ) panelInfo
           where flexState.box_no = panelInfo.box_no
        ) flexem
        where flexem.facility_no = networkPointInfo.point_no
  </select>

  <!--202112011726 Wangchong 查询有安装设备的管网点位的信息-->
  <select id="selectNetworkPointHaveDeviceList"  resultType="com.zy.gis.orm.vo.GisPointHaveFlexemInfo">
        select networkPointInfo.id, networkPointInfo.point_no, networkPointInfo.point_name, networkPointInfo.address_name, networkPointInfo.address_id,
         networkPointInfo.network_type, networkPointInfo.network_level, networkPointInfo.point_type,
         networkPointInfo.system_type, networkPointInfo.material, networkPointInfo.specs, networkPointInfo.longitude,
         networkPointInfo.latitude, networkPointInfo.top_depth, networkPointInfo.bottom_depth, networkPointInfo.completion_date,
         networkPointInfo.create_time, networkPointInfo.update_time, dev.box_no, dev.box_alias
         from (
              select  <include refid="Base_Column_List" /> from network_point_info
              where system_type &lt;&gt; '无' and point_name &lt;&gt; '无'
              <if test="addressId != null">
                and address_id = #{addressId}
              </if>
         ) networkPointInfo,
        (
             select box_no, box_alias, facility_no from dev_control_panel_info
        ) dev
        where networkPointInfo.point_no = dev.facility_no
  </select>

  <!--202111050926 Wangchong 查询一条有繁易屏设备的点位记录信息-->
  <select id="selectNetworkPointHaveFlexem" resultType="com.zy.gis.orm.vo.GisPointHaveFlexemInfo">
       select networkPointInfo.id, networkPointInfo.point_no, networkPointInfo.address_name, networkPointInfo.address_id,
         networkPointInfo.network_type, networkPointInfo.network_level, networkPointInfo.point_type,
         networkPointInfo.system_type, networkPointInfo.material, networkPointInfo.specs, networkPointInfo.longitude,
         networkPointInfo.latitude, networkPointInfo.top_depth, networkPointInfo.bottom_depth, networkPointInfo.completion_date,
         networkPointInfo.create_time, networkPointInfo.update_time, flexem.box_no, flexem.alarm_state
         from network_point_info networkPointInfo,
        (
          select flexState.box_no, flexState.alarm_state, panelInfo.facility_no from flex_state flexState,
          (
             select box_no, facility_no from dev_control_panel_info
             <where>
               <if test="boxNo != null and boxNo !=''">
                  box_no = #{boxNo}
               </if>
             </where>
          ) panelInfo
           where flexState.box_no = panelInfo.box_no
        ) flexem
        where flexem.facility_no = networkPointInfo.point_no
  </select>

  <!--20211113 Wangchong 查询管网点位信息，附带相应点位的报警记录id-->
  <select id="selectNetworkPointWithAlarmIdList" resultType="com.zy.gis.orm.vo.NetworkPointWithAlarmId">
         select pointInfo.*, flexem.box_no, flexem.box_alias from (
           select networkPointInfo.id, networkPointInfo.point_no, networkPointInfo.point_name, networkPointInfo.address_name, networkPointInfo.address_id,
           networkPointInfo.network_type, networkPointInfo.network_level, networkPointInfo.point_type,
           networkPointInfo.system_type, networkPointInfo.material, networkPointInfo.specs, networkPointInfo.longitude,
           networkPointInfo.latitude, networkPointInfo.top_depth, networkPointInfo.bottom_depth, networkPointInfo.completion_date,
           networkPointInfo.create_time, networkPointInfo.update_time, alarmRecord.id as alarm_record_id
           from network_point_info networkPointInfo
           left join (
               select id, dev_facility_no from alarm_record where handle_state = "未处理" or handle_state = "处理中"
           ) alarmRecord
           on networkPointInfo.point_no = alarmRecord.dev_facility_no
         ) pointInfo left join dev_control_panel_info flexem on pointInfo.point_no = flexem.facility_no
  </select>

  <!--202111011151 Wangchong 查询繁易屏设备对应的管网的系统类型-->
  <select id="selectSystemTypeInfoByBoxNo" parameterType="java.lang.String" resultType="java.lang.String">
      select networkPointInfo.system_type from network_point_info networkPointInfo,
      (
        select facility_no from dev_control_panel_info
        where box_no = #{boxNo}
      ) panelInfo where panelInfo.facility_no = networkPointInfo.point_no

  </select>

  <!--202111191433 Wangchong 查询点位编号,名称 添加工控屏时用-->
  <select id="selectNetworkPointNoAndName" resultType="java.util.Map">
      SELECT point_no, point_name from network_point_info
      where system_type &lt;&gt; '无' and point_name &lt;&gt; '无'
  </select>

  <select id="selectAreaSewageCumulativeFlow" >

  </select>
  
    <select id="getNetworkSystemTypeRainNum"  resultType ="Integer">
        select count(*) from network_point_info WHERE system_type = '雨水监测点';
</select>

  <select id="getNetworkSystemTypeSewageNum" resultType="Integer">
        select count(*) from network_point_info where system_type = '污水监测点';
</select>
  <select id="getNetworkSystemTypeRainPollutionNum" resultType="Integer">
          select count(*) from network_point_info where system_type = '雨污分流器';
</select>
  <select id="getNetworkSystemTypeOilwaterNum" resultType="Integer">
          select count(*) from network_point_info where system_type = '油水分离器';
</select>
  <select id="getNetworkSystemTypePumpingNum" resultType="Integer">
          select count(*) from network_point_info where system_type = '泵站';
</select>
</mapper>
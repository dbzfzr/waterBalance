/* 2020-4-13 18:06:18 | 版权所有 杭州德慧信息技术有限公司 */
function _typeof2(e){return(_typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof2(exports))&&"object"===("undefined"==typeof module?"undefined":_typeof2(module))?module.exports=t(require("Cesium"),require("jQuery"),require("turf"),require("mapv")):"function"==typeof define&&define.amd?define(["Cesium","jQuery","turf","mapv"],t):"object"===("undefined"==typeof exports?"undefined":_typeof2(exports))?exports.gsp3d=t(require("Cesium"),require("jQuery"),require("turf"),require("mapv")):e.gsp3d=t(e.Cesium,e.jQuery,e.turf,e.mapv)}("undefined"!=typeof self?self:this,function(__WEBPACK_EXTERNAL_MODULE_0__,__WEBPACK_EXTERNAL_MODULE_5__,__WEBPACK_EXTERNAL_MODULE_22__,__WEBPACK_EXTERNAL_MODULE_96__){return j=[function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_0__},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.aroundPoint=t.windingPoint=void 0,t.formatNum=l,t.formatPositon=p,t.formatRectangle=c,t.getMaxHeight=u,t.computePolygonHeightRange=function(e,t){for(var i=[],n=0;n<e.length;n++)i.push(e[n].clone());var r,o,a,s,l,c,u,h=0,d=9999,p=Math.PI/Math.pow(2,11)/64,f=new g.PolygonGeometry.fromPositions({positions:i,vertexFormat:g.PerInstanceColorAppearance.FLAT_VERTEX_FORMAT,granularity:p}),m=new g.PolygonGeometry.createGeometry(f);for(n=0;n<m.indices.length;n+=3)r=m.indices[n],o=m.indices[n+1],a=m.indices[n+2],u=new g.Cartesian3(m.attributes.position.values[3*r],m.attributes.position.values[3*r+1],m.attributes.position.values[3*r+2]),(s=t.globe.getHeight(g.Cartographic.fromCartesian(u)))<d&&(d=s),h<s&&(h=s),u=new g.Cartesian3(m.attributes.position.values[3*o],m.attributes.position.values[3*o+1],m.attributes.position.values[3*o+2]),(l=t.globe.getHeight(g.Cartographic.fromCartesian(u)))<d&&(d=l),h<l&&(h=l),u=new g.Cartesian3(m.attributes.position.values[3*a],m.attributes.position.values[3*a+1],m.attributes.position.values[3*a+2]),(c=t.globe.getHeight(g.Cartographic.fromCartesian(u)))<d&&(d=c),h<c&&(h=c);return{maxHeight:h,minHeight:d}},t.addPositionsHeight=function(e,t){if(t=Number(t)||0,isNaN(t)||0==t)return e;{if(e instanceof Array){for(var i=[],n=0,r=e.length;n<r;n++){var o=g.Cartographic.fromCartesian(e[n]),a=g.Cartesian3.fromRadians(o.longitude,o.latitude,o.height+t);i.push(a)}return i}o=g.Cartographic.fromCartesian(e);return g.Cartesian3.fromRadians(o.longitude,o.latitude,o.height+t)}},t.setPositionsHeight=function(e,t){{if(t=Number(t)||0,e instanceof Array){for(var i=[],n=0,r=e.length;n<r;n++){var o=g.Cartographic.fromCartesian(e[n]),a=g.Cartesian3.fromRadians(o.longitude,o.latitude,t);i.push(a)}return i}o=g.Cartographic.fromCartesian(e);return g.Cartesian3.fromRadians(o.longitude,o.latitude,t)}},t.updateHeightForClampToGround=function(e,t){var i=g.Cartographic.fromCartesian(t),n=e.scene.globe.getHeight(i)||0,r=e.scene.sampleHeight(i)||0,o=n<r?r:n;if(null!=o&&0<o){return g.Cartesian3.fromRadians(i.longitude,i.latitude,o)}return t},t.getCurrentMousePosition=function(e,t,i){var n=e.pick(t);if(e.pickPositionSupported&&g.defined(n)&&function(e,t){if(g.defined(e.id)){var i=e.id;if(i._noMousePosition)return;if(t&&i==t)return}if(g.defined(e.primitive)){var n=e.primitive;if(n._noMousePosition)return;if(t&&n==t)return}return 1}(n,i)){var r=e.pickPosition(t);if(g.defined(r)){if(0<=(a=g.Cartographic.fromCartesian(r)).height)return r;if(!g.defined(n.id)&&-500<=a.height)return r}}if(e.mode===g.SceneMode.SCENE3D){var o=e.camera.getPickRay(t);r=e.globe.pick(o,e)}else r=e.camera.pickEllipsoid(t,e.globe.ellipsoid);if(g.defined(r)){var a;if((a=g.Cartographic.fromCartesian(r)).height<-1e3)return null}return r},t.getCenter=h,t.getExtent=function(e,t){var i=c(e.camera.computeViewRectangle());if(t){var n=e.gsp.point2wgs({x:i.xmin,y:i.ymin});i.xmin=n.x,i.ymin=n.y;var r=e.gsp.point2wgs({x:i.xmax,y:i.ymax});i.xmax=r.x,i.ymax=r.y}if(i.xmax<i.xmin){var o=i.xmax;i.xmax=i.xmin,i.xmin=o}if(i.ymax<i.ymin){o=i.ymax;i.ymax=i.ymin,i.ymin=o}return i},t.getCameraView=function(e,t){var i=e.camera,n=i.positionCartographic,r={};r.y=l(g.Math.toDegrees(n.latitude),6),r.x=l(g.Math.toDegrees(n.longitude),6),r.z=l(n.height,2),r.heading=l(g.Math.toDegrees(i.heading||-90),1),r.pitch=l(g.Math.toDegrees(i.pitch||0),1),r.roll=l(g.Math.toDegrees(i.roll||0),1),t&&(r=e.gsp.point2wgs(r));return r},t.centerOfMass=function(e,t){null==t&&(t=u(e));var i=a.cartesians2lonlats(e);i.push(i[0]);var n=o.centerOfMass(o.polygon([i]));return g.Cartesian3.fromDegrees(n.geometry.coordinates[0],n.geometry.coordinates[1],t)};var n,r=i(0),g=(n=r)&&n.__esModule?n:{default:n},o=s(i(22)),a=s(i(2));function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function l(e,t){return Number(e.toFixed(t||0))}function p(e){var t=g.Cartographic.fromCartesian(e),i={};return i.y=l(g.Math.toDegrees(t.latitude),6),i.x=l(g.Math.toDegrees(t.longitude),6),i.z=l(t.height,2),i}function c(e){var t=l(g.Math.toDegrees(e.west),6),i=l(g.Math.toDegrees(e.east),6),n=l(g.Math.toDegrees(e.north),6);return{xmin:t,xmax:i,ymin:l(g.Math.toDegrees(e.south),6),ymax:n}}function u(e,t){null==t&&(t=0);var i=t;if(null==e||0==e.length)return i;for(var n=0;n<e.length;n++){var r=g.Cartographic.fromCartesian(e[n]);r.height>i&&(i=r.height)}return l(i,2)}function h(e,t){var i,n,r,o,a=e.scene,s=(n=(i=a).canvas,r=new g.Cartesian2(n.clientWidth/2,n.clientHeight/2),o=i.camera.getPickRay(r),i.globe.pick(o,i)||i.camera.pickEllipsoid(r));if(!s){var l=a.globe,c=a.camera.positionCartographic.clone(),u=l.getHeight(c);c.height=u||0,s=g.Ellipsoid.WGS84.cartographicToCartesian(c)}var h=p(s);t&&(h=e.gsp.point2wgs(h));var d=g.Cartesian3.distance(s,e.scene.camera.positionWC);return h.cameraZ=d,h}t.windingPoint={isStart:!1,viewer:null,start:function(e,t){this.viewer=e,t&&t instanceof g.Cartesian3?this.position=t:(t=t||h(e),this.position=g.Cartesian3.fromDegrees(t.x,t.y,t.z)),this.distance=t.distance||g.Cartesian3.distance(this.position,e.camera.positionWC),this.angle=360/(t.time||60),this.time=e.clock.currentTime.clone(),this.heading=e.camera.heading,this.pitch=e.camera.pitch,this.viewer.clock.onTick.addEventListener(this.clock_onTickHandler,this),this.isStart=!0},clock_onTickHandler:function(){var e=g.JulianDate.secondsDifference(this.viewer.clock.currentTime,this.time),t=g.Math.toRadians(e*this.angle)+this.heading;this.viewer.scene.camera.setView({destination:this.position,orientation:{heading:t,pitch:this.pitch}}),this.viewer.scene.camera.moveBackward(this.distance)},stop:function(){this.isStart&&(this.viewer&&this.viewer.clock.onTick.removeEventListener(this.clock_onTickHandler,this),this.isStart=!1)}},t.aroundPoint={isStart:!1,viewer:null,start:function(e,t){this.viewer=e,t&&t instanceof g.Cartesian3?this.position=t:(t=t||h(e),this.position=g.Cartesian3.fromDegrees(t.x,t.y,t.z)),this.angle=360/(t.time||60),this.time=e.clock.currentTime.clone(),this.heading=e.camera.heading,this.pitch=e.camera.pitch,this.viewer.clock.onTick.addEventListener(this.clock_onTickHandler,this),this.isStart=!0},clock_onTickHandler:function(){var e=g.JulianDate.secondsDifference(this.viewer.clock.currentTime,this.time),t=g.Math.toRadians(e*this.angle)+this.heading;this.viewer.scene.camera.setView({orientation:{heading:t,pitch:this.pitch}})},stop:function(){this.isStart&&(this.viewer&&this.viewer.clock.onTick.removeEventListener(this.clock_onTickHandler,this),this.isStart=!1)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cancelFn=t.requestFn=t.emptyImageUrl=t.isArray=t.lastId=t.create=t.freeze=void 0,t.extend=function(e){var t,i,n,r;for(i=1,n=arguments.length;i<n;i++)for(t in r=arguments[i])e[t]=r[t];return e},t.bind=c,t.stamp=function(e){return e._leaflet_id=e._leaflet_id||(t.lastId=u+=1),e._leaflet_id},t.throttle=function(e,t,i){var n,r,o,a;return a=function(){n=!1,r&&(o.apply(i,r),r=!1)},o=function(){n?r=arguments:(e.apply(i,arguments),setTimeout(a,t),n=!0)}},t.wrapNum=function(e,t,i){var n=t[1],r=t[0],o=n-r;return e===n&&i?e:((e-r)%o+o)%o+r},t.falseFn=function(){return!1},t.formatNum=h,t.trim=d,t.splitWords=function(e){return d(e).split(/\s+/)},t.setOptions=function(e,t){e.hasOwnProperty("options")||(e.options=e.options?a(e.options):{});for(var i in t)e.options[i]=t[i];return e.options},t.getParamString=function(e,t,i){var n=[];for(var r in e)n.push(encodeURIComponent(i?r.toUpperCase():r)+"="+encodeURIComponent(e[r]));return(t&&-1!==t.indexOf("?")?"&":"?")+n.join("&")},t.template=function(e,n){return e.replace(p,function(e,t){var i=n[t];if(void 0===i)throw new Error("No value provided for variable "+e);return"function"==typeof i&&(i=i(n)),i})},t.indexOf=function(e,t){for(var i=0;i<e.length;i++)if(e[i]===t)return i;return-1},t.requestAnimFrame=function(e,t,i){{if(!i||y!==v)return y.call(window,c(e,t));e.call(t)}},t.cancelAnimFrame=function(e){e&&_.call(window,e)},t.removeGeoJsonDefVal=function(e){if(!e.properties||!e.properties.type)return e;var t=e.properties.edittype||e.properties.type,i=w[t];if(!i)return e;var n=l.clone(e);if(e.properties.style){var r={};for(var o in e.properties.style){if(null!=(s=e.properties.style[o]))i.style[o]!==s&&(r[o]=s)}n.properties.style=r}if(e.properties.attr){var a={};for(var o in e.properties.attr){var s;if(null!=(s=e.properties.attr[o]))i.attr[o]!==s&&(a[o]=s)}n.properties.attr=a}return n},t.addGeoJsonDefVal=function(e){var t=w[e.edittype||e.type];if(t){for(var i in e.style=e.style||{},t.style){null==e.style[i]&&(e.style[i]=t.style[i])}for(var i in e.attr=e.attr||{},t.attr){null==e.attr[i]&&(e.attr[i]=t.attr[i])}}return e},t.cartesians2lonlats=function(e){for(var t=[],i=0,n=e.length;i<n;i++){var r=b(e[i]);t.push(r)}return t},t.cartesian2lonlat=b,t.getPositionByGeoJSON=function(e,t){var i="Feature"===e.type?e.geometry:e,n=i?i.coordinates:null;if(!n&&!i)return null;switch(i.type){case"Point":return C(n,t);case"MultiPoint":case"LineString":return x(n,t);case"MultiLineString":case"Polygon":return x(n[0],t);case"MultiPolygon":return x(n[0][0],t);default:throw new Error("Invalid GeoJSON object.")}},t.lonlat2cartesian=C,t.lonlats2cartesians=x;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},l=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(4));t.freeze=Object.freeze;Object.freeze=function(e){return e};var a=t.create=Object.create||function(e){return s.prototype=e,new s};function s(){}function c(e,t){var i=Array.prototype.slice;if(e.bind)return e.bind.apply(e,i.call(arguments,1));var n=i.call(arguments,2);return function(){return e.apply(t,n.length?n.concat(i.call(arguments)):arguments)}}var u=t.lastId=0;function h(e,t){return Number(e.toFixed(t||0))}function d(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}var p=/\{ *([\w_-]+) *\}/g;var f=t.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.emptyImageUrl="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function m(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var g=0;function v(e){var t=+new Date,i=Math.max(0,16-(t-g));return g=t+i,window.setTimeout(e,i)}var y=t.requestFn=window.requestAnimationFrame||m("RequestAnimationFrame")||v,_=t.cancelFn=window.cancelAnimationFrame||m("CancelAnimationFrame")||m("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};var w={label:{edittype:"label",name:"文字",style:{text:"文字",color:"#ffffff",opacity:1,font_family:"楷体",font_size:30,border:!0,border_color:"#000000",border_width:3,background:!1,background_color:"#000000",background_opacity:.5,font_weight:"normal",font_style:"normal",scaleByDistance:!1,scaleByDistance_far:1e6,scaleByDistance_farValue:.1,scaleByDistance_near:1e3,scaleByDistance_nearValue:1,distanceDisplayCondition:!1,distanceDisplayCondition_far:1e4,distanceDisplayCondition_near:0},attr:{id:"",name:"",remark:""}},point:{edittype:"point",name:"点标记",style:{pixelSize:10,color:"#3388ff",opacity:1,outline:!0,outlineColor:"#ffffff",outlineOpacity:.6,outlineWidth:2,scaleByDistance:!1,scaleByDistance_far:1e6,scaleByDistance_farValue:.1,scaleByDistance_near:1e3,scaleByDistance_nearValue:1,distanceDisplayCondition:!1,distanceDisplayCondition_far:1e4,distanceDisplayCondition_near:0},attr:{id:"",name:"",remark:""}},imagepoint:{edittype:"imagepoint",name:"图标点标记",style:{image:"",opacity:1,scale:1,rotation:0,scaleByDistance:!1,scaleByDistance_far:1e6,scaleByDistance_farValue:.1,scaleByDistance_near:1e3,scaleByDistance_nearValue:1,distanceDisplayCondition:!1,distanceDisplayCondition_far:1e4,distanceDisplayCondition_near:0},attr:{id:"",name:"",remark:""}},model:{edittype:"model",name:"模型",style:{modelUrl:"",scale:1,heading:0,pitch:0,roll:0,fill:!1,color:"#3388ff",opacity:1,silhouette:!1,silhouetteColor:"#ffffff",silhouetteSize:2,silhouetteAlpha:.8},attr:{id:"",name:"",remark:""}},polyline:{edittype:"polyline",name:"线",position:{minCount:2},style:{lineType:"solid",color:"#3388ff",width:4,clampToGround:!1,outline:!1,outlineColor:"#ffffff",outlineWidth:2,opacity:1,zIndex:0},attr:{id:"",name:"",remark:""}},polylineVolume:{edittype:"polylineVolume",name:"管道线",position:{height:!0,minCount:2},style:{color:"#00FF00",radius:10,shape:"pipeline",outline:!1,outlineColor:"#ffffff",opacity:1},attr:{id:"",name:"",remark:""}},polygon:{edittype:"polygon",name:"面",position:{height:!0,minCount:3},style:{fill:!0,color:"#3388ff",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6,clampToGround:!1,zIndex:0},attr:{id:"",name:"",remark:""}},polygon_clampToGround:{edittype:"polygon_clampToGround",name:"贴地面",position:{height:!1,minCount:3},style:{color:"#ffff00",opacity:.6,clampToGround:!0,zIndex:0},attr:{id:"",name:"",remark:""}},extrudedPolygon:{edittype:"extrudedPolygon",name:"拉伸面",position:{height:!0,minCount:3},style:{fill:!0,color:"#00FF00",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6,extrudedHeight:100,perPositionHeight:!0,zIndex:0},attr:{id:"",name:"",remark:""}},rectangle:{edittype:"rectangle",name:"矩形",position:{height:!1,minCount:2,maxCount:2},style:{height:0,fill:!0,color:"#3388ff",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6,rotation:0,clampToGround:!1,zIndex:0},attr:{id:"",name:"",remark:""}},rectangle_clampToGround:{edittype:"rectangle_clampToGround",name:"贴地矩形",position:{height:!1,minCount:2,maxCount:2},style:{color:"#ffff00",opacity:.6,rotation:0,clampToGround:!0,zIndex:0},attr:{id:"",name:"",remark:""}},rectangleImg:{edittype:"rectangleImg",name:"贴地图片",position:{height:!1,minCount:2,maxCount:2},style:{image:"",opacity:1,rotation:0,clampToGround:!0,zIndex:0},attr:{id:"",name:"",remark:""}},extrudedRectangle:{edittype:"extrudedRectangle",name:"拉伸矩形",position:{height:!1,minCount:2,maxCount:2},style:{extrudedHeight:40,height:0,fill:!0,color:"#00FF00",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6,rotation:0,zIndex:0},attr:{id:"",name:"",remark:""}},ellipse:{edittype:"ellipse",name:"椭圆",position:{height:!1},style:{semiMinorAxis:200,semiMajorAxis:200,height:0,fill:!0,color:"#3388ff",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6,rotation:0,clampToGround:!1,zIndex:0},attr:{id:"",name:"",remark:""}},ellipse_clampToGround:{edittype:"ellipse_clampToGround",name:"椭圆",position:{height:!1},style:{semiMinorAxis:200,semiMajorAxis:200,color:"#ffff00",opacity:.6,rotation:0,clampToGround:!0,zIndex:0},attr:{id:"",name:"",remark:""}},extrudedEllipse:{edittype:"extrudedEllipse",name:"圆柱体",position:{height:!1},style:{semiMinorAxis:200,semiMajorAxis:200,extrudedHeight:200,height:0,fill:!0,color:"#00FF00",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6,rotation:0,zIndex:0},attr:{id:"",name:"",remark:""}},ellipsoid:{edittype:"ellipsoid",name:"球体",style:{extentRadii:200,widthRadii:200,heightRadii:200,fill:!0,color:"#00FF00",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6},attr:{id:"",name:"",remark:""}},wall:{edittype:"wall",name:"墙体",position:{height:!0,minCount:2},style:{extrudedHeight:40,fill:!0,color:"#00FF00",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6},attr:{id:"",name:"",remark:""}}};function b(e){var t=o.Cartographic.fromCartesian(e);return null==t?{}:[h(o.Math.toDegrees(t.longitude),6),h(o.Math.toDegrees(t.latitude),6),h(t.height,2)]}function C(e,t){return o.Cartesian3.fromDegrees(e[0],e[1],e[2]||t||0)}function x(e,t){for(var i=[],n=0,r=e.length;n<r;n++){var o=e[n];f(o[0])?i.push(x(o,t)):i.push(C(o,t))}return i}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.message=void 0,t.Tooltip=a;var n,r=i(5),o=(n=r)&&n.__esModule?n:{default:n};t.message={draw:{point:{start:"单击 完成绘制"},polyline:{start:"单击 开始绘制",cont:"单击增加点，右击删除点",end:"单击增加点，右击删除点<br/>双击完成绘制",end2:"单击完成绘制"}},edit:{start:"单击后 激活编辑<br/>右击 单击菜单删除",end:"释放后 完成修改"},dragger:{def:"拖动 修改位置",addMidPoint:"拖动 增加点",moveHeight:"拖动 修改高度",editRadius:"拖动 修改半径",editHeading:"拖动 修改方向",editScale:"拖动 修改缩放比例"},del:{def:"<br/>右击 删除该点",min:"无法删除，点数量不能少于"}};function a(e){var t=document.createElement("DIV");t.className="draw-tooltip right";var i=document.createElement("DIV");i.className="draw-tooltip-arrow",t.appendChild(i);var n=document.createElement("DIV");n.className="draw-tooltip-inner",t.appendChild(n),this._div=t,this._title=n,e.appendChild(t),(0,o.default)(".draw-tooltip").mouseover(function(){(0,o.default)(this).hide()})}a.prototype.setVisible=function(e){this._div.style.display=e?"block":"none"},a.prototype.showAt=function(e,t){e&&t?(this.setVisible(!0),this._title.innerHTML=t,this._div.style.top=e.y-this._div.clientHeight/2+"px",this._div.style.left=e.x+30+"px"):this.setVisible(!1)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)};t.isNumber=function(e){return"number"==typeof e&&e.constructor==Number},t.isString=function(e){return"string"==typeof e&&e.constructor==String},t.alert=o,t.msg=function(e){window.haoutil&&window.haoutil.msg?window.haoutil.msg(e):window.toastr?toastr.info(e):window.layer?layer.msg(e):o(e)},t.getRequest=function(){var e=location.search,t=new Object;if(-1!=e.indexOf("?"))for(var i=e.substr(1).split("&"),n=0;n<i.length;n++)t[i[n].split("=")[0]]=decodeURI(i[n].split("=")[1]);return t},t.getRequestByName=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(t);return null!=i?decodeURI(i[2]):null},t.clone=function e(t,i){null==i&&(i=5);if(null==t||"object"!=(void 0===t?"undefined":s(t)))return t;if(t instanceof Date){var n=new Date;return n.setTime(t.getTime()),n}if(t instanceof Array&&0<=i){for(var n=[],r=0,o=t.length;r<o;++r)n[r]=e(t[r],i-1);return n}if("object"===(void 0===t?"undefined":s(t))&&0<=i){var n={};for(var a in t)"function"!=typeof a&&"_layer"!=a&&"_layers"!=a&&"_parent"!=a&&t.hasOwnProperty(a)&&(n[a]=e(t[a],i-1));return n}return t},t.template=function(e,t){if(null==e)return e;for(var i in t){var n=t[i];null!=n&&"Null"!=n&&"Unknown"!=n||(n=""),e=e.replace(new RegExp("{"+i+"}","gm"),n)}return e},t.isPCBroswer=function(){var e=navigator.userAgent.toLowerCase(),t="ipad"==e.match(/ipad/i),i="iphone"==e.match(/iphone/i),n="midp"==e.match(/midp/i),r="rv:1.2.3.4"==e.match(/rv:1.2.3.4/i),o="ucweb"==e.match(/ucweb/i),a="android"==e.match(/android/i),s="windows ce"==e.match(/windows ce/i),l="windows mobile"==e.match(/windows mobile/i);return!(t||i||n||r||o||a||s||l)},t.getExplorerInfo=a,t.webglreport=function(){var e=a();if("IE"==e.type&&e.version<11)return!1;try{var t,i=document.createElement("canvas");if("undefined"!=typeof WebGL2RenderingContext&&(t=i.getContext("webgl2")||i.getContext("experimental-webgl2")||void 0),null==t&&(t=i.getContext("webgl")||i.getContext("experimental-webgl")||void 0),null==t)return!1}catch(e){return!1}return!0},t.terrainPolyline=function(o){var a=o.viewer,s=o.positions;if(null==s||0==s.length)return void(o.calback&&o.calback(s));for(var e=S.PolylinePipeline.generateArc({positions:s,granularity:o.granularity||1e-5}),t=[],l=a.scene.globe.ellipsoid,i=0;i<e.length;i+=3){var n=S.Cartesian3.unpack(e,i);t.push(l.cartesianToCartographic(n))}var c=S.Cartographic.fromCartesian(s[0]).height;S.when(S.sampleTerrainMostDetailed(a.terrainProvider,t),function(e){for(var t=!1,i=o.offset||2,n=0;n<e.length;++n)null==e[n].height?(t=!0,e[n].height=c):e[n].height=i+e[n].height*a.scene._terrainExaggeration;var r=l.cartographicArrayToCartesianArray(e);o.calback?o.calback(r,t):s.setValue&&s.setValue(r)})},t.getProxyUrl=l,t.getEllipsoidTerrain=function(){return c},t.getTerrainProvider=function(e){e.hasOwnProperty("requestWaterMask")||(e.requestWaterMask=!0);e.hasOwnProperty("requestVertexNormals")||(e.requestVertexNormals=!0);var t;t="ion"==e.type||"ion"==e.url||""==e.url||null==e.url?new S.CesiumTerrainProvider({url:S.IonResource.fromAssetId(1)}):"ellipsoid"==e.type||"ellipsoid"==e.url?c:"gee"==e.type?new S.GoogleEarthEnterpriseTerrainProvider({metadata:new S.GoogleEarthEnterpriseMetadata(l(e))}):new S.CesiumTerrainProvider(l(e));return t},t.createModel=function(e,t){e=t.gsp.point2map(e);var i=S.Cartesian3.fromDegrees(e.x,e.y,e.z||0),n=S.Math.toRadians(e.heading||0),r=S.Math.toRadians(e.pitch||0),o=S.Math.toRadians(e.roll||0),a=new S.HeadingPitchRoll(n,r,o),s=e.converter||S.Transforms.eastNorthUpToFixedFrame,l=S.Transforms.headingPitchRollQuaternion(i,a,t.scene.globe.ellipsoid,s);return t.entities.add({name:e.name||"",position:i,orientation:l,model:e,tooltip:e.tooltip,popup:e.popup})},t.formatDegree=function(e){e=Math.abs(e);var t=Math.floor(e),i=Math.floor(60*(e-t)),n=Math.round(3600*(e-t)%60);return t+"° "+i+"'  "+n+'"'},t.getLinkedPointList=function(e,t,i,n){var r=[],o=S.Cartographic.fromCartesian(e),a=S.Cartographic.fromCartesian(t),s=180*o.longitude/Math.PI,l=180*o.latitude/Math.PI,c=180*a.longitude/Math.PI,u=180*a.latitude/Math.PI,h=Math.sqrt((s-c)*(s-c)+(l-u)*(l-u))*i,d=S.Cartesian3.clone(e),p=S.Cartesian3.clone(t),f=S.Cartesian3.distance(d,S.Cartesian3.ZERO),m=S.Cartesian3.distance(p,S.Cartesian3.ZERO);if(S.Cartesian3.normalize(d,d),S.Cartesian3.normalize(p,p),0==S.Cartesian3.distance(d,p))return r;var g=S.Cartesian3.angleBetween(d,p);r.push(e);for(var v=1;v<n-1;v++){var y=v/(n-1),_=1-y,w=Math.sin(_*g)/Math.sin(g),b=Math.sin(y*g)/Math.sin(g),C=S.Cartesian3.multiplyByScalar(d,w,new S.Cartesian3),x=S.Cartesian3.multiplyByScalar(p,b,new S.Cartesian3),P=S.Cartesian3.add(C,x,new S.Cartesian3),E=y*Math.PI,M=f*_+m*y+Math.sin(E)*h;P=S.Cartesian3.multiplyByScalar(P,M,P),r.push(P)}return r.push(t),r};var n,r=i(0),S=(n=r)&&n.__esModule?n:{default:n};function o(e,t){window.haoutil&&window.haoutil.alert?window.haoutil.alert(e,t):window.layer?layer.alert(e,{title:t||"提示",skin:"layui-layer-lan layer-mars-dialog",closeBtn:0,anim:0}):o(e)}function a(){var e=window.navigator.userAgent.toLowerCase();return 0<=e.indexOf("msie")?{type:"IE",version:Number(e.match(/msie ([\d]+)/)[1])}:0<=e.indexOf("firefox")?{type:"Firefox",version:Number(e.match(/firefox\/([\d]+)/)[1])}:0<=e.indexOf("chrome")?{type:"Chrome",version:Number(e.match(/chrome\/([\d]+)/)[1])}:0<=e.indexOf("opera")?{type:"Opera",version:Number(e.match(/opera.([\d]+)/)[1])}:0<=e.indexOf("Safari")?{type:"Safari",version:Number(e.match(/version\/([\d]+)/)[1])}:{type:e,version:-1}}function l(e){if(!e.proxy||!e.url)return e;if(e.url instanceof S.Resource)return e;var t={};for(var i in e)t[i]=e[i];return t.url=new S.Resource({url:t.url,proxy:new S.DefaultProxy(t.proxy)}),t}var c=new S.EllipsoidTerrainProvider({ellipsoid:S.Ellipsoid.WGS84})},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_5__},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PointColor=t.PointType=t.PixelSize=void 0,t.createDragger=function(e,t){var i;if(t.dragger)i=t.dragger;else{var n={scale:1,pixelSize:s,outlineColor:new o.Color.fromCssColorString("#ffffff").withAlpha(.5),outlineWidth:2,scaleByDistance:new o.NearFarScalar(1e3,1,1e6,.5),disableDepthTestDistance:Number.POSITIVE_INFINITY};n=function(e,t){switch(e){case l.AddMidPoint:t.color=c.AddMidPoint,t.outlineColor=new o.Color.fromCssColorString("#ffffff").withAlpha(.4);break;case l.MoveHeight:t.color=c.MoveHeight;break;case l.EditAttr:t.color=c.EditAttr;break;case l.Control:default:t.color=c.Control}return t}(t.type,n),i=e.entities.add({position:o.defaultValue(t.position,o.Cartesian3.ZERO),point:n,draw_tooltip:t.tooltip||a.message.dragger.def})}return i._isDragger=!0,i._pointType=t.type||l.Control,i.onDragStart=o.defaultValue(t.onDragStart,null),i.onDrag=o.defaultValue(t.onDrag,null),i.onDragEnd=o.defaultValue(t.onDragEnd,null),i};var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=i(3);var s=t.PixelSize=12,l=t.PointType={Control:1,AddMidPoint:2,MoveHeight:3,EditAttr:4,EditRotation:5},c=t.PointColor={Control:new o.Color.fromCssColorString("#1c197d"),MoveHeight:new o.Color.fromCssColorString("#9500eb"),EditAttr:new o.Color.fromCssColorString("#f73163"),AddMidPoint:new o.Color.fromCssColorString("#04c2c9").withAlpha(.3)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DrawStart="draw-start",t.DrawAddPoint="draw-add-point",t.DrawRemovePoint="draw-remove-lastpoint",t.DrawMouseMove="draw-mouse-move",t.DrawCreated="draw-created",t.EditStart="edit-start",t.EditMovePoint="edit-move-point",t.EditRemovePoint="edit-remove-point",t.EditStop="edit-stop"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawPolyline=void 0;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=i(21),s=i(1),l=d(i(7)),c=i(3),u=d(i(10)),h=i(14);function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.DrawPolyline=a.DrawBase.extend({type:"polyline",_minPointNum:2,_maxPointNum:9999,createFeature:function(e){this._positions_draw=[],e.config?(this._minPointNum=e.config.minPointNum||2,this._maxPointNum=e.config.maxPointNum||9999):(this._minPointNum=2,this._maxPointNum=9999);var t=this,i={polyline:u.style2Entity(e.style),attribute:e};return i.polyline.positions=new o.CallbackProperty(function(e){return t.getDrawPosition()},!1),this.entity=this.dataSource.entities.add(i),this.entity._positions_draw=this._positions_draw,this.entity},style2Entity:function(e,t){return u.style2Entity(e,t.polyline)},bindEvent:function(){var i=this,n=!1;this.getHandler().setInputAction(function(e){var t=(0,s.getCurrentMousePosition)(i.viewer.scene,e.position,i.entity);t&&(n&&i._positions_draw.pop(),n=!1,i.entity.attribute&&i.entity.attribute.config&&i.entity.attribute.config.addHeight&&(t=(0,s.addPositionsHeight)(t,i.entity.attribute.config.addHeight)),i._positions_draw.push(t),i.updateAttrForDrawing(),i.fire(l.DrawAddPoint,{drawtype:i.type,entity:i.entity,position:t,positions:i._positions_draw}),i._positions_draw.length>=i._maxPointNum&&i.disable())},o.ScreenSpaceEventType.LEFT_CLICK),this.getHandler().setInputAction(function(e){i._positions_draw.pop();var t=(0,s.getCurrentMousePosition)(i.viewer.scene,e.position,i.entity);t&&(n&&i._positions_draw.pop(),n=!0,i.fire(l.DrawRemovePoint,{drawtype:i.type,entity:i.entity,position:t,positions:i._positions_draw}),i._positions_draw.push(t),i.updateAttrForDrawing())},o.ScreenSpaceEventType.RIGHT_CLICK),this.getHandler().setInputAction(function(e){i._positions_draw.length<=1?i.tooltip.showAt(e.endPosition,c.message.draw.polyline.start):i._positions_draw.length<i._minPointNum?i.tooltip.showAt(e.endPosition,c.message.draw.polyline.cont):i._positions_draw.length>=i._maxPointNum?i.tooltip.showAt(e.endPosition,c.message.draw.polyline.end2):i.tooltip.showAt(e.endPosition,c.message.draw.polyline.end);var t=(0,s.getCurrentMousePosition)(i.viewer.scene,e.endPosition,i.entity);t&&(n&&i._positions_draw.pop(),n=!0,i._positions_draw.push(t),i.updateAttrForDrawing(),i.fire(l.DrawMouseMove,{drawtype:i.type,entity:i.entity,position:t,positions:i._positions_draw}))},o.ScreenSpaceEventType.MOUSE_MOVE),this.getHandler().setInputAction(function(e){i._positions_draw.pop(),i._positions_draw.length<i._minPointNum||(i.updateAttrForDrawing(),i.disable())},o.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},getEditClass:function(e){var t=new h.EditPolyline(e,this.viewer,this.dataSource);return t._minPointNum=this._minPointNum,t._maxPointNum=this._maxPointNum,this._bindEdit(t)},getAttrClass:function(){return u},finish:function(){var t=this.entity;t.editing=this.getEditClass(t),t._positions_draw=this.getDrawPosition(),t.polyline.positions=new o.CallbackProperty(function(e){return t._positions_draw},!1)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseLayer=void 0;var n=i(12),r=i(4),o=n.Class.extend({config:{},viewer:null,initialize:function(e,t){this.viewer=t,this.config=e,this.name=e.name,this.config.hasOwnProperty("alpha")?this._opacity=Number(this.config.alpha):this.config.hasOwnProperty("opacity")&&(this._opacity=Number(this.config.opacity)),this.config.hasOwnProperty("hasOpacity")&&(this.hasOpacity=this.config.hasOpacity),this.create(),e.visible?this.setVisible(!0):this._visible=!1,e.visible&&e.flyTo&&this.centerAt(0)},create:function(){},showError:function(e,t){t=t||"未知错误",this.viewer&&this.viewer.cesiumWidget.showErrorPanel(e,void 0,t),console.log("layer错误:"+e+t)},_visible:null,getVisible:function(){return this._visible},setVisible:function(e){null!=this._visible&&this._visible==e||((this._visible=e)?(this.config.msg&&(0,r.msg)(this.config.msg),this.add()):this.remove())},add:function(){this._visible=!0,this.config.onAdd&&this.config.onAdd()},remove:function(){this._visible=!1,this.config.onRemove&&this.config.onRemove()},centerAt:function(e){this.config.extent||this.config.center?this.viewer.gsp.centerAt(this.config.extent||this.config.center,{duration:e,isWgs84:!0}):this.config.onCenterAt&&this.config.onCenterAt(e)},hasOpacity:!1,_opacity:1,setOpacity:function(e){this.config.onSetOpacity&&this.config.onSetOpacity(e)},hasZIndex:!1,setZIndex:function(e){this.config.onSetZIndex&&this.config.onSetZIndex(e)},destroy:function(){this.setVisible(!1)}});t.BaseLayer=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){e=e||{},null==t&&(t={});for(var i in e){var n=e[i];switch(i){default:t[i]=n;break;case"lineType":case"color":case"opacity":case"outline":case"outlineWidth":case"outlineColor":case"outlineOpacity":case"flowDuration":case"flowImage":}}if(e.color||e.lineType){var r=new o.Color.fromCssColorString(e.color||"#FFFF00").withAlpha(Number(o.defaultValue(e.opacity,1)));switch(e.lineType){default:case"solid":e.outline?t.material=new o.PolylineOutlineMaterialProperty({color:r,outlineWidth:Number(e.outlineWidth||1),outlineColor:new o.Color.fromCssColorString(e.outlineColor||"#FFFF00").withAlpha(Number(e.outlineOpacity||e.opacity||1))}):t.material=r;break;case"dash":e.outline?t.material=new o.PolylineDashMaterialProperty({dashLength:e.dashLength||e.outlineWidth||16,color:r,gapColor:new o.Color.fromCssColorString(e.outlineColor||"#FFFF00").withAlpha(Number(e.outlineOpacity||e.opacity||1))}):t.material=new o.PolylineDashMaterialProperty({dashLength:e.dashLength||16,color:r});break;case"glow":t.material=new o.PolylineGlowMaterialProperty({glowPower:e.glowPower||.1,color:r});break;case"arrow":t.material=new o.PolylineArrowMaterialProperty(r);break;case"animation":t.material=new l.LineFlowMaterial({color:r,duration:e.animationDuration||2e3,url:e.animationImage})}}return t},t.getPositions=u,t.getCoordinates=h,t.toGeoJSON=function(e){var t=h(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"LineString",coordinates:t}}},t.line2curve=function(e){if(!a)return e;var t=e.map(function(e){return s.cartesian2lonlat(e)}),i=t[t.length-1][2],n=a.lineString(t),r=a.bezierSpline(n);return s.lonlats2cartesians(r.geometry.coordinates,i)};var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=c(i(22)),s=c(i(2)),l=i(25);function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function u(e){return e._positions_draw&&0<e._positions_draw.length?e._positions_draw:e.polyline.positions.getValue(o.JulianDate.fromDate(new Date))}function h(e){var t=u(e);return s.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){e=e||{},null==t&&(t={});for(var i in e){var n=e[i];switch(i){default:t[i]=n;break;case"opacity":case"outlineOpacity":break;case"color":t.material=new a.Color.fromCssColorString(n||"#FFFF00").withAlpha(Number(e.opacity||1));break;case"outlineColor":t.outlineColor=new a.Color.fromCssColorString(n||e.color||"#FFFF00").withAlpha(e.outlineOpacity||e.opacity||1);break;case"extrudedHeight":var r=0;if(t.hierarchy){var o=l({polygon:t});r=(0,s.getMaxHeight)(o)}t.extrudedHeight=Number(n)+r;break;case"clampToGround":t.perPositionHeight=!n}}null==e.color&&(t.material=a.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:Number(e.opacity||1)}));return t},t.getPositions=l,t.getCoordinates=c,t.toGeoJSON=function(e){var t=c(e);0<t.length&&t.push(t[0]);return{type:"Feature",properties:e.attribute||{},geometry:{type:"Polygon",coordinates:[t]}}};var n,r=i(0),a=(n=r)&&n.__esModule?n:{default:n},o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2)),s=i(1);function l(e){var t=e.polygon.hierarchy.getValue(a.JulianDate.fromDate(new Date));return t&&t instanceof a.PolygonHierarchy?t.positions:t}function c(e){var t=l(e);return o.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Class=n;var o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2));function n(){}n.extend=function(e){function t(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()}var i=t.__super__=this.prototype,n=o.create(i);for(var r in(n.constructor=t).prototype=n,this)this.hasOwnProperty(r)&&"prototype"!==r&&"__super__"!==r&&(t[r]=this[r]);return e.statics&&(o.extend(t,e.statics),delete e.statics),e.includes&&(o.extend.apply(null,[n].concat(e.includes)),delete e.includes),n.options&&(e.options=o.extend(o.create(n.options),e.options)),o.extend(n,e),n._initHooks=[],n.callInitHooks=function(){if(!this._initHooksCalled){i.callInitHooks&&i.callInitHooks.call(this),this._initHooksCalled=!0;for(var e=0,t=n._initHooks.length;e<t;e++)n._initHooks[e].call(this)}},t},n.include=function(e){return o.extend(this.prototype,e),this},n.mergeOptions=function(e){return o.extend(this.prototype.options,e),this},n.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),i="function"==typeof e?e:function(){this[e].apply(this,t)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){e=e||{},null==t&&(t={scale:1,horizontalOrigin:o.HorizontalOrigin.CENTER,verticalOrigin:o.VerticalOrigin.BOTTOM});for(var i in e){var n=e[i];switch(i){default:t[i]=n;break;case"font_style":case"font_weight":case"font_size":case"font_family":case"scaleByDistance_near":case"scaleByDistance_nearValue":case"scaleByDistance_far":case"scaleByDistance_farValue":case"distanceDisplayCondition_far":case"distanceDisplayCondition_near":case"background_opacity":case"pixelOffsetY":break;case"text":t.text=n.replace(new RegExp("<br />","gm"),"\n");break;case"color":t.fillColor=new o.Color.fromCssColorString(n||"#ffffff").withAlpha(Number(e.opacity||1));break;case"border":t.style=n?o.LabelStyle.FILL_AND_OUTLINE:o.LabelStyle.FILL;break;case"border_color":t.outlineColor=new o.Color.fromCssColorString(n||"#000000").withAlpha(Number(e.opacity||1));break;case"border_width":t.outlineWidth=n;break;case"background":t.showBackground=n;break;case"background_color":t.backgroundColor=new o.Color.fromCssColorString(n||"#000000").withAlpha(Number(e.background_opacity||e.opacity||.5));break;case"pixelOffset":t.pixelOffset=new o.Cartesian2(e.pixelOffset[0],e.pixelOffset[1]);break;case"hasPixelOffset":n||(t.pixelOffset=new o.Cartesian2(0,0));break;case"pixelOffsetX":t.pixelOffset=new o.Cartesian2(n,e.pixelOffsetY);break;case"scaleByDistance":t.scaleByDistance=n?new o.NearFarScalar(Number(e.scaleByDistance_near||1e3),Number(e.scaleByDistance_nearValue||1),Number(e.scaleByDistance_far||1e6),Number(e.scaleByDistance_farValue||.1)):null;break;case"distanceDisplayCondition":t.distanceDisplayCondition=n?new o.DistanceDisplayCondition(Number(e.distanceDisplayCondition_near||0),Number(e.distanceDisplayCondition_far||1e5)):null;break;case"heightReference":switch(n){case"NONE":t.heightReference=o.HeightReference.NONE;break;case"CLAMP_TO_GROUND":t.heightReference=o.HeightReference.CLAMP_TO_GROUND;break;case"RELATIVE_TO_GROUND":t.heightReference=o.HeightReference.RELATIVE_TO_GROUND;break;default:t.heightReference=n}break;case"visibleDepth":t.disableDepthTestDistance=n?0:Number.POSITIVE_INFINITY}}var r=(e.font_style||"normal")+" small-caps "+(e.font_weight||"normal")+" "+(e.font_size||"25")+"px "+(e.font_family||"楷体");return t.font=r,t},t.getPositions=s,t.getCoordinates=l,t.toGeoJSON=function(e){var t=l(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"Point",coordinates:t[0]}}};var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2));function s(e){return[e.position.getValue(o.JulianDate.fromDate(new Date))]}function l(e){var t=s(e);return a.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditPolyline=void 0;var n,r=i(0),u=(n=r)&&n.__esModule?n:{default:n},h=a(i(6)),d=i(3),o=i(18),p=(a(i(2)),i(1));function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.EditPolyline=o.EditBase.extend({_positions_draw:[],getPosition:function(){return this._positions_draw},setPositions:function(e){this._positions_draw=e,this.updateAttrForEditing()},changePositionsToCallback:function(){this._positions_draw=this.entity._positions_draw||this.entity.polyline.positions.getValue(this.viewer.clock.currentTime)},finish:function(){this.entity._positions_draw=this.getPosition()},isClampToGround:function(){return this.entity.attribute.style.clampToGround},bindDraggers:function(){for(var n=this,r=this.isClampToGround(),o=this.getPosition(),a=o.length<this._maxPointNum,e=0,t=o.length;e<t;e++){var i=o[e];if(r&&(i=(0,p.updateHeightForClampToGround)(this.viewer,i),o[e]=i),(l=h.createDragger(this.dataSource,{position:i,onDrag:function(e,t){if(o[e.index]=t,a){if(0<e.index){var i=u.Cartesian3.midpoint(t,o[e.index-1],new u.Cartesian3);r&&(i=(0,p.updateHeightForClampToGround)(n.viewer,i)),n.draggers[2*e.index-1].position=i}if(e.index<o.length-1){i=u.Cartesian3.midpoint(t,o[e.index+1],new u.Cartesian3);r&&(i=(0,p.updateHeightForClampToGround)(n.viewer,i)),n.draggers[2*e.index+1].position=i}}}})).index=e,this.draggers.push(l),a){var s=e+1;if(s<t){var l,c=u.Cartesian3.midpoint(i,o[s],new u.Cartesian3);r&&(c=(0,p.updateHeightForClampToGround)(this.viewer,c)),(l=h.createDragger(this.dataSource,{position:c,type:h.PointType.AddMidPoint,tooltip:d.message.dragger.addMidPoint,onDragStart:function(e,t){o.splice(e.index,0,t)},onDrag:function(e,t){o[e.index]=t},onDragEnd:function(){n.updateDraggers()}})).index=s,this.draggers.push(l)}}}}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){e=e||{},null==t&&(t={scale:1,horizontalOrigin:o.HorizontalOrigin.CENTER,verticalOrigin:o.VerticalOrigin.BOTTOM});for(var i in e){var n=e[i];switch(i){default:t[i]=n;break;case"scaleByDistance_near":case"scaleByDistance_nearValue":case"scaleByDistance_far":case"scaleByDistance_farValue":case"distanceDisplayCondition_far":case"distanceDisplayCondition_near":break;case"opacity":t.color=new o.Color.fromCssColorString("#FFFFFF").withAlpha(Number(n||1));break;case"rotation":t.rotation=o.Math.toRadians(n);break;case"scaleByDistance":t.scaleByDistance=n?new o.NearFarScalar(Number(e.scaleByDistance_near||1e3),Number(e.scaleByDistance_nearValue||1),Number(e.scaleByDistance_far||1e6),Number(e.scaleByDistance_farValue||.1)):null;break;case"distanceDisplayCondition":t.distanceDisplayCondition=n?new o.DistanceDisplayCondition(Number(e.distanceDisplayCondition_near||0),Number(e.distanceDisplayCondition_far||1e5)):null;break;case"heightReference":switch(n){case"NONE":t.heightReference=o.HeightReference.NONE;break;case"CLAMP_TO_GROUND":t.heightReference=o.HeightReference.CLAMP_TO_GROUND;break;case"RELATIVE_TO_GROUND":t.heightReference=o.HeightReference.RELATIVE_TO_GROUND;break;default:t.heightReference=n}break;case"visibleDepth":t.disableDepthTestDistance=n?0:Number.POSITIVE_INFINITY}}return t},t.getPositions=s,t.getCoordinates=l,t.toGeoJSON=function(e){var t=l(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"Point",coordinates:t[0]}}};var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2));function s(e){return[e.position.getValue(o.JulianDate.fromDate(new Date))]}function l(e){var t=s(e);return a.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Draw=void 0;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=i(51),s=i(3),d=E(i(4)),p=E(i(2)),l=E(i(7)),c=i(17),u=i(53),h=i(54),f=i(55),m=i(8),g=i(56),v=i(58),y=i(60),_=i(63),w=i(64),b=i(66),C=i(68),x=i(70),P=i(72);function E(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}var M=t.Draw=a.Evented.extend({dataSource:null,primitives:null,drawCtrl:null,initialize:function(e,t){this.viewer=e,this.options=t||{},this.dataSource=new o.CustomDataSource,this.viewer.dataSources.add(this.dataSource),this.primitives=new o.PrimitiveCollection,this.viewer.scene.primitives.add(this.primitives),o.defaultValue(this.options.removeScreenSpaceEvent,!0)&&(this.viewer.screenSpaceEventHandler.removeInputAction(o.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.viewer.screenSpaceEventHandler.removeInputAction(o.ScreenSpaceEventType.LEFT_CLICK)),this.tooltip=new s.Tooltip(this.viewer.container),this.hasEdit(o.defaultValue(this.options.hasEdit,!0));var i={viewer:this.viewer,dataSource:this.dataSource,primitives:this.primitives,tooltip:this.tooltip};this.drawCtrl={},this.drawCtrl.point=new c.DrawPoint(i),this.drawCtrl.billboard=new u.DrawBillboard(i),this.drawCtrl.label=new h.DrawLabel(i),this.drawCtrl.model=new f.DrawModel(i),this.drawCtrl.polyline=new m.DrawPolyline(i),this.drawCtrl.curve=new g.DrawCurve(i),this.drawCtrl.polylineVolume=new v.DrawPolylineVolume(i),this.drawCtrl.corridor=new y.DrawCorridor(i),this.drawCtrl.polygon=new _.DrawPolygon(i),this.drawCtrl.rectangle=new w.DrawRectangle(i),this.drawCtrl.ellipse=new b.DrawCircle(i),this.drawCtrl.circle=this.drawCtrl.ellipse,this.drawCtrl.ellipsoid=new C.DrawEllipsoid(i),this.drawCtrl.wall=new x.DrawWall(i),this.drawCtrl["model-p"]=new P.DrawPModel(i);var n=this;for(var r in this.drawCtrl)this.drawCtrl[r]._fire=function(e,t,i){n.fire(e,t,i)};this.on(l.DrawCreated,function(e){this.startEditing(e.entity)},this)},startDraw:function(e){if("string"==typeof e)e={type:e};else if(null==e||null==e.type)return void console.error("需要传入指定绘制的type类型！");var t=e.type;if(null!=this.drawCtrl[t]){var i;e.success&&(i=e.success,delete e.success),e=p.addGeoJsonDefVal(e),this.stopDraw();var n=this.drawCtrl[t].activate(e,i);return this.bindDeleteContextmenu(n),n}console.error("不能进行type为【"+t+"】的绘制，无该类型！")},stopDraw:function(){for(var e in this.stopEditing(),this.drawCtrl)this.drawCtrl[e].disable(!0)},clearDraw:function(){this.stopDraw(),this.dataSource.entities.removeAll(),this.primitives.removeAll()},currEditFeature:null,getCurrentEntity:function(){return this.currEditFeature},_hasEdit:null,hasEdit:function(e){null!==this._hasEdit&&this._hasEdit===e||((this._hasEdit=e)?this.bindSelectEvent():(this.stopEditing(),this.destroySelectEvent()))},bindSelectEvent:function(){var r=this,e=new o.ScreenSpaceEventHandler(this.viewer.scene.canvas);e.setInputAction(function(e){var t=r.viewer.scene.pick(e.position);if(o.defined(t)){var i=t.id||t.primitive.id||t.primitive;if(i&&r.isMyEntity(i)){if(r.currEditFeature&&r.currEditFeature===i)return;if(!o.defaultValue(i.inProgress,!1))return void r.startEditing(i)}}r.stopEditing()},o.ScreenSpaceEventType.LEFT_CLICK),e.setInputAction(function(e){if(r._hasEdit){r.tooltip.setVisible(!1);var t=r.viewer.scene.pick(e.endPosition);if(o.defined(t)){var i=t.id||t.primitive.id||t.primitive;if(i&&i.editing&&!o.defaultValue(i.inProgress,!1)&&r.isMyEntity(i)){var n=r.tooltip;setTimeout(function(){n.showAt(e.endPosition,s.message.edit.start)},100)}}}},o.ScreenSpaceEventType.MOUSE_MOVE),this.selectHandler=e},destroySelectEvent:function(){this.selectHandler&&this.selectHandler.destroy(),this.selectHandler=void 0},startEditing:function(e){this.stopEditing(),null!=e&&this._hasEdit&&(e.editing&&e.editing.activate&&e.editing.activate(),this.currEditFeature=e)},stopEditing:function(){this.currEditFeature&&this.currEditFeature.editing&&this.currEditFeature.editing.disable&&this.currEditFeature.editing.disable(),this.currEditFeature=null},updateAttribute:function(e,t){if(null==t&&(t=this.currEditFeature),null!=t&&null!=e){e.style=e.style||{},e.attr=e.attr||{};var i=t.attribute.type;if(this.drawCtrl[i].style2Entity(e.style,t),t.attribute=e,t.editing&&(t.editing.updateAttrForEditing&&t.editing.updateAttrForEditing(),t.editing.updateDraggers&&t.editing.updateDraggers()),this.options.nameTooltip){var n=this;t.attribute.attr&&t.attribute.attr.name?t.tooltip={html:t.attribute.attr.name,check:function(){return!n._hasEdit}}:t.tooltip=null}return t}},setPositions:function(e,t){if(null==t&&(t=this.currEditFeature),null!=t&&null!=e)return t.editing&&(t.editing.setPositions(e),t.editing.updateDraggers()),t},bindDeleteContextmenu:function(e){var i=this;e.contextmenuItems=[{text:"删除对象",iconCls:"fa fa-trash-o",visible:function(){return i._hasEdit},calback:function(e){var t=e.target;t.editing&&t.editing.disable&&t.editing.disable(),i.deleteEntity(t)}}]},deleteEntity:function(e){null==e&&(e=this.currEditFeature),null!=e&&(e.editing&&e.editing.disable(),this.dataSource.entities.contains(e)&&this.dataSource.entities.remove(e),this.primitives.contains(e)&&this.primitives.remove(e))},isMyEntity:function(e){return!!this.dataSource.entities.contains(e)||!!this.primitives.contains(e)},deleteAll:function(){this.clearDraw()},toGeoJSON:function(e){if(this.stopDraw(),null==e){var t=this.getEntitys();if(0==t.length)return null;for(var i=[],n=0,r=t.length;n<r;n++){if(null!=(e=t[n]).attribute&&null!=e.attribute.type){var o=e.attribute.type;null!=(a=this.drawCtrl[o].toGeoJSON(e))&&(a=p.removeGeoJsonDefVal(a),i.push(a))}}return 0<i.length?{type:"FeatureCollection",features:i}:null}o=e.attribute.type;var a=this.drawCtrl[o].toGeoJSON(e);return a=p.removeGeoJsonDefVal(a)},jsonToEntity:function(e,t,i){var n=e;try{d.isString(e)&&(n=JSON.parse(e))}catch(e){return void d.alert(e.name+": "+e.message+" \n请确认json文件格式正确!!!")}t&&this.clearDraw();for(var r=[],o=n.features?n.features:[n],a=0,s=o.length;a<s;a++){var l=o[a];if(!l.properties||!l.properties.type)switch(l.properties=l.properties||{},l.geometry.type){case"MultiPolygon":case"Polygon":l.properties.type="polygon";break;case"MultiLineString":case"LineString":l.properties.type="polyline";break;case"MultiPoint":case"Point":l.properties.type="point"}var c=l.properties.type;if(null!=this.drawCtrl[c]){l.properties.style=l.properties.style||{},l.properties=p.addGeoJsonDefVal(l.properties);var u=this.drawCtrl[c].jsonToEntity(l);if(this.bindDeleteContextmenu(u),this.options.nameTooltip)if(u.attribute.attr&&u.attribute.attr.name){var h=this;u.tooltip={html:u.attribute.attr.name,check:function(){return!h._hasEdit}}}else u.tooltip=null;r.push(u)}else console.log("数据无法识别或者数据的["+c+"]类型参数有误")}return i&&this.viewer.flyTo(r),r},attributeToEntity:function(e,t){return this.drawCtrl[e.type].attributeToEntity(e,t)},bindExtraEntity:function(e,t){e=this.drawCtrl[t.type].attributeToEntity(e,t);this.dataSource.entities.add(e)},_visible:!0,setVisible:function(e){(this._visible=e)?(this.viewer.dataSources.contains(this.dataSource)||this.viewer.dataSources.add(this.dataSource),this.viewer.scene.primitives.contains(this.primitives)||this.viewer.scene.primitives.add(this.primitives)):(this.stopDraw(),this.viewer.dataSources.contains(this.dataSource)&&this.viewer.dataSources.remove(this.dataSource,!1),this.viewer.scene.primitives.contains(this.dataSource)&&this.viewer.scene.primitives.remove(this.primitives))},hasDraw:function(){return 0<this.getEntitys().length},getEntitys:function(){this.stopDraw();var e=this.dataSource.entities.values;return e=e.concat(this.primitives._primitives)},getDataSource:function(){return this.dataSource},getEntityById:function(e){for(var t=this.getEntitys(),i=0,n=t.length;i<n;i++){var r=t[i];if(e==r.attribute.attr.id)return r}return null},getCoordinates:function(e){var t=e.attribute.type;return this.drawCtrl[t].getCoordinates(e)},getPositions:function(e){var t=e.attribute.type;return this.drawCtrl[t].getPositions(e)},destroy:function(){this.stopDraw(),this.hasEdit(!1),this.clearDraw(),this.viewer.dataSources.contains(this.dataSource)&&this.viewer.dataSources.remove(this.dataSource,!0)}});M.Point=c.DrawPoint,M.Billboard=u.DrawBillboard,M.Label=h.DrawLabel,M.Model=f.DrawModel,M.Polyline=m.DrawPolyline,M.Curve=g.DrawCurve,M.PolylineVolume=v.DrawPolylineVolume,M.Polygon=_.DrawPolygon,M.Rectangle=w.DrawRectangle,M.Circle=b.DrawCircle,M.Ellipsoid=C.DrawEllipsoid,M.Wall=x.DrawWall},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawPoint=void 0;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=i(21),s=i(1),l=d(i(23)),c=i(3),u=d(i(7)),h=i(52);function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.DrawPoint=a.DrawBase.extend({type:"point",createFeature:function(e){this._positions_draw=null;var t=this,i={show:!1,position:new o.CallbackProperty(function(e){return t.getDrawPosition()},!1),point:l.style2Entity(e.style),attribute:e};return this.entity=this.dataSource.entities.add(i),this.entity},style2Entity:function(e,t){return l.style2Entity(e,t.point)},bindEvent:function(){var i=this;this.getHandler().setInputAction(function(e){var t=(0,s.getCurrentMousePosition)(i.viewer.scene,e.endPosition,i.entity);t&&(i._positions_draw=t),i.tooltip.showAt(e.endPosition,c.message.draw.point.start),i.fire(u.DrawMouseMove,{drawtype:i.type,entity:i.entity,position:t})},o.ScreenSpaceEventType.MOUSE_MOVE),this.getHandler().setInputAction(function(e){var t=(0,s.getCurrentMousePosition)(i.viewer.scene,e.position,i.entity);t&&(i._positions_draw=t,i.disable())},o.ScreenSpaceEventType.LEFT_CLICK)},getEditClass:function(e){var t=new h.EditPoint(e,this.viewer,this.dataSource);return this._bindEdit(t)},getAttrClass:function(){return l},finish:function(){this.entity.show=!0,this.entity.editing=this.getEditClass(this.entity),this.entity.position=this.getDrawPosition()}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditBase=void 0;var n,r=i(0),m=(n=r)&&n.__esModule?n:{default:n},o=i(12),a=l(i(7)),g=l(i(6)),v=i(3),s=l(i(2)),y=i(1);function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.EditBase=o.Class.extend({_dataSource:null,_minPointNum:1,_maxPointNum:9999,initialize:function(e,t,i){this.entity=e,this.viewer=t,this.dataSource=i,this.draggers=[]},fire:function(e,t,i){this._fire&&this._fire(e,t,i)},formatNum:function(e,t){return s.formatNum(e,t)},setCursor:function(e){this.viewer._container.style.cursor=e?"crosshair":""},activate:function(){return this._enabled||(this._enabled=!0,this.entity.inProgress=!0,this.changePositionsToCallback(),this.bindDraggers(),this.bindEvent(),this.fire(a.EditStart,{edittype:this.entity.attribute.type,entity:this.entity})),this},disable:function(){return this._enabled&&(this._enabled=!1,this.destroyEvent(),this.destroyDraggers(),this.finish(),this.entity.inProgress=!1,this.fire(a.EditStop,{edittype:this.entity.attribute.type,entity:this.entity}),this.tooltip.setVisible(!1)),this},changePositionsToCallback:function(){},finish:function(){},bindEvent:function(){var h=this,d=new m.BoundingSphere,p=new m.Cartesian3,f=new m.ScreenSpaceEventHandler(this.viewer.canvas);f.dragger=null,f.setInputAction(function(e){var t=h.viewer.scene.pick(e.position);if(m.defined(t)){var i=t.id||t.primitive.id||t.primitive;if(i&&m.defaultValue(i._isDragger,!1)&&(h.viewer.scene.screenSpaceCameraController.enableRotate=!1,h.viewer.scene.screenSpaceCameraController.enableTilt=!1,h.viewer.scene.screenSpaceCameraController.enableTranslate=!1,h.viewer.scene.screenSpaceCameraController.enableInputs=!1,h.viewer.gsp&&h.viewer.gsp.popup.close(i),f.dragger=i,f.dragger.point&&(f.dragger.show=!1),h.setCursor(!0),f.dragger.onDragStart)){var n=f.dragger.position;n&&n.getValue&&(n=n.getValue(h.viewer.clock.currentTime)),f.dragger.onDragStart(f.dragger,n)}}},m.ScreenSpaceEventType.LEFT_DOWN),f.setInputAction(function(e){var t=f.dragger;if(t)switch(t._pointType){case g.PointType.MoveHeight:var i=e.endPosition.y-e.startPosition.y,n=t.position;n&&n.getValue&&(n=n.getValue(h.viewer.clock.currentTime));var r=new m.EllipsoidTangentPlane(n);d.center=n,d.radius=1;var o=1.5*h.viewer.scene.frameState.camera.getPixelSize(d,h.viewer.scene.frameState.context.drawingBufferWidth,h.viewer.scene.frameState.context.drawingBufferHeight);m.Cartesian3.multiplyByScalar(r.zAxis,-i*o,p);var a=m.Cartesian3.clone(n);m.Cartesian3.add(n,p,a),t.position=a,t.onDrag&&t.onDrag(t,a,n),h.updateAttrForEditing();break;default:h.tooltip.showAt(e.endPosition,v.message.edit.end);var s=(0,y.getCurrentMousePosition)(h.viewer.scene,e.endPosition,h.entity);s&&(t.position=s,t.onDrag&&t.onDrag(t,s),h.updateAttrForEditing())}else{h.tooltip.setVisible(!1);var l=h.viewer.scene.pick(e.endPosition);if(m.defined(l)){var c=l.id;if(c&&m.defaultValue(c._isDragger,!1)&&c.draw_tooltip){var u=c.draw_tooltip;g.PointType.Control==c._pointType&&h._positions_draw&&h._positions_draw.length&&h._positions_draw.length>h._minPointNum&&(u+=v.message.del.def),h.tooltip.showAt(e.endPosition,u)}}}},m.ScreenSpaceEventType.MOUSE_MOVE),f.setInputAction(function(e){var t=f.dragger;if(t){h.setCursor(!1),t.show=!0;var i=t.position;i&&i.getValue&&(i=i.getValue(h.viewer.clock.currentTime)),t.onDragEnd&&t.onDragEnd(t,i),h.fire(a.EditMovePoint,{edittype:h.entity.attribute.type,entity:h.entity,position:i}),f.dragger=null,h.viewer.scene.screenSpaceCameraController.enableRotate=!0,h.viewer.scene.screenSpaceCameraController.enableTilt=!0,h.viewer.scene.screenSpaceCameraController.enableTranslate=!0,h.viewer.scene.screenSpaceCameraController.enableInputs=!0}},m.ScreenSpaceEventType.LEFT_UP),f.setInputAction(function(e){var t=h.viewer.scene.pick(e.position);if(m.defined(t)){var i=t.id;if(i&&m.defaultValue(i._isDragger,!1)&&g.PointType.Control==i._pointType)h.deletePointForDragger(i,e.position)&&h.fire(a.EditRemovePoint,{edittype:h.entity.attribute.type,entity:h.entity})}},m.ScreenSpaceEventType.RIGHT_CLICK),this.draggerHandler=f},destroyEvent:function(){this.viewer.scene.screenSpaceCameraController.enableRotate=!0,this.viewer.scene.screenSpaceCameraController.enableTilt=!0,this.viewer.scene.screenSpaceCameraController.enableTranslate=!0,this.viewer.scene.screenSpaceCameraController.enableInputs=!0,this.setCursor(!1),this.draggerHandler&&(this.draggerHandler.dragger&&(this.draggerHandler.dragger.show=!0),this.draggerHandler.destroy(),this.draggerHandler=null)},bindDraggers:function(){},updateDraggers:function(){if(!this._enabled)return this;this.destroyDraggers(),this.bindDraggers()},destroyDraggers:function(){for(var e=0,t=this.draggers.length;e<t;e++)this.dataSource.entities.remove(this.draggers[e]);this.draggers=[]},deletePointForDragger:function(e,t){if(this._positions_draw.length-1<this._minPointNum)return this.tooltip.showAt(t,v.message.del.min+this._minPointNum),!1;var i=e.index;return 0<i&&i<this._positions_draw.length&&(this._positions_draw.splice(i,1),this.updateDraggers(),!0)},updateAttrForEditing:function(){}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bd2gcj=n,t.gcj2bd=r,t.wgs2gcj=o,t.gcj2wgs=a,t.bd2wgs=function(e){return a(n(e))},t.wgs2bd=function(e){return r(o(e))},t.jwd2mct=function(e){var t=Number(e[0]),i=Number(e[1]),n=20037508.34*t/180,r=Math.log(Math.tan((90+i)*u/360))/(u/180);return r=20037508.34*r/180,n=Number(n.toFixed(2)),r=Number(r.toFixed(2)),[n,r]},t.mct2jwd=function(e){var t=Number(e[0]),i=Number(e[1]),n=t/20037508.34*180,r=i/20037508.34*180;return r=180/u*(2*Math.atan(Math.exp(r*u/180))-u/2),n=Number(n.toFixed(6)),r=Number(r.toFixed(6)),[n,r]};var s=52.35987755982988,u=3.141592653589793,h=6378245,d=.006693421622965943;function p(e,t){var i=2*e-100+3*t+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return i+=2*(20*Math.sin(6*e*u)+20*Math.sin(2*e*u))/3,i+=2*(20*Math.sin(t*u)+40*Math.sin(t/3*u))/3,i+=2*(160*Math.sin(t/12*u)+320*Math.sin(t*u/30))/3}function f(e,t){var i=300+e+2*t+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e));return i+=2*(20*Math.sin(6*e*u)+20*Math.sin(2*e*u))/3,i+=2*(20*Math.sin(e*u)+40*Math.sin(e/3*u))/3,i+=2*(150*Math.sin(e/12*u)+300*Math.sin(e/30*u))/3}function m(e,t){return e<72.004||137.8347<e||t<.8293||55.8271<t}function n(e){var t=52.35987755982988,i=Number(e[0])-.0065,n=Number(e[1])-.006,r=Math.sqrt(i*i+n*n)-2e-5*Math.sin(n*t),o=Math.atan2(n,i)-3e-6*Math.cos(i*t),a=r*Math.cos(o),s=r*Math.sin(o);return[a=Number(a.toFixed(6)),s=Number(s.toFixed(6))]}function r(e){var t=Number(e[0]),i=Number(e[1]),n=Math.sqrt(t*t+i*i)+2e-5*Math.sin(i*s),r=Math.atan2(i,t)+3e-6*Math.cos(t*s),o=n*Math.cos(r)+.0065,a=n*Math.sin(r)+.006;return[o=Number(o.toFixed(6)),a=Number(a.toFixed(6))]}function o(e){var t=Number(e[0]),i=Number(e[1]);if(m(t,i))return[t,i];var n=p(t-105,i-35),r=f(t-105,i-35),o=i/180*u,a=Math.sin(o);a=1-d*a*a;var s=Math.sqrt(a),l=i+(n=180*n/(h*(1-d)/(a*s)*u)),c=t+(r=180*r/(h/s*Math.cos(o)*u));return[c=Number(c.toFixed(6)),l=Number(l.toFixed(6))]}function a(e){var t=Number(e[0]),i=Number(e[1]);if(m(t,i))return[t,i];var n=p(t-105,i-35),r=f(t-105,i-35),o=i/180*u,a=Math.sin(o);a=1-d*a*a;var s=Math.sqrt(a);n=180*n/(h*(1-d)/(a*s)*u);var l=2*t-(t+(r=180*r/(h/s*Math.cos(o)*u))),c=2*i-(i+n);return[l=Number(l.toFixed(6)),c=Number(c.toFixed(6))]}},function(e,t,i){"use strict";var n,r=i(0),f=(n=r)&&n.__esModule?n:{default:n},m=i(4),o=i(9),l=i(77),c=i(41),u=i(78),h=i(42),d=i(80),p=i(28),g=i(81),v=i(82),y=i(83),_=i(84),w=i(85),b=i(86),C=i(87),x=i(88);t.BaseLayer=o.BaseLayer,t.GroupLayer=l.GroupLayer,t.TileLayer=c.TileLayer,t.GraticuleLayer=u.GraticuleLayer,t.CustomFeatureGridLayer=h.CustomFeatureGridLayer,t.POILayer=d.POILayer,t.GeoJsonLayer=p.GeoJsonLayer,t.GltfLayer=g.GltfLayer,t.Tiles3dLayer=v.Tiles3dLayer,t.KmlLayer=y.KmlLayer,t.CzmlLayer=_.CzmlLayer,t.TerrainLayer=w.TerrainLayer,t.DrawLayer=b.DrawLayer;var P={};t.regLayerForConfig=function(e,t){P[e]=t},t.createLayer=function e(t,i,n){var r;switch(t.url&&(n&&(t.url=t.url.replace("$serverURL$",n)),t.url=t.url.replace("$hostname$",location.hostname).replace("$host$",location.host)),t.type){case"group":if(t.layers&&0<t.layers.length){for(var o=[],a=0;a<t.layers.length;a++){var s=e(t.layers[a],i,n);null!=s&&o.push(s)}t._layers=o,r=new l.GroupLayer(t,i)}break;case"www_bing":case"www_osm":case"www_google":case"www_gaode":case"www_baidu":case"www_tdt":case"mapbox":case"www_mapbox":case"arcgis_cache":case"arcgis":case"arcgis_tile":case"arcgis_dynamic":case"wmts":case"tms":case"wms":case"xyz":case"tile":case"single":case"image":case"gee":case"custom_tilecoord":case"custom_grid":(r=new c.TileLayer(t,i)).isTile=!0;break;case"www_poi":r=new d.POILayer(t,i);break;case"custom_featuregrid":r=new h.CustomFeatureGridLayer(t,i);break;case"custom_graticule":r=new u.GraticuleLayer(t,i);break;case"3dtiles":r=new v.Tiles3dLayer(t,i);break;case"gltf":r=new g.GltfLayer(t,i);break;case"geojson":r=new p.GeoJsonLayer(t,i);break;case"geojson-draw":r=new b.DrawLayer(t,i);break;case"kml":r=new y.KmlLayer(t,i);break;case"czml":r=new _.CzmlLayer(t,i);break;case"terrain":r=new w.TerrainLayer(t,i);break;default:if(P[t.type]&&(r=new P[t.type](t,i)),null==r)try{console.log("配置中的图层未处理："+JSON.stringify(t))}catch(e){}}return null!==r&&(t._layer=r),r},t.createImageryProvider=function(e,t){e.url&&(t&&(e.url=e.url.replace("$serverURL$",t)),e.url=e.url.replace("$hostname$",location.hostname).replace("$host$",location.host));var i,n,r,o={};for(var a in e){var s=e[a];if(null!=s)switch(a){default:o[a]=s;break;case"crs":"4326"==s||"EPSG4326"==s.toUpperCase()||"EPSG:4326"==s.toUpperCase()?o.tilingScheme=new f.GeographicTilingScheme({numberOfLevelZeroTilesX:e.numberOfLevelZeroTilesX||2,numberOfLevelZeroTilesY:e.numberOfLevelZeroTilesY||1}):o.tilingScheme=new f.WebMercatorTilingScheme({numberOfLevelZeroTilesX:e.numberOfLevelZeroTilesX||1,numberOfLevelZeroTilesY:e.numberOfLevelZeroTilesY||1});break;case"rectangle":o.rectangle=f.Rectangle.fromDegrees(s.xmin,s.ymin,s.xmax,s.ymax)}}switch(o.url&&o.proxy&&(o=(0,m.getProxyUrl)(o)),o.type_new||o.type){case"single":case"image":i=new f.SingleTileImageryProvider(o);break;case"xyz":case"tile":o.customTags={"z&1":function(e,t,i,n){return n+1}},i=new f.UrlTemplateImageryProvider(o);break;case"wms":i=new f.WebMapServiceImageryProvider(o);break;case"tms":o.url||(o.url=f.buildModuleUrl("Assets/Textures/NaturalEarthII")),i=new f.createTileMapServiceImageryProvider(o);break;case"wmts":i=new f.WebMapTileServiceImageryProvider(o);break;case"gee":i=new f.GoogleEarthEnterpriseImageryProvider({metadata:new f.GoogleEarthEnterpriseMetadata(o)});break;case"mapbox":case"www_mapbox":i=new f.MapboxImageryProvider(o);break;case"arcgis":case"arcgis_tile":case"arcgis_dynamic":i=new f.ArcGisMapServerImageryProvider(o);break;case"arcgis_cache":f.UrlTemplateImageryProvider.prototype.padLeft0||(f.UrlTemplateImageryProvider.prototype.padLeft0=function(e,t){for(var i=(e=String(e)).length;i<t;)e="0"+e,i++;return e}),o.customTags={arc_x:function(e,t){return e.padLeft0(t.toString(16),8)},arc_y:function(e,t,i){return e.padLeft0(i.toString(16),8)},arc_z:function(e,t,i,n){return e.padLeft0(n.toString(),2)},arc_X:function(e,t){return e.padLeft0(t.toString(16),8).toUpperCase()},arc_Y:function(e,t,i){return e.padLeft0(i.toString(16),8).toUpperCase()},arc_Z:function(e,t,i,n){return e.padLeft0(n.toString(),2).toUpperCase()}},i=new f.UrlTemplateImageryProvider(o);break;case"www_tdt":var l,c;switch(o.layer){default:case"vec_d":l="vec";break;case"vec_z":l="cva";break;case"img_d":l="img";break;case"img_z":l="cia";break;case"ter_d":l="ter";break;case"ter_z":l="cta"}c=null==o.key||0==o.key.length?"87949882c75775b5069a0076357b7530":(n=o.key,r=Math.floor(Math.random()*n.length+1)-1,n[r]);if("4326"==e.crs){for(var u=new Array(18),h=0;h<=18;h++)u[h]=(h+1).toString();var d="http://t{s}.tianditu.gov.cn/"+l+"_c/wmts?service=WMTS&version=1.0.0&request=GetTile&tilematrix={TileMatrix}&layer="+l+"&style={style}&tilerow={TileRow}&tilecol={TileCol}&tilematrixset={TileMatrixSet}&format=tiles&tk="+c;i=new f.WebMapTileServiceImageryProvider({url:o.proxy?new f.Resource({url:d,proxy:o.proxy}):d,layer:l,style:"default",format:"tiles",tileMatrixSetID:"c",subdomains:["0","1","2","3","4","5","6","7"],tileMatrixLabels:u,tilingScheme:new f.GeographicTilingScheme,maximumLevel:18})}else{for(u=new Array(18),h=0;h<=18;h++)u[h]=h.toString();d="http://t{s}.tianditu.gov.cn/"+l+"_w/wmts?service=WMTS&version=1.0.0&request=GetTile&tilematrix={TileMatrix}&layer="+l+"&style={style}&tilerow={TileRow}&tilecol={TileCol}&tilematrixset={TileMatrixSet}&format=tiles&tk="+c;i=new f.WebMapTileServiceImageryProvider({url:o.proxy?new f.Resource({url:d.replace("{s}","0"),proxy:o.proxy}):d,layer:l,style:"default",format:"tiles",tileMatrixSetID:"w",subdomains:["0","1","2","3","4","5","6","7"],tileMatrixLabels:u,tilingScheme:new f.WebMercatorTilingScheme,maximumLevel:18})}break;case"www_gaode":switch(o.layer){case"vec":default:d="http://"+(o.bigfont?"wprd":"webrd")+"0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}";break;case"img_d":d="http://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}";break;case"img_z":d="http://webst0{s}.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scale=1&style=8";break;case"time":d="http://tm.amap.com/trafficengine/mapabc/traffictile?v=1.0&;t=1&x={x}&y={y}&z={z}&&t="+(new Date).getTime()}i=new f.UrlTemplateImageryProvider({url:o.proxy?new f.Resource({url:d,proxy:o.proxy}):d,subdomains:["1","2","3","4"],maximumLevel:18});break;case"www_baidu":i=new C.BaiduImageryProvider(o);break;case"www_google":if("4326"==e.crs||"wgs84"==e.crs)o.layer,d="http://www.google.cn/maps/vt?lyrs=s&x={x}&y={y}&z={z}";else switch(o.layer){case"vec":default:d="http://mt{s}.google.cn/vt/lyrs=m@207000000&hl=zh-CN&gl=CN&src=app&x={x}&y={y}&z={z}&s=Galile";break;case"img_d":d="http://mt{s}.google.cn/vt/lyrs=s&hl=zh-CN&gl=CN&x={x}&y={y}&z={z}&s=Gali";break;case"img_z":d="http://mt{s}.google.cn/vt/imgtp=png32&lyrs=h@207000000&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}&s=Galil";break;case"ter":d="http://mt{s}.google.cn/vt/lyrs=t@131,r@227000000&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}&s=Galile"}i=new f.UrlTemplateImageryProvider({url:o.proxy?new f.Resource({url:d,proxy:o.proxy}):d,subdomains:["1","2","3"],maximumLevel:20});break;case"www_osm":d="http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";i=new f.UrlTemplateImageryProvider({url:o.proxy?new f.Resource({url:d,proxy:o.proxy}):d,subdomains:"abc",maximumLevel:18});break;case"www_bing":d="https://dev.virtualearth.net";var p=o.layer||f.BingMapsStyle.Aerial;i=new f.BingMapsImageryProvider({url:o.proxy?new f.Resource({url:d,proxy:o.proxy}):d,key:o.key||"AtkX3zhnRe5fyGuLU30uZw8r3sxdBDnpQly7KfFTCB2rGlDgXBG3yr-qEiQEicEc",mapStyle:p});break;case"custom_grid":o.cells=o.cells||2,o.color=f.Color.fromCssColorString(o.color||"rgba(255,255,255,0.5)"),o.glowWidth=o.glowWidth||3,o.glowColor=f.Color.fromCssColorString(o.glowColor||"rgba(255,255,255,0.1)"),o.backgroundColor=f.Color.fromCssColorString(o.backgroundColor||"rgba(0,0,0,0)"),i=new f.GridImageryProvider(o);break;case"custom_tilecoord":i=new f.TileCoordinatesImageryProvider(o);break;case"custom_featuregrid":i=new x.FeatureGridImageryProvider(o);break;default:console.log("config配置图层未处理:"+e)}return i.config=o,i}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawBase=void 0;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=(i(1),i(12)),s=c(i(2)),l=c(i(7));function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.DrawBase=a.Class.extend({type:null,dataSource:null,initialize:function(e){this.viewer=e.viewer,this.dataSource=e.dataSource,this.primitives=e.primitives,this.dataSource||(this.dataSource=new o.CustomDataSource,this.viewer.dataSources.add(this.dataSource)),this.tooltip=e.tooltip||new Tooltip(this.viewer.container)},fire:function(e,t,i){this._fire&&this._fire(e,t,i)},formatNum:function(e,t){return s.formatNum(e,t)},activate:function(e,t){return this._enabled?this:(this._enabled=!0,this.drawOkCalback=t,this.createFeature(e),this.entity.inProgress=!0,this.setCursor(!0),this.bindEvent(),this.fire(l.DrawStart,{drawtype:this.type,entity:this.entity}),this.entity)},disable:function(e){return this._enabled&&(this._enabled=!1,this.setCursor(!1),e&&this.entity.inProgress?(this.dataSource&&this.dataSource.entities.contains(this.entity)&&this.dataSource.entities.remove(this.entity),this.primitives&&this.primitives.contains(this.entity)&&this.primitives.remove(this.entity)):(this.entity.inProgress=!1,this.finish(),this.drawOkCalback&&(this.drawOkCalback(this.entity),delete this.drawOkCalback),this.fire(l.DrawCreated,{drawtype:this.type,entity:this.entity})),this.destroyHandler(),this._positions_draw=null,this.entity=null,this.tooltip.setVisible(!1)),this},createFeature:function(){},getHandler:function(){return this.handler&&!this.handler.isDestroyed()||(this.handler=new o.ScreenSpaceEventHandler(this.viewer.scene.canvas)),this.handler},destroyHandler:function(){this.handler&&this.handler.destroy(),this.handler=void 0},setCursor:function(e){this.viewer._container.style.cursor=e?"crosshair":""},bindEvent:function(){},_positions_draw:null,getDrawPosition:function(){return this._positions_draw},_bindEdit:function(e){return e._fire=this._fire,e.tooltip=this.tooltip,e},updateAttrForDrawing:function(){},finish:function(){},getCoordinates:function(e){return this.getAttrClass().getCoordinates(e)},getPositions:function(e){return this.getAttrClass().getPositions(e)},toGeoJSON:function(e){return this.getAttrClass().toGeoJSON(e)},attributeToEntity:function(e,t){var i=this.createFeature(e);return this._positions_draw=t,this.updateAttrForDrawing(!0),this.finish(),i},jsonToEntity:function(e){var t=e.properties,i=s.getPositionByGeoJSON(e);return this.attributeToEntity(t,i)},bindExtraEntity:function(e,t){return t&&t.style&&this.style2Entity(t.style,e),this._positions_draw=this.getPositions(e),this.updateAttrForDrawing(!0),this.finish(),e}})},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_22__},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){e=e||{},null==t&&(t={});for(var i in e){var n=e[i];switch(i){default:t[i]=n;break;case"opacity":case"outlineOpacity":case"scaleByDistance_near":case"scaleByDistance_nearValue":case"scaleByDistance_far":case"scaleByDistance_farValue":case"distanceDisplayCondition_far":case"distanceDisplayCondition_near":break;case"outlineColor":t.outlineColor=new o.Color.fromCssColorString(n||"#FFFF00").withAlpha(e.outlineOpacity||e.opacity||1);break;case"color":t.color=new o.Color.fromCssColorString(n||"#FFFF00").withAlpha(Number(e.opacity||1));break;case"scaleByDistance":t.scaleByDistance=n?new o.NearFarScalar(Number(e.scaleByDistance_near||1e3),Number(e.scaleByDistance_nearValue||1),Number(e.scaleByDistance_far||1e6),Number(e.scaleByDistance_farValue||.1)):null;break;case"distanceDisplayCondition":t.distanceDisplayCondition=n?new o.DistanceDisplayCondition(Number(e.distanceDisplayCondition_near||0),Number(e.distanceDisplayCondition_far||1e5)):null;break;case"heightReference":switch(n){case"NONE":t.heightReference=o.HeightReference.NONE;break;case"CLAMP_TO_GROUND":t.heightReference=o.HeightReference.CLAMP_TO_GROUND;break;case"RELATIVE_TO_GROUND":t.heightReference=o.HeightReference.RELATIVE_TO_GROUND;break;default:t.heightReference=n}break;case"visibleDepth":t.disableDepthTestDistance=n?0:Number.POSITIVE_INFINITY}}e.outline||(t.outlineWidth=0);return t},t.getPositions=s,t.getCoordinates=l,t.toGeoJSON=function(e){var t=l(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"Point",coordinates:t[0]}}};var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2));function s(e){return[e.position.getValue(o.JulianDate.fromDate(new Date))]}function l(e){var t=s(e);return a.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){e=e||{},null==t&&(t={});for(var i in e){var n=e[i];switch(i){default:t[i]=n;break;case"silhouette":case"silhouetteColor":case"silhouetteAlpha":case"silhouetteSize":case"fill":case"color":case"opacity":break;case"modelUrl":t.uri=n;break;case"heightReference":switch(n){case"NONE":t.heightReference=o.HeightReference.NONE;break;case"CLAMP_TO_GROUND":t.heightReference=o.HeightReference.CLAMP_TO_GROUND;break;case"RELATIVE_TO_GROUND":t.heightReference=o.HeightReference.RELATIVE_TO_GROUND;break;default:t.heightReference=n}}}e.silhouette?(t.silhouetteColor=new o.Color.fromCssColorString(e.silhouetteColor||"#FFFFFF").withAlpha(Number(e.silhouetteAlpha||1)),t.silhouetteSize=Number(e.silhouetteSize||1)):t.silhouetteSize=0;var r=e.hasOwnProperty("opacity")?Number(e.opacity):1;e.fill?t.color=new o.Color.fromCssColorString(e.color||"#FFFFFF").withAlpha(r):t.color=new o.Color.fromCssColorString("#FFFFFF").withAlpha(r);return t},t.getPositions=s,t.getCoordinates=l,t.toGeoJSON=function(e){var t=l(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"Point",coordinates:t[0]}}};var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2));function s(e){var t=e.position;return t&&t.getValue&&(t=t.getValue(o.JulianDate.fromDate(new Date))),[t]}function l(e){var t=s(e);return a.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LineFlowMaterial=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),s=(o=a)&&o.__esModule?o:{default:o};var l=new s.Color(0,0,0,0),c=t.LineFlowMaterial=(n(u,[{key:"getType",value:function(){return this._materialType}},{key:"getValue",value:function(e,t){return s.defined(t)||(t={}),t.color=s.Property.getValueOrClonedDefault(this._color,e,l,t.color),t.image=this._materialImage,void 0===this._time&&(this._time=(new Date).getTime()),t.time=((new Date).getTime()-this._time)/this._duration,t}},{key:"equals",value:function(e){return this===e||e instanceof u&&s.Property.equals(this._color,e._color)}},{key:"isConstant",get:function(){return!1}},{key:"definitionChanged",get:function(){return this._definitionChanged}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),e=s.defaultValue(e,s.defaultValue.EMPTY_OBJECT),this._definitionChanged=new s.Event,this._color=void 0,this._colorSubscription=void 0,this.color=s.defaultValue(e.color,l),this._duration=e.duration||1e3;var t,i,n,r,o,a=(t=e.url,i=e.repeat,n=Boolean(e.axisY),r=d+ ++h+"Type",o=d+h+"Image",s.Material[r]=r,s.Material[o]=t,s.Material._materialCache.addMaterial(s.Material[r],{fabric:{type:s.Material.PolylineArrowLinkType,uniforms:{color:new s.Color(1,0,0,1),image:s.Material[o],time:0,repeat:i||new s.Cartesian2(1,1),axisY:n},source:"czm_material czm_getMaterial(czm_materialInput materialInput)\n                        {\n                            czm_material material = czm_getDefaultMaterial(materialInput);\n                            vec2 st = repeat * materialInput.st;\n                            vec4 colorImage = texture2D(image, vec2(fract((axisY?st.t:st.s) - time), st.t));\n                            if(color.a == 0.0)\n                            {\n                                material.alpha = colorImage.a;\n                                material.diffuse = colorImage.rgb; \n                            }\n                            else\n                            {\n                                material.alpha = colorImage.a * color.a;\n                                material.diffuse = max(color.rgb * material.alpha * 3.0, color.rgb); \n                            }\n                            return material;\n                        }"},translucent:function(){return!0}}),{type:s.Material[r],image:s.Material[o]});this._materialType=a.type,this._materialImage=a.image,this.axisY=Boolean(e.axisY),this._time=void 0}s.defineProperties(c.prototype,{color:s.createPropertyDescriptor("color")});var h=0,d="AnimationLine"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditPolygon=void 0;var n,r=i(0),h=(n=r)&&n.__esModule?n:{default:n},d=s(i(6)),p=i(3),o=s(i(11)),a=i(14),f=i(1);function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.EditPolygon=a.EditPolyline.extend({changePositionsToCallback:function(){this._positions_draw=this.entity._positions_draw||o.getPositions(this.entity)},finish:function(){this.entity._positions_draw=this.getPosition()},isClampToGround:function(){return this.entity.attribute.style.hasOwnProperty("clampToGround")?this.entity.attribute.style.clampToGround:!this.entity.attribute.style.perPositionHeight},bindDraggers:function(){for(var a=this,s=this.getPosition(),l=s.length<this._maxPointNum,c=this.isClampToGround(),e=0,u=s.length;e<u;e++){var t=s[e];c&&(t=(0,f.updateHeightForClampToGround)(this.viewer,t),s[e]=t);var i=d.createDragger(this.dataSource,{position:t,onDrag:function(e,t){if(s[e.index]=t,a.heightDraggers&&0<a.heightDraggers.length){var i=a.entity.polygon.extrudedHeight.getValue(a.viewer.clock.currentTime);a.heightDraggers[e.index].position=(0,f.setPositionsHeight)(t,i)}if(l){var n,r;r=0==e.index?(n=2*u-1,u-1):(n=2*e.index-1,e.index-1);var o=h.Cartesian3.midpoint(t,s[r],new h.Cartesian3);c&&(o=(0,f.updateHeightForClampToGround)(a.viewer,o)),a.draggers[n].position=o,r=e.index==u-1?(n=2*e.index+1,0):(n=2*e.index+1,e.index+1);o=h.Cartesian3.midpoint(t,s[r],new h.Cartesian3);c&&(o=(0,f.updateHeightForClampToGround)(a.viewer,o)),a.draggers[n].position=o}}});if(i.index=e,this.draggers.push(i),l){var n=(e+1)%u,r=h.Cartesian3.midpoint(t,s[n],new h.Cartesian3);c&&(r=(0,f.updateHeightForClampToGround)(this.viewer,r));var o=d.createDragger(this.dataSource,{position:r,type:d.PointType.AddMidPoint,tooltip:p.message.dragger.addMidPoint,onDragStart:function(e,t){s.splice(e.index,0,t)},onDrag:function(e,t){s[e.index]=t},onDragEnd:function(){a.updateDraggers()}});o.index=n,this.draggers.push(o)}}this.entity.polygon.extrudedHeight&&this.bindHeightDraggers(this.entity.polygon)},heightDraggers:null,bindHeightDraggers:function(r,e){var o=this;this.heightDraggers=[],e=e||this.getPosition();for(var t=r.extrudedHeight.getValue(this.viewer.clock.currentTime),i=0,n=e.length;i<n;i++){var a=e[i];a=(0,f.setPositionsHeight)(a,t);var s=d.createDragger(this.dataSource,{position:a,type:d.PointType.MoveHeight,tooltip:p.message.dragger.moveHeight,onDrag:function(e,t){var i=h.Cartographic.fromCartesian(t).height;r.extrudedHeight=i;var n=(0,f.getMaxHeight)(o.getPosition());o.entity.attribute.style.extrudedHeight=o.formatNum(i-n,2),o.updateHeightDraggers(i)}});this.draggers.push(s),this.heightDraggers.push(s)}},updateHeightDraggers:function(e){for(var t=0;t<this.heightDraggers.length;t++){var i=this.heightDraggers[t],n=(0,f.setPositionsHeight)(i.position.getValue(this.viewer.clock.currentTime),e);i.position.setValue(n)}}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){null==t&&(t={fill:!0});(e=e||{}).clampToGround&&(e.hasOwnProperty("height")&&delete e.height,e.hasOwnProperty("extrudedHeight")&&delete e.extrudedHeight);for(var i in e){var n=e[i];switch(i){default:t[i]=n;break;case"opacity":case"outlineOpacity":case"color":case"animation":break;case"outlineColor":t.outlineColor=new o.Color.fromCssColorString(n||"#FFFF00").withAlpha(e.outlineOpacity||e.opacity||1);break;case"rotation":t.rotation=o.Math.toRadians(n);break;case"height":t.height=Number(n),e.extrudedHeight&&(t.extrudedHeight=Number(e.extrudedHeight)+Number(n));break;case"extrudedHeight":t.extrudedHeight=Number(t.height||e.height||0)+Number(n);break;case"radius":t.semiMinorAxis=Number(n),t.semiMajorAxis=Number(n)}}e.animation?t.material=new s.CircleWaveMaterial({duration:e.animationDuration||2e3,color:new o.Color.fromCssColorString(e.color||"#FFFF00").withAlpha(Number(e.opacity||1)),gradient:e.animationGradient||0,count:e.animationCount||1}):e.color&&(t.material=new o.Color.fromCssColorString(e.color||"#FFFF00").withAlpha(Number(e.opacity||1)));null==t.material&&(t.material=o.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:Number(e.opacity||1)}));return t},t.getPositions=l,t.getCoordinates=c,t.toGeoJSON=function(e){var t=c(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"Point",coordinates:t[0]}}};var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2)),s=i(36);function l(e){return[e.position.getValue(o.JulianDate.fromDate(new Date))]}function c(e){var t=l(e);return a.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonLayer=void 0;var u=r(i(0)),h=r(i(5)),d=i(4),p=i(1),n=i(9),f=i(15),m=i(13),g=i(10),v=i(11);function r(e){return e&&e.__esModule?e:{default:e}}var o=n.BaseLayer.extend({dataSource:null,add:function(){this.dataSource?this.viewer.dataSources.add(this.dataSource):this.queryData()},remove:function(){this.viewer.dataSources.remove(this.dataSource)},centerAt:function(e){if(this.config.extent||this.config.center)this.viewer.gsp.centerAt(this.config.extent||this.config.center,{duration:e,isWgs84:!0});else{if(null==this.dataSource)return;this.viewer.flyTo(this.dataSource.entities.values,{duration:e})}},hasOpacity:!0,_opacity:1,setOpacity:function(e){if(this._opacity=e,null!=this.dataSource)for(var t=this.dataSource.entities.values,i=0,n=t.length;i<n;i++){var r=t[i];if(r.polygon&&r.polygon.material&&r.polygon.material.color&&(this._updatEntityAlpha(r.polygon.material.color,this._opacity),r.polygon.outlineColor&&this._updatEntityAlpha(r.polygon.outlineColor,this._opacity)),r.polyline&&r.polyline.material&&r.polyline.material.color&&this._updatEntityAlpha(r.polyline.material.color,this._opacity),r.billboard&&(r.billboard.color=new u.Color.fromCssColorString("#FFFFFF").withAlpha(this._opacity)),r.model&&(r.model.color=new u.Color.fromCssColorString("#FFFFFF").withAlpha(this._opacity)),r.label){var o=this._opacity;r.attribute&&r.attribute.label&&r.attribute.label.opacity&&(o=r.attribute.label.opacity),r.label.fillColor&&this._updatEntityAlpha(r.label.fillColor,o),r.label.outlineColor&&this._updatEntityAlpha(r.label.outlineColor,o),r.label.backgroundColor&&this._updatEntityAlpha(r.label.backgroundColor,o)}}},_updatEntityAlpha:function(e,t){var i=e.getValue(this.viewer.clock.currentTime);if(!i||!i.withAlpha)return e;i=i.withAlpha(t),e.setValue(i)},queryData:function(){var t=this,e=(0,d.getProxyUrl)(this.config);u.GeoJsonDataSource.load(e.url,e).then(function(e){t.showResult(e)}).otherwise(function(e){t.showError("服务出错",e)})},showResult:function(e){var i=this;this.dataSource&&this.viewer.dataSources.remove(this.dataSource),this.dataSource=e,this.viewer.dataSources.add(e),this.config.flyTo&&this.centerAt();for(var t=e.entities.values,n=0,r=t.length;n<r;n++){var o=t[n];this.config.symbol&&("default"==this.config.symbol?this.setDefSymbol(o):this.setConfigSymbol(o,this.config.symbol)),(this.config.columns||this.config.popup)&&(o.popup={html:function(e){var t=i.getEntityAttr(e);return(0,d.isString)(t)?t:i.viewer.gsp.popup.getPopupForConfig(i.config,t)},anchor:this.config.popupAnchor||[0,-15]}),this.config.tooltip&&(o.tooltip={html:function(e){var t=i.getEntityAttr(e);return(0,d.isString)(t)?t:i.viewer.gsp.popup.getPopupForConfig({popup:i.config.tooltip},t)},anchor:this.config.tooltipAnchor||[0,-15]}),this.config.click&&(o.click=this.config.click),this.config.mouseover&&(o.mouseover=this.config.mouseover),this.config.mouseout&&(o.mouseout=this.config.mouseout)}1!=this._opacity&&this.setOpacity(this._opacity)},getEntityAttr:function(e){return e.properties},colorHash:{},setDefSymbol:function(e){var t=this.getEntityAttr(e)||{};if(e.polygon){var i=t.id||t.OBJECTID||0;(n=this.colorHash[i])||(n=u.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:this._opacity}),this.colorHash[i]=n),e.polygon.material=n,e.polygon.outline=!0,e.polygon.outlineColor=u.Color.WHITE}else if(e.polyline){var n;i=t.id||t.OBJECTID||0;(n=this.colorHash[i])||(n=u.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:this._opacity}),this.colorHash[i]=n),e.polyline.material=n,e.polyline.width=2}else e.billboard&&(e.billboard.scale=.5,e.billboard.horizontalOrigin=u.HorizontalOrigin.CENTER,e.billboard.verticalOrigin=u.VerticalOrigin.BOTTOM)},setConfigSymbol:function(e,t){var i=this.getEntityAttr(e)||{},n=t.styleOptions;if(t.styleField){var r=i[t.styleField];null!=(o=t.styleFieldOptions[r])&&(n=(0,d.clone)(n),n=h.default.extend(n,o))}if("function"==typeof t.calback){var o;if(!(o=t.calback(i,e,t)))return;n=(0,d.clone)(n),n=h.default.extend(n,o)}if(n=n||{},e.polyline&&(0,g.style2Entity)(n,e.polyline),e.polygon){if((0,v.style2Entity)(n,e.polygon),n.outlineWidth&&1<n.outlineWidth){e.polygon.outline=!1;var a={color:n.outlineColor,width:n.outlineWidth,opacity:n.outlineOpacity,lineType:"solid",clampToGround:!0,outline:!1},s=(0,g.style2Entity)(a);s.positions=(0,v.getPositions)(e),this.dataSource._entityCollection.add({polyline:s})}if(n.label&&n.label.field&&(n.label.heightReference=n.label.heightReference||u.HeightReference.RELATIVE_TO_GROUND,e.position=(0,p.centerOfMass)((0,v.getPositions)(e)),e.label=(0,m.style2Entity)(n.label),e.label.text=i[n.label.field]||""),this.config.buildings){var l=Number(i[this.config.buildings.cloumn]||1),c=Number(this.config.buildings.height||5);e.polygon.extrudedHeight=l*c}}e.label&&(n.heightReference=n.heightReference||u.HeightReference.RELATIVE_TO_GROUND,(0,m.style2Entity)(n,e.label)),e.billboard&&(n.heightReference=n.heightReference||u.HeightReference.RELATIVE_TO_GROUND,(0,f.style2Entity)(n,e.billboard),n.label&&n.label.field&&(n.label.heightReference=n.label.heightReference||u.HeightReference.RELATIVE_TO_GROUND,e.label=(0,m.style2Entity)(n.label),e.label.text=i[n.label.field]||"")),e.attribute=n}});t.GeoJsonLayer=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TilesetBase=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),m=(o=a)&&o.__esModule?o:{default:o};t.TilesetBase=(n(s,[{key:"setUpAxis",value:function(e){this.base_height="X"!=e?"Y"!=e?this.flatRect[2]:this.flatRect[1]:this.flatRect[0]}},{key:"clear",value:function(){m.ExpandByMars.resetTilesEditor()}},{key:"_preparePos",value:function(e){if(e&&e.length){for(var t=[],i=[],n=[],r=0,o=this.tileInverTransform,a=7378137,s=7378137,l=7378137,c=-7378137,u=-7378137,h=-7378137,d=0;d<16;d++)if(e[d]){var p=new m.Cartesian3,f=e[d];m.Matrix4.multiplyByPoint(o,f,p),t.push(p.x+1e-6),i.push(p.y+1e-6),n.push(p.z+1e-6),r++,p.x>c&&(c=p.x),p.x<a&&(a=p.x),p.y>u&&(u=p.y),p.y<s&&(s=p.y),p.z>h&&(h=p.z),p.z<l&&(l=p.z)}else t.push(0),i.push(0),n.push(0);this.yp_mat_x=t,this.yp_mat_y=i,this.yp_mat_z=n,this.yp_max_index=r,this.flatRect=[+a,+s,+l,c+0,u+0,h+0,0,0,0]}}},{key:"destroy",value:function(){delete this.viewer,delete this._tileset,delete this.tileInverTransform,m.ExpandByMars.resetTilesEditor()}},{key:"tileset",get:function(){return this._tileset},set:function(e){this._tileset=e;var t=new m.Matrix4;m.Matrix4.fromArray(e._root.transform,0,t),m.Matrix4.inverse(t,t),this.tileInverTransform=t}}]),s);function s(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),e=e||{},this.viewer=e.viewer,this.tileset=e.tileset}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)};t.init=s,t.getDefWindowOptions=function(){return function e(t,i){if(null==t||"object"!=(void 0===t?"undefined":r(t)))return t;if(t.constructor!=Object&&t.constructor!=Array)return t;if(t.constructor==Date||t.constructor==RegExp||t.constructor==Function||t.constructor==String||t.constructor==Number||t.constructor==Boolean)return new t.constructor(t);i=i||new t.constructor;for(var n in t)i[n]=void 0===i[n]?e(t[n],null):i[n];return i}(u.windowOptions)},t.activate=v,t.getWidget=l,t.getClass=y,t.isActivate=_,t.disable=w,t.disableAll=b,t.disableGroup=C,t.eachWidget=function(e){for(var t=0;t<m.length;t++){var i=m[t];e(i)}},t.bindClass=function(e){{if(null!=x)return x.isloading=!1,x._class=new e(x,p),x._class.activateBase(),x._class;for(var t=function(){for(var e,t=document.scripts,i=t.length-1;0<=i;i--)if(null!=(e=t[i].src)&&""!=e&&-1!=e.indexOf("widgets"))return e;return""}(),i=0;i<m.length;i++){var n=m[i];if(t.endsWith(n.uri))return n.isloading=!1,n._class=new e(n,p),n._class.activateBase(),n._class}}},t.removeDebugeBar=S,t.getCacheVersion=function(){return h},t.getBasePath=function(){return f};var n,o=i(5),c=(n=o)&&n.__esModule?n:{default:n},a=i(31);var u,h,d,p,f="",m=[];function s(e,t,i){p=e,f=i||"",m=[],u=(t=t||{}).defaultOptions||{windowOptions:{position:"rt",maxmin:!1,resize:!0},autoDisable:!0,disableOhter:!0},"time"==(h=t.version)&&(h=(new Date).getTime());var n=t.widgetsAtStart;if(n&&0<n.length)for(var r=0;r<n.length;r++){(l=n[r]).hasOwnProperty("uri")&&""!=l.uri?l.hasOwnProperty("visible")&&!l.visible||(l.autoDisable=!1,l.openAtStart=!0,l._nodebug=!0,g(l),m.push(l)):console.log("widget未配置uri："+JSON.stringify(l))}if(d=t.debugger){var o='<div id="widget-testbar" class="widgetbar animation-slide-bottom no-print-view" >      <div style="height: 30px; line-height:30px;"><b style="color: #4db3ff;">widget测试栏</b>&nbsp;&nbsp;<button  id="widget-testbar-remove"  type="button" class="btn btn-link btn-xs">关闭</button> </div>     <button id="widget-testbar-disableAll" type="button" class="btn btn-info" ><i class="fa fa-globe"></i>漫游</button></div>';(0,c.default)("body").append(o),(0,c.default)("#widget-testbar-remove").click(function(e){S()}),(0,c.default)("#widget-testbar-disableAll").click(function(e){b()})}if((n=t.widgets)&&0<n.length){for(r=0;r<n.length;r++){if("group"==(l=n[r]).type){o=' <div class="btn-group dropup">  <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-align-justify"></i>'+l.name+' <span class="caret"></span></button> <ul class="dropdown-menu">';for(var a=0;a<l.children.length;a++){var s=l.children[a];s.hasOwnProperty("uri")&&""!=s.uri?(o+=' <li data-widget="'+s.uri+'" class="widget-btn" ><a href="#"><i class="fa fa-star"></i>'+s.name+"</a></li>",g(s),m.push(s)):console.log("widget未配置uri："+JSON.stringify(s))}o+="</ul></div>",d&&!l._nodebug&&(0,c.default)("#widget-testbar").append(o)}else{if(!l.hasOwnProperty("uri")||""==l.uri){console.log("widget未配置uri："+JSON.stringify(l));continue}if(d&&!l._nodebug){o='<button type="button" class="btn btn-primary widget-btn" data-widget="'+l.uri+'"  > <i class="fa fa-globe"></i>'+l.name+" </button>";(0,c.default)("#widget-testbar").append(o)}g(l),m.push(l)}}d&&(0,c.default)("#widget-testbar .widget-btn").each(function(){(0,c.default)(this).click(function(e){var t=(0,c.default)(this).attr("data-widget");null!=t&&""!=t&&(_(t)?w:v)(t)})})}for(r=0;r<m.length;r++){var l;((l=m[r]).openAtStart||l.createAtStart)&&E.push(l)}(0,c.default)(window).resize(function(){for(var e=0;e<m.length;e++){var t=m[e];t._class&&t._class.indexResize()}}),M()}function g(e){if(u)for(var t in u)"windowOptions"==t||e.hasOwnProperty(t)||(e[t]=u[t]);var i,n;e.path=(i=f+e.uri,n=i.lastIndexOf("/"),i.substring(0,n+1)),e.name=e.name||e.label}function v(e,t){var i;null==p&&e.viewer&&s(e.viewer),"string"==typeof e?(e={uri:e},null!=t&&(e.disableOhter=!t)):null==e.uri&&console.error("activate激活widget时需要uri参数！");for(var n=0;n<m.length;n++){var r=m[n];if(e.uri==r.uri||r.id&&e.uri==r.id){if((i=r).isloading)return i;for(var o in e)"uri"!=o&&(i[o]=e[o]);break}}if(null==i&&(g(e),i=e,m.push(e)),d&&console.log("开始激活widget："+i.uri),i.disableOhter?b(i.uri,i.group):C(i.group,i.uri),i._class)if(i._class.isActivate)if(i._class.update)i._class.update();else{i._class.disableBase();var a=setInterval(function(){i._class.isActivate||(i._class.activateBase(),clearInterval(a))},200)}else i._class.activateBase();else{for(n=0;n<E.length;n++)if(E[n].uri==i.uri)return E[n];E.push(i),1==E.length&&M()}return i}function l(e){for(var t=0;t<m.length;t++){var i=m[t];if(e==i.uri||e==i.id)return i}}function y(e){var t=l(e);return t?t._class:null}function _(e){var t=y(e);return null!=t&&t.isActivate}function w(e){if(null!=e)for(var t=0;t<m.length;t++){var i=m[t];if(i._class&&(e==i.uri||e==i.id)){i._class.disableBase();break}}}function b(e,t){for(var i=0;i<m.length;i++){var n=m[i];(t&&n.group==t||n.autoDisable)&&(!e||e!=n.uri&&e!=n.id)&&n._class&&n._class.disableBase()}}function C(e,t){if(null!=e)for(var i=0;i<m.length;i++){var n=m[i];if(n.group==e){if(t&&(t==n.uri||t==n.id))continue;n._class&&n._class.disableBase()}}}var x,P,E=[];function M(){if(0!=E.length)if(P)setTimeout(M,500);else{P=!0,(x=E[0]).isloading=!0;var e=x.uri;h&&(-1==e.indexOf("?")?e+="?time="+h:e+="&time="+h),window.NProgress&&NProgress.start(),d&&console.log("开始加载js："+f+e),a.Loader.async([f+e],function(){P=!1,x.isloading=!1,d&&console.log("完成js加载："+f+e),window.NProgress&&NProgress.done(!0),E.shift(),M()})}}function S(){(0,c.default)("#widget-testbar").remove()}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=new RegExp("\\.css"),p=document.head||document.getElementsByTagName("head")[0],o=+navigator.userAgent.replace(/.*(?:AppleWebKit|AndroidWebKit)\/?(\d+).*/i,"$1")<536;function a(e){return"complete"===e.readyState||"loaded"===e.readyState}function f(e,t,i){var n="onload"in e;function r(){e.onload=e.onreadystatechange=null,e=null,t()}"css"===i&&(o||!n)?setTimeout(function(){!function e(t,i){var n;t.sheet&&(n=!0),setTimeout(function(){n?i():e(t,i)},20)}(e,t)},1):n?(e.onload=r,e.onerror=function(){e.onerror=null,"css"==i?console.error("该css文件不存在："+e.href):console.error("该js文件不存在："+e.src),r()}):e.onreadystatechange=function(){a(e)&&r()}}function s(t,i,e,n){var r,o,a,s,l,c,u;t?d.test(t)?(l=t,c=h,(u=document.createElement("link")).rel="stylesheet",f(u,c,"css"),u.async=!0,u.href=l,p.appendChild(u)):(r=t,o=e,a=h,(s=document.createElement("script")).charset="utf-8",f(s,a,"js"),s.async=!o.sync,s.src=r,p.appendChild(s)):setTimeout(function(){h()});function h(){var e=i.indexOf(t);-1<e&&i.splice(e,1),0===i.length&&n()}}function n(e,t,i){function n(){i&&i()}if(0!==(e=Array.prototype.slice.call(e||[])).length)for(var r=0,o=e.length;r<o;r++)s(e[r],e,t,n);else n()}function r(e,t){if(a(e))t();else{var i=!1;window.addEventListener("load",function(){i||(t(),i=!0)}),setTimeout(function(){i||(t(),i=!0)},1500)}}var l={async:function(e,t){r(document,function(){n(e,{},t)})},sync:function(e,t){r(document,function(){n(e,{sync:!0},t)})}};t.Loader=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addImage=function(e){};t.image={url:null,rectangle:null}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ViewerEx=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var h=_(i(0)),d=_(i(5)),o=i(16),a=y(i(74)),s=y(i(75)),l=y(i(76)),c=y(i(40)),p=y(i(4)),f=y(i(1)),u=y(i(19)),m=i(20),g=i(89),v=i(32);function y(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function _(e){return e&&e.__esModule?e:{default:e}}h.Camera.DEFAULT_VIEW_RECTANGLE=h.Rectangle.fromDegrees(89.5,20.4,110.4,61.2),h.BingMapsApi.defaultKey="AtkX3zhnRe5fyGuLU30uZw8r3sxdBDnpQly7KfFTCB2rGlDgXBG3yr-qEiQEicEc",setTimeout(g.addLog,6e5);t.ViewerEx=(n(w,[{key:"_optimization",value:function(){var t=this.viewer;if(this.viewer.sceneModePicker&&(this.viewer.sceneModePicker.viewModel.duration=0),this.viewer._cesiumWidget._supportsImageRenderingPixelated=h.FeatureDetection.supportsImageRenderingPixelated(),this.viewer._cesiumWidget._forceResize=!0,h.FeatureDetection.supportsImageRenderingPixelated()){for(var e=window.devicePixelRatio;2<=e;)e/=2;this.viewer.resolutionScale=e}this.viewer.camera.changed.addEventListener(function(){if(t.camera._suspendTerrainAdjustment&&t.scene.mode===h.SceneMode.SCENE3D&&(t.camera._suspendTerrainAdjustment=!1,t.camera._adjustHeightForTerrain()),t.scene.camera.positionCartographic.height<-100){var e=f.setPositionsHeight(t.camera.positionWC,0);t.scene.camera.setView({destination:e,orientation:{heading:t.camera.heading,pitch:t.camera.pitch}})}})}},{key:"_initForOpts",value:function(){var t=this;this.viewer.cesiumWidget.creditContainer.style.display="none",this.viewer.homeButton&&this.viewer.homeButton.viewModel.command.beforeExecute.addEventListener(function(e){t.centerAt(),e.cancel=!0}),this.centerAt(null,{duration:0});var e=this.viewer.scene;e.globe.baseColor=new h.Color.fromCssColorString(this.config.baseColor||"#546a53"),this.config.backgroundColor&&(e.backgroundColor=new h.Color.fromCssColorString(this.config.backgroundColor)),this.config.style&&(e.globe.depthTestAgainstTerrain=this.config.style.testTerrain,e.globe.enableLighting=this.config.style.lighting,e.skyAtmosphere.show=this.config.style.atmosphere,e.globe.showGroundAtmosphere=this.config.style.atmosphere,e.fog.enabled=this.config.style.fog,e.globe.show=h.defaultValue(this.config.style.globe,!0),e.moon.show=h.defaultValue(this.config.style.moon,e.globe.show),e.sun.show=h.defaultValue(this.config.style.sun,e.globe.show),e.skyBox.show=h.defaultValue(this.config.style.skyBox,e.globe.show)),e.screenSpaceCameraController.maximumZoomDistance=h.defaultValue(this.config.maxzoom,2e7),e.screenSpaceCameraController.minimumZoomDistance=h.defaultValue(this.config.minzoom,1),e.screenSpaceCameraController._zoomFactor=2,e.screenSpaceCameraController.minimumCollisionTerrainHeight=15e6}},{key:"_addControls",value:function(){if(a.init(this.viewer),this._popup=a,s.init(this.viewer),this._tooltip=s,this.config.contextmenu&&(l.init(this.viewer),this.contextmenuItems=this.config.contextmenuItems||l.defaultContextmenuItems,this._contextmenu=l),this.config.navigation&&this._addNavigationWidget(this.config.navigation),this.config.location&&this._addLocationWidget(this.config.location),this.config.mouseZoom&&p.isPCBroswer()){(0,d.default)("#"+this.viewer._container.id).append('<div class="cesium-mousezoom"><div class="zoomimg"/></div>');var t=!0,i=-1,n=this.viewer,e=new h.ScreenSpaceEventHandler(this.viewer.scene.canvas);e.setInputAction(function(e){t&&(0,d.default)(".cesium-mousezoom").css({top:e.endPosition.y+"px",left:e.endPosition.x+"px"})},h.ScreenSpaceEventType.MOUSE_MOVE),e.setInputAction(function(e){(0,d.default)(".cesium-mousezoom").addClass("cesium-mousezoom-visible"),clearTimeout(i),i=setTimeout(function(){(0,d.default)(".cesium-mousezoom").removeClass("cesium-mousezoom-visible")},200)},h.ScreenSpaceEventType.WHEEL),e.setInputAction(function(e){f.getCurrentMousePosition(n.scene,e.position)&&(n.camera.positionCartographic.height>n.scene.screenSpaceCameraController.minimumCollisionTerrainHeight||(t=!1,clearTimeout(i),(0,d.default)(".cesium-mousezoom").css({top:e.position.y+"px",left:e.position.x+"px"}),(0,d.default)(".cesium-mousezoom").addClass("cesium-mousezoom-visible")))},h.ScreenSpaceEventType.MIDDLE_DOWN),e.setInputAction(function(e){(0,d.default)(".cesium-mousezoom").removeClass("cesium-mousezoom-visible"),t=!0},h.ScreenSpaceEventType.MIDDLE_UP)}}},{key:"_initLayers",value:function(){var e=[],t=[];if(!this.config.baseLayerPicker&&(o=this.config.basemaps)&&0<o.length)for(var i=0;i<o.length;i++)if((l=o[i]).visible&&l.crs&&(this.crs=l.crs),(s=(0,m.createLayer)(l,this.viewer,this.config.serverURL))&&t.push(s),e.push(l),"group"==l.type&&l.layers)for(var n=0;n<l.layers.length;n++){var r=l.layers[n];e.push(r)}this.arrBasemaps=t;var o,a=[];if((o=this.config.operationallayers)&&0<o.length)for(i=0;i<o.length;i++){var s,l=o[i];if((s=(0,m.createLayer)(l,this.viewer,this.config.serverURL))&&a.push(s),e.push(l),"group"==l.type&&l.layers)for(n=0;n<l.layers.length;n++)r=l.layers[n],e.push(r)}for(this.arrOperationallayers=a,i=0;i<e.length;i++){l=e[i];var c=Number(l.order);isNaN(c)&&(c=i),l.order=c,null!=l._layer&&l._layer.setZIndex(c)}}},{key:"getConfig",value:function(){return p.clone(this.config,5)}},{key:"keyboard",value:function(e,t){e?c.bind(this.viewer,t):c.unbind(this.viewer)}},{key:"keyboardAuto",value:function(e){return c.enable(this.viewer,e)}},{key:"getLayer",value:function(e,t){null==t&&(t="name");var i=this.arrBasemaps;if(i&&0<i.length)for(var n=0;n<i.length;n++)if(null!=(r=i[n])&&r.config[t]==e)return r;if((i=this.arrOperationallayers)&&0<i.length)for(n=0;n<i.length;n++){var r;if(null!=(r=i[n])&&r.config[t]==e)return r}return null}},{key:"changeBasemap",value:function(e){for(var t=this.arrBasemaps,i=0;i<t.length;i++){var n=t[i];"group"==n.config.type&&null==n._layers||(e==n.config.name||e==n.config.id?n.setVisible(!0):n.setVisible(!1))}}},{key:"hasTerrain",value:function(){return null!=this.terrainProvider&&this.viewer.terrainProvider!=p.getEllipsoidTerrain()}},{key:"updateTerrainProvider",value:function(e){if(e){if(null==this.terrainProvider){var t=this.config.terrain;t.url&&(this.config.serverURL&&(t.url=t.url.replace("$serverURL$",this.config.serverURL)),t.url=t.url.replace("$hostname$",location.hostname).replace("$host$",location.host)),this.terrainProvider=p.getTerrainProvider(t)}this.viewer.terrainProvider=this.terrainProvider}else this.viewer.terrainProvider=p.getEllipsoidTerrain()}},{key:"getCrs",value:function(){return this.crs}},{key:"point2map",value:function(e){if("gcj"!=this.crs)return"baidu"!=this.crs?e:(t=p.clone(e),i=u.wgs2bd([t.x,t.y]),t.x=i[0],t.y=i[1],t);var t=p.clone(e),i=u.wgs2gcj([t.x,t.y]);return t.x=i[0],t.y=i[1],t}},{key:"point2wgs",value:function(e){if("gcj"!=this.crs)return"baidu"!=this.crs?e:(t=p.clone(e),i=u.bd2gcj([t.x,t.y]),t.x=i[0],t.y=i[1],t);var t=p.clone(e),i=u.gcj2wgs([t.x,t.y]);return t.x=i[0],t.y=i[1],t}},{key:"centerAtArr",value:function(e,t){this.cancelCenterAt(),this.arrCenterTemp=e,this._isCenterAtArr=!0,this._centerAtArrItem(0,t)}},{key:"_centerAtArrItem",value:function(t,i){var n=this;if(!this._isCenterAtArr||t<0||t>=this.arrCenterTemp.length)return this._isCenterAtArr=!1,void(i&&i());var r=this.arrCenterTemp[t];r.onStart&&r.onStart(),this.centerAt(r,{duration:r.duration,complete:function(){r.onEnd&&r.onEnd();var e=h.defaultValue(r.stop,1);setTimeout(function(){n._centerAtArrItem(++t,i)},1e3*e)},cancle:function(){this._isCenterAtArr=!1,i&&i()}})}},{key:"cancelCenterAt",value:function(){this._isCenterAtArr=!1,this.viewer.camera.flyTo({destination:this.viewer.camera.position,orientation:{heading:this.viewer.camera.heading,pitch:this.viewer.camera.pitch,roll:this.viewer.camera.roll},duration:0})}},{key:"centerAt",value:function(e,t){null==t?t={}:p.isNumber(t)&&(t={duration:t}),null==e&&(t.isWgs84=!0,e=this.config.extent||this.config.center||{y:17.196575,x:114.184276,z:9377198,heading:0,pitch:-80,roll:0});var i={};for(var n in t)i[n]=t[n];if(e.xmin&&e.xmax&&e.ymin&&e.ymax){var r=e.xmin,o=e.xmax,a=e.ymin,s=e.ymax;if(i.isWgs84){var l=this.point2map({x:r,y:a});r=l.x,a=l.y;var c=this.point2map({x:o,y:s});o=c.x,s=c.y}i.rectangle=h.Rectangle.fromDegrees(r,a,o,s),this.viewer.camera.flyTo(i)}else{i.isWgs84&&(e=this.point2map(e));var u=h.defaultValue(i.minz,2500);this.viewer.camera.positionCartographic.height<u&&(u=this.viewer.camera.positionCartographic.height),null!=e.z&&0!=e.z&&(u=e.z),i.destination=h.Cartesian3.fromDegrees(e.x,e.y,u),i.orientation={heading:h.Math.toRadians(h.defaultValue(e.heading,0)),pitch:h.Math.toRadians(h.defaultValue(e.pitch,-90)),roll:h.Math.toRadians(h.defaultValue(e.roll,0))},this.viewer.camera.flyTo(i)}}},{key:"centerPoint",value:function(e,t){null==t&&(t={});var i,n={};for(var r in t)n[r]=t[r];n.isWgs84&&(e=this.point2map(e)),i=e instanceof h.Cartesian3?e:h.Cartesian3.fromDegrees(e.x,e.y,h.defaultValue(e.z,0));var o=h.defaultValue(t.radius,5e3);n.offset={heading:h.Math.toRadians(h.defaultValue(t.heading,0)),pitch:h.Math.toRadians(h.defaultValue(t.pitch,-60)),range:h.defaultValue(t.range,0)},this.viewer.camera.flyToBoundingSphere(new h.BoundingSphere(i,o),n)}},{key:"isFlyAnimation",value:function(){return this._isFlyAnimation}},{key:"openFlyAnimation",value:function(t,e){var i=this,n=this.viewer,r=e||f.getCameraView(n);this._isFlyAnimation=!0,n.camera.setView({destination:h.Cartesian3.fromDegrees(-85.16,13.71,23e6)}),n.camera.flyTo({destination:h.Cartesian3.fromDegrees(r.x,r.y,23e6),duration:2,easingFunction:h.EasingFunction.LINEAR_NONE,complete:function(){var e=h.defaultValue(r.z,9e4);e<2e5&&-90!=r.pitch?(e=1.2*e+8e3,n.camera.flyTo({destination:h.Cartesian3.fromDegrees(r.x,r.y,e),complete:function(){i.centerAt(r,{duration:2,complete:function(){i._isFlyAnimation=!1,t&&t()}})}})):i.centerAt(r,{complete:function(){i._isFlyAnimation=!1,t&&t()}})}})}},{key:"rotateAnimation",value:function(e,t){var i=this.viewer,n=f.getCameraView(i),r=t/3;i.camera.flyTo({destination:h.Cartesian3.fromDegrees(n.x+120,n.y,n.z),orientation:{heading:h.Math.toRadians(n.heading),pitch:h.Math.toRadians(n.pitch),roll:h.Math.toRadians(n.roll)},duration:r,easingFunction:h.EasingFunction.LINEAR_NONE,complete:function(){i.camera.flyTo({destination:h.Cartesian3.fromDegrees(n.x+240,n.y,n.z),orientation:{heading:h.Math.toRadians(n.heading),pitch:h.Math.toRadians(n.pitch),roll:h.Math.toRadians(n.roll)},duration:r,easingFunction:h.EasingFunction.LINEAR_NONE,complete:function(){i.camera.flyTo({destination:h.Cartesian3.fromDegrees(n.x,n.y,n.z),orientation:{heading:h.Math.toRadians(n.heading),pitch:h.Math.toRadians(n.pitch),roll:h.Math.toRadians(n.roll)},duration:r,easingFunction:h.EasingFunction.LINEAR_NONE,complete:function(){e&&e()}})}})}})}},{key:"_addLocationWidget",value:function(l){var c=this.viewer;(0,d.default)("#"+c._container.id).prepend('<div id="location_mars_jwd"  class="location-bar animation-slide-bottom no-print" ></div>'),l.style?(0,d.default)("#location_mars_jwd").css(l.style):(0,d.default)("#location_mars_jwd").css({left:c.animation?"170px":"0",right:"0",bottom:c.timeline?"25px":"0"}),l.format=l.format||"<div>视高：{height}米</div><div>俯仰角：{pitch}度</div><div>方向：{heading}度</div><div>海拔：{z}米</div><div>纬度:{y}</div><div>经度:{x}</div>";var u={};u.height=c.camera.positionCartographic.height.toFixed(1),u.heading=h.Math.toDegrees(c.camera.heading).toFixed(0),u.pitch=h.Math.toDegrees(c.camera.pitch).toFixed(0),new h.ScreenSpaceEventHandler(c.scene.canvas).setInputAction(function(e){var t=f.getCurrentMousePosition(c.scene,e.endPosition);if(t){var i=h.Cartographic.fromCartesian(t);u.z=i.height.toFixed(1);var n=h.Math.toDegrees(i.longitude),r=h.Math.toDegrees(i.latitude);switch(l.crs){default:var o=l.hasOwnProperty("toFixed")?l.toFixed:6;u.x=n.toFixed(o),u.y=r.toFixed(o);break;case"degree":u.x=p.formatDegree(n),u.y=p.formatDegree(r);break;case"project":o=l.hasOwnProperty("toFixed")?l.toFixed:0,u.x=t.x.toFixed(o),u.y=t.y.toFixed(o);break;case"wgs":o=l.hasOwnProperty("toFixed")?l.toFixed:6;var a=point2wgs({x:n,y:r});u.x=a.x.toFixed(o),u.y=a.y.toFixed(o);break;case"wgs-degree":a=point2wgs({x:n,y:r}),u.x=p.formatDegree(a.x),u.y=p.formatDegree(a.y)}var s=p.template(l.format,u);(0,d.default)("#location_mars_jwd").html(s)}},h.ScreenSpaceEventType.MOUSE_MOVE),c.scene.camera.changed.addEventListener(function(e){if(u.height=c.camera.positionCartographic.height.toFixed(1),u.heading=h.Math.toDegrees(c.camera.heading).toFixed(0),u.pitch=h.Math.toDegrees(c.camera.pitch).toFixed(0),null!=u.x){var t=p.template(l.format,u);(0,d.default)("#location_mars_jwd").html(t)}})}},{key:"_addNavigationWidget",value:function(e){h.viewerCesiumNavigationMixin&&(this.viewer.extend(h.viewerCesiumNavigationMixin,{defaultResetView:h.Rectangle.fromDegrees(110,20,120,30),enableZoomControls:!0}),this.viewer.animation?(0,d.default)(".distance-legend").css({left:"150px",bottom:"25px",border:"none",background:"rgba(0, 0, 0, 0)","z-index":"992"}):(0,d.default)(".distance-legend").css({left:"-10px",bottom:"-1px",border:"none",background:"rgba(0, 0, 0, 0)","z-index":"992"}),e.legend?(0,d.default)(".distance-legend").css(e.legend):(0,d.default)(".distance-legend").remove(),e.compass?(0,d.default)(".compass").css(e.compass):(0,d.default)(".compass").remove(),(0,d.default)(".navigation-controls").remove())}},{key:"destroy",value:function(){this._tooltip.destroy(),this._popup.destroy(),this._contextmenu&&this._contextmenu.destroy()}},{key:"popup",get:function(){return this._popup}},{key:"tooltip",get:function(){return this._tooltip}},{key:"contextmenu",get:function(){return this._contextmenu}},{key:"contextmenuItems",get:function(){return this._contextmenuItems},set:function(e){this._contextmenuItems=e}},{key:"draw",get:function(){return null==this._drawControl&&(this._drawControl=new o.Draw(this.viewer,{hasEdit:!1})),this._drawControl}}]),w);function w(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,w),this.viewer=e,this.config=h.defaultValue(t,{}),(this.viewer.gsp=this)._isFlyAnimation=!1,this.crs=h.defaultValue(this.config.crs,"3857"),(0,v.addImage)(e),this._optimization(),this._initForOpts(),this._addControls(),this._initLayers()}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){e=e||{},null==t&&(t={});for(var i in e){var n=e[i];switch(i){default:t[i]=n;break;case"opacity":case"outlineOpacity":case"radius":case"shape":break;case"outlineColor":t.outlineColor=new s.Color.fromCssColorString(n||"#FFFF00").withAlpha(e.outlineOpacity||e.opacity||1);break;case"color":t.material=new s.Color.fromCssColorString(n||"#FFFF00").withAlpha(Number(e.opacity||1))}}switch(e.radius=e.radius||10,e.shape){default:case"pipeline":t.shape=function(e){for(var t=e/3,i=[],n=0;n<=360;n++){var r=s.Math.toRadians(n);i.push(new s.Cartesian2(e*Math.cos(r),e*Math.sin(r)))}for(n=360;0<=n;n--){r=s.Math.toRadians(n);i.push(new s.Cartesian2((e-t)*Math.cos(r),(e-t)*Math.sin(r)))}return i}(e.radius);break;case"circle":t.shape=function(e){for(var t=[],i=0;i<=360;i++){var n=s.Math.toRadians(i);t.push(new s.Cartesian2(e*Math.cos(n),e*Math.sin(n)))}return t}(e.radius);break;case"star":t.shape=function(e,t){t=t||6;for(var i=Math.PI/t,n=2*t,r=new Array(n),o=0;o<n;o++){var a=o%2==0?e:e/3;r[o]=new s.Cartesian2(Math.cos(o*i)*a,Math.sin(o*i)*a)}return r}(e.radius)}return t},t.getPositions=a,t.getCoordinates=l,t.toGeoJSON=function(e){var t=l(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"LineString",coordinates:t}}};var n,r=i(0),s=(n=r)&&n.__esModule?n:{default:n},o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2));function a(e){return e._positions_draw&&0<e._positions_draw.length?e._positions_draw:e.polylineVolume.positions.getValue(s.JulianDate.fromDate(new Date))}function l(e){var t=a(e);return o.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){null==t&&(t={fill:!0});(e=e||{}).clampToGround&&(e.hasOwnProperty("height")&&delete e.height,e.hasOwnProperty("extrudedHeight")&&delete e.extrudedHeight);for(var i in e){var n=e[i];switch(i){default:t[i]=n;break;case"opacity":case"outlineOpacity":break;case"outlineColor":t.outlineColor=new o.Color.fromCssColorString(n||"#FFFF00").withAlpha(e.outlineOpacity||e.opacity||1);break;case"height":t.height=Number(n),e.extrudedHeight&&(t.extrudedHeight=Number(e.extrudedHeight)+Number(n));break;case"extrudedHeight":t.extrudedHeight=Number(t.height||e.height||0)+Number(n);break;case"color":t.material=new o.Color.fromCssColorString(n||"#FFFF00").withAlpha(Number(e.opacity||1));break;case"image":t.material=new o.ImageMaterialProperty({image:e.image,color:new o.Color.fromCssColorString("#FFFFFF").withAlpha(Number(e.opacity||1))});break;case"rotation":t.rotation=o.Math.toRadians(n),e.stRotation||(t.stRotation=o.Math.toRadians(n));break;case"stRotation":t.stRotation=o.Math.toRadians(n)}}null==t.material&&(t.material=o.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:Number(e.opacity||1)}));return t},t.getPositions=s,t.getCoordinates=l,t.toGeoJSON=function(e){var t=l(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"MultiPoint",coordinates:t}}};var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2));function s(e){if(e._positions_draw&&0<e._positions_draw.length)return e._positions_draw;var t=o.JulianDate.fromDate(new Date),i=e.rectangle.coordinates.getValue(t),n=e.rectangle.height?e.rectangle.height.getValue(t):0;return[o.Cartesian3.fromRadians(i.west,i.south,n),o.Cartesian3.fromRadians(i.east,i.north,n)]}function l(e){var t=s(e);return a.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CircleWaveMaterial=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),s=(o=a)&&o.__esModule?o:{default:o};var l=new s.Color(0,0,0,0),c=t.CircleWaveMaterial=(n(u,[{key:"getType",value:function(){return s.Material.CircleWaveMaterialType}},{key:"getValue",value:function(e,t){return s.defined(t)||(t={}),t.color=s.Property.getValueOrClonedDefault(this._color,e,l,t.color),void 0===this._time&&(this._time=(new Date).getTime()),t.time=((new Date).getTime()-this._time)/this._duration,t.count=this._count,t.gradient=1+10*(1-this._gradient),t}},{key:"equals",value:function(e){return this===e||e instanceof u&&s.Property.equals(this._color,e._color)}},{key:"isConstant",get:function(){return!1}},{key:"definitionChanged",get:function(){return this._definitionChanged}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),e=s.defaultValue(e,s.defaultValue.EMPTY_OBJECT),this._definitionChanged=new s.Event,this._color=void 0,this._colorSubscription=void 0,this.color=s.defaultValue(e.color,l),this._duration=s.defaultValue(e.duration,1e3),this._count=s.defaultValue(e.count,2),this._count<=0&&(this._count=1),this._gradient=s.defaultValue(e.gradient,.1),this._gradient<0&&(this._gradient=0),1<this._gradient&&(this._gradient=1),this._time=void 0}s.defineProperties(c.prototype,{color:s.createPropertyDescriptor("color")}),s.Material.CircleWaveMaterialType="CircleWaveMaterial",s.Material._materialCache.addMaterial(s.Material.CircleWaveMaterialType,{fabric:{type:s.Material.CircleWaveMaterialType,uniforms:{color:new s.Color(1,0,0,1),time:1,count:2,gradient:.1},source:"czm_material czm_getMaterial(czm_materialInput materialInput)\n                {\n                    czm_material material = czm_getDefaultMaterial(materialInput);\n                    material.diffuse = 1.5 * color.rgb;\n                    vec2 st = materialInput.st;\n                    vec3 str = materialInput.str;\n                    float dis = distance(st, vec2(0.5, 0.5));\n                    float per = fract(time);\n                    if(abs(str.z)>0.001){\n                        discard;\n                    }\n                    if(dis >0.5){\n                        discard;\n                    }else {\n                        float perDis = 0.5/count;\n                        float disNum;\n                        float bl = .0;\n                        for(int i=0;i<=999;i++){\n                            if(float(i)<=count){\n                                disNum = perDis*float(i) - dis + per/count;\n                                if(disNum>0.0){\n                                    if(disNum<perDis){\n                                        bl = 1.0-disNum/perDis;\n                                    }\n                                    else if(disNum-perDis<perDis){\n                                        bl = 1.0 - abs(1.0-disNum/perDis);\n                                    }\n                                    material.alpha = pow(bl,gradient);\n                                }\n                            }\n                        }\n                    }\n                    return material;\n                }"},translucent:function(){return!0}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){e=e||{},null==t&&(t={fill:!0});for(var i in e){var n=e[i];switch(i){default:t[i]=n;break;case"opacity":case"outlineOpacity":case"widthRadii":case"heightRadii":break;case"outlineColor":t.outlineColor=new s.Color.fromCssColorString(n||"#FFFF00").withAlpha(e.outlineOpacity||e.opacity||1);break;case"color":t.material=new s.Color.fromCssColorString(n||"#FFFF00").withAlpha(Number(e.opacity||1));break;case"extentRadii":var r=e.extentRadii||100,o=e.widthRadii||100,a=e.heightRadii||100;t.radii=new s.Cartesian3(r,o,a)}}null==t.material&&(t.material=s.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:Number(e.opacity||1)}));return t},t.getPositions=a,t.getCoordinates=l,t.toGeoJSON=function(e){var t=l(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"Point",coordinates:t[0]}}};var n,r=i(0),s=(n=r)&&n.__esModule?n:{default:n},o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2));function a(e){return[e.position.getValue(s.JulianDate.fromDate(new Date))]}function l(e){var t=a(e);return o.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){e=e||{},t=t||{fill:!0};for(var i in e){var n=e[i];switch(i){default:t[i]=n;break;case"opacity":case"outlineOpacity":case"color":case"materialType":case"animationDuration":case"animationImage":case"animationAxisY":break;case"outlineColor":t.outlineColor=new o.Color.fromCssColorString(n||"#FFFF00").withAlpha(e.outlineOpacity||e.opacity||1)}}if(e.color||e.materialType){var r=new o.Color.fromCssColorString(e.color||"#FFFF00").withAlpha(Number(o.defaultValue(e.opacity,1)));switch(e.materialType){default:case"color":t.material=r;break;case"animation":t.material=new s.LineFlowMaterial({color:r,duration:e.animationDuration||2e3,url:e.animationImage,repeat:new o.Cartesian2(e.animationRepeatX||1,e.animationRepeatY||1),axisY:e.animationAxisY})}}null==t.material&&(t.material=o.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:Number(e.opacity||1)}));return t},t.getPositions=l,t.getCoordinates=c,t.toGeoJSON=function(e){var t=c(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"LineString",coordinates:t}}};var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2)),s=i(25);function l(e){return e.wall.positions.getValue(o.JulianDate.fromDate(new Date))}function c(e){var t=l(e);return a.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ellipsoid=t.rectangle=t.circle=t.polygon=t.wall=t.polylineVolume=t.polyline=t.model=t.point=t.label=t.billboard=void 0,t.getCoordinates=function(e){return m(e).getCoordinates(e)},t.getPositions=function(e){return m(e).getPositions(e)},t.toGeoJSON=function(e){return m(e).toGeoJSON(e)},t.style2Entity=function(e,t){return m(t).style2Entity(e,t)};var n=f(i(15)),r=f(i(13)),o=f(i(23)),a=f(i(24)),s=f(i(10)),l=f(i(34)),c=f(i(38)),u=f(i(11)),h=f(i(27)),d=f(i(35)),p=f(i(37));function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function m(e){return e.billboard?n:e.point?o:e.label?r:e.model?a:e.polyline?s:e.polylineVolume?l:e.wall?c:e.circle?h:e.polygon?u:e.rectangle?d:e.ellipsoid?p:e}t.billboard=n,t.label=r,t.point=o,t.model=a,t.polyline=s,t.polylineVolume=l,t.wall=c,t.polygon=u,t.circle=h,t.rectangle=d,t.ellipsoid=p},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bind=o,t.unbind=a,t.isEnable=function(){return b},t.enable=function(e,t){b?a(e):o(e,t);return b};var n,_,w,b,r=i(0),C=(n=r)&&n.__esModule?n:{default:n};var x={options:{able:!1,step:200},events:{LEFT_DOWN:void 0,MOUSE_MOVE:void 0,LEFT_UP:void 0,keydown:void 0,keyup:void 0,clock:void 0},type:{ENLARGE:0,NARROW:1,LEFT_ROTATE:2,RIGHT_ROTATE:3,TOP_ROTATE:4,BOTTOM_ROTATE:5}};function o(h,e){if(!b){b=!0;var c=(e=e||{}).speedRatio||150,d=e.dirStep||25,p=e.rotateStep||1,r=e.minPitch||.1,o=e.maxPitch||.95,t=h.scene,u=h.canvas;u.setAttribute("tabindex","0"),u.onclick=function(){u.focus()};var f,m,g=t.globe.ellipsoid;t.screenSpaceCameraController.enableRotate=!1,t.screenSpaceCameraController.enableTranslate=!1,t.screenSpaceCameraController.enableZoom=!1,t.screenSpaceCameraController.enableTilt=!1;var v={looking:t.screenSpaceCameraController.enableLook=!1,moveForward:!1,moveBackward:!1,moveUp:!1,moveDown:!1,moveLeft:!1,moveRight:!1};(w=new C.ScreenSpaceEventHandler(u)).setInputAction(function(e){v.looking=!0,m=f=C.Cartesian3.clone(e.position)},C.ScreenSpaceEventType.LEFT_DOWN),w.setInputAction(function(e){m=e.endPosition},C.ScreenSpaceEventType.MOUSE_MOVE),w.setInputAction(function(e){v.looking=!1},C.ScreenSpaceEventType.LEFT_UP),w.setInputAction(function(e){0<e?(c*=.9,p*=1.1,d*=.9):(c*=1.1,p*=.9,d*=1.1)},C.ScreenSpaceEventType.WHEEL),document.addEventListener("keydown",function(e){var t=i(e.keyCode);void 0!==t&&(v[t]=!0)},!1),document.addEventListener("keyup",function(e){var t=i(e.keyCode);void 0!==t&&(v[t]=!1)},!1),_=function(){var e=h.camera;if(v.looking){var t=u.clientWidth,i=u.clientHeight,n=(m.x-f.x)/t,r=-(m.y-f.y)/i;e.lookRight(.05*n),e.lookUp(.05*r);var o=e.direction,a=C.Cartesian3.normalize(e.position,new C.Cartesian3),s=C.Cartesian3.cross(o,a,new C.Cartesian3);a=C.Cartesian3.cross(s,o,new C.Cartesian3),e.up=a,e.right=s}var l=g.cartesianToCartographic(e.position).height/c;v.moveForward&&y(l),v.moveBackward&&y(-l),v.moveUp&&e.moveUp(l),v.moveDown&&e.moveDown(l),v.moveLeft&&e.moveLeft(l),v.moveRight&&e.moveRight(l)},h.clock.onTick.addEventListener(_)}function i(e){switch(e){case"W".charCodeAt(0):return"moveForward";case"S".charCodeAt(0):return"moveBackward";case"D".charCodeAt(0):return"moveRight";case"A".charCodeAt(0):return"moveLeft";case"Q".charCodeAt(0):return"moveUp";case"E".charCodeAt(0):return"moveDown";case 38:l(x.type.TOP_ROTATE);break;case 37:l(x.type.LEFT_ROTATE);break;case 39:l(x.type.RIGHT_ROTATE);break;case 40:l(x.type.BOTTOM_ROTATE);break;case"I".charCodeAt(0):case 104:n(x.type.ENLARGE);break;case"K".charCodeAt(0):case 101:n(x.type.NARROW);break;case"J".charCodeAt(0):case 100:n(x.type.LEFT_ROTATE);break;case"L".charCodeAt(0):case 102:n(x.type.RIGHT_ROTATE);break;case"U".charCodeAt(0):case 103:n(x.type.TOP_ROTATE);break;case"O".charCodeAt(0):case 105:n(x.type.BOTTOM_ROTATE)}}function y(e){var t=h.camera,i=t.direction,n=C.Cartesian3.normalize(t.position,new C.Cartesian3),r=C.Cartesian3.cross(i,n,new C.Cartesian3);i=C.Cartesian3.cross(n,r,new C.Cartesian3),i=C.Cartesian3.normalize(i,i),i=C.Cartesian3.multiplyByScalar(i,e,i),t.position=C.Cartesian3.add(t.position,i,t.position)}function a(e,t,i){var n=C.Cartesian3.dot(e,C.Cartesian3.normalize(t,new C.Cartesian3));return!("up"==i&&n<r)&&!("down"==i&&o<n)}function s(e,t,i){var n=e.position,r=gsp3d.point.getCenter(h);if(r){var o=C.Cartesian3.fromDegrees(r.x,r.y,r.z);if(o){var a=C.Cartesian3.distance(o,n),s=a/100;s=i?s*p:s;var l={},c=new C.Ray(n,t);if(l.position=C.Ray.getPoint(c,s),l.direction=e.direction,l.right=e.right,l.up=e.up,i){var u=C.Cartesian3.normalize(C.Cartesian3.subtract(l.position,o,new C.Cartesian3),new C.Cartesian3);c=new C.Ray(o,u),l.position=C.Ray.getPoint(c,a),l.direction=C.Cartesian3.negate(u,new C.Cartesian3),l.up=C.Cartesian3.normalize(l.position,new C.Cartesian3),l.right=C.Cartesian3.cross(l.direction,l.up,new C.Cartesian3)}return l}}}function n(e){var t,i,n=h.scene.camera;switch(e){case x.type.ENLARGE:t=s(n,n.direction);break;case x.type.NARROW:t=s(n,C.Cartesian3.negate(n.direction,new C.Cartesian3));break;case x.type.LEFT_ROTATE:t=s(n,C.Cartesian3.negate(n.right,new C.Cartesian3),!0);break;case x.type.RIGHT_ROTATE:t=s(n,n.right,!0);break;case x.type.TOP_ROTATE:if(!a(C.clone(n.up),C.clone(n.position),"up"))return;t=s(n,C.clone(n.up),!0);break;case x.type.BOTTOM_ROTATE:if(!a(C.clone(n.up),C.clone(n.position),"down"))return;t=s(n,C.Cartesian3.negate(n.up,new C.Cartesian3),!0)}t&&(i=t)&&(h.scene.camera.position=i.position,h.scene.camera.direction=i.direction,h.scene.camera.right=i.right,h.scene.camera.up=i.up)}function l(e){if(h){var t=[0,0],i=h.scene.canvas.clientWidth,n=h.scene.canvas.clientHeight,r=(i+n)/d;switch(e){case x.type.LEFT_ROTATE:t=[-r*i/n,0];break;case x.type.RIGHT_ROTATE:t=[r*i/n,0];break;case x.type.TOP_ROTATE:t=[0,r];break;case x.type.BOTTOM_ROTATE:t=[0,-r];break;default:return}var o=t[0]/i,a=t[1]/n,s=h.camera;s.lookRight(.05*o),s.lookUp(.05*a);var l=s.direction,c=C.Cartesian3.normalize(s.position,new C.Cartesian3),u=C.Cartesian3.cross(l,c,new C.Cartesian3);c=C.Cartesian3.cross(u,l,new C.Cartesian3),s.up=c,s.right=u}}}function a(e){if(b){b=!1;var t=e.scene;e.canvas;t.screenSpaceCameraController.enableRotate=!0,t.screenSpaceCameraController.enableTranslate=!0,t.screenSpaceCameraController.enableZoom=!0,t.screenSpaceCameraController.enableTilt=!0,t.screenSpaceCameraController.enableLook=!0,_&&(e.clock.onTick.removeEventListener(_),_=void 0),w&&(w.destroy(),w=void 0)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileLayer=void 0;var n,r=i(0),l=(n=r)&&n.__esModule?n:{default:n},o=i(9),a=i(20);var s=o.BaseLayer.extend({layer:null,add:function(){null!=this.layer&&this.remove(),this.addEx();var e=this.createImageryProvider(this.config);if(null!=e){var t=this.config,i={show:!0,alpha:this._opacity};if(t.rectangle&&t.rectangle.xmin&&t.rectangle.xmax&&t.rectangle.ymin&&t.rectangle.ymax){var n=t.rectangle.xmin,r=t.rectangle.xmax,o=t.rectangle.ymin,a=t.rectangle.ymax,s=l.Rectangle.fromDegrees(n,o,r,a);this.rectangle=s,i.rectangle=s}t.brightness&&(i.brightness=t.brightness),t.contrast&&(i.contrast=t.contrast),t.hue&&(i.hue=t.hue),t.saturation&&(i.saturation=t.saturation),t.gamma&&(i.gamma=t.gamma),t.maximumAnisotropy&&(i.maximumAnisotropy=t.maximumAnisotropy),t.minimumTerrainLevel&&(i.minimumTerrainLevel=t.minimumTerrainLevel),t.maximumTerrainLevel&&(i.maximumTerrainLevel=t.maximumTerrainLevel),this.layer=new l.ImageryLayer(e,i),this.layer.config=this.config,this.viewer.imageryLayers.add(this.layer),this.setZIndex(this.config.order)}},createImageryProvider:function(e){return(0,a.createImageryProvider)(e)},addEx:function(){},remove:function(){null!=this.layer&&(this.removeEx(),this.viewer.imageryLayers.remove(this.layer,!0),this.layer=null)},removeEx:function(){},centerAt:function(e){if(null!=this.layer)if(this.config.extent||this.config.center)this.viewer.gsp.centerAt(this.config.extent||this.config.center,{duration:e,isWgs84:!0});else if(this.rectangle)this.viewer.camera.flyTo({destination:this.rectangle,duration:e});else{var t=this.layer.imageryProvider.rectangle;t&&t!=l.Rectangle.MAX_VALUE&&0<t.west&&0<t.south&&0<t.east&&0<t.north&&this.viewer.camera.flyTo({destination:t,duration:e})}},hasOpacity:!0,_opacity:1,setOpacity:function(e){this._opacity=e,null!=this.layer&&(this.layer.alpha=e)},hasZIndex:!0,setZIndex:function(e){if(null!=this.layer&&null!=e){this.viewer.imageryLayers.raiseToTop(this.layer);for(var t=this.viewer.imageryLayers._layers,i=t.length-1;0<=i;i--)if(t[i]!=this.layer){var n=t[i].config;n&&n.order&&e<n.order&&this.viewer.imageryLayers.lower(this.layer)}}}});t.TileLayer=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CustomFeatureGridLayer=void 0;var u=r(i(0)),h=r(i(5)),d=i(4),n=i(79),p=i(15),f=i(13),m=i(10),g=i(11);function r(e){return e&&e.__esModule?e:{default:e}}var o=n.FeatureGridLayer.extend({_cacheGrid:{},_cacheFeature:{},_addImageryCache:function(t){this._cacheGrid[t.key]={opts:t,isLoading:!0};var i=this;this.getDataForGrid(t,function(e){i._visible&&i._showData(t,e)})},getDataForGrid:function(e,t){this.config.getDataForGrid&&this.config.getDataForGrid(e,t)},checkHasBreak:function(e){return!this._visible||!this._cacheGrid[e]},_showData:function(e,t){var i=e.key;if(!this.checkHasBreak[i]){for(var n=this,r=[],o=0,a=t.length;o<a;o++){var s=t[o],l=s[this.config.IdName||"id"],c=this._cacheFeature[l];if(c)c.grid.push(i),this.updateEntity(c.entity,s);else{var u=this.createEntity(e,s,function(e){n.config.debuggerTileInfo&&(e._temp_id=l,e.popup=function(e){return JSON.stringify(n._cacheFeature[e._temp_id].grid)}),n._cacheFeature[l]={grid:[i],entity:e}});null!=u&&(n.config.debuggerTileInfo&&(u._temp_id=l,u.popup=function(e){return JSON.stringify(n._cacheFeature[e._temp_id].grid)}),n._cacheFeature[l]={grid:[i],entity:u})}r.push(l)}this._cacheGrid[i]=this._cacheGrid[i]||{},this._cacheGrid[i].ids=r,this._cacheGrid[i].isLoading=!1}},createEntity:function(e,t,i){return this.config.createEntity?this.config.createEntity(e,t,i):null},updateEntity:function(e,t){this.config.updateEntity&&this.config.updateEntity(e,t)},removeEntity:function(e){this.config.removeEntity?this.config.removeEntity(e):this.dataSource.entities.remove(e)},_removeImageryCache:function(e){var t=e.key,i=this._cacheGrid[t];if(i){if(i.ids)for(var n=0;n<i.ids.length;n++){var r=i.ids[n],o=this._cacheFeature[r];o&&(o.grid.remove(t),0==o.grid.length&&(delete this._cacheFeature[r],this.removeEntity(o.entity)))}delete this._cacheGrid[t]}},_removeAllImageryCache:function(){this.config.removeAllEntity?this.config.removeAllEntity():(this.dataSource.entities.removeAll(),this.primitives.removeAll()),this._cacheFeature={},this._cacheGrid={}},removeEx:function(){this.config.removeAllEntity?this.config.removeAllEntity():(this.dataSource.entities.removeAll(),this.primitives.removeAll()),this._cacheFeature={},this._cacheGrid={},this.viewer.dataSources.remove(this.dataSource),this.viewer.scene.primitives.remove(this.primitives)},reload:function(){var t=this;for(var e in this._cacheGrid){var i=this._cacheGrid[e];if(null!=i&&null!=i.opts&&!i.isLoading){var n=i.opts;this.getDataForGrid(n,function(e){t._showData(n,e)})}}},hasOpacity:!0,_opacity:1,setOpacity:function(e){for(var t in this._opacity=e,this._cacheFeature){var i=this._cacheFeature[t].entity;i.polygon&&i.polygon.material&&i.polygon.material.color?(this._updatEntityAlpha(i.polygon.material.color,this._opacity),i.polygon.outlineColor&&this._updatEntityAlpha(i.polygon.outlineColor,this._opacity)):i.polyline&&i.polyline.material&&i.polyline.material.color?this._updatEntityAlpha(i.polyline.material.color,this._opacity):i.billboard&&(i.billboard.color=new u.Color.fromCssColorString("#FFFFFF").withAlpha(this._opacity),i.label&&(i.label.fillColor&&this._updatEntityAlpha(i.label.fillColor,this._opacity),i.label.outlineColor&&this._updatEntityAlpha(i.label.outlineColor,this._opacity),i.label.backgroundColor&&this._updatEntityAlpha(i.label.backgroundColor,this._opacity)))}},_updatEntityAlpha:function(e,t){var i=e.getValue(this.viewer.clock.currentTime).withAlpha(t);e.setValue(i)},colorHash:{},setDefSymbol:function(e){if(e.polygon){var t=e.properties.OBJECTID;(i=this.colorHash[t])||(i=u.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:this._opacity}),this.colorHash[t]=i),e.polygon.material=i,e.polygon.outline=!0,e.polygon.outlineColor=u.Color.WHITE}else if(e.polyline){var i;t=e.properties.OBJECTID;(i=this.colorHash[t])||(i=u.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:this._opacity}),this.colorHash[t]=i),e.polyline.material=i,e.polyline.width=2}else e.billboard&&(e.billboard.scale=.5,e.billboard.horizontalOrigin=u.HorizontalOrigin.CENTER,e.billboard.verticalOrigin=u.VerticalOrigin.BOTTOM)},setConfigSymbol:function(e,t){var i=e.properties,n=t.styleOptions;if(t.styleField){var r=i[t.styleField];null!=(o=t.styleFieldOptions[r])&&(n=(0,d.clone)(n),n=h.default.extend(n,o))}if("function"==typeof t.calback){var o;if(!(o=t.calback(i,e,t)))return;n=(0,d.clone)(n),n=h.default.extend(n,o)}if(n=n||{},this._opacity=n.opacity||1,e.polygon){if((0,g.style2Entity)(n,e.polygon),n.outlineWidth&&1<n.outlineWidth){e.polygon.outline=!1;var a={color:n.outlineColor,width:n.outlineWidth,opacity:n.outlineOpacity,lineType:"solid",outline:!1},s=(0,m.style2Entity)(a);s.positions=(0,g.getPositions)(e),this.dataSource.entities.add({polyline:s})}if(this.config.buildings){var l=Number(i[this.config.buildings.cloumn]||1),c=Number(this.config.buildings.height||5);e.polygon.extrudedHeight=l*c}}else e.polyline?(0,m.style2Entity)(n,e.polyline):e.billboard&&(e.billboard.heightReference=u.HeightReference.RELATIVE_TO_GROUND,(0,p.style2Entity)(n,e.billboard),n.label&&n.label.field&&(n.label.heightReference=u.HeightReference.RELATIVE_TO_GROUND,e.label=(0,f.style2Entity)(n.label),e.label.text=i[n.label.field]))}});t.CustomFeatureGridLayer=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCenter=function(e,t){var i={},n=e.boundingSphere.center,r=y.Cartographic.fromCartesian(n),o=Number(r.height.toFixed(2)),a=Number(y.Math.toDegrees(r.longitude).toFixed(6)),s=Number(y.Math.toDegrees(r.latitude).toFixed(6));if(i={x:a,y:s,z:o},console.log("模型内部原始位置:"+JSON.stringify(i)),t){var l=y.Matrix4.fromArray(e._root.transform),c=y.Matrix4.getTranslation(l,new y.Cartesian3),u=y.Cartographic.fromCartesian(c);if(u){i.x=Number(y.Math.toDegrees(u.longitude).toFixed(6)),i.y=Number(y.Math.toDegrees(u.latitude).toFixed(6)),i.z=Number(u.height.toFixed(2));var h=y.Matrix4.getRotation(l,new y.Matrix3),d=y.Matrix4.getRotation(y.Transforms.eastNorthUpToFixedFrame(c),new y.Matrix3),p=y.Matrix3.getColumn(d,0,new y.Cartesian3),f=y.Matrix3.getColumn(d,1,new y.Cartesian3),m=y.Matrix3.getColumn(d,2,new y.Cartesian3),g=y.Matrix3.getColumn(h,0,new y.Cartesian3);g=y.Cartesian3.cross(g,m,g),g=y.Cartesian3.cross(m,g,g),g=y.Cartesian3.normalize(g,g);var v=y.Cartesian3.angleBetween(p,g);y.Cartesian3.angleBetween(f,g)>.5*Math.PI&&(v=2*Math.PI-v),i.heading=Number(y.Math.toDegrees(v).toFixed(1)),console.log("模型内部世界矩阵:"+JSON.stringify(i))}}return i},t.updateMatrix=function(e,t){var i;if(e._root&&e._root.transform&&t.transform){var n=y.Cartesian3.fromDegrees(t.x,t.y,t.z);i=y.Transforms.eastNorthUpToFixedFrame(n);var r=y.Matrix4.fromRotationTranslation(y.Matrix3.fromRotationZ(y.Math.toRadians(t.heading||0)));y.Matrix4.multiply(i,r,i),0<t.scale&&1!=t.scale&&y.Matrix4.multiplyByUniformScale(i,t.scale,i),t.axis&&(i=function(e,t){if(null==t)return e;var i;switch(t.toUpperCase()){case"Y_UP_TO_Z_UP":i=y.Axis.Y_UP_TO_Z_UP;break;case"Z_UP_TO_Y_UP":i=y.Axis.Z_UP_TO_Y_UP;break;case"X_UP_TO_Z_UP":i=y.Axis.X_UP_TO_Z_UP;break;case"Z_UP_TO_X_UP":i=y.Axis.Z_UP_TO_X_UP;break;case"X_UP_TO_Y_UP":i=y.Axis.X_UP_TO_Y_UP;break;case"Y_UP_TO_X_UP":i=y.Axis.Y_UP_TO_X_UP}return null==i?e:y.Matrix4.multiplyTransformation(e,i,e)}(i,t.axis)),e._root.transform=i}else{var o=e.boundingSphere,a=y.Cartographic.fromCartesian(o.center),s=y.Cartesian3.fromRadians(a.longitude,a.latitude,0),l=y.Cartesian3.fromDegrees(t.x,t.y,t.z),c=y.Cartesian3.subtract(l,s,new y.Cartesian3);i=y.Matrix4.fromTranslation(c),e.modelMatrix=i}return i};var n,r=i(0),y=(n=r)&&n.__esModule?n:{default:n}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RectangularSensorPrimitive=void 0;var L=n(i(0)),R=n(i(107)),F=n(i(108)),I=n(i(109)),N=n(i(110));function n(e){return e&&e.__esModule?e:{default:e}}var V=L.BoundingSphere,z=L.Cartesian3,r=L.Color,d=L.combine,H=L.ComponentDatatype,o=L.defaultValue,a=L.defined,B=L.DeveloperError,G=L.Matrix4,s=L.PrimitiveType,W=L.Buffer,j=L.BufferUsage,l=L.DrawCommand,U=L.Pass,Y=L.RenderState,q=L.ShaderProgram,J=L.ShaderSource,Z=L.VertexArray,X=L.BlendingState,K=L.CullFace,c=L.Material,Q=L.SceneMode,$=L.VertexFormat,ee=L.Math,te=L.Matrix3,ie=(G=L.Matrix4,L.JulianDate),f=Math.sin,ne=Math.cos,re=Math.tan,oe=Math.atan,ae=(Math.asin,{position:0,normal:1});function u(e){var t=this;e=o(e,o.EMPTY_OBJECT),this.show=o(e.show,!0),this.slice=o(e.slice,32),this.modelMatrix=G.clone(e.modelMatrix,new G),this._modelMatrix=new G,this._computedModelMatrix=new G,this._computedScanPlaneModelMatrix=new G,this.radius=o(e.radius,Number.POSITIVE_INFINITY),this._radius=void 0,this.xHalfAngle=o(e.xHalfAngle,0),this._xHalfAngle=void 0,this.yHalfAngle=o(e.yHalfAngle,0),this._yHalfAngle=void 0,this.lineColor=o(e.lineColor,r.WHITE),this.showSectorLines=o(e.showSectorLines,!0),this.showSectorSegmentLines=o(e.showSectorSegmentLines,!0),this.showLateralSurfaces=o(e.showLateralSurfaces,!0),this.material=a(e.material)?e.material:c.fromType(c.ColorType),this._material=void 0,this._translucent=void 0,this.lateralSurfaceMaterial=a(e.lateralSurfaceMaterial)?e.lateralSurfaceMaterial:c.fromType(c.ColorType),this._lateralSurfaceMaterial=void 0,this._lateralSurfaceTranslucent=void 0,this.showDomeSurfaces=o(e.showDomeSurfaces,!0),this.domeSurfaceMaterial=a(e.domeSurfaceMaterial)?e.domeSurfaceMaterial:c.fromType(c.ColorType),this._domeSurfaceMaterial=void 0,this.showDomeLines=o(e.showDomeLines,!0),this.showIntersection=o(e.showIntersection,!0),this.intersectionColor=o(e.intersectionColor,r.WHITE),this.intersectionWidth=o(e.intersectionWidth,5),this.showThroughEllipsoid=o(e.showThroughEllipsoid,!1),this._showThroughEllipsoid=void 0,this.showScanPlane=o(e.showScanPlane,!0),this.scanPlaneColor=o(e.scanPlaneColor,r.WHITE),this.scanPlaneMode=o(e.scanPlaneMode,"horizontal"),this.scanPlaneRate=o(e.scanPlaneRate,10),this._scanePlaneXHalfAngle=0,this._scanePlaneYHalfAngle=0,this._time=ie.now(),this._boundingSphere=new V,this._boundingSphereWC=new V,this._sectorFrontCommand=new l({owner:this,primitiveType:s.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._sectorBackCommand=new l({owner:this,primitiveType:s.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._sectorVA=void 0,this._sectorLineCommand=new l({owner:this,primitiveType:s.LINES,boundingVolume:this._boundingSphereWC}),this._sectorLineVA=void 0,this._sectorSegmentLineCommand=new l({owner:this,primitiveType:s.LINES,boundingVolume:this._boundingSphereWC}),this._sectorSegmentLineVA=void 0,this._domeFrontCommand=new l({owner:this,primitiveType:s.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._domeBackCommand=new l({owner:this,primitiveType:s.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._domeVA=void 0,this._domeLineCommand=new l({owner:this,primitiveType:s.LINES,boundingVolume:this._boundingSphereWC}),this._domeLineVA=void 0,this._scanPlaneFrontCommand=new l({owner:this,primitiveType:s.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._scanPlaneBackCommand=new l({owner:this,primitiveType:s.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._scanRadialCommand=void 0,this._colorCommands=[],this._frontFaceRS=void 0,this._backFaceRS=void 0,this._sp=void 0,this._uniforms={u_type:function(){return 0},u_xHalfAngle:function(){return t.xHalfAngle},u_yHalfAngle:function(){return t.yHalfAngle},u_radius:function(){return t.radius},u_showThroughEllipsoid:function(){return t.showThroughEllipsoid},u_showIntersection:function(){return t.showIntersection},u_intersectionColor:function(){return t.intersectionColor},u_intersectionWidth:function(){return t.intersectionWidth},u_normalDirection:function(){return 1},u_lineColor:function(){return t.lineColor}},this._scanUniforms={u_xHalfAngle:function(){return t._scanePlaneXHalfAngle},u_yHalfAngle:function(){return t._scanePlaneYHalfAngle},u_radius:function(){return t.radius},u_color:function(){return t.scanPlaneColor},u_showThroughEllipsoid:function(){return t.showThroughEllipsoid},u_showIntersection:function(){return t.showIntersection},u_intersectionColor:function(){return t.intersectionColor},u_intersectionWidth:function(){return t.intersectionWidth},u_normalDirection:function(){return 1},u_lineColor:function(){return t.lineColor}}}u.prototype.update=function(e){var t=e.mode;if(this.show&&t===Q.SCENE3D){var i=!1,n=!1,r=!1,o=this.xHalfAngle,a=this.yHalfAngle;if(o<0||a<0)throw new B("halfAngle must be greater than or equal to zero.");if(0!=o&&0!=a){this._xHalfAngle===o&&this._yHalfAngle===a||(this._xHalfAngle=o,this._yHalfAngle=a,i=!0);var s=this.radius;if(s<0)throw new B("this.radius must be greater than or equal to zero.");var l=!1;this._radius!==s&&(l=!0,this._radius=s,this._boundingSphere=new V(z.ZERO,this.radius)),G.equals(this.modelMatrix,this._modelMatrix)&&!l||(G.clone(this.modelMatrix,this._modelMatrix),G.multiplyByUniformScale(this.modelMatrix,this.radius,this._computedModelMatrix),V.transform(this._boundingSphere,this.modelMatrix,this._boundingSphereWC));var c=this.showThroughEllipsoid;this._showThroughEllipsoid!==this.showThroughEllipsoid&&(this._showThroughEllipsoid=c,n=!0);var u=this.material;this._material!==u&&(this._material=u,r=n=!0);var h,d,p,f,m,g=u.isTranslucent();if(this._translucent!==g&&(this._translucent=g,n=!0),this.showScanPlane){var v=e.time,y=ie.secondsDifference(v,this._time);y<0&&(this._time=ie.clone(v,this._time));var _,w=Math.max(y%this.scanPlaneRate/this.scanPlaneRate,0);if("horizontal"==this.scanPlaneMode){var b=ne(_=2*a*w-a),C=re(o),x=oe(b*C);this._scanePlaneXHalfAngle=x,this._scanePlaneYHalfAngle=_,L.Matrix3.fromRotationX(this._scanePlaneYHalfAngle,se)}else{_=2*o*w-o;var P=re(a),E=ne(_),M=oe(E*P);this._scanePlaneXHalfAngle=_,this._scanePlaneYHalfAngle=M,L.Matrix3.fromRotationY(this._scanePlaneXHalfAngle,se)}L.Matrix4.multiplyByMatrix3(this.modelMatrix,se,this._computedScanPlaneModelMatrix),G.multiplyByUniformScale(this._computedScanPlaneModelMatrix,this.radius,this._computedScanPlaneModelMatrix)}i&&function(e,t){var i=t.context,n=ce(e,e.xHalfAngle,e.yHalfAngle),r=function(e,t){var i=e.xHalfAngle,n=e.yHalfAngle,r=t.zoy,o=t.zox,a=[],s=te.fromRotationY(i,se);a.push(r.map(function(e){return te.multiplyByVector(s,e,new L.Cartesian3)}));s=te.fromRotationX(-n,se);a.push(o.map(function(e){return te.multiplyByVector(s,e,new L.Cartesian3)}).reverse());s=te.fromRotationY(-i,se);a.push(r.map(function(e){return te.multiplyByVector(s,e,new L.Cartesian3)}).reverse());s=te.fromRotationX(n,se);return a.push(o.map(function(e){return te.multiplyByVector(s,e,new L.Cartesian3)})),a}(e,n);e.showLateralSurfaces&&(e._sectorVA=function(e,t){for(var i=Array.prototype.concat.apply([],t).length-t.length,n=new Float32Array(18*i),r=0,o=0,a=t.length;o<a;o++){var s=t[o],l=z.normalize(z.cross(s[0],s[s.length-1],le),le),c=0;for(i=s.length-1;c<i;c++)n[r++]=0,n[r++]=0,n[r++]=0,n[r++]=-l.x,n[r++]=-l.y,n[r++]=-l.z,n[r++]=s[c].x,n[r++]=s[c].y,n[r++]=s[c].z,n[r++]=-l.x,n[r++]=-l.y,n[r++]=-l.z,n[r++]=s[c+1].x,n[r++]=s[c+1].y,n[r++]=s[c+1].z,n[r++]=-l.x,n[r++]=-l.y,n[r++]=-l.z}var u=W.createVertexBuffer({context:e,typedArray:n,usage:j.STATIC_DRAW}),h=6*Float32Array.BYTES_PER_ELEMENT,d=[{index:ae.position,vertexBuffer:u,componentsPerAttribute:3,componentDatatype:H.FLOAT,offsetInBytes:0,strideInBytes:h},{index:ae.normal,vertexBuffer:u,componentsPerAttribute:3,componentDatatype:H.FLOAT,offsetInBytes:3*Float32Array.BYTES_PER_ELEMENT,strideInBytes:h}];return new Z({context:e,attributes:d})}(i,r));e.showSectorLines&&(e._sectorLineVA=function(e,t){for(var i=t.length,n=new Float32Array(9*i),r=0,o=0,a=t.length;o<a;o++){var s=t[o];n[r++]=0,n[r++]=0,n[r++]=0,n[r++]=s[0].x,n[r++]=s[0].y,n[r++]=s[0].z}var l=W.createVertexBuffer({context:e,typedArray:n,usage:j.STATIC_DRAW}),c=3*Float32Array.BYTES_PER_ELEMENT,u=[{index:ae.position,vertexBuffer:l,componentsPerAttribute:3,componentDatatype:H.FLOAT,offsetInBytes:0,strideInBytes:c}];return new Z({context:e,attributes:u})}(i,r));e.showSectorSegmentLines&&(e._sectorSegmentLineVA=function(e,t){for(var i=Array.prototype.concat.apply([],t).length-t.length,n=new Float32Array(9*i),r=0,o=0,a=t.length;o<a;o++){var s=t[o],l=0;for(i=s.length-1;l<i;l++)n[r++]=s[l].x,n[r++]=s[l].y,n[r++]=s[l].z,n[r++]=s[l+1].x,n[r++]=s[l+1].y,n[r++]=s[l+1].z}var c=W.createVertexBuffer({context:e,typedArray:n,usage:j.STATIC_DRAW}),u=3*Float32Array.BYTES_PER_ELEMENT,h=[{index:ae.position,vertexBuffer:c,componentsPerAttribute:3,componentDatatype:H.FLOAT,offsetInBytes:0,strideInBytes:u}];return new Z({context:e,attributes:h})}(i,r));e.showDomeSurfaces&&(e._domeVA=function(e){var t=L.EllipsoidGeometry.createGeometry(new L.EllipsoidGeometry({vertexFormat:$.POSITION_ONLY,stackPartitions:32,slicePartitions:32}));return Z.fromGeometry({context:e,geometry:t,attributeLocations:ae,bufferUsage:j.STATIC_DRAW,interleave:!1})}(i));e.showDomeLines&&(e._domeLineVA=function(e){var t=L.EllipsoidOutlineGeometry.createGeometry(new L.EllipsoidOutlineGeometry({vertexFormat:$.POSITION_ONLY,stackPartitions:32,slicePartitions:32}));return Z.fromGeometry({context:e,geometry:t,attributeLocations:ae,bufferUsage:j.STATIC_DRAW,interleave:!1})}(i));if(e.showScanPlane)if("horizontal"==e.scanPlaneMode){var o=ce(e,ee.PI_OVER_TWO,0);e._scanPlaneVA=ue(i,o.zox)}else{o=ce(e,0,ee.PI_OVER_TWO);e._scanPlaneVA=ue(i,o.zoy)}}(this,e),n&&(h=this,d=c,g?(h._frontFaceRS=Y.fromCache({depthTest:{enabled:!d},depthMask:!1,blending:X.ALPHA_BLEND,cull:{enabled:!0,face:K.BACK}}),h._backFaceRS=Y.fromCache({depthTest:{enabled:!d},depthMask:!1,blending:X.ALPHA_BLEND,cull:{enabled:!0,face:K.FRONT}}),h._pickRS=Y.fromCache({depthTest:{enabled:!d},depthMask:!1,blending:X.ALPHA_BLEND})):(h._frontFaceRS=Y.fromCache({depthTest:{enabled:!d},depthMask:!0}),h._pickRS=Y.fromCache({depthTest:{enabled:!0},depthMask:!0}))),r&&(function(e,t,i){var n=t.context,r=R.default,o=new J({sources:[I.default,i.shaderSource,F.default]});e._sp=q.replaceCache({context:n,shaderProgram:e._sp,vertexShaderSource:r,fragmentShaderSource:o,attributeLocations:ae});var a=new J({sources:[I.default,i.shaderSource,F.default],pickColorQualifier:"uniform"});e._pickSP=q.replaceCache({context:n,shaderProgram:e._pickSP,vertexShaderSource:r,fragmentShaderSource:a,attributeLocations:ae})}(p=this,f=e,m=u),p.showScanPlane&&function(e,t,i){var n=t.context,r=R.default,o=new J({sources:[I.default,i.shaderSource,N.default]});e._scanePlaneSP=q.replaceCache({context:n,shaderProgram:e._scanePlaneSP,vertexShaderSource:r,fragmentShaderSource:o,attributeLocations:ae})}(p,f,m)),(n||r)&&function(e,t){e._colorCommands.length=0;var i=t?U.TRANSLUCENT:U.OPAQUE;e.showLateralSurfaces&&he(e,e._sectorFrontCommand,e._sectorBackCommand,e._frontFaceRS,e._backFaceRS,e._sp,e._sectorVA,e._uniforms,e._computedModelMatrix,t,i);e.showSectorLines&&he(e,e._sectorLineCommand,void 0,e._frontFaceRS,e._backFaceRS,e._sp,e._sectorLineVA,e._uniforms,e._computedModelMatrix,t,i,!0);e.showSectorSegmentLines&&he(e,e._sectorSegmentLineCommand,void 0,e._frontFaceRS,e._backFaceRS,e._sp,e._sectorSegmentLineVA,e._uniforms,e._computedModelMatrix,t,i,!0);e.showDomeSurfaces&&he(e,e._domeFrontCommand,e._domeBackCommand,e._frontFaceRS,e._backFaceRS,e._sp,e._domeVA,e._uniforms,e._computedModelMatrix,t,i);e.showDomeLines&&he(e,e._domeLineCommand,void 0,e._frontFaceRS,e._backFaceRS,e._sp,e._domeLineVA,e._uniforms,e._computedModelMatrix,t,i,!0);e.showScanPlane&&he(e,e._scanPlaneFrontCommand,e._scanPlaneBackCommand,e._frontFaceRS,e._backFaceRS,e._scanePlaneSP,e._scanPlaneVA,e._scanUniforms,e._computedScanPlaneModelMatrix,t,i)}(this,g);var S=e.commandList,T=e.passes,D=this._colorCommands;if(T.render)for(var O=0,A=D.length;O<A;O++){var k=D[O];S.push(k)}}}};var se=new te,le=new z;function ce(e,t,i){for(var n=e.slice,r=ne(i),o=re(i),a=ne(t),s=re(t),l=oe(a*o),c=oe(r*s),u=[],h=0;h<n;h++){var d=2*l*h/(n-1)-l;u.push(new z(0,f(d),ne(d)))}var p=[];for(h=0;h<n;h++){d=2*c*h/(n-1)-c;p.push(new z(f(d),0,ne(d)))}return{zoy:u,zox:p}}function ue(e,t){for(var i=t.length-1,n=new Float32Array(9*i),r=0,o=0;o<i;o++)n[r++]=0,n[r++]=0,n[r++]=0,n[r++]=t[o].x,n[r++]=t[o].y,n[r++]=t[o].z,n[r++]=t[o+1].x,n[r++]=t[o+1].y,n[r++]=t[o+1].z;var a=W.createVertexBuffer({context:e,typedArray:n,usage:j.STATIC_DRAW}),s=3*Float32Array.BYTES_PER_ELEMENT,l=[{index:ae.position,vertexBuffer:a,componentsPerAttribute:3,componentDatatype:H.FLOAT,offsetInBytes:0,strideInBytes:s}];return new Z({context:e,attributes:l})}function he(e,t,i,n,r,o,a,s,l,c,u,h){c&&i&&(i.vertexArray=a,i.renderState=r,i.shaderProgram=o,i.uniformMap=d(s,e._material._uniforms),i.uniformMap.u_normalDirection=function(){return-1},i.pass=u,i.modelMatrix=l,e._colorCommands.push(i)),t.vertexArray=a,t.renderState=n,t.shaderProgram=o,t.uniformMap=d(s,e._material._uniforms),h&&(t.uniformMap.u_type=function(){return 1}),t.pass=u,t.modelMatrix=l,e._colorCommands.push(t)}t.RectangularSensorPrimitive=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RectangularSensorGraphics=void 0;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n};function a(e){this._show=void 0,this._radius=void 0,this._xHalfAngle=void 0,this._yHalfAngle=void 0,this._lineColor=void 0,this._showSectorLines=void 0,this._showSectorSegmentLines=void 0,this._showLateralSurfaces=void 0,this._material=void 0,this._showDomeSurfaces=void 0,this._showDomeLines=void 0,this._showIntersection=void 0,this._intersectionColor=void 0,this._intersectionWidth=void 0,this._showThroughEllipsoid=void 0,this._gaze=void 0,this._showScanPlane=void 0,this._scanPlaneColor=void 0,this._scanPlaneMode=void 0,this._scanPlaneRate=void 0,this._definitionChanged=new o.Event,this.merge(o.defaultValue(e,o.defaultValue.EMPTY_OBJECT))}o.defineProperties(a.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:o.createPropertyDescriptor("show"),radius:o.createPropertyDescriptor("radius"),xHalfAngle:o.createPropertyDescriptor("xHalfAngle"),yHalfAngle:o.createPropertyDescriptor("yHalfAngle"),lineColor:o.createPropertyDescriptor("lineColor"),showSectorLines:o.createPropertyDescriptor("showSectorLines"),showSectorSegmentLines:o.createPropertyDescriptor("showSectorSegmentLines"),showLateralSurfaces:o.createPropertyDescriptor("showLateralSurfaces"),material:o.createMaterialPropertyDescriptor("material"),showDomeSurfaces:o.createPropertyDescriptor("showDomeSurfaces"),showDomeLines:o.createPropertyDescriptor("showDomeLines "),showIntersection:o.createPropertyDescriptor("showIntersection"),intersectionColor:o.createPropertyDescriptor("intersectionColor"),intersectionWidth:o.createPropertyDescriptor("intersectionWidth"),showThroughEllipsoid:o.createPropertyDescriptor("showThroughEllipsoid"),gaze:o.createPropertyDescriptor("gaze"),showScanPlane:o.createPropertyDescriptor("showScanPlane"),scanPlaneColor:o.createPropertyDescriptor("scanPlaneColor"),scanPlaneMode:o.createPropertyDescriptor("scanPlaneMode"),scanPlaneRate:o.createPropertyDescriptor("scanPlaneRate")}),a.prototype.clone=function(e){return o.defined(e)||(e=new a),e.show=this.show,e.radius=this.radius,e.xHalfAngle=this.xHalfAngle,e.yHalfAngle=this.yHalfAngle,e.lineColor=this.lineColor,e.showSectorLines=this.showSectorLines,e.showSectorSegmentLines=this.showSectorSegmentLines,e.showLateralSurfaces=this.showLateralSurfaces,e.material=this.material,e.showDomeSurfaces=this.showDomeSurfaces,e.showDomeLines=this.showDomeLines,e.showIntersection=this.showIntersection,e.intersectionColor=this.intersectionColor,e.intersectionWidth=this.intersectionWidth,e.showThroughEllipsoid=this.showThroughEllipsoid,e.gaze=this.gaze,e.showScanPlane=this.showScanPlane,e.scanPlaneColor=this.scanPlaneColor,e.scanPlaneMode=this.scanPlaneMode,e.scanPlaneRate=this.scanPlaneRate,e},a.prototype.merge=function(e){if(!o.defined(e))throw new o.DeveloperError("source is required.");this.slice=o.defaultValue(this.slice,e.slice),this.show=o.defaultValue(this.show,e.show),this.radius=o.defaultValue(this.radius,e.radius),this.xHalfAngle=o.defaultValue(this.xHalfAngle,e.xHalfAngle),this.yHalfAngle=o.defaultValue(this.yHalfAngle,e.yHalfAngle),this.lineColor=o.defaultValue(this.lineColor,e.lineColor),this.showSectorLines=o.defaultValue(this.showSectorLines,e.showSectorLines),this.showSectorSegmentLines=o.defaultValue(this.showSectorSegmentLines,e.showSectorSegmentLines),this.showLateralSurfaces=o.defaultValue(this.showLateralSurfaces,e.showLateralSurfaces),this.material=o.defaultValue(this.material,e.material),this.showDomeSurfaces=o.defaultValue(this.showDomeSurfaces,e.showDomeSurfaces),this.showDomeLines=o.defaultValue(this.showDomeLines,e.showDomeLines),this.showIntersection=o.defaultValue(this.showIntersection,e.showIntersection),this.intersectionColor=o.defaultValue(this.intersectionColor,e.intersectionColor),this.intersectionWidth=o.defaultValue(this.intersectionWidth,e.intersectionWidth),this.showThroughEllipsoid=o.defaultValue(this.showThroughEllipsoid,e.showThroughEllipsoid),this.gaze=o.defaultValue(this.gaze,e.gaze),this.showScanPlane=o.defaultValue(this.showScanPlane,e.showScanPlane),this.scanPlaneColor=o.defaultValue(this.scanPlaneColor,e.scanPlaneColor),this.scanPlaneMode=o.defaultValue(this.scanPlaneMode,e.scanPlaneMode),this.scanPlaneRate=o.defaultValue(this.scanPlaneRate,e.scanPlaneRate)},t.RectangularSensorGraphics=a},function(e,t,i){"use strict";i(47),i(48);var n=te(i(0)),r=i(12),o=ee(i(30)),a=i(49),s=ee(i(32)),l=i(50),c=i(33),u=te(i(20)),h=ee(i(19)),d=ee(i(4)),p=ee(i(43)),f=ee(i(92)),m=ee(i(1)),g=i(93),v=i(94),y=i(16),_=ee(i(39)),w=ee(i(7)),b=i(3),C=ee(i(2)),x=ee(i(6)),P=i(97),E=i(98),M=i(99),S=i(100),T=te(i(101)),D=te(i(102)),O=i(103),A=i(36),k=i(25),L=i(104),R=i(105),F=i(106),I=i(44),N=i(45),V=i(111),z=i(113),H=i(114),B=i(115),G=ee(i(116)),W=i(120),j=i(122),U=i(124),Y=i(125),q=i(126),J=i(127),Z=i(128),X=i(129),K=i(130),Q=i(131),$=i(132);function ee(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function te(e){return e&&e.__esModule?e:{default:e}}t.name="DHGSP for Cesium三维地球框架",t.version="1.8.3",t.date="2019-8-20",t.author="木遥（QQ 346819890，微信 muyao1987）",t.website="http://cesium.gspgis.cn",console.log("当前Cesium版本："+n.VERSION+" ， DHGSP版本："+t.version),t.Class=r.Class,t.widget=o,t.widget.BaseWidget=a.BaseWidget,t.image=s.image,t.createMap=l.createMap,t.ViewerEx=c.ViewerEx,t.layer=u.default,t.pointconvert=h,t.util=d,t.util.tileset=p,t.matrix=f,t.point=m,t.FlowEcharts=g.FlowEcharts,t.MapVLayer=v.MapVLayer,t.Draw=y.Draw,t.draw={},t.draw.util=C,t.draw.event=w,t.draw.tooltip=b.message,t.draw.dragger=x,t.draw.attr=_,t.Measure=P.Measure,t.DivPoint=E.DivPoint,t.FlyLine=M.FlyLine,t.TilesEditor=S.TilesEditor,t.shaders={},t.shaders.Rain=T.default,t.shaders.Snow=D.default,t.CircleFadeMaterial=O.CircleFadeMaterial,t.CircleWaveMaterial=A.CircleWaveMaterial,t.LineFlowMaterial=k.LineFlowMaterial,t.GroundPolylineFlowMaterial=L.GroundPolylineFlowMaterial,t.CoolPlaneMaterial=R.CoolPlaneMaterial,t.TextMaterial=F.TextMaterial,t.AnimationLineMaterialProperty=k.LineFlowMaterial,t.ElliposidFadeMaterialProperty=O.CircleFadeMaterial,t.RectangularSensorPrimitive=I.RectangularSensorPrimitive,t.RectangularSensorGraphics=N.RectangularSensorGraphics,t.RectangularSensorVisualizer=V.RectangularSensorVisualizer;var ie=n.DataSourceDisplay.defaultVisualizersCallback;n.DataSourceDisplay.defaultVisualizersCallback=function(e,t,i){var n=i.entities;return ie(e,t,i).concat([new V.RectangularSensorVisualizer(e,n)])},t.analysi={},t.analysi.TerrainClipPlan=z.TerrainClipPlan,t.analysi.TilesetClipPlan=H.TilesetClipPlan,t.analysi.FloodByEntity=B.FloodByEntity,t.analysi.GlobeDefine=G,t.analysi.ViewShed3D=W.ViewShed3D,t.analysi.VideoShed3D=j.VideoShed3D,t.analysi.TerrainFlood=U.TerrainFlood,t.analysi.TerrainExcavate=Y.TerrainExcavate,t.analysi.TilesetClip=q.TilesetClip,t.analysi.TilesetFlat=J.TilesetFlat,t.analysi.TilesetFlood=Z.TilesetFlood,t.analysi.Underground=X.Underground,t.branch={},t.branch.FuseTileAndBG=K.FuseTileAndBG,t.branch.PrimitiveBloom=Q.PrimitiveBloom,t.scene={},t.scene.FogEffect=$.FogEffect},function(e,t){},function(e,t){},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseWidget=void 0;var n,c="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)},r=i(5),l=(n=r)&&n.__esModule?n:{default:n},o=i(12),a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2)),s=i(31),u=i(30);var h=[];t.BaseWidget=o.Class.extend({viewer:null,options:{},config:{},path:"",isActivate:!1,isCreate:!1,initialize:function(e,t){this.viewer=t,this.config=e,this.path=e.path||"",this.init()},addCacheVersion:function(e){if(null==e)return e;var t=(0,u.getCacheVersion)();return t&&(-1==e.indexOf("?")?e+="?time="+t:-1==e.indexOf("time="+t)&&(e+="&time="+t)),e},activateBase:function(){var e=this;if(!this.isActivate){if(this.beforeActivate(),this.isActivate=!0,!this.isCreate){if(this.options.resources&&0<this.options.resources.length){for(var t=[],i=0;i<this.options.resources.length;i++){var n=this.options.resources[i];n=this._getUrl(n),-1==h.indexOf(n)&&t.push(n)}return h=h.concat(t),void s.Loader.async(t,function(){if(!e.create(function(){e._createWidgetView(),e.isCreate=!0})){if(e.config.createAtStart)return e.config.createAtStart=!1,e.isActivate=!1,void(e.isCreate=!0);e._createWidgetView(),e.isCreate=!0}})}if(this.create(function(){e._createWidgetView(),this.isCreate=!0}))return;if(e.config.createAtStart)return e.config.createAtStart=!1,e.isActivate=!1,void(e.isCreate=!0);this.isCreate=!0}return this._createWidgetView(),this}this.changeWidgetView(function(e){e._dom&&((0,l.default)(".layui-layer").each(function(){(0,l.default)(this).css("z-index",19891e3)}),(0,l.default)(e._dom).css("z-index",19891014))})},_createWidgetView:function(){var e=this.options.view;if(null==e)this._startActivate();else if(a.isArray(e)){this._viewcreate_allcount=e.length;for(var t=this._viewcreate_okcount=0;t<e.length;t++)this.createItemView(e[t])}else this._viewcreate_allcount=1,this._viewcreate_okcount=0,this.createItemView(e)},changeWidgetView:function(e){var t=this.options.view;if(null==t)return!1;if(a.isArray(t)){for(var i=!1,n=0;n<t.length;n++)i=i||e(t[n]);return i}return e(t)},createItemView:function(t){switch(t.type){default:case"window":this._openWindow(t);break;case"divwindow":this._openDivWindow(t);break;case"append":this._appendView(t);break;case"custom":var e=this._getUrl(t.url),i=this;t.open(e,function(e){i.winCreateOK(t,e),i._viewcreate_okcount++,i._viewcreate_okcount>=i._viewcreate_allcount&&i._startActivate(e)},this)}},_viewcreate_allcount:0,_viewcreate_okcount:0,_openWindow:function(i){var n=this,r=this._getUrl(i.url),e={type:2,content:[r,"no"],success:function(e){i._layerOpening=!1,i._dom=e;var t=window[e.find("iframe")[0].name];n.config.hasOwnProperty("visible")&&!n.config.visible&&(0,l.default)(e).hide(),layer.setTop(e),n.winCreateOK(i,t),n._viewcreate_okcount++,n._viewcreate_okcount>=n._viewcreate_allcount&&n._startActivate(e),t&&t.initWidgetView?t.initWidgetView(n):console.error(r+"页面没有定义function initWidgetView(widget)方法，无法初始化widget页面!")}};i._layerIdx,i._layerOpening=!0,i._layerIdx=layer.open(this._getWinOpt(i,e))},_openDivWindow:function(i){var e=this._getUrl(i.url),n=this;this.getHtml(e,function(e){var t={type:1,content:e,success:function(e){i._layerOpening=!1,i._dom=e,n.config.hasOwnProperty("visible")&&!n.config.visible&&(0,l.default)(e).hide(),layer.setTop(e),n.winCreateOK(i,e),n._viewcreate_okcount++,n._viewcreate_okcount>=n._viewcreate_allcount&&n._startActivate(e)}};i._layerOpening=!0,i._layerIdx=layer.open(n._getWinOpt(i,t))})},_getUrl:function(e){return(e=this.addCacheVersion(e)).startsWith("/")||e.startsWith(".")||e.startsWith("http")?e:this.path+e},_getWinOpt:function(e,t){var i=(0,u.getDefWindowOptions)(),n=l.default.extend(i,e.windowOptions);n=l.default.extend(n,this.config.windowOptions),e.windowOptions=n;var r=this,o=this._getWinSize(n),a={title:!n.noTitle&&(this.config.name||" "),area:o.area,offset:o.offset,shade:0,maxmin:!1,zIndex:layer.zIndex,end:function(){e._layerIdx=-1,e._dom=null,r.disableBase()},full:function(e){r.winFull(e)},min:function(e){r.winMin(e)},restore:function(e){r.winRestore(e)}},s=l.default.extend(a,n);return l.default.extend(s,t||{})},_getWinSize:function(e){var t=this.bfb2Number(e.width,document.documentElement.clientWidth,e),i=this.bfb2Number(e.height,document.documentElement.clientHeight,e),n="",r=e.position;if(r)if("string"==typeof r)n=r;else if("object"==(void 0===r?"undefined":c(r))){var o,a;if(r.hasOwnProperty("top")&&null!=r.top&&(o=this.bfb2Number(r.top,document.documentElement.clientHeight,e)),r.hasOwnProperty("bottom")&&null!=r.bottom){e._hasresize=!0;var s=this.bfb2Number(r.bottom,document.documentElement.clientHeight,e);null!=o?i=document.documentElement.clientHeight-o-s:o=document.documentElement.clientHeight-i-s}if(r.hasOwnProperty("left")&&null!=r.left&&(a=this.bfb2Number(r.left,document.documentElement.clientWidth,e)),r.hasOwnProperty("right")&&null!=r.right){e._hasresize=!0;var l=this.bfb2Number(r.right,document.documentElement.clientWidth,e);null!=a?t=document.documentElement.clientWidth-a-l:a=document.documentElement.clientWidth-t-l}null==o&&(o=(document.documentElement.clientHeight-i)/2),null==a&&(a=(document.documentElement.clientWidth-t)/2),n=[o+"px",a+"px"]}return e.hasOwnProperty("minHeight")&&i<e.minHeight&&(e._hasresize=!0,i=e.minHeight),e.hasOwnProperty("maxHeight")&&i>e.maxHeight&&(e._hasresize=!0,i=e.maxHeight),e.hasOwnProperty("minHeight")&&t<e.minWidth&&(e._hasresize=!0,t=e.minWidth),e.hasOwnProperty("maxWidth")&&t>e.maxWidth&&(e._hasresize=!0,t=e.maxWidth),{area:t&&i?[t+"px",i+"px"]:t+"px",offset:n}},bfb2Number:function(e,t,i){return"string"==typeof e&&-1!=e.indexOf("%")?(i._hasresize=!0,t*Number(e.replace("%",""))/100):e},_appendView:function(t){if(this.isCreate&&t._dom)(0,l.default)(t._dom).show({duration:500}),this._startActivate(t._dom);else{var e=this._getUrl(t.url),i=this;i.getHtml(e,function(e){t._dom=(0,l.default)(e).appendTo(t.parent||"body"),i.winCreateOK(t,e),i._viewcreate_okcount++,i._viewcreate_okcount>=i._viewcreate_allcount&&i._startActivate(e)})}},disableBase:function(){this.isActivate&&(this.beforeDisable(),this.changeWidgetView(function(e){return null!=e._layerIdx&&-1!=e._layerIdx?(e._layerOpening,layer.close(e._layerIdx),!0):("append"==e.type&&e._dom&&(0,l.default)(e._dom).hide({duration:1e3}),"custom"==e.type&&e.close&&e.close(),!1)})||(this.disable(),this.isActivate=!1))},setViewVisible:function(t){this.changeWidgetView(function(e){null!=e._layerIdx&&-1!=e._layerIdx?t?(0,l.default)("#layui-layer"+e._layerIdx).show():(0,l.default)("#layui-layer"+e._layerIdx).hide():"append"==e.type&&e._dom&&(t?(0,l.default)(e._dom).show():(0,l.default)(e._dom).hide())})},setViewCss:function(t){this.changeWidgetView(function(e){null!=e._layerIdx&&-1!=e._layerIdx?(0,l.default)("#layui-layer"+e._layerIdx).css(t):"append"==e.type&&e._dom&&(0,l.default)(e._dom).css(t)})},indexResize:function(){if(this.isActivate){var n=this;this.changeWidgetView(function(e){if(null!=e._layerIdx&&-1!=e._layerIdx&&null!=e.windowOptions&&e.windowOptions._hasresize){var t=n._getWinSize(e.windowOptions),i={width:t.area[0],height:t.area[1],top:t.offset[0],left:t.offset[1]};(0,l.default)(e._dom).attr("myTopLeft",!0),layer.style(e._layerIdx,i),"divwindow"==e.type&&layer.iframeAuto(e._layerIdx)}})}},_startActivate:function(e){this.activate(e),this.config.success&&this.config.success(this),this.isActivate||this.disableBase()},init:function(){},create:function(){},beforeActivate:function(){},activate:function(){},beforeDisable:function(){},disable:function(){},winCreateOK:function(){},winFull:function(){},winMin:function(){},winRestore:function(){},getHtml:function(e,t){l.default.ajax({url:e,type:"GET",dataType:"html",timeout:0,success:function(e){t(e)}})}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createMap=createMap;var _Cesium=__webpack_require__(0),_Cesium2=_interopRequireDefault(_Cesium),_jquery=__webpack_require__(5),_jquery2=_interopRequireDefault(_jquery),_util2=__webpack_require__(4),_util=_interopRequireWildcard(_util2),_ViewerEx=__webpack_require__(33),_GaodePOIGeocoder=__webpack_require__(90),_layer=__webpack_require__(20),_alert=__webpack_require__(91);function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function createMap(i){if((0,_alert.testTk)()){if(i.url)return _jquery2.default.ajax({type:"get",dataType:"json",url:i.url,timeout:0,success:function(e){e.serverURL&&(i.serverURL=e.serverURL);var t=initMap(e.map3d,i);i.success&&i.success(t,e,e)},error:function(){console.log(i.url+"文件加载失败！"),_util.alert(i.url+"文件加载失败！")}}),null;var e=initMap(i.data,i);return i.success&&i.success(e,i.data),e}}function initMap(e,t){var i,n=t.id,r={animation:!1,timeline:!1,fullscreenButton:!0,vrButton:!1,geocoder:!1,sceneModePicker:!1,homeButton:!0,navigationHelpButton:!0,navigationInstructionsInitiallyVisible:!1,infoBox:!0,selectionIndicator:!1,shouldAnimate:!0,showRenderLoopErrors:!0,baseLayerPicker:!1,contextmenu:!0};for(var o in e)r[o]=e[o];if(r)for(var o in t)"id"!==o&&"success"!==o&&(r[o]=t[o]);_Cesium2.Ion&&(_Cesium2.Ion.defaultAccessToken=r.ionToken||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI1NjM5MjMxOS1lMWVkLTQyNDQtYTM4Yi0wZjA4ZDMxYTlmNDMiLCJpZCI6MTQ4MiwiaWF0IjoxNTI4Njc3NDQyfQ.vVoSexHMqQhKK5loNCv6gCA5d5_z3wE2M0l_rWnIP_w"),_Cesium2.AnimationViewModel.defaultTicks=r.animationTicks||[.1,.25,.5,1,2,5,10,15,30,60,120,300,600,900,1800,3600],!0===r.geocoder&&(r.geocoder=new _GaodePOIGeocoder.GaodePOIGeocoder(r.geocoderConfig)),r.terrain&&r.terrain.visible&&(i=getTerrainProvider(r.terrain,r.serverURL),r.terrainProvider=i);var a=!1;if(r.baseLayerPicker){if(!r.imageryProviderViewModels&&r.basemaps&&0<r.basemaps.length){var s=getImageryProviderArr(r.basemaps);r.imageryProviderViewModels=s.imageryProviderViewModels,r.selectedImageryProviderViewModel=s.imageryProviderViewModels[s.index]}r.terrainProviderViewModels||(r.terrainProviderViewModels=getTerrainProviderViewModelsArr(r.terrain,r.serverURL),r.selectedTerrainProviderViewModel=r.terrainProviderViewModels[1])}else null==r.imageryProvider&&(a=!0,r.imageryProvider=_Cesium2.createTileMapServiceImageryProvider({url:_Cesium2.buildModuleUrl("Assets/Textures/NaturalEarthII")}));var l=new _Cesium2.Viewer(n,r);if(a)for(var c=l.imageryLayers,u=c.length,h=0;h<u;h++){var d=c.get(0);c.remove(d,!0)}return r.geocoder&&(r.geocoder.viewer=l),delete r.geocoder,delete r.imageryProviderViewModels,delete r.selectedImageryProviderViewModel,delete r.terrainProviderViewModels,delete r.selectedTerrainProviderViewModel,delete r.terrainProvider,delete r.imageryProvider,l.gsp=new _ViewerEx.ViewerEx(l,r),i&&(l.gsp.terrainProvider=i),l.gisdata={config:l.gsp.config},l}function getTerrainProvider(e,t){return e.url&&(t&&(e.url=e.url.replace("$serverURL$",t)),e.url=e.url.replace("$hostname$",location.hostname).replace("$host$",location.host)),_util.getTerrainProvider(e)}function getImageryProviderArr(layersCfg){var providerViewModels=[],selectedIndex=0;window._temp_createImageryProvider=_layer.createImageryProvider;for(var i=0;i<layersCfg.length;i++){var item=layersCfg[i];if("group"!=item.type||null!=item.layers){item.visible&&(selectedIndex=providerViewModels.length);var funstr="window._temp_basemaps"+i+" = function () {                        var item = "+JSON.stringify(item)+';                        if (item.type == "group") {                            var arrVec = [];                            for (var index = 0; index < item.layers.length; index++) {                                var temp = window._temp_createImageryProvider(item.layers[index]);                                if (temp == null) continue;                                arrVec.push(temp);                            }                            return arrVec;                        }                        else {                            return window._temp_createImageryProvider(item);                        }                     }';eval(funstr);var imgModel=new _Cesium2.ProviderViewModel({name:item.name||"未命名",tooltip:item.name||"未命名",iconUrl:item.icon||"",creationFunction:eval("window._temp_basemaps"+i)});providerViewModels.push(imgModel)}}return{imageryProviderViewModels:providerViewModels,index:selectedIndex}}function getTerrainProviderViewModelsArr(e,t){return[new _Cesium2.ProviderViewModel({name:"无地形",iconUrl:_Cesium2.buildModuleUrl("Widgets/Images/TerrainProviders/Ellipsoid.png"),tooltip:"WGS84标准椭球，即 EPSG:4326",category:"",creationFunction:function(){return new _Cesium2.EllipsoidTerrainProvider({ellipsoid:_Cesium2.Ellipsoid.WGS84})}}),new _Cesium2.ProviderViewModel({name:"中国地形",iconUrl:_Cesium2.buildModuleUrl("Widgets/Images/TerrainProviders/CesiumWorldTerrain.png"),tooltip:"杭州德慧 提供的高分辨率中国地形",category:"",creationFunction:function(){return getTerrainProvider(e,t)}}),new _Cesium2.ProviderViewModel({name:"全球地形",iconUrl:_Cesium2.buildModuleUrl("Widgets/Images/TerrainProviders/CesiumWorldTerrain.png"),tooltip:"Cesium官方 提供的高分辨率全球地形",category:"",creationFunction:function(){return _util.getTerrainProvider({type:"ion"})}})]}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Evented=t.Events=void 0;var a="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)},n=i(12),l=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2));var r=t.Events={on:function(e,t,i){if("object"===(void 0===e?"undefined":a(e)))for(var n in e)this._on(n,e[n],t);else for(var r=0,o=(e=l.splitWords(e)).length;r<o;r++)this._on(e[r],t,i);return this},off:function(e,t,i){if(e)if("object"===(void 0===e?"undefined":a(e)))for(var n in e)this._off(n,e[n],t);else for(var r=0,o=(e=l.splitWords(e)).length;r<o;r++)this._off(e[r],t,i);else delete this._events;return this},_on:function(e,t,i){this._events=this._events||{};var n=this._events[e];n||(n=[],this._events[e]=n),i===this&&(i=void 0);for(var r={fn:t,ctx:i},o=n,a=0,s=o.length;a<s;a++)if(o[a].fn===t&&o[a].ctx===i)return;o.push(r)},_off:function(e,t,i){var n,r,o;if(this._events&&(n=this._events[e]))if(t){if(i===this&&(i=void 0),n)for(r=0,o=n.length;r<o;r++){var a=n[r];if(a.ctx===i&&a.fn===t)return a.fn=l.falseFn,this._firingCount&&(this._events[e]=n=n.slice()),void n.splice(r,1)}}else{for(r=0,o=n.length;r<o;r++)n[r].fn=l.falseFn;delete this._events[e]}},fire:function(e,t,i){if(!this.listens(e,i))return this;var n=l.extend({},t,{type:e,target:this,sourceTarget:t&&t.sourceTarget||this});if(this._events){var r=this._events[e];if(r){this._firingCount=this._firingCount+1||1;for(var o=0,a=r.length;o<a;o++){var s=r[o];s.fn.call(s.ctx||this,n)}this._firingCount--}}return i&&this._propagateEvent(n),this},listens:function(e,t){var i=this._events&&this._events[e];if(i&&i.length)return!0;if(t)for(var n in this._eventParents)if(this._eventParents[n].listens(e,t))return!0;return!1},once:function(e,t,i){if("object"===(void 0===e?"undefined":a(e))){for(var n in e)this.once(n,e[n],t);return this}var r=l.bind(function(){this.off(e,t,i).off(e,r,i)},this);return this.on(e,t,i).on(e,r,i)},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[l.stamp(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[l.stamp(e)],this},_propagateEvent:function(e){for(var t in this._eventParents)this._eventParents[t].fire(e.type,l.extend({layer:e.target,propagatedFrom:e.target},e),!0)}};r.addEventListener=r.on,r.removeEventListener=r.clearAllEventListeners=r.off,r.addOneTimeEventListener=r.once,r.fireEvent=r.fire,r.hasEventListeners=r.listens;t.Evented=n.Class.extend(r)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditPoint=void 0;var n,r=i(0),o=((n=r)&&n.__esModule,function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(6))),a=i(3),s=i(18);t.EditPoint=s.EditBase.extend({setPositions:function(e){this.entity.position.setValue(e)},bindDraggers:function(){var i=this;this.entity.draw_tooltip=a.message.dragger.def;o.createDragger(this.dataSource,{dragger:this.entity,onDrag:function(e,t){i.entity.position.setValue(t)}})},finish:function(){this.entity.draw_tooltip=null}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawBillboard=void 0;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=i(17),s=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(15));t.DrawBillboard=a.DrawPoint.extend({type:"billboard",createFeature:function(e){this._positions_draw=null;var t=this,i={show:!1,position:new o.CallbackProperty(function(e){return t.getDrawPosition()},!1),billboard:s.style2Entity(e.style),attribute:e};return this.entity=this.dataSource.entities.add(i),this.entity},style2Entity:function(e,t){return s.style2Entity(e,t.billboard)},getAttrClass:function(){return s}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawLabel=void 0;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=i(17),s=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(13));t.DrawLabel=a.DrawPoint.extend({type:"label",createFeature:function(e){this._positions_draw=null;var t=this,i={show:!1,position:new o.CallbackProperty(function(e){return t.getDrawPosition()},!1),label:s.style2Entity(e.style),attribute:e};return this.entity=this.dataSource.entities.add(i),this.entity},style2Entity:function(e,t){return s.style2Entity(e,t.label)},getAttrClass:function(){return s}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawModel=void 0;var n,r=i(0),s=(n=r)&&n.__esModule?n:{default:n},o=i(17),a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(24));t.DrawModel=o.DrawPoint.extend({type:"model",createFeature:function(e){this._positions_draw=null;var t=this,i={position:new s.CallbackProperty(function(e){return t.getDrawPosition()},!1),model:a.style2Entity(e.style),attribute:e};return this.entity=this.dataSource.entities.add(i),this.entity},style2Entity:function(e,t){return this.updateOrientation(e,t),a.style2Entity(e,t.model)},updateAttrForDrawing:function(){this.updateOrientation(this.entity.attribute.style,this.entity)},updateOrientation:function(e,t){var i=t.position.getValue(this.viewer.clock.currentTime);if(null!=i){var n=s.Math.toRadians(Number(e.heading||0)),r=s.Math.toRadians(Number(e.pitch||0)),o=s.Math.toRadians(Number(e.roll||0)),a=new s.HeadingPitchRoll(n,r,o);t.orientation=s.Transforms.headingPitchRollQuaternion(i,a)}},getAttrClass:function(){return a}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawCurve=void 0;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=i(8),s=i(10),l=i(57);t.DrawCurve=a.DrawPolyline.extend({type:"curve",_positions_show:null,getDrawPosition:function(){return this._positions_show},updateAttrForDrawing:function(){null==this._positions_draw||this._positions_draw.length<3?this._positions_show=this._positions_draw:this._positions_show=(0,s.line2curve)(this._positions_draw)},getEditClass:function(e){var t=new l.EditCurve(e,this.viewer,this.dataSource);return this._bindEdit(t)},finish:function(){var t=this.entity;t.editing=this.getEditClass(t),this.entity._positions_draw=this._positions_draw,this.entity._positions_show=this._positions_show,t.polyline.positions=new o.CallbackProperty(function(e){return t._positions_show},!1)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditCurve=void 0;var n,r=i(0),o=((n=r)&&n.__esModule,i(14)),a=i(10);t.EditCurve=o.EditPolyline.extend({changePositionsToCallback:function(){this._positions_draw=this.entity._positions_draw,this._positions_show=this.entity._positions_show||this.entity.polyline.positions.getValue(this.viewer.clock.currentTime)},updateAttrForEditing:function(){null==this._positions_draw||this._positions_draw.length<3?this._positions_show=this._positions_draw:(this._positions_show=(0,a.line2curve)(this._positions_draw),this.entity._positions_show=this._positions_show)},finish:function(){this.entity._positions_show=this._positions_show,this.entity._positions_draw=this._positions_draw}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawPolylineVolume=void 0;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=i(8),s=(i(1),c(i(34))),l=i(59);c(i(2));function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.DrawPolylineVolume=a.DrawPolyline.extend({type:"polylineVolume",_minPointNum:2,_maxPointNum:9999,createFeature:function(e){this._positions_draw=[],e.config?(this._minPointNum=e.config.minPointNum||2,this._maxPointNum=e.config.maxPointNum||9999):(this._minPointNum=2,this._maxPointNum=9999);var t=this,i={polylineVolume:s.style2Entity(e.style),attribute:e};return i.polylineVolume.positions=new o.CallbackProperty(function(e){return t.getDrawPosition()},!1),this.entity=this.dataSource.entities.add(i),this.entity._positions_draw=this._positions_draw,this.entity},style2Entity:function(e,t){return s.style2Entity(e,t.polylineVolume)},updateAttrForDrawing:function(){},getEditClass:function(e){var t=new l.EditPolylineVolume(e,this.viewer,this.dataSource);return t._minPointNum=this._minPointNum,t._maxPointNum=this._maxPointNum,this._bindEdit(t)},getAttrClass:function(){return s},finish:function(){this.entity.editing=this.getEditClass(this.entity),this.entity.polylineVolume.positions=this.getDrawPosition()}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditPolylineVolume=void 0;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=i(14);i(10);t.EditPolylineVolume=a.EditPolyline.extend({changePositionsToCallback:function(){var t=this;this._positions_draw=this.entity.polylineVolume.positions.getValue(this.viewer.clock.currentTime),this.entity.polylineVolume.positions=new o.CallbackProperty(function(e){return t.getPosition()},!1)},finish:function(){this.entity.polylineVolume.positions=this.getPosition()}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawCorridor=void 0;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=i(8),s=(i(1),c(i(61))),l=i(62);c(i(2));function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.DrawCorridor=a.DrawPolyline.extend({type:"corridor",_minPointNum:2,_maxPointNum:9999,createFeature:function(e){this._positions_draw=[],e.config?(this._minPointNum=e.config.minPointNum||2,this._maxPointNum=e.config.maxPointNum||9999):(this._minPointNum=2,this._maxPointNum=9999);var t=this,i={corridor:s.style2Entity(e.style),attribute:e};return i.corridor.positions=new o.CallbackProperty(function(e){return t.getDrawPosition()},!1),this.entity=this.dataSource.entities.add(i),this.entity._positions_draw=this._positions_draw,this.entity},style2Entity:function(e,t){return s.style2Entity(e,t.corridor)},updateAttrForDrawing:function(){},getEditClass:function(e){var t=new l.EditCorridor(e,this.viewer,this.dataSource);return t._minPointNum=this._minPointNum,t._maxPointNum=this._maxPointNum,this._bindEdit(t)},getAttrClass:function(){return s},finish:function(){var t=this.entity;t.editing=this.getEditClass(t),t._positions_draw=this.getDrawPosition(),t.corridor.positions=new o.CallbackProperty(function(e){return t._positions_draw},!1)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){e=e||{},null==t&&(t={fill:!0});for(var i in e){var n=e[i];switch(i){default:t[i]=n;break;case"opacity":case"outlineOpacity":break;case"outlineColor":t.outlineColor=new o.Color.fromCssColorString(n||"#FFFF00").withAlpha(e.outlineOpacity||e.opacity||1);break;case"color":t.material=new o.Color.fromCssColorString(n||"#FFFF00").withAlpha(Number(e.opacity||1));break;case"cornerType":switch(n){case"BEVELED":t.cornerType=o.CornerType.BEVELED;break;case"MITERED":t.cornerType=o.CornerType.MITERED;break;case"ROUNDED":t.cornerType=o.CornerType.ROUNDED;break;default:t.cornerType=n}}}null==t.material&&(t.material=o.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:Number(e.opacity||1)}));return t},t.getPositions=s,t.getCoordinates=l,t.toGeoJSON=function(e){var t=l(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"LineString",coordinates:t}}};var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2));function s(e){return e.corridor.positions.getValue(o.JulianDate.fromDate(new Date))}function l(e){var t=s(e);return a.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditCorridor=void 0;var n,r=i(0),o=((n=r)&&n.__esModule,i(14));t.EditCorridor=o.EditPolyline.extend({changePositionsToCallback:function(){this._positions_draw=this.entity._positions_draw||this.entity.corridor.positions.getValue(this.viewer.clock.currentTime)},finish:function(){this.entity._positions_draw=this.getPosition()}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawPolygon=void 0;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=i(8),s=i(1),l=u(i(11)),c=i(26);u(i(2));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.DrawPolygon=a.DrawPolyline.extend({type:"polygon",_minPointNum:3,_maxPointNum:9999,createFeature:function(e){this._positions_draw=[],e.config?(this._minPointNum=e.config.minPointNum||3,this._maxPointNum=e.config.maxPointNum||9999):(this._minPointNum=3,this._maxPointNum=9999);var i=this,t={polygon:l.style2Entity(e.style),attribute:e};return t.polygon.hierarchy=new o.CallbackProperty(function(e){var t=i.getDrawPosition();return new o.PolygonHierarchy(t)},!1),t.polyline={clampToGround:e.style.clampToGround,show:!1},this.entity=this.dataSource.entities.add(t),this.bindOutline(this.entity),this.entity},style2Entity:function(e,t){return l.style2Entity(e,t.polygon)},bindOutline:function(i){i.polyline.show=new o.CallbackProperty(function(e){var t=l.getPositions(i);return!!(t&&t.length<3)||i.polygon.outline&&i.polygon.outline.getValue(e)&&i.polygon.outlineWidth&&1<i.polygon.outlineWidth.getValue(e)},!1),i.polyline.positions=new o.CallbackProperty(function(e){if(!i.polyline.show.getValue(e))return null;var t=l.getPositions(i);return t&&t.length<3?t:t.concat([t[0]])},!1),i.polyline.width=new o.CallbackProperty(function(e){var t=l.getPositions(i);return t&&t.length<3?2:i.polygon.outlineWidth},!1),i.polyline.material=new o.ColorMaterialProperty(new o.CallbackProperty(function(e){var t=l.getPositions(i);return t&&t.length<3?i.polygon.material.color.getValue(e):i.polygon.outlineColor.getValue(e)},!1))},updateAttrForDrawing:function(){var e=this.entity.attribute.style;if(e.extrudedHeight){var t=(0,s.getMaxHeight)(this.getDrawPosition());this.entity.polygon.extrudedHeight=t+Number(e.extrudedHeight)}},getEditClass:function(e){var t=new c.EditPolygon(e,this.viewer,this.dataSource);return t._minPointNum=this._minPointNum,t._maxPointNum=this._maxPointNum,this._bindEdit(t)},getAttrClass:function(){return l},finish:function(){var i=this.entity;i.editing=this.getEditClass(i),i._positions_draw=this.getDrawPosition(),i.polygon.hierarchy=new o.CallbackProperty(function(e){var t=i._positions_draw;return new o.PolygonHierarchy(t)},!1)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawRectangle=void 0;var n,r=i(0),a=(n=r)&&n.__esModule?n:{default:n},o=i(8),s=i(1),l=u(i(35)),c=i(65);u(i(2));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.DrawRectangle=o.DrawPolyline.extend({type:"rectangle",_minPointNum:2,_maxPointNum:2,getRectangle:function(){var e=this.getDrawPosition();return e.length<2?null:a.Rectangle.fromCartesianArray(e)},createFeature:function(e){this._positions_draw=[];var t=this,i={rectangle:l.style2Entity(e.style),attribute:e};return i.rectangle.coordinates=new a.CallbackProperty(function(e){return t.getRectangle()},!1),i.polyline={clampToGround:e.style.clampToGround,show:!1},this.entity=this.dataSource.entities.add(i),this.bindOutline(this.entity),this.entity},style2Entity:function(e,t){return l.style2Entity(e,t.rectangle)},bindOutline:function(o){o.polyline.show=new a.CallbackProperty(function(e){return o.rectangle.outline&&o.rectangle.outline.getValue(e)&&o.rectangle.outlineWidth&&1<o.rectangle.outlineWidth.getValue(e)},!1),o.polyline.positions=new a.CallbackProperty(function(e){if(!o.polyline.show.getValue(e))return null;var t=o._draw_positions,i=o.rectangle.height?o.rectangle.height.getValue(e):0,n=a.Rectangle.fromCartesianArray(t),r=a.Cartesian3.fromRadians(n.west,n.south,i);return[r,a.Cartesian3.fromRadians(n.east,n.south,i),a.Cartesian3.fromRadians(n.east,n.north,i),a.Cartesian3.fromRadians(n.west,n.north,i),r]},!1),o.polyline.width=new a.CallbackProperty(function(e){return o.rectangle.outlineWidth},!1),o.polyline.material=new a.ColorMaterialProperty(new a.CallbackProperty(function(e){return o.rectangle.outlineColor.getValue(e)},!1))},updateAttrForDrawing:function(){var e=this.entity.attribute.style;if(!e.clampToGround){var t=(0,s.getMaxHeight)(this.getDrawPosition());this.entity.rectangle.height=t,e.height=t,e.extrudedHeight&&(this.entity.rectangle.extrudedHeight=t+Number(e.extrudedHeight))}},getEditClass:function(e){var t=new c.EditRectangle(e,this.viewer,this.dataSource);return t._minPointNum=this._minPointNum,t._maxPointNum=this._maxPointNum,this._bindEdit(t)},getAttrClass:function(){return l},finish:function(){var t=this.entity;t.editing=this.getEditClass(t),t._positions_draw=this._positions_draw,t.rectangle.coordinates=new a.CallbackProperty(function(e){return t._positions_draw.length<2?null:a.Rectangle.fromCartesianArray(t._positions_draw)},!1)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditRectangle=void 0;var n,r=i(0),l=((n=r)&&n.__esModule,function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(6))),o=(i(3),i(26)),c=i(1);t.EditRectangle=o.EditPolygon.extend({changePositionsToCallback:function(){this._positions_draw=this.entity._positions_draw},finish:function(){this.entity._positions_draw=this._positions_draw},isClampToGround:function(){return this.entity.attribute.style.clampToGround},bindDraggers:function(){for(var r=this,e=this.isClampToGround(),o=this.getPosition(),t=0,i=o.length;t<i;t++){var n=o[t];if(null!=this.entity.rectangle.height){var a=this.entity.rectangle.height.getValue(this.viewer.clock.currentTime);n=(0,c.setPositionsHeight)(n,a)}e&&(n=(0,c.updateHeightForClampToGround)(this.viewer,n));var s=l.createDragger(this.dataSource,{position:n,onDrag:function(e,t){if(null!=r.entity.rectangle.height){var i=r.entity.rectangle.height.getValue(this.viewer.clock.currentTime);t=(0,c.setPositionsHeight)(t,i),e.position=t}if(o[e.index]=t,r.heightDraggers&&0<r.heightDraggers.length){var n=r.entity.rectangle.extrudedHeight.getValue(this.viewer.clock.currentTime);r.heightDraggers[e.index].position=(0,c.setPositionsHeight)(t,n)}}});s.index=t,this.draggers.push(s)}this.entity.rectangle.extrudedHeight&&this.bindHeightDraggers(this.entity.rectangle)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawCircle=void 0;var n,r=i(0),a=(n=r)&&n.__esModule?n:{default:n},o=i(8),s=(i(1),c(i(7)),i(3),c(i(27))),l=i(67);function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.DrawCircle=o.DrawPolyline.extend({type:"ellipse",_minPointNum:2,_maxPointNum:2,getShowPosition:function(){return this._positions_draw&&1<this._positions_draw.length?this._positions_draw[0]:null},createFeature:function(e){this._positions_draw=[],"ellipse"==e.type?this._maxPointNum=3:this._maxPointNum=2;var t=this,i={position:new a.CallbackProperty(function(e){return t.getShowPosition()},!1),ellipse:s.style2Entity(e.style),attribute:e};return this.entity=this.dataSource.entities.add(i),this.entity},style2Entity:function(e,t){return s.style2Entity(e,t.ellipse)},updateAttrForDrawing:function(e){if(this._positions_draw)if(e)this.addPositionsForRadius(this._positions_draw);else if(!(this._positions_draw.length<2)){var t=this.entity.attribute.style;if(!t.clampToGround){var i=this.formatNum(a.Cartographic.fromCartesian(this._positions_draw[0]).height,2);if(this.entity.ellipse.height=i,t.height=i,t.extrudedHeight){var n=i+Number(t.extrudedHeight);this.entity.ellipse.extrudedHeight=n}}var r,o=this.formatNum(a.Cartesian3.distance(this._positions_draw[0],this._positions_draw[1]),2);if(this.entity.ellipse.semiMinorAxis=o,3==this._maxPointNum)r=3==this._positions_draw.length?this.formatNum(a.Cartesian3.distance(this._positions_draw[0],this._positions_draw[2]),2):o,this.entity.ellipse.semiMajorAxis=r,t.semiMinorAxis=o,t.semiMajorAxis=r;else this.entity.ellipse.semiMajorAxis=o,t.radius=o}},addPositionsForRadius:function(e){this._positions_draw=[e];var t=this.entity.attribute.style,i=a.EllipseGeometryLibrary.computeEllipsePositions({center:e,semiMajorAxis:this.entity.ellipse.semiMajorAxis.getValue(this.viewer.clock.currentTime),semiMinorAxis:this.entity.ellipse.semiMinorAxis.getValue(this.viewer.clock.currentTime),rotation:a.Math.toRadians(Number(t.rotation||0)),granularity:2},!0,!1),n=new a.Cartesian3(i.positions[0],i.positions[1],i.positions[2]);if(this._positions_draw.push(n),3==this._maxPointNum){var r=new a.Cartesian3(i.positions[3],i.positions[4],i.positions[5]);this._positions_draw.push(r)}},getEditClass:function(e){var t=new l.EditCircle(e,this.viewer,this.dataSource);return t._minPointNum=this._minPointNum,t._maxPointNum=this._maxPointNum,this._bindEdit(t)},getAttrClass:function(){return s},finish:function(){var t=this.entity;t.editing=this.getEditClass(t),t._positions_draw=this._positions_draw,t.position=new a.CallbackProperty(function(e){return t._positions_draw&&0<t._positions_draw.length?t._positions_draw[0]:null},!1)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditCircle=void 0;var n,r=i(0),v=(n=r)&&n.__esModule?n:{default:n},y=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(6)),_=i(3),o=i(26),w=i(1);t.EditCircle=o.EditPolygon.extend({changePositionsToCallback:function(){this._positions_draw=this.entity._positions_draw},finish:function(){this.entity._positions_draw=this._positions_draw},isClampToGround:function(){return this.entity.attribute.style.clampToGround},getPosition:function(){if(null!=this.entity.ellipse.height)for(var e=this.entity.ellipse.height.getValue(this.viewer.clock.currentTime),t=0,i=this._positions_draw.length;t<i;t++)this._positions_draw[t]=(0,w.setPositionsHeight)(this._positions_draw[t],e);return this._positions_draw},bindDraggers:function(){var r=this,e=this.isClampToGround(),o=this.getPosition(),a=new v.Cartesian3,s=new v.Cartesian3,l=this.entity.attribute.style,t=o[0];e&&(t=(0,w.updateHeightForClampToGround)(this.viewer,t),o[0]=t);var i=y.createDragger(this.dataSource,{position:t,onDrag:function(e,t){if(v.Cartesian3.subtract(t,o[e.index],a),o[e.index]=t,!l.clampToGround){var i=r.formatNum(v.Cartographic.fromCartesian(t).height,2);r.entity.ellipse.height=i,l.height=i}var n=r.viewer.clock.currentTime;v.Cartesian3.add(e.majorDragger.position.getValue(n),a,s),e.majorDragger.position=s,e.minorDragger&&(v.Cartesian3.add(e.minorDragger.position.getValue(n),a,s),e.minorDragger.position=s),null!=r.entity.attribute.style.extrudedHeight&&r.updateDraggers()}});i.index=0,this.draggers.push(i);var c=this.viewer.clock.currentTime,n=v.EllipseGeometryLibrary.computeEllipsePositions({center:t,semiMajorAxis:this.entity.ellipse.semiMajorAxis.getValue(c),semiMinorAxis:this.entity.ellipse.semiMinorAxis.getValue(c),rotation:v.Math.toRadians(Number(l.rotation||0)),granularity:2},!0,!1),u=new v.Cartesian3(n.positions[0],n.positions[1],n.positions[2]);e&&(u=(0,w.updateHeightForClampToGround)(this.viewer,u)),o[1]=u;var h=y.createDragger(this.dataSource,{position:u,type:y.PointType.EditAttr,tooltip:_.message.dragger.editRadius,onDrag:function(e,t){if(null!=r.entity.ellipse.height){var i=r.entity.ellipse.height.getValue(c);t=(0,w.setPositionsHeight)(t,i),e.position=t}o[e.index]=t;var n=r.formatNum(v.Cartesian3.distance(o[0],t),2);r.entity.ellipse.semiMajorAxis=n,l.radius?(r.entity.ellipse.semiMinorAxis=n,l.radius=n):l.semiMajorAxis=n,null!=r.entity.attribute.style.extrudedHeight&&r.updateDraggers()}});if(h.index=1,i.majorDragger=h,this.draggers.push(h),3==this._maxPointNum){var d=new v.Cartesian3(n.positions[3],n.positions[4],n.positions[5]);e&&(d=(0,w.updateHeightForClampToGround)(this.viewer,d)),o[2]=d;var p=y.createDragger(this.dataSource,{position:d,type:y.PointType.EditAttr,tooltip:_.message.dragger.editRadius,onDrag:function(e,t){if(null!=r.entity.ellipse.height){var i=r.entity.ellipse.height.getValue(c);t=(0,w.setPositionsHeight)(t,i),e.position=t}o[e.index]=t;var n=r.formatNum(v.Cartesian3.distance(o[0],t),2);r.entity.ellipse.semiMinorAxis=n,l.radius?(r.entity.ellipse.semiMajorAxis=n,l.radius=n):l.semiMinorAxis=n,null!=r.entity.attribute.style.extrudedHeight&&r.updateDraggers()}});p.index=2,i.minorDragger=p,this.draggers.push(p)}if(this.entity.ellipse.extrudedHeight){var f=this.entity.ellipse.extrudedHeight.getValue(c),m=(t=(0,w.setPositionsHeight)(o[0],f),y.createDragger(this.dataSource,{position:t,onDrag:function(e,t){t=(0,w.setPositionsHeight)(t,r.entity.ellipse.height),o[0]=t,r.updateDraggers()}}));this.draggers.push(m);var g=3==this._maxPointNum?[o[1],o[2]]:[o[1]];this.bindHeightDraggers(this.entity.ellipse,g),this.heightDraggers.push(m)}}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawEllipsoid=void 0;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=i(8),s=(i(1),c(i(7)),i(3),c(i(37))),l=i(69);function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.DrawEllipsoid=a.DrawPolyline.extend({type:"ellipsoid",_minPointNum:2,_maxPointNum:3,getShowPosition:function(){return this._positions_draw&&0<this._positions_draw.length?this._positions_draw[0]:null},createFeature:function(e){this._positions_draw=[];var t=this,i={position:new o.CallbackProperty(function(e){return t.getShowPosition()},!1),ellipsoid:s.style2Entity(e.style),attribute:e};return this.entity=this.dataSource.entities.add(i),this.entity},style2Entity:function(e,t){return s.style2Entity(e,t.ellipsoid)},updateAttrForDrawing:function(e){if(this._positions_draw)if(e)this.addPositionsForRadius(this._positions_draw);else if(!(this._positions_draw.length<2)){var t,i=this.entity.attribute.style,n=this.formatNum(o.Cartesian3.distance(this._positions_draw[0],this._positions_draw[1]),2);i.extentRadii=n,i.heightRadii=n,t=3==this._positions_draw.length?this.formatNum(o.Cartesian3.distance(this._positions_draw[0],this._positions_draw[2]),2):n,i.widthRadii=t,this.updateRadii(i)}},updateRadii:function(e){this.entity.ellipsoid.radii.setValue(new o.Cartesian3(e.extentRadii,e.widthRadii,e.heightRadii))},addPositionsForRadius:function(e){this._positions_draw=[e];var t=this.entity.attribute.style,i=o.EllipseGeometryLibrary.computeEllipsePositions({center:e,semiMajorAxis:Number(t.extentRadii),semiMinorAxis:Number(t.widthRadii),rotation:o.Math.toRadians(Number(t.rotation||0)),granularity:2},!0,!1),n=new o.Cartesian3(i.positions[0],i.positions[1],i.positions[2]);this._positions_draw.push(n);var r=new o.Cartesian3(i.positions[3],i.positions[4],i.positions[5]);this._positions_draw.push(r)},getEditClass:function(e){var t=new l.EditEllipsoid(e,this.viewer,this.dataSource);return t._minPointNum=this._minPointNum,t._maxPointNum=this._maxPointNum,this._bindEdit(t)},getAttrClass:function(){return s},finish:function(){this.entity.editing=this.getEditClass(this.entity),this.entity._positions_draw=this._positions_draw,this.entity.position=this.getShowPosition()}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditEllipsoid=void 0;var n,r=i(0),c=(n=r)&&n.__esModule?n:{default:n},u=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(6)),h=i(3),o=i(18),d=i(1);t.EditEllipsoid=o.EditBase.extend({_positions_draw:null,changePositionsToCallback:function(){this._positions_draw=this.entity.position.getValue(this.viewer.clock.currentTime)},finish:function(){this._positions_draw=null},updateRadii:function(e){var t=new c.Cartesian3(Number(e.extentRadii),Number(e.widthRadii),Number(e.heightRadii));this.entity.ellipsoid.radii.setValue(t)},bindDraggers:function(){var r=this,o=this.entity.attribute.style,e=this.entity.position.getValue(this.viewer.clock.currentTime),t=u.createDragger(this.dataSource,{position:(0,d.addPositionsHeight)(e,o.heightRadii),onDrag:function(e,t){this._positions_draw=t,r.entity.position.setValue(t),r.updateDraggers()}});this.draggers.push(t);var i=c.EllipseGeometryLibrary.computeEllipsePositions({center:e,semiMajorAxis:Number(o.extentRadii),semiMinorAxis:Number(o.widthRadii),rotation:c.Math.toRadians(Number(o.rotation||0)),granularity:2},!0,!1),n=new c.Cartesian3(i.positions[0],i.positions[1],i.positions[2]),a=u.createDragger(this.dataSource,{position:n,type:u.PointType.EditAttr,tooltip:h.message.dragger.editRadius,onDrag:function(e,t){var i=c.Cartographic.fromCartesian(r._positions_draw).height;t=(0,d.setPositionsHeight)(t,i),e.position=t;var n=r.formatNum(c.Cartesian3.distance(r._positions_draw,t),2);o.extentRadii=n,r.updateRadii(o),r.updateDraggers()}});t.majorDragger=a,this.draggers.push(a);var s=new c.Cartesian3(i.positions[3],i.positions[4],i.positions[5]),l=u.createDragger(this.dataSource,{position:s,type:u.PointType.EditAttr,tooltip:h.message.dragger.editRadius,onDrag:function(e,t){var i=c.Cartographic.fromCartesian(r._positions_draw).height;t=(0,d.setPositionsHeight)(t,i),e.position=t;var n=r.formatNum(c.Cartesian3.distance(r._positions_draw,t),2);o.widthRadii=n,r.updateRadii(o),r.updateDraggers()}});t.minorDragger=l,this.draggers.push(l)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawWall=void 0;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=i(8),s=(i(1),c(i(38))),l=i(71);c(i(2));function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.DrawWall=a.DrawPolyline.extend({type:"wall",_minPointNum:2,_maxPointNum:9999,createFeature:function(e){this._positions_draw=[],e.config?(this._minPointNum=e.config.minPointNum||2,this._maxPointNum=e.config.maxPointNum||9999):(this._minPointNum=2,this._maxPointNum=9999),this.maximumHeights=[],this.minimumHeights=[];var t=this,i={wall:s.style2Entity(e.style),attribute:e};return i.wall.positions=new o.CallbackProperty(function(e){return t.getDrawPosition()},!1),i.wall.minimumHeights=new o.CallbackProperty(function(e){return t.getMinimumHeights()},!1),i.wall.maximumHeights=new o.CallbackProperty(function(e){return t.getMaximumHeights()},!1),this.entity=this.dataSource.entities.add(i),this.entity},style2Entity:function(e,t){return s.style2Entity(e,t.wall)},maximumHeights:null,getMaximumHeights:function(){return this.maximumHeights},minimumHeights:null,getMinimumHeights:function(){return this.minimumHeights},updateAttrForDrawing:function(){var e=this.entity.attribute.style,t=this.getDrawPosition(),i=t.length;this.maximumHeights=new Array(i),this.minimumHeights=new Array(i);for(var n=0;n<i;n++){var r=o.Cartographic.fromCartesian(t[n]).height;this.minimumHeights[n]=r,this.maximumHeights[n]=r+Number(e.extrudedHeight)}},getEditClass:function(e){var t=new l.EditWall(e,this.viewer,this.dataSource);return t._minPointNum=this._minPointNum,t._maxPointNum=this._maxPointNum,this._bindEdit(t)},getAttrClass:function(){return s},finish:function(){this.entity.editing=this.getEditClass(this.entity),this.entity.wall.positions=this.getDrawPosition(),this.entity.wall.minimumHeights=this.getMinimumHeights(),this.entity.wall.maximumHeights=this.getMaximumHeights()}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditWall=void 0;var n,r=i(0),d=(n=r)&&n.__esModule?n:{default:n},p=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(6)),f=i(3),o=i(14),m=i(1);t.EditWall=o.EditPolyline.extend({changePositionsToCallback:function(){var t=this,e=this.viewer.clock.currentTime;this._positions_draw=this.entity.wall.positions.getValue(e),this.entity.wall.positions=new d.CallbackProperty(function(e){return t.getPosition()},!1),this.minimumHeights=this.entity.wall.minimumHeights.getValue(e),this.entity.wall.minimumHeights=new d.CallbackProperty(function(e){return t.getMinimumHeights()},!1),this.maximumHeights=this.entity.wall.maximumHeights.getValue(e),this.entity.wall.maximumHeights=new d.CallbackProperty(function(e){return t.getMaximumHeights()},!1)},maximumHeights:null,getMaximumHeights:function(){return this.maximumHeights},minimumHeights:null,getMinimumHeights:function(){return this.minimumHeights},updateAttrForEditing:function(){var e=this.entity.attribute.style,t=this.getPosition(),i=t.length;this.maximumHeights=new Array(i),this.minimumHeights=new Array(i);for(var n=0;n<i;n++){var r=d.Cartographic.fromCartesian(t[n]).height;this.minimumHeights[n]=r,this.maximumHeights[n]=r+Number(e.extrudedHeight)}},finish:function(){this.entity.wall.positions=this.getPosition()},bindDraggers:function(){for(var i=this,e=this.isClampToGround(),n=this.getPosition(),r=this.entity.attribute.style,o=n.length<this._maxPointNum,t=0,a=n.length;t<a;t++){var s=n[t],l=p.createDragger(this.dataSource,{position:s,clampToGround:e,onDrag:function(e,t){n[e.index]=t,i.heightDraggers&&0<i.heightDraggers.length&&(i.heightDraggers[e.index].position=(0,m.addPositionsHeight)(t,r.extrudedHeight)),o&&(0<e.index&&(i.draggers[2*e.index-1].position=d.Cartesian3.midpoint(t,n[e.index-1],new d.Cartesian3)),e.index<n.length-1&&(i.draggers[2*e.index+1].position=d.Cartesian3.midpoint(t,n[e.index+1],new d.Cartesian3)))}});if(l.index=t,this.draggers.push(l),o){var c=t+1;if(c<a){var u=d.Cartesian3.midpoint(s,n[c],new d.Cartesian3),h=p.createDragger(this.dataSource,{position:u,type:p.PointType.AddMidPoint,tooltip:f.message.dragger.addMidPoint,clampToGround:e,onDragStart:function(e,t){n.splice(e.index,0,t),i.updateAttrForEditing()},onDrag:function(e,t){n[e.index]=t},onDragEnd:function(){i.updateDraggers()}});h.index=c,this.draggers.push(h)}}}this.bindHeightDraggers()},heightDraggers:null,bindHeightDraggers:function(){var r=this;this.heightDraggers=[];for(var o=this.getPosition(),a=this.entity.attribute.style,e=Number(a.extrudedHeight),t=0,i=o.length;t<i;t++){var n=(0,m.addPositionsHeight)(o[t],e),s=p.createDragger(this.dataSource,{position:n,type:p.PointType.MoveHeight,tooltip:f.message.dragger.moveHeight,onDrag:function(e,t){var i=d.Cartographic.fromCartesian(t).height;a.extrudedHeight=r.formatNum(i-r.minimumHeights[e.index],2);for(var n=0;n<o.length;n++)n!=e.index&&(r.heightDraggers[n].position=(0,m.addPositionsHeight)(o[n],a.extrudedHeight));r.updateAttrForEditing()}});s.index=t,this.draggers.push(s),this.heightDraggers.push(s)}}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawPModel=void 0;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=i(21),s=i(1),l=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(24)),c=i(3),u=i(73);t.DrawPModel=a.DrawBase.extend({type:"point",createFeature:function(e){var t=this;this._positions_draw=o.Cartesian3.ZERO;var i=e.style,n=this.primitives.add(o.Model.fromGltf({url:i.modelUrl,modelMatrix:this.getModelMatrix(i),minimumPixelSize:i.minimumPixelSize||30}));return n.readyPromise.then(function(e){t.style2Entity(i,t.entity)}),n.attribute=e,this.entity=n,this.entity},getModelMatrix:function(e,t){var i=new o.HeadingPitchRoll(o.Math.toRadians(e.heading||0),o.Math.toRadians(e.pitch||0),o.Math.toRadians(e.roll||0)),n=o.Transforms.eastNorthUpToFixedFrame,r=o.Transforms.headingPitchRollToFixedFrame(t||this._positions_draw,i,this.viewer.scene.globe.ellipsoid,n);return e.scale&&o.Matrix4.multiplyByUniformScale(r,e.scale,r),r},style2Entity:function(e,t){return t.modelMatrix=this.getModelMatrix(e,t.position),l.style2Entity(e,t)},bindEvent:function(){var i=this;this.getHandler().setInputAction(function(e){var t=(0,s.getCurrentMousePosition)(i.viewer.scene,e.endPosition,i.entity);t&&(i._positions_draw=t,i.entity.modelMatrix=i.getModelMatrix(i.entity.attribute.style)),i.tooltip.showAt(e.endPosition,c.message.draw.point.start)},o.ScreenSpaceEventType.MOUSE_MOVE),this.getHandler().setInputAction(function(e){var t=(0,s.getCurrentMousePosition)(i.viewer.scene,e.position,i.entity);t&&(i._positions_draw=t,i.disable())},o.ScreenSpaceEventType.LEFT_CLICK)},getEditClass:function(e){var t=new u.EditPModel(e,this.viewer,this.dataSource);return this._bindEdit(t)},getAttrClass:function(){return l},finish:function(){this.entity.modelMatrix=this.getModelMatrix(this.entity.attribute.style),this.entity.editing=this.getEditClass(this.entity),this.entity.position=this.getDrawPosition()}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditPModel=void 0;var n,r=i(0),c=(n=r)&&n.__esModule?n:{default:n},u=a(i(6)),h=i(3),o=i(18),d=a(i(27)),p=i(1);function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.EditPModel=o.EditBase.extend({setPositions:function(e){this.entity.position=e,this.entity.modelMatrix=this.getModelMatrix()},getModelMatrix:function(e){var t=this.entity.attribute.style,i=new c.HeadingPitchRoll(c.Math.toRadians(t.heading||0),c.Math.toRadians(t.pitch||0),c.Math.toRadians(t.roll||0)),n=c.Transforms.eastNorthUpToFixedFrame,r=c.Transforms.headingPitchRollToFixedFrame(e||this.entity.position,i,this.viewer.scene.globe.ellipsoid,n);return t.scale&&c.Matrix4.multiplyByUniformScale(r,t.scale,r),r},bindDraggers:function(){if(this.entity.ready){l=this;this.entity.draw_tooltip=h.message.dragger.def;var e=u.createDragger(this.dataSource,{dragger:this.entity,onDrag:function(e,t){l.entity.position=t,l.entity.modelMatrix=l.getModelMatrix(t),l.updateDraggers()}}),r=this.entity.attribute.style,o=this.entity.position,t=c.Cartographic.fromCartesian(o).height,i=this.entity.boundingSphere.radius;this.entityAngle=this.dataSource.entities.add({name:"角度调整底部圆",position:new c.CallbackProperty(function(e){return l.entity.position},!1),ellipse:d.style2Entity({fill:!1,outline:!0,outlineColor:"#ffff00",outlineOpacity:.8,radius:i,height:t})});var n=this.getHeadingPosition(),a=u.createDragger(this.dataSource,{position:n,type:u.PointType.EditAttr,tooltip:h.message.dragger.editHeading,onDrag:function(e,t){var i=l.getHeading(l.entity.position,t);r.heading=l.formatNum(i,1),l.entity.modelMatrix=l.getModelMatrix(),e.position=l.getHeadingPosition()}});this.draggers.push(a);var s=(0,p.addPositionsHeight)(o,i);(e=u.createDragger(this.dataSource,{position:s,type:u.PointType.MoveHeight,tooltip:h.message.dragger.editScale,onDrag:function(e,t){var i=c.Cartesian3.distance(t,o),n=i/(e.radius/r.scale);e.radius=i,r.scale=l.formatNum(n,2),l.entity.modelMatrix=l.getModelMatrix(),l.updateDraggers()}})).radius=i,this.draggers.push(e)}else{var l=this;this.entity.readyPromise.then(function(e){l.bindDraggers()})}},destroyDraggers:function(){o.EditBase.prototype.destroyDraggers.call(this),this.entityAngle&&(this.dataSource.entities.remove(this.entityAngle),delete this.entityAngle),this.entityBox&&(this.dataSource.entities.remove(this.entityBox),delete this.entityBox)},finish:function(){this.entity.draw_tooltip=null},getHeadingPosition:function(){var e=this.entity.position,t=this.entity.boundingSphere.radius,i=-Number(this.entity.attribute.style.heading||0),n=new c.Cartesian3(t,0,0),r=c.Transforms.eastNorthUpToFixedFrame(e),o=c.Matrix4.fromRotationTranslation(c.Matrix3.fromRotationZ(c.Math.toRadians(i)));return c.Matrix4.multiply(r,o,r),r=c.Matrix4.getRotation(r,new c.Matrix3),n=c.Matrix3.multiplyByVector(r,n,n),n=c.Cartesian3.add(e,n,n)},getHeading:function(e,t){var i=c.Transforms.eastNorthUpToFixedFrame(e);i=c.Matrix4.getRotation(i,new c.Matrix3);var n=c.Matrix3.getColumn(i,0,new c.Cartesian3),r=c.Matrix3.getColumn(i,1,new c.Cartesian3),o=c.Matrix3.getColumn(i,2,new c.Cartesian3),a=c.Cartesian3.subtract(t,e,new c.Cartesian3);a=c.Cartesian3.cross(a,o,a),a=c.Cartesian3.cross(o,a,a),a=c.Cartesian3.normalize(a,a);var s=c.Cartesian3.angleBetween(n,a);return c.Cartesian3.angleBetween(r,a)>.5*Math.PI&&(s=2*Math.PI-s),-c.Math.toDegrees(s)}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)};exports.isOnly=isOnly,exports.setEnable=setEnable,exports.getEnable=getEnable,exports.init=init,exports.show=show,exports.getPopupId=getPopupId,exports.close=close,exports.destroy=destroy,exports.getPopupForConfig=getPopupForConfig,exports.getPopup=getPopup;var _Cesium=__webpack_require__(0),_Cesium2=_interopRequireDefault(_Cesium),_jquery=__webpack_require__(5),_jquery2=_interopRequireDefault(_jquery),_point=__webpack_require__(1),_Util=__webpack_require__(2),Util=_interopRequireWildcard(_Util),_index=__webpack_require__(39),attrUtil=_interopRequireWildcard(_index),viewer,handler;function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var objPopup={},_isOnly=!0,_enable=!0,lastShowFeature;function isOnly(e){_isOnly=e}function setEnable(e){(_enable=e)||close()}function getEnable(e){return _enable}function init(e){viewer=e;(0,_jquery2.default)("#"+viewer._container.id).append('<div id="pupup-all-view" ></div>'),(handler=new _Cesium2.ScreenSpaceEventHandler(viewer.scene.canvas)).setInputAction(mousePickingClick,_Cesium2.ScreenSpaceEventType.LEFT_CLICK),viewer.scene.postRender.addEventListener(bind2scene)}function mousePickingClick(e){if(removeFeature(),unHighlighPick(),_isOnly&&close(),_enable){var t=e.position,i=viewer.scene.pick(t);if(i&&_Cesium2.defined(i.id)&&i.id instanceof _Cesium2.Entity){var n=i.id;_Cesium2.defined(n.popup)&&show(n,u=(n.billboard||n.label||n.point)&&i.primitive.heightReference==_Cesium2.HeightReference.NONE?i.primitive.position:(0,_point.getCurrentMousePosition)(viewer.scene,t),t),n.click&&"function"==typeof n.click&&n.click(n,t)}else{if(i&&_Cesium2.defined(i.tileset)&&_Cesium2.defined(i.getProperty)){for(var r={},o=i.getPropertyNames(),a=0;a<o.length;a++){var s=o[a];if(i.hasProperty(s)){var l=i.getProperty(s);null!=l&&(r[s]=l)}}var c=i.tileset._config;if(c){if(_Cesium2.defined(c.popup)){var u=(0,_point.getCurrentMousePosition)(viewer.scene,t);show({id:i._batchId,popup:{html:getPopupForConfig(c,r),anchor:c.popupAnchor||[0,-15]}},u,t)}return c.showClickFeature&&highlighPick(i,c.clickFeatureColor),void(c.click&&"function"==typeof c.click&&c.click({attr:r,feature:i},t))}}if(i&&_Cesium2.defined(i.primitive)){var h=i.primitive;_Cesium2.defined(h.popup)&&show(h,u=(0,_point.getCurrentMousePosition)(viewer.scene,t),t),h.click&&"function"==typeof h.click&&h.click(h,t)}else pickImageryLayerFeatures(t)}}}function pickImageryLayerFeatures(o){var e=viewer.scene,t=e.camera.getPickRay(o),i=e.imageryLayers.pickImageryLayerFeatures(t,e);_Cesium2.defined(i)&&_Cesium2.when(i,function(e){if(_Cesium2.defined(e)&&0!==e.length){var t=e[0];if(null!=t.imageryLayer&&null!=t.imageryLayer.config){var i=t.imageryLayer.config;i.showClickFeature&&t.data&&showFeature(t.data,i.pickFeatureStyle);var n=getPopupForConfig(t.imageryLayer.config,t.properties);if(n){var r=(0,_point.getCurrentMousePosition)(viewer.scene,o);show({id:"imageryLayerFeaturePromise",popup:{html:n,anchor:t.imageryLayer.config.popupAnchor||[0,-12]}},r,o)}i.click&&"function"==typeof i.click&&i.click(t.properties,o)}}},function(){})}function removeFeature(){null!=lastShowFeature&&(viewer.dataSources.remove(lastShowFeature),lastShowFeature=null)}function showFeature(e,t){removeFeature();var i=e;if(e.geometryType&&-1!=e.geometryType.indexOf("esri")){if(JSON.stringify(e.geometry).length<1e4){if(!(n=window.gsp3d.L||window.L).esri)return void console.log("需要引入 mars-esri 插件解析arcgis标准的json数据！");i=gsp3d.L.esri.Util.arcgisToGeoJSON(e.geometry)}}else if(e.geometry&&e.geometry.type){var n;if(n=window.gsp3d.L||window.L)i=n.geoJSON(e.geometry,{coordsToLatLng:function(e){return 180<e[0]||e[0]<-180?n.CRS.EPSG3857.unproject(n.point(e[0],e[1])):new n.LatLng(e[1],e[0],e[2])}}).toGeoJSON()}null!=i&&(t=t||{},_Cesium2.GeoJsonDataSource.load(i,{clampToGround:!0,stroke:new _Cesium2.Color.fromCssColorString(t.stroke||"#ffff00"),strokeWidth:t.strokeWidth||3,fill:new _Cesium2.Color.fromCssColorString(t.fill||"#ffff00").withAlpha(t.fillAlpha||.7)}).then(function(e){viewer.dataSources.add(e),lastShowFeature=e}).otherwise(function(e){console.log(e)}))}var highlighted={feature:void 0,originalColor:new _Cesium2.Color},defaultHighlightedClr=new _Cesium2.Color.fromCssColorString("#95e40c");function unHighlighPick(){if(_Cesium2.defined(highlighted.feature)){try{highlighted.feature.color=highlighted.originalColor}catch(e){}highlighted.feature=void 0}}function highlighPick(e,t){unHighlighPick(),highlighted.feature=e,_Cesium2.Color.clone(e.color,highlighted.originalColor),t&&"string"==typeof t&&(t=new _Cesium2.Color.fromCssColorString(t)),e.color=t||defaultHighlightedClr}function show(t,i,n){if(null!=t&&null!=t.popup){i=i||attrUtil.getPositions(t)[0];var e,r=getPopupId(t);close(r),objPopup[r]={id:t.id,popup:t.popup,cartesian:i,viewPoint:n},(e="object"===_typeof(t.popup)?t.popup.html:t.popup)&&("function"==typeof e&&(e=e(t,i,function(e){_showHtml(e,r,t,i,n)})),e&&_showHtml(e,r,t,i,n))}}function _showHtml(e,t,i,n,r){(0,_jquery2.default)("#pupup-all-view").append('<div id="'+t+'" class="cesium-popup">            <a class="cesium-popup-close-button cesium-popup-color" href="javascript:viewer.gsp.popup.close(\''+t+'\',true)">✖</a>            <div class="cesium-popup-content-wrapper cesium-popup-background">                <div class="cesium-popup-content cesium-popup-color">'+e+'</div>            </div>            <div class="cesium-popup-tip-container"><div class="cesium-popup-tip cesium-popup-background"></div></div>        </div>'),updateViewPoint(t,n,i.popup,r)||close(t)}function updateViewPoint(e,t,i,n){var r=_Cesium2.SceneTransforms.wgs84ToWindowCoordinates(viewer.scene,t);if(r&&(n=r,objPopup[e]&&(objPopup[e].viewPoint=r)),null==n)return console.log("wgs84ToWindowCoordinates无法转换为屏幕坐标"),!1;var o=viewer.scene;if(o.mode===_Cesium2.SceneMode.SCENE3D){var a=o.camera.getPickRay(n),s=o.globe.pick(a,o);if(s)if(1e6<_Cesium2.Cartesian3.distance(t,s))return!1}var l=(0,_jquery2.default)("#"+e),c=n.x-l.width()/2,u=n.y-l.height();return i&&"object"===(void 0===i?"undefined":_typeof(i))&&i.anchor&&(c+=i.anchor[0],u+=i.anchor[1]),l.css("transform","translate3d("+c+"px,"+u+"px, 0)"),!0}function bind2scene(){for(var e in objPopup){var t=objPopup[e];updateViewPoint(e,t.cartesian,t.popup,t.viewPoint)||close(e)}}function getPopupId(e){return"popup_"+((e.id||"")+"").replace(new RegExp("[^0-9a-zA-Z_]","gm"),"_")}function close(e,t){if(!_isOnly&&e){for(var i in"object"===(void 0===e?"undefined":_typeof(e))&&(e=getPopupId(e)),objPopup)if(e==objPopup[i].id||e==i){(0,_jquery2.default)("#"+i).remove(),delete objPopup[i];break}}else(0,_jquery2.default)("#pupup-all-view").empty(),objPopup={};t&&(removeFeature(),unHighlighPick())}function destroy(){close(),handler.destroy(),viewer.scene.postRender.removeEventListener(bind2scene)}function template(e,t){for(var i in t){var n=t[i];null!=n&&"Null"!=n&&"Unknown"!=n||(n=""),"_"==i.substr(0,1)&&(i=i.substring(1)),e=e.replace(new RegExp("{"+i+"}","gm"),n)}return e}function getAttrVal(e){try{var t={};if(e._propertyNames&&0<e._propertyNames.length){var i=!0,n=!1,r=void 0;try{for(var o,a=e._propertyNames[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var s=o.value;t[s]=e[s].getValue(viewer.clock.currentTime)}}catch(e){n=!0,r=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}}else for(var l in e)"function"!=typeof e[l]&&(t[l]=e[l]);return t}catch(e){console.log(e)}return e}function getPopupForConfig(e,t){var i=e.popupNameField?t[e.popupNameField]:e.name;return e.popup?getPopup(e.popup,t,i):!!e.columns&&getPopup(e.columns,t,i)}function getPopup(cfg,attr,title){if(!attr)return!1;if(title=title||"",Util.isArray(cfg)){for(var countsok=0,inhtml='<div class="mars-popup-titile">'+title+'</div><div class="mars-popup-content" >',i=0;i<cfg.length;i++){var thisfield=cfg[i],col=thisfield.field;if(null!=col&&null!=attr[col]&&("object"===_typeof(attr[col])&&attr[col].hasOwnProperty&&attr[col].hasOwnProperty("getValue")&&(attr[col]=attr[col].getValue(viewer.clock.currentTime)),"function"!=typeof attr[col]))if("details"!=thisfield.type){var showval=_jquery2.default.trim(attr[col]);if(null!=showval&&""!=showval&&"Null"!=showval&&"Unknown"!=showval&&"0"!=showval&&0!=showval.length){if(thisfield.format)try{showval=eval(thisfield.format+"("+showval+")")}catch(e){console.log("getPopupByConfig error:"+thisfield.format)}thisfield.unit&&(showval+=thisfield.unit),inhtml+="<div><label>"+thisfield.name+"</label>"+showval+"</div>",countsok++}}else{var showval=_jquery2.default.trim(attr[col||"OBJECTID"]);if(null==showval||""==showval||"Null"==showval||"Unknown"==showval)continue;inhtml+='<div style="text-align: center;padding: 10px 0;"><button type="button" onclick="'+thisfield.calback+"('"+showval+'\');" " class="btn btn-info  btn-sm">'+(thisfield.name||"查看详情")+"</button></div>"}}return inhtml+="</div>",0!=countsok&&inhtml}if("object"!==(void 0===cfg?"undefined":_typeof(cfg))){if("function"==typeof cfg)return cfg(attr);if("all"!=cfg)return template(cfg,attr);var countsok=0,inhtml='<div class="mars-popup-titile">'+title+'</div><div class="mars-popup-content" >';for(var col in attr)try{if(null==col||null==attr[col])continue;if("Shape"==col||"FID"==col||"OBJECTID"==col||"_definitionChanged"==col||"_propertyNames"==col)continue;if("_"==col.substr(0,1)&&(col=col.substring(1)),"object"===_typeof(attr[col])&&attr[col].hasOwnProperty&&attr[col].hasOwnProperty("getValue")&&(attr[col]=attr[col].getValue(viewer.clock.currentTime)),"function"==typeof attr[col])continue;var showval=_jquery2.default.trim(attr[col]);if(null==showval||""==showval||"Null"==showval||"Unknown"==showval||"0"==showval||0==showval.length)continue;inhtml+="<div><label>"+col+"</label>"+showval+"</div>",countsok++}catch(e){console.log(e)}return inhtml+="</div>",0!=countsok&&inhtml}switch(cfg.type){case"iframe":var _url=_util.template(cfg.url,attr),inhtml='<iframe id="ifarm" src="'+_url+'"  style="width:'+(cfg.width||"300")+"px;height:"+(cfg.height||"300")+'px;overflow:hidden;margin:0;" scrolling="no" frameborder="0" ></iframe>';return inhtml;case"javascript":return eval(cfg.calback+"("+JSON.stringify(getAttrVal(attr))+")")}return!1}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)};t.init=function(e){c=e;(0,h.default)("#"+c._container.id).append('<div id="tooltip-view" class="cesium-popup" style="display:none;">     <div class="cesium-popup-content-wrapper  cesium-popup-background">         <div id="tooltip-content" class="cesium-popup-content cesium-popup-color"></div>     </div>     <div class="cesium-popup-tip-container"><div class="cesium-popup-tip  cesium-popup-background"></div></div></div> '),(n=new u.ScreenSpaceEventHandler(c.scene.canvas)).setInputAction(d,u.ScreenSpaceEventType.MOUSE_MOVE)},t.show=p,t.close=f,t.destroy=function(){f(),n.destroy()};var c,n,o,a,u=r(i(0)),h=r(i(5)),s=i(1);function r(e){return e&&e.__esModule?e:{default:e}}function d(e){if((0,h.default)(".cesium-viewer").css("cursor",""),!1!==c.scene.screenSpaceCameraController.enableRotate&&!1!==c.scene.screenSpaceCameraController.enableTilt&&!1!==c.scene.screenSpaceCameraController.enableTranslate){var t,i=e.endPosition,n=c.scene.pick(i);if(n&&u.defined(n.id)&&n.id instanceof u.Entity?t=n.id:n&&u.defined(n.primitive)&&(t=n.primitive),t)if((t.popup||t.click||t.cursorCSS)&&(0,h.default)(".cesium-viewer").css("cursor",t.cursorCSS||"pointer"),t.noMouseMove||(clearTimeout(a),a=setTimeout(function(){!function(e,t){if(o===e)return;m(),e.mouseover&&"function"==typeof e.mouseover&&e.mouseover(e,t);o=e}(t,i)},20)),t.tooltip){var r=(0,s.getCurrentMousePosition)(c.scene,i);p(t,r,i)}else f();else f(),clearTimeout(a),a=setTimeout(m,20)}else f()}function p(e,t,i){if(null!=e&&null!=e.tooltip)if(null==i&&(i=u.SceneTransforms.wgs84ToWindowCoordinates(c.scene,t)),null!=i){var n,r=(0,h.default)("#tooltip-view");if("object"===l(e.tooltip)){if(n=e.tooltip.html,e.tooltip.check&&!e.tooltip.check())return void f()}else n=e.tooltip;if("function"==typeof n&&(n=n(e,t)),n){(0,h.default)("#tooltip-content").html(n),r.show();var o=i.x-r.width()/2,a=i.y-r.height(),s=e.tooltip;s&&"object"===(void 0===s?"undefined":l(s))&&s.anchor?(o+=s.anchor[0],a+=s.anchor[1]):a-=15,r.css("transform","translate3d("+o+"px,"+a+"px, 0)")}}else f()}function f(){(0,h.default)("#tooltip-content").empty(),(0,h.default)("#tooltip-view").hide()}function m(){null!=o&&(o.mouseout&&"function"==typeof o.mouseout&&o.mouseout(o),o=null)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultContextmenuItems=void 0,t.init=function(e){r=e;(0,l.default)("#"+r._container.id).append('<div id="mars-contextmenu" class="mars-contextmenu open" style="display:none;">\n            <ul id="mars-contextmenu-ul" class="dropdown-menu mars-contextmenu-ul"> \n            </ul>\n        </div>'),(n=new o.ScreenSpaceEventHandler(r.scene.canvas)).setInputAction(p,o.ScreenSpaceEventType.LEFT_DOWN),n.setInputAction(p,o.ScreenSpaceEventType.MIDDLE_DOWN),n.setInputAction(p,o.ScreenSpaceEventType.RIGHT_DOWN),n.setInputAction(p,o.ScreenSpaceEventType.PINCH_START),n.setInputAction(p,o.ScreenSpaceEventType.WHEEL),n.setInputAction(function(e){p();var t,i=e.position,n=r.scene.pick(i);n&&o.defined(n.id)&&n.id instanceof o.Entity?d((t=n.id).contextmenuItems,i,t):n&&o.defined(n.primitive)&&(t=n.primitive).contextmenuItems?d(t.contextmenuItems,i,t):d(r.gsp.contextmenuItems,i)},o.ScreenSpaceEventType.RIGHT_CLICK)},t.show=d;var r,n,o=h(i(0)),l=h(i(5)),a=u(i(1)),s=u(i(4)),c=u(i(40));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function h(e){return e&&e.__esModule?e:{default:e}}t.defaultContextmenuItems=[{text:"显示此处经纬度",iconCls:"fa fa-info-circle",calback:function(e){var t=a.getCurrentMousePosition(r.scene,e.position),i=a.formatPositon(t),n="经度："+i.x+" , 纬度："+i.y+"<br/>高程："+i.z;s.alert(n,"位置信息")}},{text:"显示当前视角信息",iconCls:"fa fa-camera-retro",calback:function(){var e=a.getCameraView(r);s.alert(JSON.stringify(e),"当前视角信息")}},{text:"开启光照效果",iconCls:"fa fa-bullseye",visible:function(){return!r.shadows},calback:function(){r.shadows=!0,r.terrainShadows=o.ShadowMode.ENABLED,r.scene.globe.enableLighting=!0}},{text:"关闭光照效果",iconCls:"fa fa-sun-o",visible:function(){return r.shadows},calback:function(){r.shadows=!1,r.terrainShadows=o.ShadowMode.RECEIVE_ONLY,r.scene.globe.enableLighting=!1}},{text:"开启深度监测",iconCls:"fa fa-eye-slash",visible:function(){return!r.scene.globe.depthTestAgainstTerrain},calback:function(){r.scene.globe.depthTestAgainstTerrain=!0}},{text:"关闭深度监测",iconCls:"fa fa-eye",visible:function(){return r.scene.globe.depthTestAgainstTerrain},calback:function(){r.scene.globe.depthTestAgainstTerrain=!1}},{text:"开启键盘控制",iconCls:"fa fa-keyboard-o",visible:function(){return!c.isEnable()},calback:function(){c.bind(r)}},{text:"关闭键盘控制",iconCls:"fa fa-hand-o-right",visible:function(){return c.isEnable()},calback:function(){c.unbind(r)}},{text:"绕此处环绕飞行",iconCls:"fa fa-retweet",visible:function(){return!a.windingPoint.isStart},calback:function(e){var t=a.getCurrentMousePosition(r.scene,e.position);a.windingPoint.start(r,t)}},{text:"关闭环绕飞行",iconCls:"fa fa-remove",visible:function(){return a.windingPoint.isStart},calback:function(){a.windingPoint.stop()}},{text:"移动到此处",iconCls:"fa fa-send-o",calback:function(e){var t=a.getCurrentMousePosition(r.scene,e.position),i=r.scene.camera.positionCartographic.height;5e3<i&&(i=5e3),r.camera.lookAt(t,new o.HeadingPitchRange(r.camera.heading,r.camera.pitch,i)),r.camera.lookAtTransform(o.Matrix4.IDENTITY)}},{text:"第一视角站到此处",iconCls:"fa fa-street-view",calback:function(e){var t=a.getCurrentMousePosition(r.scene,e.position);r.camera.flyTo({destination:a.addPositionsHeight(t,10),orientation:{heading:o.Math.toRadians(0),pitch:o.Math.toRadians(10),roll:o.Math.toRadians(0)}})}}];function d(n,r,o){if(n&&0!=n.length){for(var e="",t=0,i=n.length;t<i;t++){var a=n[t];if(a.hasOwnProperty("visible")){var s=a.visible;if("function"==typeof s&&(s=a.visible()),!s)continue}a.text?e+='<li class="contextmenu-item" data-index="'+t+'"><a href="javascript:void(0)"><i class="'+a.iconCls+'"></i>'+a.text+"</a></li>":e+='<li class="line"></li>'}""!=e?((0,l.default)("#mars-contextmenu-ul").html(e),(0,l.default)("#mars-contextmenu-ul .contextmenu-item").click(function(e){var t=Number((0,l.default)(this).attr("data-index")),i=n[t];i&&i.calback&&i.calback({position:r,data:i,target:o}),p()}),(0,l.default)("#mars-contextmenu").css({top:r.y+10,left:r.x+10}).show()):p()}else p()}function p(){(0,l.default)("#mars-contextmenu").hide()}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroupLayer=void 0;var n=i(9).BaseLayer.extend({create:function(){for(var e=this.config._layers,t=0,i=e.length;t<i;t++)this.hasOpacity=e[t].hasOpacity,this.hasZIndex=e[t].hasZIndex},setVisible:function(e){this._visible=e;for(var t=this.config._layers,i=0,n=t.length;i<n;i++)t[i].setVisible(e)},add:function(){this._visible=!0;for(var e=this.config._layers,t=0,i=e.length;t<i;t++)e[t].setVisible(!0)},remove:function(){this._visible=!1;for(var e=this.config._layers,t=0,i=e.length;t<i;t++)e[t].setVisible(!1)},centerAt:function(e){for(var t=this.config._layers,i=0,n=t.length;i<n;i++)t[i].centerAt(e)},setOpacity:function(e){for(var t=this.config._layers,i=0,n=t.length;i<n;i++)t[i].hasOpacity&&t[i].setOpacity(e)}});t.GroupLayer=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GraticuleLayer=void 0;var n,r=i(0),_=(n=r)&&n.__esModule?n:{default:n};var o=i(9).BaseLayer.extend({model:null,add:function(){null==this.model&&this.initData(),this.model.setVisible(!0)},remove:function(){null!=this.model&&this.model.setVisible(!1)},initData:function(){function e(e,t){e=e||{},this._tilingScheme=e.tilingScheme||new _.GeographicTilingScheme,this._color=e.color||new _.Color(1,1,1,.4),this._tileWidth=e.tileWidth||256,this._tileHeight=e.tileHeight||256,this._ready=!0,this._sexagesimal=e.sexagesimal||!1,this._numLines=e.numLines||50,this._scene=t,this._labels=new _.LabelCollection,t.primitives.add(this._labels),this._polylines=new _.PolylineCollection,t.primitives.add(this._polylines),this._ellipsoid=t.globe.ellipsoid;var i=document.createElement("canvas");i.width=256,i.height=256,this._canvas=i;var n=this;t.camera.moveEnd.addEventListener(function(){n._show&&(n._polylines.removeAll(),n._labels.removeAll(),n._currentExtent=null,n._drawGrid(n._getExtentView()))}),t.imageryLayers.addImageryProvider(this)}var t=function(){try{return"x"in Object.defineProperty({},"x",{})}catch(e){return!1}}(),i=Object.defineProperties;function v(e){return e<.01?2:e<.1?1:0}t&&i||(i=function(e){return e}),i(e.prototype,{url:{get:function(){}},proxy:{get:function(){}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return 18}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}}}),e.prototype.makeLabel=function(e,t,i,n,r){this._labels.add({position:this._ellipsoid.cartographicToCartesian(new _.Cartographic(e,t,10)),text:i,font:"normal small-caps normal 16px 楷体",style:_.LabelStyle.FILL_AND_OUTLINE,fillColor:_.Color.AZURE,outlineColor:_.Color.BLACK,outlineWidth:2,pixelOffset:new _.Cartesian2(5,n?5:-5),eyeOffset:_.Cartesian3.ZERO,horizontalOrigin:_.HorizontalOrigin.LEFT,verticalOrigin:n?_.VerticalOrigin.BOTTOM:_.VerticalOrigin.TOP,scale:1})},e.prototype._drawGrid=function(e){if(!this._currentExtent||!this._currentExtent.equals(e)){this._currentExtent=e,this._polylines.removeAll(),this._labels.removeAll();this._canvasSize;var t,i=0,n=0;for(t=0;t<y.length&&i<(e.north-e.south)/10;t++)i=y[t];for(t=0;t<y.length&&n<(e.east-e.west)/10;t++)n=y[t];var r=(e.west<0?Math.ceil(e.west/n):Math.floor(e.west/n))*n,o=(e.south<0?Math.ceil(e.south/i):Math.floor(e.south/i))*i,a=(e.east<0?Math.ceil(e.east/i):Math.floor(e.east/i))*i,s=(e.north<0?Math.ceil(e.north/n):Math.floor(e.north/n))*n;r=Math.max(r-2*n,-Math.PI),a=Math.min(a+2*n,Math.PI),o=Math.max(o-2*i,-Math.PI/2),s=Math.min(s+2*n,Math.PI/2);var l,c,u=this._ellipsoid,h=_.Math.toRadians(1),d=o+Math.floor((s-o)/i/2)*i;for(c=r;c<a;c+=n){var p=[];for(l=o;l<s;l+=h)p.push(new _.Cartographic(c,l));p.push(new _.Cartographic(c,s)),this._polylines.add({positions:u.cartographicArrayToCartesianArray(p),width:1});var f=_.Math.toDegrees(c);this.makeLabel(c,d,this._sexagesimal?this._decToSex(f):f.toFixed(v(n)),!1)}var m=r+Math.floor((a-r)/n/2)*n;for(l=o;l<s;l+=i){p=[];for(c=r;c<a;c+=h)p.push(new _.Cartographic(c,l));p.push(new _.Cartographic(a,l)),this._polylines.add({positions:u.cartographicArrayToCartesianArray(p),width:1});var g=_.Math.toDegrees(l);this.makeLabel(m,l,this._sexagesimal?this._decToSex(g):g.toFixed(v(i)),!0)}}},e.prototype.requestImage=function(e,t,i){return this._show&&this._drawGrid(this._getExtentView()),this._canvas},e.prototype.setVisible=function(e){(this._show=e)?(this._currentExtent=null,this._drawGrid(this._getExtentView())):(this._polylines.removeAll(),this._labels.removeAll())},e.prototype.isVisible=function(){return this._show},e.prototype._decToSex=function(e){var t=Math.floor(e),i=(60*(Math.abs(e)-t)).toFixed(2);return"60.00"==i&&(t+=1,i="0.00"),[t,":",i].join("")},e.prototype._getExtentView=function(){for(var e=this._scene.camera,t=this._scene.canvas,i=[e.pickEllipsoid(new _.Cartesian2(0,0),this._ellipsoid),e.pickEllipsoid(new _.Cartesian2(t.width,0),this._ellipsoid),e.pickEllipsoid(new _.Cartesian2(0,t.height),this._ellipsoid),e.pickEllipsoid(new _.Cartesian2(t.width,t.height),this._ellipsoid)],n=0;n<4;n++)if(void 0===i[n])return _.Rectangle.MAX_VALUE;return _.Rectangle.fromCartographicArray(this._ellipsoid.cartesianArrayToCartographicArray(i))};var y=[_.Math.toRadians(.05),_.Math.toRadians(.1),_.Math.toRadians(.2),_.Math.toRadians(.5),_.Math.toRadians(1),_.Math.toRadians(2),_.Math.toRadians(5),_.Math.toRadians(10)];this.model=new e({numLines:10},this.viewer.scene)}});t.GraticuleLayer=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureGridLayer=void 0;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n};var a=i(41).TileLayer.extend({dataSource:null,hasOpacity:!1,create:function(){this.dataSource=new o.CustomDataSource,this.primitives=new o.PrimitiveCollection;var t=this;this.config.type_new="custom_featuregrid",this.config.addImageryCache=function(e){return t._addImageryCache(e)},this.config.removeImageryCache=function(e){return t._removeImageryCache(e)},this.config.removeAllImageryCache=function(e){return t._removeAllImageryCache(e)}},getLength:function(){return this.primitives.length+this.dataSource.entities.values.length},addEx:function(){this.viewer.dataSources.add(this.dataSource),this.viewer.scene.primitives.add(this.primitives)},removeEx:function(){this.viewer.dataSources.remove(this.dataSource),this.viewer.scene.primitives.remove(this.primitives)},_addImageryCache:function(){},_removeImageryCache:function(){},_removeAllImageryCache:function(){}});t.FeatureGridLayer=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.POILayer=void 0;var u=r(i(0)),h=r(i(5)),d=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(19)),n=i(42),p=i(23),f=i(15),m=i(13);function r(e){return e&&e.__esModule?e:{default:e}}var o=n.CustomFeatureGridLayer.extend({_keys:null,_key_index:0,getKey:function(){this._keys||(this._keys=this.config.key||["c95467d0ed2a3755836e37dc27369f97","4320dda936d909d73ab438b4e29cf2a2","e64a96ed7e361cbdc0ebaeaf3818c564","df3247b7df64434adecb876da94755d7","d4375ec477cb0a473c448fb1f83be781","13fdd7b2b90a9d326ae96867ebcc34ce","c34502450ae556f42b21760faf6695a0","57f8ebe12797a73fc5b87f5d4ef859b1"]);var e=this._key_index++%this._keys.length;return this._keys[e]},getDataForGrid:function(e,i){var t=d.wgs2gcj([e.rectangle.xmin,e.rectangle.ymax]),n=d.wgs2gcj([e.rectangle.xmax,e.rectangle.ymin]),r=t[0]+","+t[1]+"|"+n[0]+","+n[1],o=this.config.filter||{};o.output="json",o.key=this.getKey(),o.polygon=r,o.offset||(o.offset=25),o.types||(o.types="120000|130000|190000");h.default.ajax({url:"http://restapi.amap.com/v3/place/polygon",type:"get",dataType:"json",timeout:"5000",data:o,success:function(e){if("10000"===e.infocode){var t=e.pois;i(t)}else console.log("POI 请求失败("+e.infocode+")："+e.info)},error:function(e){console.log("POI 请求出错("+e.status+")："+e.statusText)}})},createEntity:function(e,t){var i="<div>名称："+t.name+"</div><div>地址："+t.address+"</div><div>区域："+t.pname+t.cityname+t.adname+"</div><div>类别："+t.type+"</div>",n=t.location.split(",");n=d.gcj2wgs(n);var r=this.viewer.gsp.point2map({x:n[0],y:n[1]}),o={name:t.name,position:u.Cartesian3.fromDegrees(r.x,r.y,this.config.height||3),popup:{html:i,anchor:[0,-15]},properties:t},a=this.config.symbol;if(a){var s=a.styleOptions;if(a.styleField){var l=attr[a.styleField],c=a.styleFieldOptions[l];null!=c&&(s=h.default.extend({},s),s=h.default.extend(s,c))}(s=s||{}).image?(o.billboard=(0,f.style2Entity)(s),o.billboard.heightReference=u.HeightReference.RELATIVE_TO_GROUND):o.point=(0,p.style2Entity)(s),s.label&&(o.label=(0,m.style2Entity)(s.label),o.label.heightReference=u.HeightReference.RELATIVE_TO_GROUND,o.label.text=t.name)}else o.point={color:new u.Color.fromCssColorString("#3388ff"),pixelSize:10,outlineColor:new u.Color.fromCssColorString("#ffffff"),outlineWidth:2,heightReference:u.HeightReference.RELATIVE_TO_GROUND,scaleByDistance:new u.NearFarScalar(1e3,1,2e4,.5)},o.label={text:t.name,font:"normal small-caps normal 16px 楷体",style:u.LabelStyle.FILL_AND_OUTLINE,fillColor:u.Color.AZURE,outlineColor:u.Color.BLACK,outlineWidth:2,horizontalOrigin:u.HorizontalOrigin.CENTER,verticalOrigin:u.VerticalOrigin.BOTTOM,pixelOffset:new u.Cartesian2(0,-15),heightReference:u.HeightReference.RELATIVE_TO_GROUND,scaleByDistance:new u.NearFarScalar(1e3,1,5e3,.8),distanceDisplayCondition:new u.DistanceDisplayCondition(0,5e3)};return this.dataSource.entities.add(o)}});t.POILayer=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GltfLayer=void 0;var n,r=i(0),c=(n=r)&&n.__esModule?n:{default:n};var o=i(9).BaseLayer.extend({model:null,add:function(){this.model?this.viewer.entities.add(this.model):this.initData()},remove:function(){this.viewer.entities.remove(this.model)},centerAt:function(e){if(null!=this.model)if(this.config.extent||this.config.center)this.viewer.gsp.centerAt(this.config.extent||this.config.center,{duration:e,isWgs84:!0});else{var t=this.config.position;this.viewer.gsp.centerAt(t,{duration:e,isWgs84:!0})}},initData:function(){var e=this.config.position;e=this.viewer.gsp.point2map(e);var t=c.Cartesian3.fromDegrees(e.x,e.y,e.z||0),i=c.Math.toRadians(e.heading||0),n=c.Math.toRadians(e.pitch||0),r=c.Math.toRadians(e.roll||0),o=new c.HeadingPitchRoll(i,n,r),a=c.Transforms.headingPitchRollQuaternion(t,o),s={uri:this.config.url};for(var l in this.config)"url"!=l&&"name"!=l&&"position"!=l&&"center"!=l&&"tooltip"!=l&&"popup"!=l&&(s[l]=this.config[l]);this.model=this.viewer.entities.add({name:this.config.name,position:t,orientation:a,model:s,_config:this.config,tooltip:this.config.tooltip,popup:this.config.popup})},hasOpacity:!0,setOpacity:function(e){null!=this.model&&(this.model.model.color=new c.Color.fromCssColorString("#FFFFFF").withAlpha(e))}});t.GltfLayer=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tiles3dLayer=void 0;var n,r=i(0),u=(n=r)&&n.__esModule?n:{default:n},o=i(9),a=i(4),s=i(43),l=i(1);var c=o.BaseLayer.extend({model:null,originalCenter:null,boundingSphere:null,add:function(){this.model?this.viewer.scene.primitives.add(this.model):this.initData()},remove:function(){this.viewer.scene.primitives.remove(this.model),this.model=null},centerAt:function(e){this.config.extent||this.config.center?this.viewer.gsp.centerAt(this.config.extent||this.config.center,{duration:e,isWgs84:!0}):this.boundingSphere&&this.viewer.camera.flyToBoundingSphere(this.boundingSphere,{offset:new u.HeadingPitchRange(0,-.5,2*this.boundingSphere.radius),duration:e})},initData:function(){for(var e in this.config.maximumScreenSpaceError=this.config.maximumScreenSpaceError||2,this.config.maximumMemoryUsage=this.config.maximumMemoryUsage||2048,this.model=this.viewer.scene.primitives.add(new u.Cesium3DTileset((0,a.getProxyUrl)(this.config))),this.model._config=this.config,this.config)if("url"!=e&&"type"!=e&&"style"!=e&&"classificationType"!=e)try{this.model[e]=this.config[e]}catch(e){}this.config.style&&(this.model.style=new u.Cesium3DTileStyle(this.config.style));var c=this;this.model.readyPromise.then(function(e){c.readyPromise&&c.readyPromise(e),c.hasOpacity&&1!=c._opacity&&c.setOpacity(c._opacity);var t=e.boundingSphere;c.boundingSphere=t,e._root&&e._root.transform&&(c.orginMatrixInverse=u.Matrix4.inverse(u.Matrix4.fromArray(e._root.transform),new u.Matrix4),0<c.config.scale&&1!=c.config.scale&&(e._root.transform=u.Matrix4.multiplyByUniformScale(e._root.transform,c.config.scale,e._root.transform)));var i=t.center,n=u.Cartographic.fromCartesian(i),r=Number(n.height.toFixed(2)),o=Number(u.Math.toDegrees(n.longitude).toFixed(6)),a=Number(u.Math.toDegrees(n.latitude).toFixed(6));c.originalCenter={x:o,y:a,z:r},console.log((c.config.name||"")+" 模型原始位置:"+JSON.stringify(c.originalCenter));var s=c.viewer.gsp.point2map(c.originalCenter);if(s.x!=c.originalCenter.x||s.y!=c.originalCenter.y||null!=c.config.offset){c.config.offset=c.config.offset||{},c.config.offset.x&&c.config.offset.y&&(c.config.offset=c.viewer.gsp.point2map(c.config.offset));var l={x:c.config.offset.x||s.x,y:c.config.offset.y||s.y,z:c.config.offset.z||0,heading:c.config.offset.heading,axis:c.config.axis,scale:c.config.scale};"-height"==c.config.offset.z?(l.z=5-r,c.updateMatrix(l)):"auto"==c.config.offset.z?c.autoHeight(i,l):c.updateMatrix(l)}!c.viewer.gsp.isFlyAnimation()&&c.config.flyTo&&c.centerAt(0),c.config.calback&&c.config.calback(e)})},autoHeight:function(e,n){var r=this;(0,a.terrainPolyline)({viewer:this.viewer,positions:[e,e],calback:function(e,t){if(null!=e&&0!=e.length&&!t){var i=(0,l.formatPositon)(e[0]).z-r.originalCenter.z+1;n.z=i,r.updateMatrix(n)}}})},updateMatrix:function(e){null!=this.model&&(console.log((this.config.name||"")+" 模型修改后位置:"+JSON.stringify(e)),e.transform=null!=e.heading,(0,s.updateMatrix)(this.model,e))},hasOpacity:!0,setOpacity:function(e){this._opacity=e,this.model&&(this.model.style=new u.Cesium3DTileStyle({color:"color() *vec4(1,1,1,"+e+")"}))},showClickFeature:function(e){this.model?this.model._config.showClickFeature=e:this.config.showClickFeature=e}});t.Tiles3dLayer=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KmlLayer=void 0;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=i(28),s=i(4);var l=a.GeoJsonLayer.extend({queryData:function(){var t=this,e=(0,s.getProxyUrl)(this.config);o.KmlDataSource.load(e.url,{camera:this.viewer.scene.camera,canvas:this.viewer.scene.canvas,clampToGround:e.clampToGround}).then(function(e){t.showResult(e)}).otherwise(function(e){t.showError("服务出错",e)})},getEntityAttr:function(e){var t={name:e._name},i=e._kml.extendedData;for(var n in i)t[n]=i[n].value;return t}});t.KmlLayer=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CzmlLayer=void 0;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n},a=i(28),s=i(4);var l=a.GeoJsonLayer.extend({queryData:function(){var t=this,e=(0,s.getProxyUrl)(this.config);o.CzmlDataSource.load(e.url,e).then(function(e){t.showResult(e)}).otherwise(function(e){t.showError("服务出错",e)})},getEntityAttr:function(e){if(e.description&&e.description.getValue)return e.description.getValue(this.viewer.clock.currentTime)}});t.CzmlLayer=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TerrainLayer=void 0;var n,r=i(0),o=((n=r)&&n.__esModule,i(9)),a=i(4);var s=o.BaseLayer.extend({terrain:null,add:function(){this.terrain||(this.terrain=(0,a.getTerrainProvider)(this.config)),this.viewer.terrainProvider=this.terrain},remove:function(){this.viewer.terrainProvider=(0,a.getEllipsoidTerrain)()}});t.TerrainLayer=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawLayer=void 0;a(i(0));var n=a(i(5)),r=i(9),o=i(16);function a(e){return e&&e.__esModule?e:{default:e}}var s=r.BaseLayer.extend({create:function(){this.drawControl=new o.Draw(this.viewer,{hasEdit:!1,nameTooltip:!1,removeScreenSpaceEvent:!1})},add:function(){this._isload?this.drawControl.setVisible(!0):this._loadData()},remove:function(){this.drawControl.setVisible(!1)},centerAt:function(e){var t=this.drawControl.getEntitys();this.viewer.flyTo(t,{duration:e})},hasOpacity:!1,setOpacity:function(){},_loadData:function(){var i=this;n.default.ajax({type:"get",dataType:"json",url:this.config.url,timeout:1e4,success:function(e){i._isload=!0;var t=i.drawControl.jsonToEntity(e,!0,i.config.flyTo);i._bindEntityConfig(t)},error:function(){console.log("Json文件"+i.config.url+"加载失败！")}})},_bindEntityConfig:function(e){for(var i=this,t=0,n=e.length;t<n;t++){var r=e[t];(this.config.columns||this.config.popup)&&(r.popup={html:function(e){var t=e.attribute.attr;return t.draw_type=e.attribute.type,t.draw_typename=e.attribute.name,i.viewer.gsp.popup.getPopupForConfig(i.config,t)},anchor:this.config.popupAnchor||[0,-15]}),this.config.tooltip&&(r.tooltip={html:function(e){var t=e.attribute.attr;return t.draw_type=e.attribute.type,t.draw_typename=e.attribute.name,i.viewer.gsp.popup.getPopupForConfig({popup:i.config.tooltip},t)},anchor:this.config.tooltipAnchor||[0,-15]}),this.config.click&&(r.click=this.config.click),this.config.mouseover&&(r.mouseover=this.config.mouseover),this.config.mouseout&&(r.mouseout=this.config.mouseout)}}});t.DrawLayer=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function n(e){var t;switch(e.layer){case"vec":default:t="http://online{s}.map.bdimg.com/onlinelabel/?qt=tile&x={x}&y={y}&z={z}&styles="+(e.bigfont?"ph":"pl")+"&scaler=1&p=1";break;case"img_d":t="http://shangetu{s}.map.bdimg.com/it/u=x={x};y={y};z={z};v=009;type=sate&fm=46";break;case"img_z":t="http://online{s}.map.bdimg.com/tile/?qt=tile&x={x}&y={y}&z={z}&styles="+(e.bigfont?"sh":"sl")+"&v=020";break;case"custom":e.customid=e.customid||"midnight",t="http://api{s}.map.bdimg.com/customimage/tile?&x={x}&y={y}&z={z}&scale=1&customid="+e.customid;break;case"time":t="http://its.map.baidu.com:8002/traffic/TrafficTileService?x={x}&y={y}&level={z}&time="+(new Date).getTime()+"&label=web2D&v=017"}this._url=t,this._tileWidth=256,this._tileHeight=256,this._maximumLevel=18;var i=new Cesium.Cartesian2(-33554054,-33746824),n=new Cesium.Cartesian2(33554054,33746824);this._tilingScheme=new Cesium.WebMercatorTilingScheme({rectangleSouthwestInMeters:i,rectangleNortheastInMeters:n}),this._credit=void 0,this._rectangle=this._tilingScheme.rectangle,this._ready=!0}Cesium.defineProperties(n.prototype,{url:{get:function(){return this._url}},token:{get:function(){return this._token}},proxy:{get:function(){return this._proxy}},tileWidth:{get:function(){if(!this._ready)throw new DeveloperError("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new DeveloperError("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new DeveloperError("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new DeveloperError("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new DeveloperError("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this._ready)throw new DeveloperError("rectangle must not be called before the imagery provider is ready.");return this._rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new DeveloperError("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},usingPrecachedTiles:{get:function(){return this._useTiles}},hasAlphaChannel:{get:function(){return!0}},layers:{get:function(){return this._layers}}}),n.prototype.getTileCredits=function(e,t,i){},n.prototype.requestImage=function(e,t,i){if(!this._ready)throw new DeveloperError("requestImage must not be called before the imagery provider is ready.");var n=this._tilingScheme.getNumberOfXTilesAtLevel(i),r=this._tilingScheme.getNumberOfYTilesAtLevel(i),o=this._url.replace("{x}",e-n/2).replace("{y}",r/2-t-1).replace("{z}",i).replace("{s}",Math.floor(10*Math.random()));return Cesium.ImageryProvider.loadImage(this,o)},t.BaiduImageryProvider=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureGridImageryProvider=void 0;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n};function a(e){if(e=o.defaultValue(e,o.defaultValue.EMPTY_OBJECT),this.options=e,this._tileWidth=o.defaultValue(e.tileWidth,256),this._tileHeight=o.defaultValue(e.tileHeight,256),this._minimumLevel=o.defaultValue(e.minimumLevel,0),this._maximumLevel=e.maximumLevel,e.rectangle&&e.rectangle.xmin&&e.rectangle.xmax&&e.rectangle.ymin&&e.rectangle.ymax){var t=e.rectangle.xmin,i=e.rectangle.xmax,n=e.rectangle.ymin,r=e.rectangle.ymax;e.rectangle=o.Rectangle.fromDegrees(t,n,i,r)}this._tilingScheme=o.defaultValue(e.tilingScheme,new o.GeographicTilingScheme({ellipsoid:e.ellipsoid})),this._rectangle=o.defaultValue(e.rectangle,this._tilingScheme.rectangle),this._rectangle=o.Rectangle.intersection(this._rectangle,this._tilingScheme.rectangle),this._hasAlphaChannel=o.defaultValue(e.hasAlphaChannel,!0),this._errorEvent=new o.Event,this._readyPromise=o.when.resolve(!0),this._credit=void 0,this._ready=!0}o.defineProperties(a.prototype,{url:{get:function(){return this._url}},token:{get:function(){return this._token}},proxy:{get:function(){return this._proxy}},tileWidth:{get:function(){if(!this._ready)throw new DeveloperError("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new DeveloperError("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new DeveloperError("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new DeveloperError("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new DeveloperError("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this._ready)throw new DeveloperError("rectangle must not be called before the imagery provider is ready.");return this._rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new DeveloperError("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},usingPrecachedTiles:{get:function(){return this._useTiles}},hasAlphaChannel:{get:function(){return!0}},layers:{get:function(){return this._layers}}}),a.prototype.getTileCredits=function(e,t,i){},a.prototype.requestImage=function(e,t,i){var n=document.createElement("canvas");if(n.width=256,n.height=256,i<this._minimumLevel)return n;if(this.options.debuggerTileInfo){var r=n.getContext("2d");r.strokeStyle="#ffff00",r.lineWidth=2,r.strokeRect(1,1,255,255);var o="L"+i+"X"+e+"Y"+t;r.font="bold 25px Arial",r.textAlign="center",r.fillStyle="black",r.fillText(o,127,127),r.fillStyle="#ffff00",r.fillText(o,124,124)}return n},a.prototype._getGridKey=function(e){return e.level+"_x"+e.x+"_y"+e.y},a.prototype.addImageryCache=function(e){e.level<this._minimumLevel||e.level<e.maxLevel-1||this.options.addImageryCache&&(e.key=this._getGridKey(e),this.options.addImageryCache(e))},a.prototype.removeImageryCache=function(e){e.maxLevel<this._minimumLevel&&this.options.removeAllImageryCache&&this.options.removeAllImageryCache(),e.level<this._minimumLevel||this.options.removeImageryCache&&(e.key=this._getGridKey(e),this.options.removeImageryCache(e))},t.FeatureGridImageryProvider=a},function(module,exports,__webpack_require__){"use strict";function addLog(){try{eval(function(e,t,i,n,r){if(n=function(e){return e.toString(30)},!"".replace(/^/,String)){for(;t--;)r[n(t)]=i[t]||n(t);i=[function(e){return r[e]}],n=function(){return"\\w+"},t=1}for(;t--;)i[t]&&(e=e.replace(new RegExp("\\b"+n(t)+"\\b","g"),i[t]));return e}('1(g(){2.3("\\4\\5\\6\\7\\8\\9\\a\\b d e\\f\\0\\h\\i %c \\j\\k\\l\\m\\n://o.p.q","r:s")},t);',30,"u67b6|setTimeout|console|log|u5f53|u524d|u4e09|u7ef4|u5730|u56fe|u4f7f|u7528MarsGIS||for|Cesium|u6846|function|u5b9e|u73b0|u5b98|u65b9|u7f51|u7ad9|uff1ahttp|cesium|con|color|red|6E4".split("|"),0,{}))}catch(e){}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.addLog=addLog},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GaodePOIGeocoder=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),s=(o=a)&&o.__esModule?o:{default:o},l=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(19)),c=i(4);t.GaodePOIGeocoder=(n(u,[{key:"getOneKey",value:function(){var e=this.gaodekey;return e[Math.floor(Math.random()*e.length+1)-1]}},{key:"geocode",value:function(t){var r=this,e=this.getOneKey();return new s.Resource({url:"http://restapi.amap.com/v3/place/text",queryParameters:{key:e,city:this.citycode,keywords:t}}).fetchJson().then(function(e){if(0!=e.status){if(0!==e.pois.length){var n=3e3;return r.viewer.camera.positionCartographic.height<n&&(n=r.viewer.camera.positionCartographic.height),e.pois.map(function(e){var t=e.location.split(",");t=l.gcj2wgs(t);var i=r.viewer.gsp.point2map({x:t[0],y:t[1]});return{displayName:e.name,destination:s.Cartesian3.fromDegrees(i.x,i.y,n)}})}(0,c.msg)("未查询到“"+t+"”相关数据！")}else(0,c.msg)("请求失败("+e.infocode+")："+e.info)})}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),e=e||{},this.citycode=e.citycode||"",this.gaodekey=e.key||["f2fedb9b08ae13d22f1692cd472d345e","81825d9f2bafbb14f235d2779be90c0f","b185732970a4487de104fa71ef575f29","2e6ca4aeb6867fb637a5bee8333e5d3a","027187040fa924e56048468aaa77b62c"]}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testTk=function(){return!0}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHeadingPitchRollByOrientation=function(e,t){var i=d.Matrix4.fromRotationTranslation(d.Matrix3.fromQuaternion(t,o),e,a);return s(e,i)},t.getHeadingPitchRollByMatrix=s,t.getHeadingPitchRollForLine=function(e,t,i){i=i||d.Ellipsoid.WGS84;var n=d.Cartesian3.normalize(d.Cartesian3.subtract(t,e,l),l);d.Transforms.rotationMatrixFromPositionVelocity(e,n,i,c);var r=d.Matrix4.fromRotationTranslation(c,e,a);return d.Matrix4.multiplyTransformation(r,d.Axis.Z_UP_TO_X_UP,r),s(e,r)},t.getRotateCenterPoint=function(e,t,i){var n=d.Cartographic.fromCartesian(e);n.height=0;var r=d.Cartographic.toCartesian(n),o=d.Cartesian3.normalize(d.Cartesian3.subtract(r,e,new d.Cartesian3),new d.Cartesian3),a=d.Quaternion.fromAxisAngle(o,d.Math.toRadians(i)),s=d.Matrix3.fromQuaternion(a),l=d.Matrix4.fromRotationTranslation(s),c=d.Cartesian3.subtract(t,e,new d.Cartesian3),u=d.Matrix4.multiplyByPoint(l,c,new d.Cartesian3);return d.Cartesian3.add(u,e,new d.Cartesian3)},t.getPositionTranslation=function(e,t,i,n){i=i||0,n=n||"z";var r=d.Math.toRadians(-i);n="UNIT_"+n.toUpperCase();var o=d.Quaternion.fromAxisAngle(d.Cartesian3[n],r),a=d.Matrix3.fromQuaternion(o),s=new d.Cartesian3(t.x,t.y,t.z),l=d.Matrix4.fromRotationTranslation(a,d.Cartesian3.ZERO);d.Matrix4.multiplyByTranslation(l,s,l);var c=d.Ellipsoid.WGS84.cartographicToCartesian(d.Cartographic.fromCartesian(e)),u=d.Transforms.eastNorthUpToFixedFrame(c);d.Matrix4.multiplyTransformation(u,l,l);var h=new d.Cartesian3;return d.Matrix4.getTranslation(l,h),h},t.getOffsetLine=function(e,t){for(var i=[],n=1;n<e.length;n++){var r=e[n-1],o=e[n],a=d.Cartesian3.subtract(r,o,new d.Cartesian3),s=d.Cartesian3.cross(r,a,new d.Cartesian3),l=u(r,s,1e3*t),c=u(o,s,1e3*t);1==n&&i.push(l),i.push(c)}return i};var n,r=i(0),d=(n=r)&&n.__esModule?n:{default:n};var o=new d.Matrix3,a=new d.Matrix4;function s(e,t){var i=d.Transforms.eastNorthUpToFixedFrame(e,d.Ellipsoid.WGS84,new d.Matrix4),n=d.Matrix4.multiply(d.Matrix4.inverse(i,new d.Matrix4),t,new d.Matrix4),r=d.Matrix4.getRotation(n,new d.Matrix3),o=d.Quaternion.fromRotationMatrix(r);return d.HeadingPitchRoll.fromQuaternion(o)}var l=new d.Cartesian3,c=(a=new d.Matrix4,new d.Matrix3);function u(e,t,i){var n=new d.Ray(e,t);return d.Ray.getPoint(n,i,new d.Cartesian3)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FlowEcharts=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),s=(o=a)&&o.__esModule?o:{default:o};function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var c=s.Math.toRadians(80),u=(n(h,[{key:"setMapOffset",value:function(e){this._mapOffset=e}},{key:"getBMap",value:function(){return this._GLMap}},{key:"dataToPoint",value:function(e){var t=[99999,99999],i=s.Cartesian3.fromDegrees(e[0],e[1]);if(!i)return t;var n=this._GLMap.cartesianToCanvasCoordinates(i);if(!n)return t;var r=this._GLMap;if(r.mode===s.SceneMode.SCENE3D){var o=s.Cartesian3.angleBetween(r.camera.position,i);if(c<o)return!1}return[n.x-this._mapOffset[0],n.y-this._mapOffset[1]]}},{key:"pointToData",value:function(e){var t=this._mapOffset;return[(e=this._bmap.project([e[0]+t[0],e[1]+t[1]])).lng,e.lat]}},{key:"getViewRect",value:function(){var e=this._api;return new echarts.graphic.BoundingRect(0,0,e.getWidth(),e.getHeight())}},{key:"getRoamTransform",value:function(){return echarts.matrix.create()}}]),h);function h(e,t){l(this,h),this._GLMap=e,this.dimensions=["lng","lat"],this._mapOffset=[0,0],this._api=t}u.dimensions=["lng","lat"],u.create=function(e,n){var r;e.eachComponent("GLMap",function(e){var t=n.getZr().painter;if(t){t.getViewportRoot();var i=echarts.glMap;(r=new u(i,n)).setMapOffset(e.__mapOffset||[0,0]),e.coordinateSystem=r}}),e.eachSeries(function(e){"GLMap"===e.get("coordinateSystem")&&(e.coordinateSystem=r)})},window.echarts&&(echarts.registerCoordinateSystem("GLMap",u),echarts.registerAction({type:"GLMapRoam",event:"GLMapRoam",update:"updateLayout"},function(e,t){}),echarts.extendComponentModel({type:"GLMap",getBMap:function(){return this.__GLMap},defaultOption:{roam:!1}}),echarts.extendComponentView({type:"GLMap",init:function(e,t){this.api=t,echarts.glMap.postRender.addEventListener(this.moveHandler,this)},moveHandler:function(){this.api.dispatchAction({type:"GLMapRoam"})},render:function(){},dispose:function(){echarts.glMap.postRender.removeEventListener(this.moveHandler,this)}}));t.FlowEcharts=(n(d,[{key:"_createChartOverlay",value:function(){var e=this._mapContainer.scene;e.canvas.setAttribute("tabIndex",0);var t=document.createElement("div");return t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.width=e.canvas.width+"px",t.style.height=e.canvas.height+"px",t.style.pointerEvents="none",t.setAttribute("id","echarts"),t.setAttribute("class","echartMap"),this._mapContainer.container.appendChild(t),this._echartsContainer=t,echarts.glMap=e,echarts.init(t)}},{key:"dispose",value:function(){this._echartsContainer&&(this._mapContainer.container.removeChild(this._echartsContainer),this._echartsContainer=null),this._overlay&&(this._overlay.dispose(),this._overlay=null)}},{key:"destroy",value:function(){this.dispose()}},{key:"updateOverlay",value:function(e){this._overlay&&this._overlay.setOption(e)}},{key:"getMap",value:function(){return this._mapContainer}},{key:"getOverlay",value:function(){return this._overlay}},{key:"show",value:function(){document.getElementById(this._id).style.visibility="visible"}},{key:"hide",value:function(){document.getElementById(this._id).style.visibility="hidden"}}]),d);function d(e,t){l(this,d),this._mapContainer=e,this._overlay=this._createChartOverlay(),this._overlay.setOption(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapVLayer=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),s=(o=a)&&o.__esModule?o:{default:o},l=i(95);var c=0;t.MapVLayer=(n(u,[{key:"initDevicePixelRatio",value:function(){this.devicePixelRatio=window.devicePixelRatio||1}},{key:"addInnerContainer",value:function(){this.container.appendChild(this.canvas)}},{key:"bindEvent",value:function(){var t=this;this.innerMoveStart=this.moveStartEvent.bind(this),this.innerMoveEnd=this.moveEndEvent.bind(this),this.scene.camera.moveStart.addEventListener(this.innerMoveStart,this),this.scene.camera.moveEnd.addEventListener(this.innerMoveEnd,this);var e=new s.ScreenSpaceEventHandler(this.canvas);e.setInputAction(function(e){t.innerMoveEnd()},s.ScreenSpaceEventType.LEFT_UP),e.setInputAction(function(e){t.innerMoveEnd()},s.ScreenSpaceEventType.MIDDLE_UP),this.handler=e}},{key:"unbindEvent",value:function(){this.scene.camera.moveStart.removeEventListener(this.innerMoveStart,this),this.scene.camera.moveEnd.removeEventListener(this.innerMoveEnd,this),this.scene.postRender.removeEventListener(this._reset,this),this.handler&&(this.handler.destroy(),this.handler=null)}},{key:"moveStartEvent",value:function(){this.mapvBaseLayer&&this.mapvBaseLayer.animatorMovestartEvent(),this.scene.postRender.addEventListener(this._reset,this),console.log("mapv moveStartEvent")}},{key:"moveEndEvent",value:function(){this.scene.postRender.removeEventListener(this._reset,this),this.mapvBaseLayer&&this.mapvBaseLayer.animatorMoveendEvent(),this._reset(),console.log("mapv moveEndEvent")}},{key:"zoomStartEvent",value:function(){this._unvisiable()}},{key:"zoomEndEvent",value:function(){this._unvisiable()}},{key:"addData",value:function(e,t){null!=this.mapvBaseLayer&&this.mapvBaseLayer.addData(e,t)}},{key:"updateData",value:function(e,t){null!=this.mapvBaseLayer&&this.mapvBaseLayer.updateData(e,t)}},{key:"getData",value:function(){return this.mapvBaseLayer&&(this.dataSet=this.mapvBaseLayer.getData()),this.dataSet}},{key:"removeData",value:function(e){null!=this.mapvBaseLayer&&this.mapvBaseLayer&&this.mapvBaseLayer.removeData(e)}},{key:"removeAllData",value:function(){null!=this.mapvBaseLayer&&this.mapvBaseLayer.clearData()}},{key:"_visiable",value:function(){return this.canvas.style.display="block"}},{key:"_unvisiable",value:function(){return this.canvas.style.display="none"}},{key:"_createCanvas",value:function(){var e=document.createElement("canvas");e.id=this.mapVOptions.layerid||"mapv"+c++,e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.pointerEvents="none",e.style.zIndex=this.mapVOptions.zIndex||100,e.width=parseInt(this.map.canvas.width),e.height=parseInt(this.map.canvas.height),e.style.width=this.map.canvas.style.width,e.style.height=this.map.canvas.style.height;var t=this.devicePixelRatio;return"2d"==this.mapVOptions.context&&e.getContext(this.mapVOptions.context).scale(t,t),e}},{key:"_reset",value:function(){this.resizeCanvas(),this.fixPosition(),this.onResize(),this.render()}},{key:"draw",value:function(){this._reset()}},{key:"show",value:function(){this._visiable()}},{key:"hide",value:function(){this._unvisiable()}},{key:"destroy",value:function(){this.unbindEvent(),this.remove()}},{key:"remove",value:function(){null!=this.mapvBaseLayer&&(this.removeAllData(),this.mapvBaseLayer.destroy(),this.mapvBaseLayer=void 0,this.canvas.parentElement.removeChild(this.canvas))}},{key:"update",value:function(e){null!=e&&this.updateData(e.data,e.options)}},{key:"resizeCanvas",value:function(){if(null!=this.canvas&&null!=this.canvas){var e=this.canvas;e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.width=parseInt(this.map.canvas.width),e.height=parseInt(this.map.canvas.height),e.style.width=this.map.canvas.style.width,e.style.height=this.map.canvas.style.height}}},{key:"fixPosition",value:function(){}},{key:"onResize",value:function(){}},{key:"render",value:function(){null!=this.mapvBaseLayer&&this.mapvBaseLayer._canvasUpdate()}}]),u);function u(e,t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),this.map=e,this.scene=e.scene,this.mapvBaseLayer=new l.MapVRenderer(e,t,i,this),this.mapVOptions=i,this.initDevicePixelRatio(),this.canvas=this._createCanvas(),this.render=this.render.bind(this),null!=n?(this.container=n).appendChild(this.canvas):(this.container=e.container,this.addInnerContainer()),this.bindEvent(),this._reset()}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapVRenderer=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:a(r,t,i)}if("value"in n)return n.value;var o=n.get;return void 0!==o?o.call(i):void 0}var o,s=i(0),l=(o=s)&&o.__esModule?o:{default:o};function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==_typeof2(t)&&"function"!=typeof t?e:t}var u=i(96),h=u?u.baiduMapLayer:null,d=h?h.__proto__:Function,p=l.Math.toRadians(80);t.MapVRenderer=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof2(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(f,d),n(f,[{key:"initDevicePixelRatio",value:function(){this.devicePixelRatio=window.devicePixelRatio||1}},{key:"clickEvent",value:function(e){var t=e.point;a(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"clickEvent",this).call(this,t,e)}},{key:"mousemoveEvent",value:function(e){var t=e.point;a(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"mousemoveEvent",this).call(this,t,e)}},{key:"addAnimatorEvent",value:function(){}},{key:"animatorMovestartEvent",value:function(){var e=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=e.stepsRange.start)}},{key:"animatorMoveendEvent",value:function(){this.isEnabledTime()&&this.animator}},{key:"bindEvent",value:function(){this.map,this.options.methods&&(this.options.methods.click,this.options.methods.mousemove)}},{key:"unbindEvent",value:function(){var e=this.map;this.options.methods&&(this.options.methods.click&&e.off("click",this.clickEvent),this.options.methods.mousemove&&e.off("mousemove",this.mousemoveEvent))}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"init",value:function(e){this.options=e,this.initDataRange(e),this.context=this.options.context||"2d",this.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex&&this.canvasLayer.setZIndex(this.options.zIndex),this.initAnimator()}},{key:"_canvasUpdate",value:function(i){this.map;var o=this.scene;if(this.canvasLayer&&!this.stopAniamation){var n=this.options.animation,e=this.getContext();if(this.isEnabledTime()){if(void 0===i)return void this.clear(e);"2d"===this.context&&(e.save(),e.globalCompositeOperation="destination-out",e.fillStyle="rgba(0, 0, 0, .1)",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.restore())}else this.clear(e);if("2d"===this.context)for(var t in this.options)e[t]=this.options[t];else e.clear(e.COLOR_BUFFER_BIT);var r={transferCoordinate:function(e){var t=[99999,99999],i=l.Cartesian3.fromDegrees(e[0],e[1]);if(!i)return t;var n=o.cartesianToCanvasCoordinates(i);if(!n)return t;if(o.mode===l.SceneMode.SCENE3D){var r=l.Cartesian3.angleBetween(o.camera.position,i);if(p<r)return!1}return[n.x,n.y]}};void 0!==i&&(r.filter=function(e){var t=n.trails||10;return!!(i&&e.time>i-t&&e.time<i)});var a=this.dataSet.get(r);this.processData(a),"m"==this.options.unit&&this.options.size,this.options._size=this.options.size;var s=l.SceneTransforms.wgs84ToWindowCoordinates(o,l.Cartesian3.fromDegrees(0,0));this.drawContext(e,new u.DataSet(a),this.options,s),this.options.updateCallback&&this.options.updateCallback(i)}}},{key:"updateData",value:function(e,t){var i=e;i&&i.get&&(i=i.get()),null!=i&&this.dataSet.set(i),a(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"update",this).call(this,{options:t})}},{key:"addData",value:function(e,t){var i=e;e&&e.get&&(i=e.get()),this.dataSet.add(i),this.update({options:t})}},{key:"getData",value:function(){return this.dataSet}},{key:"removeData",value:function(t){if(this.dataSet){var e=this.dataSet.get({filter:function(e){return null==t||"function"!=typeof t||!t(e)}});this.dataSet.set(e),this.update({options:null})}}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"draw",value:function(){this.canvasLayer.draw()}},{key:"clear",value:function(e){e&&e.clearRect&&e.clearRect(0,0,e.canvas.width,e.canvas.height)}},{key:"destroy",value:function(){this.unbindEvent(),this.clear(this.getContext()),this.clearData(),this.animator&&this.animator.stop(),this.animator=null,this.canvasLayer=null}}]),f);function f(e,t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f);var r=c(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,e,t,i));return d?(r.map=e,r.scene=e.scene,r.dataSet=t,i=i||{},r.init(i),r.argCheck(i),r.initDevicePixelRatio(),r.canvasLayer=n,r.stopAniamation=!1,r.animation=i.animation,r.clickEvent=r.clickEvent.bind(r),r.mousemoveEvent=r.mousemoveEvent.bind(r),r.bindEvent(),r):c(r)}},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_96__},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Measure=void 0;var n,r=i(0),M=(n=r)&&n.__esModule?n:{default:n},f=o(i(22)),m=i(16),g=o(i(7)),v=i(13),y=o(i(11)),S=i(4),T=i(1);function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.Measure=function(e){var P=e.viewer,a={color:"#ffffff",font_family:"楷体",font_size:20,border:!0,border_color:"#000000",border_width:3,background:!0,background_color:"#000000",background_opacity:.5,scaleByDistance:!0,scaleByDistance_far:8e5,scaleByDistance_farValue:.5,scaleByDistance_near:1e3,scaleByDistance_nearValue:1,pixelOffset:[0,-15],disableDepthTestDistance:Number.POSITIVE_INFINITY};if(e.label)for(var t in e.label)a[t]=e.label[t];var i="",u=new m.Draw(P,{hasEdit:!1,removeScreenSpaceEvent:e.removeScreenSpaceEvent});u.on(g.DrawAddPoint,function(e){var t=e.entity;switch(i){case"length":case"section":r.showAddPointLength(t);break;case"area":o.showAddPointLength(t);break;case"volume":l.showAddPointLength(t);break;case"height":c.showAddPointLength(t);break;case"super_height":h.showAddPointLength(t);break;case"angle":d.showAddPointLength(t)}}),u.on(g.DrawRemovePoint,function(e){switch(i){case"length":case"section":r.showRemoveLastPointLength(e);break;case"area":o.showRemoveLastPointLength(e);break;case"volume":l.showRemoveLastPointLength(e);break;case"height":c.showRemoveLastPointLength(e);break;case"super_height":h.showRemoveLastPointLength(e);break;case"angle":d.showRemoveLastPointLength(e)}}),u.on(g.DrawMouseMove,function(e){var t=e.entity;switch(i){case"length":case"section":r.showMoveDrawing(t);break;case"area":o.showMoveDrawing(t);break;case"volume":l.showMoveDrawing(t);break;case"height":c.showMoveDrawing(t);break;case"super_height":h.showMoveDrawing(t);break;case"angle":d.showMoveDrawing(t)}}),u.on(g.DrawCreated,function(e){var t=e.entity;switch(i){case"length":case"section":r.showDrawEnd(t);break;case"area":o.showDrawEnd(t);break;case"volume":l.showDrawEnd(t);break;case"height":c.showDrawEnd(t);break;case"super_height":h.showDrawEnd(t);break;case"angle":d.showDrawEnd(t)}});var s=u.getDataSource();function n(){r.clearLastNoEnd(),o.clearLastNoEnd(),l.clearLastNoEnd(),c.clearLastNoEnd(),h.clearLastNoEnd(),d.clearLastNoEnd(),u.stopDraw()}var r={options:null,arrLables:[],totalLable:null,disTerrainScale:1.2,clearLastNoEnd:function(){if(null!=this.totalLable&&s.entities.remove(this.totalLable),this.arrLables&&0<this.arrLables.length){var e=this.arrLables;if(e&&0<e.length)for(var t in e)s.entities.remove(e[t])}this.totalLable=null,this.arrLables=[]},start:function(e){this.options=e;var t=(0,v.style2Entity)(a,{horizontalOrigin:M.HorizontalOrigin.LEFT,verticalOrigin:M.VerticalOrigin.BOTTOM,show:!1});this.totalLable=s.entities.add({label:t,isMarsMeasureLabel:!0,_noMousePosition:!0,attribute:{unit:this.options.unit,type:this.options.type}}),this.arrLables=[],u.startDraw({type:"polyline",config:{addHeight:e.addHeight},style:e.style||{lineType:"glow",color:"#ebe12c",width:9,glowPower:.1,clampToGround:"section"==this.options.type||this.options.terrain}})},showAddPointLength:function(e){var t=u.getPositions(e),i=(0,v.style2Entity)(a,{horizontalOrigin:M.HorizontalOrigin.LEFT,verticalOrigin:M.VerticalOrigin.BOTTOM,show:!0}),n=s.entities.add({position:t[t.length-1],label:i,isMarsMeasureLabel:!0,_noMousePosition:!0,attribute:{unit:this.options.unit,type:this.options.type}});if(1==t.length)n.label.text="起点";else{var r=this.getLength(t),o=E(r,this.options.unit);n.label.text=o,n.attribute.value=r,this.getLength([t[t.length-2],t[t.length-1]])<5&&(n.show=!1)}this.arrLables.push(n)},showRemoveLastPointLength:function(e){var t=this.arrLables.pop();s.entities.remove(t),this.showMoveDrawing(e.entity),this.totalLable.position=e.position},showMoveDrawing:function(e){var t=u.getPositions(e);if(t.length<2)this.totalLable.label.show=!1;else{var i=this.getLength(t),n=E(i,this.options.unit);this.totalLable.position=t[t.length-1],this.totalLable.label.text="总长:"+n,this.totalLable.label.show=!0,this.totalLable.attribute.value=i,this.totalLable.attribute.textEx="总长:",this.options.calback&&this.options.calback(n,i)}},showDrawEnd:function(e){var t=u.getPositions(e),i=this.arrLables.length-t.length;if(0<=i){for(var n=this.arrLables.length-1;n>=t.length-1;n--)s.entities.remove(this.arrLables[n]);this.arrLables.splice(t.length-1,1+i)}e._totalLable=this.totalLable,e._arrLables=this.arrLables,this.totalLable=null,this.arrLables=[],null!=e.polyline&&("section"==this.options.type?this.updateSectionForTerrain(e):this.options.terrain&&this.updateLengthForTerrain(e))},updateLengthForTerrain:function(e){var a=this,i=e.polyline.positions.getValue(P.clock.currentTime),s=e._arrLables,n=e._totalLable,l=n&&n.unit,c=0,u=0;!function o(){if(++c>=i.length&&n){var e=E(u,l);return n.label.text="总长:"+e,n.attribute.value=u,void(a.options.calback&&a.options.calback(e,u))}var t=[i[c-1],i[c]];(0,S.terrainPolyline)({viewer:P,positions:t,calback:function(e,t){var i=a.getLength(e);t&&(i*=a.disTerrainScale);var n=s[c];if(n){var r=E(i,l);n.label.text=r,n.attribute.value=i}u+=i,o()}})}()},updateSectionForTerrain:function(e){var d=e.polyline.positions.getValue(P.clock.currentTime);if(!(d.length<2)){var p=e._arrLables,f=e._totalLable,m=f&&f.unit,g=0,v=[],y=0,_=[],w=[],b=[],C=[],x=this;!function u(){var h=[d[++g-1],d[g]];(0,S.terrainPolyline)({viewer:P,positions:h,calback:function(e,t){v=t?1==g?v.concat(h):v.concat([d[g]]):v.concat(e);for(var i=M.Cartographic.fromCartesian(d[g-1]).height,n=(M.Cartographic.fromCartesian(d[g]).height-i)/e.length,r=0;r<e.length;r++){0!=r&&(y+=M.Cartesian3.distance(e[r],e[r-1])),_.push(Number(y.toFixed(1)));var o=(0,T.formatPositon)(e[r]);w.push(o.z),C.push(o);var a=Number((i+n*r).toFixed(1));b.push(a)}if(g>=d.length-1){if(f){var s=E(l=x.getLength(v),m);f.label.text="总长:"+s,f.attribute.value=l}x.options.calback&&x.options.calback({distancestr:s,distance:l,arrLen:_,arrLX:b,arrHB:w,arrPoint:C})}else{s=E(l=x.getLength(e),m);var l,c=p[g];c.label.text=s,c.attribute.value=l,u()}}})}()}},getLength:function(e){for(var t=0,i=0,n=e.length-1;i<n;i++)t+=M.Cartesian3.distance(e[i],e[i+1]);return t}},o={options:null,totalLable:null,clearLastNoEnd:function(){null!=this.totalLable&&s.entities.remove(this.totalLable),this.totalLable=null},start:function(e){this.options=e;var t=(0,v.style2Entity)(a,{horizontalOrigin:M.HorizontalOrigin.CENTER,verticalOrigin:M.VerticalOrigin.BOTTOM,show:!1});this.totalLable=s.entities.add({label:t,isMarsMeasureLabel:!0,_noMousePosition:!0,attribute:{unit:this.options.unit,type:this.options.type}}),u.startDraw({type:"polygon",style:e.style||{color:"#00fff2",outline:!0,outlineColor:"#fafa5a",outlineWidth:1,opacity:.4,clampToGround:!0}})},showAddPointLength:function(){},showRemoveLastPointLength:function(e){u.getPositions(e.entity).length<3&&(this.totalLable.label.show=!1)},showMoveDrawing:function(e){var t=u.getPositions(e);if(t.length<3)this.totalLable.label.show=!1;else{var i=y.toGeoJSON(e),n=f.area(i),r=p(n,this.options.unit),o=(0,T.centerOfMass)(t);this.totalLable.position=o,this.totalLable.label.text="面积:"+r,this.totalLable.label.show=!0,this.totalLable.attribute.value=n,this.totalLable.attribute.textEx="面积:",this.options.calback&&this.options.calback(r,n)}},showDrawEnd:function(e){null!=e.polygon&&(e._totalLable=this.totalLable,this.totalLable=null)}},l={options:null,totalLable:null,prevEntity:null,clearLastNoEnd:function(){null!=this.totalLable&&s.entities.remove(this.totalLable),(this.totalLable=null)!=this.prevEntity&&s.entities.remove(this.prevEntity),this.prevEntity=null},start:function(e){this.options=e;var t=(0,v.style2Entity)(a,{horizontalOrigin:M.HorizontalOrigin.CENTER,verticalOrigin:M.VerticalOrigin.BOTTOM,show:!1});this.totalLable=s.entities.add({label:t,isMarsMeasureLabel:!0,_noMousePosition:!0,attribute:{unit:this.options.unit,type:this.options.type}}),u.startDraw({type:"polygon",style:e.style||{color:"#00fff2",outline:!0,outlineColor:"#fafa5a",outlineWidth:1,opacity:.4,clampToGround:!0}})},showAddPointLength:function(){},showRemoveLastPointLength:function(){},showMoveDrawing:function(){},showDrawEnd:function(e){if(null!=e.polygon){var t=y.getPositions(e),i=this.computeCutVolume(t),n=i.maxHeight,r=i.totalCutVolume,o=r.toFixed(2)+"立方米",a=(0,T.centerOfMass)(t,n+10);this.totalLable.position=a,this.totalLable.label.text="挖方体积:"+o,this.totalLable.label.show=!0,this.totalLable.attribute.value=r,this.totalLable.attribute.textEx="挖方体积:",this.options.calback&&this.options.calback(areastr,r),s.entities.remove(e),(e=s.entities.add({polygon:{hierarchy:{positions:t},extrudedHeight:n,closeTop:!1,closeBottom:!1,material:new M.Color.fromCssColorString("#00fff2").withAlpha(.5),outline:!0,outlineColor:new M.Color.fromCssColorString("#fafa5a").withAlpha(.4),outlineWidth:1}}))._totalLable=this.totalLable,this.totalLable=null}},computeCutVolume:function(e){for(var t=15e3,i=0;i<e.length;i++){var n=M.Cartographic.fromCartesian(e[i]),r=P.scene.globe.getHeight(n);r<t&&(t=r)}var o=Math.PI/Math.pow(2,11);o/=64;var a,s,l,c,u,h,d,p,f,m=new M.PolygonGeometry.fromPositions({positions:e,vertexFormat:M.PerInstanceColorAppearance.FLAT_VERTEX_FORMAT,granularity:o}),g=new M.PolygonGeometry.createGeometry(m),v=0,y=0;for(i=0;i<g.indices.length;i+=3){a=g.indices[i],s=g.indices[i+1],l=g.indices[i+2],f=new M.Cartesian3(g.attributes.position.values[3*a],g.attributes.position.values[3*a+1],g.attributes.position.values[3*a+2]),n=M.Cartographic.fromCartesian(f),c=P.scene.globe.getHeight(n),d=M.Cartesian3.fromRadians(n.longitude,n.latitude,0),y<c&&(y=c),f=new M.Cartesian3(g.attributes.position.values[3*s],g.attributes.position.values[3*s+1],g.attributes.position.values[3*s+2]),n=M.Cartographic.fromCartesian(f),u=P.scene.globe.getHeight(n);var _=M.Cartesian3.fromRadians(n.longitude,n.latitude,0);y<u&&(y=u),f=new M.Cartesian3(g.attributes.position.values[3*l],g.attributes.position.values[3*l+1],g.attributes.position.values[3*l+2]),n=M.Cartographic.fromCartesian(f),h=P.scene.globe.getHeight(n),p=M.Cartesian3.fromRadians(n.longitude,n.latitude,0),y<h&&(y=h),v+=this.computeAreaOfTriangle(d,_,p)*(c-t+u-t+h-t)/3}return{maxHeight:y,totalCutVolume:v}},computeAreaOfTriangle:function(e,t,i){var n=M.Cartesian3.distance(e,t),r=M.Cartesian3.distance(t,i),o=M.Cartesian3.distance(i,e),a=(n+r+o)/2;return Math.sqrt(a*(a-n)*(a-r)*(a-o))}},c={options:null,totalLable:null,clearLastNoEnd:function(){null!=this.totalLable&&s.entities.remove(this.totalLable),this.totalLable=null},start:function(e){this.options=e;var t=(0,v.style2Entity)(a,{horizontalOrigin:M.HorizontalOrigin.RIGHT,verticalOrigin:M.VerticalOrigin.BOTTOM,show:!1});this.totalLable=s.entities.add({label:t,isMarsMeasureLabel:!0,_noMousePosition:!0,attribute:{unit:this.options.unit,type:this.options.type}}),u.startDraw({type:"polyline",config:{maxPointNum:2},style:e.style||{lineType:"glow",color:"#ebe12c",width:9,glowPower:.1}})},showAddPointLength:function(){},showRemoveLastPointLength:function(){this.totalLable&&(this.totalLable.label.show=!1)},showMoveDrawing:function(e){var t=u.getPositions(e);if(t.length<2)this.totalLable.label.show=!1;else{var i=M.Cartographic.fromCartesian(t[0]),n=M.Cartographic.fromCartesian(t[1]),r=Math.abs(n.height-i.height),o=E(r,this.options.unit);this.totalLable.position=M.Cartesian3.midpoint(t[0],t[1],new M.Cartesian3),this.totalLable.label.text="高度差:"+o,this.totalLable.label.show=!0,this.totalLable.attribute.value=r,this.totalLable.attribute.textEx="高度差:",this.options.calback&&this.options.calback(o,r)}},showDrawEnd:function(e){e._totalLable=this.totalLable,this.totalLable=null}},h={options:null,totalLable:null,xLable:null,hLable:null,clearLastNoEnd:function(){null!=this.totalLable&&s.entities.remove(this.totalLable),null!=this.xLable&&s.entities.remove(this.xLable),null!=this.hLable&&s.entities.remove(this.hLable),this.totalLable=null,this.xLable=null,this.hLable=null},start:function(e){this.options=e;var t=(0,v.style2Entity)(a,{horizontalOrigin:M.HorizontalOrigin.RIGHT,verticalOrigin:M.VerticalOrigin.CENTER,show:!1});this.totalLable=s.entities.add({label:t,isMarsMeasureLabel:!0,_noMousePosition:!0,attribute:{unit:this.options.unit,type:this.options.type}});var i=(0,v.style2Entity)(a,{horizontalOrigin:M.HorizontalOrigin.CENTER,verticalOrigin:M.VerticalOrigin.BOTTOM,show:!1});i.pixelOffset=new M.Cartesian2(0,0),this.xLable=s.entities.add({label:i,isMarsMeasureLabel:!0,_noMousePosition:!0,attribute:{unit:this.options.unit,type:this.options.type}}),this.hLable=s.entities.add({label:i,isMarsMeasureLabel:!0,_noMousePosition:!0,attribute:{unit:this.options.unit,type:this.options.type}}),u.startDraw({type:"polyline",config:{maxPointNum:2},style:e.style||{lineType:"glow",color:"#ebe12c",width:9,glowPower:.1}})},showAddPointLength:function(e){var t=u.getPositions(e);if(4==t.length){var i=t[3].clone();t.pop(),t.pop(),t.pop(),t.push(i)}if(2==t.length){var n=this.getZHeightPosition(t[0],t[1]);3<this.getHDistance(t[0],t[1])&&(t.push(n),t.push(t[0]))}this.showSuperHeight(t)},showRemoveLastPointLength:function(e){var t=u.getPositions(e.entity);2==t.length&&(t.pop(),t.pop(),this.totalLable.label.show=!1,this.hLable.label.show=!1,this.xLable.label.show=!1)},showMoveDrawing:function(e){var t=u.getPositions(e);if(4==t.length){var i=t[3].clone();t.pop(),t.pop(),t.pop(),t.push(i)}if(2==t.length){var n=this.getZHeightPosition(t[0],t[1]);3<this.getHDistance(t[0],t[1])&&(t.push(n),t.push(t[0]))}this.showSuperHeight(t)},showDrawEnd:function(e){e._arrLables=[this.totalLable,this.hLable,this.xLable],this.totalLable=null,this.hLable=null,this.xLable=null},showSuperHeight:function(e){var t,i,n,r;if(4==e.length){var o,a=M.Cartesian3.midpoint(e[0],e[1],new M.Cartesian3),s=M.Cartographic.fromCartesian(e[0]),l=M.Cartographic.fromCartesian(e[1]),c=M.Cartographic.fromCartesian(e[2]),u=l.height-c.height;r=l.height-s.height,n=M.Cartesian3.distance(e[0],e[1]),-1<r&&r<1?(h=e[1],this.updateSuperHeightLabel(this.totalLable,h,"高度差:",r)):(t=-.1<u&&u<.1?(o=M.Cartesian3.midpoint(e[2],e[1],new M.Cartesian3),h=M.Cartesian3.midpoint(e[2],e[3],new M.Cartesian3),i=M.Cartesian3.distance(e[1],e[2]),M.Cartesian3.distance(e[3],e[2])):(h=M.Cartesian3.midpoint(e[2],e[1],new M.Cartesian3),o=M.Cartesian3.midpoint(e[2],e[3],new M.Cartesian3),i=M.Cartesian3.distance(e[3],e[2]),M.Cartesian3.distance(e[1],e[2])),this.updateSuperHeightLabel(this.totalLable,h,"高度差:",t),this.updateSuperHeightLabel(this.xLable,o,"",i)),this.updateSuperHeightLabel(this.hLable,a,"",n)}else if(2==e.length){t=M.Cartesian3.distance(e[1],e[0]);var h=M.Cartesian3.midpoint(e[0],e[1],new M.Cartesian3);xLable.label.show&&(xLable.label.show=!1,hLable.label.show=!1),this.updateSuperHeightLabel(this.totalLable,h,"高度差:",t)}var d=E(t,this.options.unit);this.options.calback&&this.options.calback(d,t)},updateSuperHeightLabel:function(e,t,i,n){null!=e&&(e.position=t,e.label.text=i+E(n,this.options.unit),e.label.show=!0,e.attribute.value=n,e.attribute.textEx=i)},getZHeightPosition:function(e,t){var i=M.Cartographic.fromCartesian(e),n=Number(M.Math.toDegrees(i.longitude)),r=Number(M.Math.toDegrees(i.latitude)),o=Number(i.height.toFixed(2)),a=M.Cartographic.fromCartesian(t),s=Number(M.Math.toDegrees(a.longitude)),l=Number(M.Math.toDegrees(a.latitude)),c=Number(a.height.toFixed(2));return c<o?M.Cartesian3.fromDegrees(s,l,o):M.Cartesian3.fromDegrees(n,r,c)},getHDistance:function(e,t){var i=this.getZHeightPosition(e,t),n=M.Cartographic.fromCartesian(t),r=M.Cartographic.fromCartesian(i),o=M.Cartesian3.distance(e,i);return Math.abs(Number(r.height)-Number(n.height))<.01&&(o=M.Cartesian3.distance(t,i)),o}},d={options:null,totalLable:null,exLine:null,clearLastNoEnd:function(){null!=this.totalLable&&s.entities.remove(this.totalLable),(this.totalLable=null)!=this.exLine&&s.entities.remove(this.exLine),this.exLine=null},start:function(e){this.options=e;var t=(0,v.style2Entity)(a,{horizontalOrigin:M.HorizontalOrigin.LEFT,verticalOrigin:M.VerticalOrigin.BOTTOM,show:!1});this.totalLable=s.entities.add({label:t,isMarsMeasureLabel:!0,_noMousePosition:!0,attribute:{unit:this.options.unit,type:this.options.type}}),u.startDraw({type:"polyline",config:{maxPointNum:2},style:e.style||{lineType:"arrow",color:"#ebe967",width:9,clampToGround:!0}})},showAddPointLength:function(){},showRemoveLastPointLength:function(){this.exLine&&(this.exLine.polyline.show=!1),this.totalLable&&(this.totalLable.label.show=!1)},showMoveDrawing:function(e){var t=u.getPositions(e);if(t.length<2)this.totalLable.label.show=!1;else{var i=M.Cartesian3.distance(t[0],t[1]),n=(0,T.formatPositon)(t[0]),r=(0,T.formatPositon)(t[1]),o=f.point([n.x,n.y,n.z]),a=f.point([r.x,r.y,r.z]),s=Math.round(f.rhumbBearing(o,a)),l=f.destination(o,i/3e3,0,{units:"kilometers"});l={x:l.geometry.coordinates[0],y:l.geometry.coordinates[1],z:n.z};var c=M.Cartesian3.fromDegrees(l.x,l.y,l.z);this.updateExLine([t[0],c]),this.totalLable.position=t[1],this.totalLable.label.text="角度:"+s+"°\n距离:"+E(i),this.totalLable.label.show=!0,this.totalLable.attribute.value=s,this.totalLable.attribute.textEx="角度:",this.options.calback&&this.options.calback(s+"°",s)}},updateExLine:function(e){this.exLine?(this.exLine.polyline.show=!0,this.exLine.polyline.positions.setValue(e)):this.exLine=s.entities.add({polyline:{positions:e,width:3,clampToGround:!0,material:new M.PolylineDashMaterialProperty({color:M.Color.RED})}})},showDrawEnd:function(e){e._totalLable=this.totalLable,this.totalLable=null,this.exLine=null}};function p(e,t){if(null==e)return"";null!=t&&"auto"!=t||(t=e<1e6?"m":"km");var i="";switch(t){default:case"m":i=e.toFixed(2)+"平方米";break;case"km":i=(e/1e6).toFixed(2)+"平方公里";break;case"mu":i=(.0015*e).toFixed(2)+"亩";break;case"ha":i=(1e-4*e).toFixed(2)+"公顷"}return i}function E(e,t){if(null==e)return"";null!=t&&"auto"!=t||(t=e<1e3?"m":"km");var i="";switch(t){default:case"m":i=e.toFixed(2)+"米";break;case"km":i=(.001*e).toFixed(2)+"公里";break;case"mile":i=(54e-5*e).toFixed(2)+"海里";break;case"zhang":i=(.3*e).toFixed(2)+"丈"}return i}return{measuerLength:function(e){n(),(e=e||{}).type=i="length",e.hasOwnProperty("terrain")||(e.terrain=!0),r.start(e)},measureHeight:function(e){n(),(e=e||{}).hasOwnProperty("isSuper")&&!e.isSuper?(i="height",e.type=i,c.start(e)):(i="super_height",e.type=i,h.start(e))},measureArea:function(e){n(),(e=e||{}).type=i="area",o.start(e)},measureAngle:function(e){n(),(e=e||{}).type=i="angle",d.start(e)},measureVolume:function(e){n(),(e=e||{}).type=i="volume",l.start(e)},measureSection:function(e){n(),(e=e||{}).type=i="section",e.terrain=!0,r.start(e)},updateUnit:function(e,t){var i=s.entities.values;for(var n in i){var r=i[n];if(r.label&&r.isMarsMeasureLabel&&r.attribute&&r.attribute.value){if(r.attribute.type!=e)continue;"area"==e?r.label.text._value=(r.attribute.textEx||"")+p(r.attribute.value,t):r._label.text._value=(r.attribute.textEx||"")+E(r.attribute.value,t)}}},clearMeasure:function(){i="",n(),u.deleteAll()},formatArea:p,formatLength:E}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DivPoint=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=s(i(0)),o=s(i(5));function s(e){return e&&e.__esModule?e:{default:e}}t.DivPoint=(n(l,[{key:"updateViewPoint",value:function(){if(this._visible){var e=this.viewer.scene,t=a.SceneTransforms.wgs84ToWindowCoordinates(e,this.position);if(null!=t){if(e.mode===a.SceneMode.SCENE3D){var i=e.camera.getPickRay(t),n=e.globe.pick(i,e);if(n&&1e6<a.Cartesian3.distance(this.position,n))return!1}var r=t.x,o=t.y-this.$view.height();this.anchor?(r+=this.anchor[0],o+=this.anchor[1]):r-=this.$view.width()/2,this.$view.css("transform","translate3d("+r+"px,"+o+"px, 0)")}}}},{key:"setVisible",value:function(e){(this._visible=e)?this.$view.show():this.$view.hide()}},{key:"destroy",value:function(){this.viewer.scene.postRender.removeEventListener(this.updateViewPoint,this),this.$view.remove(),this.$view=null,this.position=null,this.anchor=null,this.viewer=null}},{key:"dom",get:function(){return this.$view}},{key:"visible",get:function(){return this._visible},set:function(e){this._visible=e,this.setVisible(e)}}]),l);function l(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),this.viewer=t,this.position=i.position,this.anchor=i.anchor,this._visible=!0,this.$view=(0,o.default)(i.html),this.$view.css({position:"absolute",left:"0",top:"0"}),this.$view.appendTo("#"+t._container.id);var n=this;(i.click||i.popup)&&this.$view.click(function(e){i.popup&&t.gsp.popup.show(i,n.position),i.click&&i.click(i,n,e)}),i.tooltip&&this.$view.hover(function(){t.gsp.tooltip.show(i,n.position)},function(){t.gsp.tooltip.close()}),this.$view.on("mousewheel",function(e){}),t.scene.postRender.addEventListener(this.updateViewPoint,this)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)},n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=new Cesium.Matrix4,s=new Cesium.Matrix3,l=new Cesium.Cartesian3,c=new Cesium.Quaternion,u={model:{show:!1,scale:1,minimumPixelSize:50},label:{show:!1,color:"#ffffff",opacity:1,font_family:"楷体",font_size:20,border:!0,border_color:"#000000",border_width:3,background:!1,hasPixelOffset:!0,pixelOffsetX:30,pixelOffsetY:-30,scaleByDistance:!0,scaleByDistance_far:1e7,scaleByDistance_farValue:.4,scaleByDistance_near:1e5,scaleByDistance_nearValue:1},path:{show:!1,lineType:"solid",color:"#3388ff",opacity:.5,width:1,outline:!1,outlineColor:"#ffffff",outlineWidth:2},shadow:{show:!1,color:"#00ff00",outline:!1,opacity:.3},camera:{type:"gs",followedX:50,followedZ:10},showGroundHeight:!1};t.FlyLine=(n(h,[{key:"_createLine",value:function(){var e,t=new Cesium.SampledPositionProperty,i=Cesium.JulianDate.fromDate(new Date),n=this.points;if(n.length<2)console.log("路线无坐标数据，无法漫游！");else{var r=this.options.speed,o=!haoutil.isutil.isNumber(r);if(2==n.length){var a=this.getPointForLineAlong(n[0],n[1],0,.5);n.splice(1,0,a),r&&o&&r.splice(1,0,r[0])}for(var s,l=0,c=0,u=[],h=0,d=n.length;h<d;h++){var p=n[h],f=Cesium.Cartesian3.fromDegrees(p[0],p[1],p[2]||0);if(f.lonlat=p,0==h){var m=Cesium.JulianDate.addSeconds(i,l,new Cesium.JulianDate);f.time=m,f.second=l,t.addSample(m,f)}else{var g=o?r?r[h-1]:100:r||100,v=Cesium.Cartesian3.distance(f,s);l+=Math.round(v/g*3.6),c+=v,m=Cesium.JulianDate.addSeconds(i,l,new Cesium.JulianDate),f.time=m,f.second=l,t.addSample(m,f)}s=f,u.push(f)}this.arrLinePoint=u,e=Cesium.JulianDate.addSeconds(i,l,new Cesium.JulianDate),this.alllen=c,this.alltimes=l,this.startTime=i,this.stopTime=e,this.property=t,this.property.setInterpolationOptions({interpolationDegree:2,interpolationAlgorithm:Cesium.LagrangePolynomialApproximation})}}},{key:"_createEntity",value:function(){this.options.label.text=this.name;var e=gsp3d.draw.attr.model.style2Entity(this.options.model),t=gsp3d.draw.attr.label.style2Entity(this.options.label),i=gsp3d.draw.attr.polyline.style2Entity(this.options.path,{});i.leadTime=0,i.trailTime=this.alltimes;var n=new Cesium.VelocityOrientationProperty(this.property);this.velocityOrientation=n,this.entity=this.viewer.entities.add({id:this.id,availability:new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({start:this.startTime,stop:this.stopTime})]),position:this.property,orientation:n,model:e,label:t,path:i,point:{show:!e.show,color:new Cesium.Color.fromCssColorString("#ffffff").withAlpha(.01),pixelSize:1}})}},{key:"updateStyle",value:function(e){for(var t in e)if("object"===o(e[t])&&this.options[t])for(var i in e[t])this.options[t][i]=e[t][i];else this.options[t]=e[t]}},{key:"updateAngle",value:function(e,t){if(e)this.entity.orientation=this.velocityOrientation;else{t=t||{};var i=Cesium.Property.getValueOrUndefined(this.property,this.viewer.clock.currentTime,l),n=Cesium.Property.getValueOrUndefined(this.velocityOrientation,this.viewer.clock.currentTime,c),r=gsp3d.matrix.getHeadingPitchRollByOrientation(i,n).heading,o=Cesium.Math.toRadians(Number(t.pitch||0)),a=Cesium.Math.toRadians(Number(t.roll||0));this.entity.orientation=Cesium.Transforms.headingPitchRollQuaternion(i,new Cesium.HeadingPitchRoll(r,o,a))}}},{key:"start",value:function(){this._isStart&&this.stop(),this._isStart=!0,this.viewer.clock.startTime=this.startTime.clone(),this.viewer.clock.stopTime=this.stopTime.clone(),this.viewer.clock.currentTime=this.startTime.clone(),this.viewer.clock.multiplier=1,this.viewer.clock.shouldAnimate=!0,this.options.clockRange?this.viewer.clock.clockRange=Cesium.ClockRange.LOOP_STOP:this.viewer.clock.clockRange=Cesium.ClockRange.CLAMPED,this.viewer.flyTo(this.entity),this.viewer.trackedEntity=this.entity,this.options.shadow.show&&("wall"==this.options.shadow.type?this.addWallShading():"cylinder"==this.options.shadow.type&&this.addCylinderShading()),this.viewer.scene.preRender.addEventListener(this.preRender_eventHandler,this)}},{key:"preRender_eventHandler",value:function(){if(this._isStart&&null!=this.entity){switch(this.options.camera.type){default:null!=this.viewer.trackedEntity&&(this.viewer.trackedEntity=void 0);break;case"gs":this.viewer.trackedEntity!=this.entity&&(this.viewer.trackedEntity=this.entity);break;case"dy":this.viewer.trackedEntity!=this.entity&&(this.viewer.trackedEntity=this.entity),this.getModelMatrix(this.viewer.trackedEntity,this.viewer.clock.currentTime,a);var e=this.options.camera.followedX,t=this.options.camera.followedZ;this.viewer.scene.camera.lookAtTransform(a,new Cesium.Cartesian3(-e,0,t));break;case"sd":this.viewer.trackedEntity!=this.entity&&(this.viewer.trackedEntity=this.entity),this.getModelMatrix(this.viewer.trackedEntity,this.viewer.clock.currentTime,a),t=this.options.camera.followedZ,this.viewer.scene.camera.lookAtTransform(a,new Cesium.Cartesian3(-1,0,t))}var i=Cesium.Property.getValueOrUndefined(this.entity.position,this.viewer.clock.currentTime,l);i&&this.realTime(i)}}},{key:"realTime",value:function(e){var t=Cesium.JulianDate.secondsDifference(this.viewer.clock.currentTime,this.viewer.clock.startTime),a=gsp3d.point.formatPositon(e),i=this.getFlyOkPoints(e);this.timeinfo={time:t,len:i.len,x:a.x,y:a.y,z:a.z},this.options.shadow.show&&"wall"==this.options.shadow.type&&this.updateWallShading(i.positions);var n=Cesium.Cartographic.fromCartesian(e),r=this.viewer.scene.globe.getHeight(n);null!=r&&0<r&&(this.timeinfo.hbgd=r,this.timeinfo.ldgd=a.z-r),this.options.showGroundHeight&&gsp3d.util.terrainPolyline({viewer:this.viewer,positions:[e,e],calback:function(e,t){if(null!=e&&0!=e.length&&!t){var i=gsp3d.point.formatPositon(e[0]).z,n=a.z-i;if(this.timeinfo.hbgd=i,this.timeinfo.ldgd=n,this.entity.label){var r=haoutil.str.formatLength(this.timeinfo.z),o=haoutil.str.formatLength(this.timeinfo.ldgd);this.entity.label.text=this.name+"\n漫游高程："+r+"\n离地距离："+o}}}})}},{key:"getFlyOkPoints",value:function(e){for(var t=[],i=0,n=this.viewer.clock.currentTime,r=this.arrLinePoint,o=0,a=r.length;o<a;o++){var s=r[o];if(Cesium.JulianDate.compare(n,s.time)<0){i+=Cesium.Cartesian3.distance(e,0==o?s:r[o-1]);break}0<o&&(i+=Cesium.Cartesian3.distance(s,r[o-1])),t.push(s)}return t.push(e),{positions:t,len:i}}},{key:"getModelMatrix",value:function(e,t,i){if(null==e)return i;var n=Cesium.Property.getValueOrUndefined(e.position,t,l);if(Cesium.defined(n)){var r=Cesium.Property.getValueOrUndefined(e.orientation,t,c);return i=Cesium.defined(r)?Cesium.Matrix4.fromRotationTranslation(Cesium.Matrix3.fromQuaternion(r,s),n,i):Cesium.Transforms.eastNorthUpToFixedFrame(n,void 0,i)}}},{key:"addWallShading",value:function(){this._wall_positions=[],this._wall_minimumHeights=[],this._wall_maximumHeights=[];var i=this,e=gsp3d.draw.attr.wall.style2Entity(this.options.shadow);e.minimumHeights=new Cesium.CallbackProperty(function(e){return i._wall_minimumHeights},!1),e.maximumHeights=new Cesium.CallbackProperty(function(e){return i._wall_maximumHeights},!1),e.positions=new Cesium.CallbackProperty(function(e){var t=Cesium.Property.getValueOrUndefined(i.entity.position,i.viewer.clock.currentTime,l);return i._wall_positions[i._wall_positions.length-1]=t,i._wall_positions},!1),this.wallEntity=this.viewer.entities.add({wall:e})}},{key:"updateWallShading",value:function(e){for(var t=[],i=[],n=[],r=0;r<e.length;r++){t.push(e[r].clone());var o=Cesium.Cartographic.fromCartesian(e[r]);i.push(0),n.push(o.height)}this._wall_positions=t,this._wall_minimumHeights=i,this._wall_maximumHeights=n}},{key:"addCylinderShading",value:function(){var r=100,o=100,a=this.property,e=gsp3d.draw.attr.wall.style2Entity(this.options.shadow);e.length=new Cesium.CallbackProperty(function(e){return o},!1),e.topRadius=0,e.bottomRadius=new Cesium.CallbackProperty(function(e){return r},!1),e.numberOfVerticalLines=0,this.cylinderEntity=viewer.entities.add({position:new Cesium.CallbackProperty(function(e){var t=Cesium.Property.getValueOrUndefined(a,e,new Cesium.Cartesian3),i=Cesium.Cartographic.fromCartesian(t),n=Cesium.Cartesian3.fromRadians(i.longitude,i.latitude,i.height/2);return o=i.height,r=.3*o,n},!1),cylinder:e})}},{key:"getTerrainHeight",value:function(c){var t=this,u=this.arrLinePoint,h=0,d=[],p=[],f=[],m=[],g=0;!function l(){var e=[u[++g-1],u[g]];gsp3d.util.terrainPolyline({viewer:t.viewer,positions:e,calback:function(e,t){for(var i=u[g-1].lonlat[2],n=(u[g].lonlat[2]-i)/e.length,r=0;r<e.length;r++){0!=r&&(h+=Cesium.Cartesian3.distance(e[r],e[r-1])),d.push(Number(h.toFixed(1)));var o=gsp3d.point.formatPositon(e[r]);m.push(o);var a=t?0:o.z;p.push(a);var s=Number((i+n*r).toFixed(1));f.push(s)}g>=u.length-1?c({arrLength:d,arrFxgd:f,arrHbgd:p,arrPoint:m}):l()}})}()}},{key:"toGeoJSON",value:function(){return this.options}},{key:"toCZML",value:function(){this.options;for(var e=this.startTime.toString(),t=this.stopTime.toString(),i=[],n=this.arrLinePoint,r=0,o=n.length;r<o;r++){var a=n[r];i.push(a.second),i=i.concat(a.lonlat)}var s={id:this.name,description:this.options.remark,availability:e+"/"+t,orientation:{velocityReference:"#position"},position:{epoch:e,cartographicDegrees:i,interpolationAlgorithm:"LAGRANGE",interpolationDegree:2}};return this.options.label.show&&(s.label={show:!0,outlineWidth:2,text:this.name,font:"12pt 微软雅黑 Console",outlineColor:{rgba:[0,0,0,255]},horizontalOrigin:"LEFT",fillColor:{rgba:[213,255,0,255]}}),this.options.path.show&&(s.path={show:!0,material:{solidColor:{color:{rgba:[255,0,0,255]}}},width:5,resolution:1,leadTime:0,trailTime:this.alltimes}),this.options.model.show&&(s.model=this.options.model),[{version:"1.0",id:"document",clock:{interval:e+"/"+t,currentTime:e,multiplier:1}},s]}},{key:"stop",value:function(){this.viewer.trackedEntity=void 0,this.viewer.scene.preRender.removeEventListener(this.preRender_eventHandler,this),this._isStart=!1}},{key:"destroy",value:function(){this.stop(),this.entity&&(this.viewer.entities.remove(this.entity),delete this.entity),this.wallEntity&&(this.viewer.entities.remove(this.wallEntity),delete this.wallEntity),this.cylinderEntity&&(this.viewer.entities.remove(this.cylinderEntity),delete this.cylinderEntity)}}]),h);function h(e,t){for(var i in!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),this.viewer=e,this.id=t.id||0,this.name=t.name||"",this.points=t.points,u){var n=u[i];if(t.hasOwnProperty(i)&&"object"===o(t[i]))for(var r in n)t[i].hasOwnProperty(r)||(t[i][r]=n[r]);else t[i]=n}this.options=t,this._isStart=!1,this._createLine(),this._createEntity()}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TilesEditor=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),s=(o=a)&&o.__esModule?o:{default:o};t.TilesEditor=(n(l,[{key:"update",value:function(e){for(var t in e)this[t]=e[t];this.movep.position=this.position,this.rotatep.position=this.rotationPos()}},{key:"modelMatrix",value:function(){var e=s.Transforms.eastNorthUpToFixedFrame(this.position),t=s.Matrix4.fromRotationTranslation(s.Matrix3.fromRotationZ(this.heading));if(s.Matrix4.multiply(e,t,e),0<this.scale&&1!=this.scale&&s.Matrix4.multiplyByUniformScale(e,this.scale,e),this.axis&&""!=this.axis){var i;switch(this.axis.toUpperCase()){case"Y_UP_TO_Z_UP":i=s.Axis.Y_UP_TO_Z_UP;break;case"Z_UP_TO_Y_UP":i=s.Axis.Z_UP_TO_Y_UP;break;case"X_UP_TO_Z_UP":i=s.Axis.X_UP_TO_Z_UP;break;case"Z_UP_TO_X_UP":i=s.Axis.Z_UP_TO_X_UP;break;case"X_UP_TO_Y_UP":i=s.Axis.X_UP_TO_Y_UP;break;case"Y_UP_TO_X_UP":i=s.Axis.Y_UP_TO_X_UP}i&&(e=s.Matrix4.multiplyTransformation(e,i,e))}return e}},{key:"rotationPos",value:function(){var e=new s.Cartesian3(this.range,0,0),t=s.Matrix4.getRotation(this.modelMatrix(),new s.Matrix3);return e=s.Matrix3.multiplyByVector(t,e,e),e=s.Cartesian3.add(this.position,e,e)}},{key:"pickTerrain",value:function(e){var t=this.viewer.camera.getPickRay(e);return this.viewer.scene.globe.pick(t,this.viewer.scene)}},{key:"setEnable",value:function(e){if(e){var t=this;this.handler.setInputAction(function(e){t.handler_onLeafDown(e)},s.ScreenSpaceEventType.LEFT_DOWN),this.handler.setInputAction(function(e){t.handler_onMouseMove(e)},s.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(e){t.handler_onLeftUp(e)},s.ScreenSpaceEventType.LEFT_UP),this.rotatep.show=!0,this.movep.show=!0}else this.handler.removeInputAction(s.ScreenSpaceEventType.LEFT_DOWN),this.handler.removeInputAction(s.ScreenSpaceEventType.MOUSE_MOVE),this.handler.removeInputAction(s.ScreenSpaceEventType.LEFT_UP),this.rotatep.show=!1,this.movep.show=!1;this._enable=!1}},{key:"handler_onLeafDown",value:function(e){for(var t=this.scene.drillPick(e.position,2),i=0;i<t.length;i++){var n=t[i];if(s.defined(n)&&n.primitive===this.movep){this.dragging=!0,this.scene.screenSpaceCameraController.enableRotate=!1;break}if(s.defined(n)&&n.primitive===this.rotatep){this.rotating=!0,this.scene.screenSpaceCameraController.enableRotate=!1;break}}}},{key:"handler_onMouseMove",value:function(e){var t=this.pickTerrain(e.endPosition);if(t)if(this.dragging)this.position=t,this.movep.position=this.position,this.rotatep.position=this.rotationPos(),this.options.onPosition&&this.options.onPosition(this.position);else if(this.rotating){this.rotatep.position=t,this.range=s.Cartesian3.distance(this.position,t);var i=s.Transforms.eastNorthUpToFixedFrame(this.position);i=s.Matrix4.getRotation(i,new s.Matrix3);var n=s.Matrix3.getColumn(i,0,new s.Cartesian3),r=s.Matrix3.getColumn(i,1,new s.Cartesian3),o=s.Matrix3.getColumn(i,2,new s.Cartesian3),a=s.Cartesian3.subtract(t,this.position,new s.Cartesian3);a=s.Cartesian3.cross(a,o,a),a=s.Cartesian3.cross(o,a,a),a=s.Cartesian3.normalize(a,a),this.heading=s.Cartesian3.angleBetween(n,a),s.Cartesian3.angleBetween(r,a)>.5*Math.PI&&(this.heading=2*Math.PI-this.heading),this.options.onHeading&&this.options.onHeading(this.heading)}}},{key:"handler_onLeftUp",value:function(){(this.dragging||this.rotating)&&(this.rotating=this.dragging=!1,this.scene.screenSpaceCameraController.enableRotate=!0,this.billboards._createVertexArray=!0)}},{key:"remove",value:function(){this.billboards&&(this.scene.primitives.remove(this.billboards),this.billboards=void 0),this.enable=!1}},{key:"destroy",value:function(){this.remove(),this.handler.destroy(),this.handler=null,this.viewer=null}}]),l);function l(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),this.viewer=e,this.scene=this.viewer.scene,this.options=t,this.position=t.position,this.heading=t.heading||0,this.range=t.range||100,this.dragging=!1,this.rotating=!1,this.enable=!1,this.billboards=this.viewer.scene.primitives.add(new s.BillboardCollection),this.handler=new s.ScreenSpaceEventHandler(this.viewer.canvas),this.movep=this.billboards.add({position:this.position,color:new s.Color.fromCssColorString("#FFFF00"),image:t.moveImg,show:!1,disableDepthTestDistance:Number.POSITIVE_INFINITY}),this.rotatep=this.billboards.add({position:this.position?this.rotationPos():null,color:new s.Color.fromCssColorString("#FFFF00"),image:t.rotateImg,show:!1,disableDepthTestDistance:Number.POSITIVE_INFINITY})}},function(e,t){e.exports="uniform sampler2D colorTexture;\r\nvarying vec2 v_textureCoordinates;\r\n\r\nfloat hash(float x){\r\n    return fract(sin(x*133.3)*13.13);\r\n}\r\n\r\nvoid main(void){ \r\n    float time = czm_frameNumber / 240.0;\r\n    vec2 resolution = czm_viewport.zw;\r\n\r\n    vec2 uv=(gl_FragCoord.xy*2.-resolution.xy)/min(resolution.x,resolution.y);\r\n    vec3 c=vec3(.6,.7,.8);\r\n\r\n    float a=-.4;\r\n    float si=sin(a),co=cos(a);\r\n    uv*=mat2(co,-si,si,co);\r\n    uv*=length(uv+vec2(0,4.9))*.3+1.;\r\n\r\n    float v=1.-sin(hash(floor(uv.x*100.))*2.);\r\n    float b=clamp(abs(sin(20.*time*v+uv.y*(5./(2.+v))))-.95,0.,1.)*20.;\r\n    c*=v*b; \r\n\r\n    gl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), vec4(c,1), 0.5);  \r\n}\r\n                        "},function(e,t){e.exports="uniform sampler2D colorTexture;\r\nvarying vec2 v_textureCoordinates;\r\n\r\nfloat snow(vec2 uv,float scale){\r\n    float time = czm_frameNumber / 60.0;\r\n    float w=smoothstep(1.,0.,-uv.y*(scale/10.));if(w<.1)return 0.;\r\n    uv+=time/scale;uv.y+=time*2./scale;uv.x+=sin(uv.y+time*.5)/scale;\r\n    uv*=scale;vec2 s=floor(uv),f=fract(uv),p;float k=3.,d;\r\n    p=.5+.35*sin(11.*fract(sin((s+p+scale)*mat2(7,3,6,5))*5.))-f;d=length(p);k=min(d,k);\r\n    k=smoothstep(0.,k,sin(f.x+f.y)*0.01);\r\n    return k*w;\r\n}\r\n\r\nvoid main(void){\r\n    vec2 resolution = czm_viewport.zw;\r\n    vec2 uv=(gl_FragCoord.xy*2.-resolution.xy)/min(resolution.x,resolution.y);\r\n    vec3 finalColor=vec3(0);\r\n    float c = 0.0;\r\n    // c+=snow(uv,30.)*.0;\r\n    // c+=snow(uv,20.)*.0;\r\n    // c+=snow(uv,15.)*.0;\r\n    c+=snow(uv,10.);\r\n    c+=snow(uv,8.);\r\n    c+=snow(uv,6.);\r\n    c+=snow(uv,5.);\r\n    finalColor=(vec3(c)); \r\n    gl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), vec4(finalColor,1), 0.5); \r\n\r\n}"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CircleFadeMaterial=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),s=(o=a)&&o.__esModule?o:{default:o};var l=new s.Color(0,0,0,0),c=t.CircleFadeMaterial=(n(u,[{key:"getType",value:function(){return s.Material.CircleFadeMaterialType}},{key:"getValue",value:function(e,t){return s.defined(t)||(t={}),t.color=s.Property.getValueOrClonedDefault(this._color,e,l,t.color),void 0===this._time&&(this._time=(new Date).getTime()),t.time=((new Date).getTime()-this._time)/this._duration,t}},{key:"equals",value:function(e){return this===e||e instanceof u&&s.Property.equals(this._color,e._color)}},{key:"isConstant",get:function(){return!1}},{key:"definitionChanged",get:function(){return this._definitionChanged}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),e=s.defaultValue(e,s.defaultValue.EMPTY_OBJECT),this._definitionChanged=new s.Event,this._color=void 0,this._colorSubscription=void 0,this.color=s.defaultValue(e.color,l),this._duration=e.duration||1e3,this._time=void 0}s.defineProperties(c.prototype,{color:s.createPropertyDescriptor("color")}),s.Material.CircleFadeMaterialType="CircleFadeMaterial",s.Material._materialCache.addMaterial(s.Material.CircleFadeMaterialType,{fabric:{type:s.Material.CircleFadeMaterialType,uniforms:{color:new s.Color(1,0,0,1),time:1},source:"czm_material czm_getMaterial(czm_materialInput materialInput)\n                {\n                    czm_material material = czm_getDefaultMaterial(materialInput);\n                    material.diffuse = 1.5 * color.rgb;\n                    vec2 st = materialInput.st;\n                    float dis = distance(st, vec2(0.5, 0.5));\n                    float per = fract(time);\n                    if(dis > per * 0.5){\n                        //material.alpha = 0.0;\n                        discard;\n                    }else {\n                            material.alpha = color.a  * dis / per / 2.0;\n                    }\n                    return material;\n                }"},translucent:function(){return!0}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GroundPolylineFlowMaterial=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=Cesium.defaultValue(t,Cesium.defaultValue.EMPTY_OBJECT);var i=Cesium.defaultValue(t.color,new Cesium.Color(1,0,0,1)),n=Cesium.defaultValue(t.image,"./img/textures/arrow.png"),r=Cesium.defaultValue(t.repeat,{x:10,y:1}),o=Cesium.defaultValue(t.axisY,!1),a=Cesium.defaultValue(t.speed,1);return new Cesium.Material({fabric:{uniforms:{color:i,image:n,repeat:r,axisY:o,speed:a},source:"czm_material czm_getMaterial(czm_materialInput materialInput) { \n                            czm_material material = czm_getDefaultMaterial(materialInput); \n                            vec2 st = repeat * materialInput.st;\n                            // vec4 color = texture2D(image, materialInput.st/repeat); \n                            vec4 colorImage = texture2D(image, vec2(fract((axisY?st.t:st.s) - czm_frameNumber*speed/100.0), st.t));\n                            if(color.a == 0.0)\n                                {\n                                    material.alpha = colorImage.a;\n                                    material.diffuse = colorImage.rgb; \n                                }\n                                else\n                                {\n                                    material.alpha = colorImage.a * color.a;\n                                    material.diffuse = max(color.rgb * material.alpha * 3.0, color.rgb); \n                                }\n                            return material; \n                        }"}})}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CoolPlaneMaterial=void 0;var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n};t.CoolPlaneMaterial=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=o.defaultValue(t,o.defaultValue.EMPTY_OBJECT);var i=o.defaultValue(t.image,"./img/cool.png"),n=o.defaultValue(t.alpha,.5);return new o.Material({fabric:{uniforms:{image:i,alpha:n,hm_dh_attr:new o.Cartesian3(50,1,100)},source:"czm_material czm_getMaterial(czm_materialInput materialInput) { \n                        czm_material material = czm_getDefaultMaterial(materialInput); \n                        vec2 st = materialInput.st;\n                        float r = sqrt((st.x-0.8)*(st.x-0.8) + (st.y-0.8)*(st.y-0.8));\n                        float r2 = sqrt((st.x-0.2)*(st.x-0.2) + (st.y-0.2)*(st.y-0.2));\n                        float z = cos(hm_dh_attr.x*r + czm_frameNumber/100.0*hm_dh_attr.y)/hm_dh_attr.z;\n                        float z2 = cos(hm_dh_attr.x*r2 + czm_frameNumber/100.0*hm_dh_attr.y)/hm_dh_attr.z;\n                        st += sqrt(z*z+z2*z2);\n                        vec4 colorImage = texture2D(image, st);\n                        material.alpha = colorImage.a+0.2;\n                        material.diffuse = colorImage.rgb; \n                        return material; \n                    }"}})}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextMaterial=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),s=(o=a)&&o.__esModule?o:{default:o};var l=new s.Color(0,0,0,0),c={font:"50px 楷体",fill:!0,fillColor:new s.Color(1,1,0,1),stroke:!0,strokeWidth:2,strokeColor:new s.Color(1,1,1,.8),backgroundColor:new s.Color(1,1,1,.1),textBaseline:"top",padding:40},u=new s.Cartesian2(1,1),h=t.TextMaterial=(n(d,[{key:"getType",value:function(){return this._materialType}},{key:"getValue",value:function(e,t){return s.defined(t)||(t={}),t.color=s.Property.getValueOrClonedDefault(this._color,e,l,t.color),t.image=this._materialImage,t.repeat=this.repeat,t}},{key:"equals",value:function(e){return this===e||e instanceof d&&s.Property.equals(this._color,e._color)}},{key:"_text2Img",value:function(e,t){var i=s.writeTextToCanvas(e,t);if(i){this.canvas=i;var n=new Image;return n.src=i.toDataURL("image/png"),n}}},{key:"isConstant",get:function(){return!1}},{key:"definitionChanged",get:function(){return this._definitionChanged}},{key:"text",get:function(){return this._text},set:function(e){if(e){this._text=e,delete this._img,this._img=this._text2Img(this._text,this._textStyles);var t=m(this._img.src,this.repeat);this._materialType=s.clone(t.type),this._materialImage=s.clone(t.image)}}},{key:"textStyles",get:function(){return this._textStyles},set:function(e){if(e){delete this._img,this._textStyles=e,this._img=this._text2Img(this._text,this._textStyles);var t=m(this._img.src,this.repeat);this._materialType=s.clone(t.type),this._materialImage=s.clone(t.image)}}}]),d);function d(e){if(!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),(e=s.defaultValue(e,s.defaultValue.EMPTY_OBJECT)).text){this._text=e.text,this._textStyles=s.defaultValue(e.textStyles,c),this._definitionChanged=new s.Event,this._color=void 0,this._colorSubscription=void 0,this.color=s.defaultValue(e.color,l),this.repeat=s.defaultValue(e.repeat,u),this._img=this._text2Img(this._text,this._textStyles);var t=m(this._img.src,this.repeat);this._materialType=s.clone(t.type),this._materialImage=s.clone(t.image)}}s.defineProperties(h.prototype,{color:s.createPropertyDescriptor("color")});var p=0,f="Text";function m(e,t){var i=f+ ++p+"Type",n=f+p+"Image";return s.Material[i]=i,s.Material[n]=e,s.Material._materialCache.addMaterial(s.Material[i],{fabric:{type:s.Material.PolylineArrowLinkType,uniforms:{color:new s.Color(1,0,0,1),image:s.Material[n],time:0,repeat:t||new s.Cartesian2(1,1)},source:"czm_material czm_getMaterial(czm_materialInput materialInput)\n                        {\n                            czm_material material = czm_getDefaultMaterial(materialInput);\n                            vec2 mst = fract(materialInput.st + vec2(.0,.0));\n                            mst = vec2(mst.x,mst.y);\n                            vec2 st = fract(repeat * mst);\n                            vec4 colorImage = texture2D(image, st);\n                            if(color.a == 0.0)\n                            {\n                                material.alpha = colorImage.a;\n                                material.diffuse = colorImage.rgb; \n                            }\n                            else\n                            {\n                                material.alpha = colorImage.a * color.a;\n                                material.diffuse = max(color.rgb * material.alpha * 3.0, color.rgb); \n                            }\n                            return material;\n                        }"},translucent:function(){return!0}}),{type:s.Material[i],image:s.Material[n]}}},function(e,t){e.exports="attribute vec4 position;\r\nattribute vec3 normal;\r\n\r\nvarying vec3 v_position;\r\nvarying vec3 v_positionWC;\r\nvarying vec3 v_positionEC;\r\nvarying vec3 v_normalEC;\r\n\r\nvoid main()\r\n{\r\n    gl_Position = czm_modelViewProjection * position;\r\n    v_position = vec3(position);\r\n    v_positionWC = (czm_model * position).xyz;\r\n    v_positionEC = (czm_modelView * position).xyz;\r\n    v_normalEC = czm_normal * normal;\r\n}"},function(e,t){e.exports='#ifdef GL_OES_standard_derivatives\r\n    #extension GL_OES_standard_derivatives : enable\r\n#endif\r\n\r\nuniform bool u_showIntersection;\r\nuniform bool u_showThroughEllipsoid;\r\n\r\nuniform float u_radius;\r\nuniform float u_xHalfAngle;\r\nuniform float u_yHalfAngle;\r\nuniform float u_normalDirection;\r\nuniform float u_type;\r\n\r\nvarying vec3 v_position;\r\nvarying vec3 v_positionWC;\r\nvarying vec3 v_positionEC;\r\nvarying vec3 v_normalEC;\r\n\r\nvec4 getColor(float sensorRadius, vec3 pointEC)\r\n{\r\n    czm_materialInput materialInput;\r\n\r\n    vec3 pointMC = (czm_inverseModelView * vec4(pointEC, 1.0)).xyz;\r\n    materialInput.st = sensor2dTextureCoordinates(sensorRadius, pointMC);\r\n    materialInput.str = pointMC / sensorRadius;\r\n\r\n    vec3 positionToEyeEC = -v_positionEC;\r\n    materialInput.positionToEyeEC = positionToEyeEC;\r\n\r\n    vec3 normalEC = normalize(v_normalEC);\r\n    materialInput.normalEC = u_normalDirection * normalEC;\r\n\r\n    czm_material material = czm_getMaterial(materialInput);\r\n\r\n    return mix(czm_phong(normalize(positionToEyeEC), material), vec4(material.diffuse, material.alpha), 0.4);\r\n\r\n}\r\n\r\nbool isOnBoundary(float value, float epsilon)\r\n{\r\n    float width = getIntersectionWidth();\r\n    float tolerance = width * epsilon;\r\n\r\n#ifdef GL_OES_standard_derivatives\r\n    float delta = max(abs(dFdx(value)), abs(dFdy(value)));\r\n    float pixels = width * delta;\r\n    float temp = abs(value);\r\n    // There are a couple things going on here.\r\n    // First we test the value at the current fragment to see if it is within the tolerance.\r\n    // We also want to check if the value of an adjacent pixel is within the tolerance,\r\n    // but we don\'t want to admit points that are obviously not on the surface.\r\n    // For example, if we are looking for "value" to be close to 0, but value is 1 and the adjacent value is 2,\r\n    // then the delta would be 1 and "temp - delta" would be "1 - 1" which is zero even though neither of\r\n    // the points is close to zero.\r\n    return temp < tolerance && temp < pixels || (delta < 10.0 * tolerance && temp - delta < tolerance && temp < pixels);\r\n#else\r\n    return abs(value) < tolerance;\r\n#endif\r\n}\r\n\r\nvec4 shade(bool isOnBoundary)\r\n{\r\n    if (u_showIntersection && isOnBoundary)\r\n    {\r\n        return getIntersectionColor();\r\n    }\r\n    if(u_type == 1.0){\r\n        return getLineColor();\r\n    }\r\n    return getColor(u_radius, v_positionEC);\r\n}\r\n\r\nfloat ellipsoidSurfaceFunction(czm_ellipsoid ellipsoid, vec3 point)\r\n{\r\n    vec3 scaled = ellipsoid.inverseRadii * point;\r\n    return dot(scaled, scaled) - 1.0;\r\n}\r\n\r\nvoid main()\r\n{\r\n    vec3 sensorVertexWC = czm_model[3].xyz;      // (0.0, 0.0, 0.0) in model coordinates\r\n    vec3 sensorVertexEC = czm_modelView[3].xyz;  // (0.0, 0.0, 0.0) in model coordinates\r\n\r\n    //vec3 pixDir = normalize(v_position);\r\n    float positionX = v_position.x;\r\n    float positionY = v_position.y;\r\n    float positionZ = v_position.z;\r\n\r\n    vec3 zDir = vec3(0.0, 0.0, 1.0);\r\n    vec3 lineX = vec3(positionX, 0 ,positionZ);\r\n    vec3 lineY = vec3(0, positionY, positionZ);\r\n    float resX = dot(normalize(lineX), zDir);\r\n    if(resX < cos(u_xHalfAngle)-0.00001){\r\n        discard;\r\n    }\r\n    float resY = dot(normalize(lineY), zDir);\r\n    if(resY < cos(u_yHalfAngle)-0.00001){\r\n        discard;\r\n    }\r\n\r\n\r\n    czm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\r\n    float ellipsoidValue = ellipsoidSurfaceFunction(ellipsoid, v_positionWC);\r\n\r\n    // Occluded by the ellipsoid?\r\n\tif (!u_showThroughEllipsoid)\r\n\t{\r\n\t    // Discard if in the ellipsoid\r\n\t    // PERFORMANCE_IDEA: A coarse check for ellipsoid intersection could be done on the CPU first.\r\n\t    if (ellipsoidValue < 0.0)\r\n\t    {\r\n            discard;\r\n\t    }\r\n\r\n\t    // Discard if in the sensor\'s shadow\r\n\t    if (inSensorShadow(sensorVertexWC, ellipsoid, v_positionWC))\r\n\t    {\r\n\t        discard;\r\n\t    }\r\n    }\r\n\r\n    // Notes: Each surface functions should have an associated tolerance based on the floating point error.\r\n    bool isOnEllipsoid = isOnBoundary(ellipsoidValue, czm_epsilon3);\r\n    //isOnEllipsoid = false;\r\n    //if((resX >= 0.8 && resX <= 0.81)||(resY >= 0.8 && resY <= 0.81)){\r\n    /*if(false){\r\n        gl_FragColor = vec4(1.0,0.0,0.0,1.0);\r\n    }else{\r\n        gl_FragColor = shade(isOnEllipsoid);\r\n    }\r\n*/\r\n    gl_FragColor = shade(isOnEllipsoid);\r\n\r\n}'},function(e,t){e.exports="uniform vec4 u_intersectionColor;\nuniform float u_intersectionWidth;\nuniform vec4 u_lineColor;\n\nbool inSensorShadow(vec3 coneVertexWC, czm_ellipsoid ellipsoidEC, vec3 pointWC)\n{\n    // Diagonal matrix from the unscaled ellipsoid space to the scaled space.    \n    vec3 D = ellipsoidEC.inverseRadii;\n\n    // Sensor vertex in the scaled ellipsoid space\n    vec3 q = D * coneVertexWC;\n    float qMagnitudeSquared = dot(q, q);\n    float test = qMagnitudeSquared - 1.0;\n    \n    // Sensor vertex to fragment vector in the ellipsoid's scaled space\n    vec3 temp = D * pointWC - q;\n    float d = dot(temp, q);\n    \n    // Behind silhouette plane and inside silhouette cone\n    return (d < -test) && (d / length(temp) < -sqrt(test));\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\nvec4 getLineColor()\n{\n    return u_lineColor;\n}\n\nvec4 getIntersectionColor()\n{\n    return u_intersectionColor;\n}\n\nfloat getIntersectionWidth()\n{\n    return u_intersectionWidth;\n}\n\nvec2 sensor2dTextureCoordinates(float sensorRadius, vec3 pointMC)\n{\n    // (s, t) both in the range [0, 1]\n    float t = pointMC.z / sensorRadius;\n    float s = 1.0 + (atan(pointMC.y, pointMC.x) / czm_twoPi);\n    s = s - floor(s);\n    \n    return vec2(s, t);\n}\n"},function(e,t){e.exports='#ifdef GL_OES_standard_derivatives\r\n    #extension GL_OES_standard_derivatives : enable\r\n#endif\r\n\r\nuniform bool u_showIntersection;\r\nuniform bool u_showThroughEllipsoid;\r\n\r\nuniform float u_radius;\r\nuniform float u_xHalfAngle;\r\nuniform float u_yHalfAngle;\r\nuniform float u_normalDirection;\r\nuniform vec4 u_color;\r\n\r\nvarying vec3 v_position;\r\nvarying vec3 v_positionWC;\r\nvarying vec3 v_positionEC;\r\nvarying vec3 v_normalEC;\r\n\r\nvec4 getColor(float sensorRadius, vec3 pointEC)\r\n{\r\n    czm_materialInput materialInput;\r\n\r\n    vec3 pointMC = (czm_inverseModelView * vec4(pointEC, 1.0)).xyz;\r\n    materialInput.st = sensor2dTextureCoordinates(sensorRadius, pointMC);\r\n    materialInput.str = pointMC / sensorRadius;\r\n\r\n    vec3 positionToEyeEC = -v_positionEC;\r\n    materialInput.positionToEyeEC = positionToEyeEC;\r\n\r\n    vec3 normalEC = normalize(v_normalEC);\r\n    materialInput.normalEC = u_normalDirection * normalEC;\r\n\r\n    czm_material material = czm_getMaterial(materialInput);\r\n\r\n    material.diffuse = u_color.rgb;\r\n    material.alpha = u_color.a;\r\n\r\n    return mix(czm_phong(normalize(positionToEyeEC), material), vec4(material.diffuse, material.alpha), 0.4);\r\n\r\n}\r\n\r\nbool isOnBoundary(float value, float epsilon)\r\n{\r\n    float width = getIntersectionWidth();\r\n    float tolerance = width * epsilon;\r\n\r\n#ifdef GL_OES_standard_derivatives\r\n    float delta = max(abs(dFdx(value)), abs(dFdy(value)));\r\n    float pixels = width * delta;\r\n    float temp = abs(value);\r\n    // There are a couple things going on here.\r\n    // First we test the value at the current fragment to see if it is within the tolerance.\r\n    // We also want to check if the value of an adjacent pixel is within the tolerance,\r\n    // but we don\'t want to admit points that are obviously not on the surface.\r\n    // For example, if we are looking for "value" to be close to 0, but value is 1 and the adjacent value is 2,\r\n    // then the delta would be 1 and "temp - delta" would be "1 - 1" which is zero even though neither of\r\n    // the points is close to zero.\r\n    return temp < tolerance && temp < pixels || (delta < 10.0 * tolerance && temp - delta < tolerance && temp < pixels);\r\n#else\r\n    return abs(value) < tolerance;\r\n#endif\r\n}\r\n\r\nvec4 shade(bool isOnBoundary)\r\n{\r\n    if (u_showIntersection && isOnBoundary)\r\n    {\r\n        return getIntersectionColor();\r\n    }\r\n    return getColor(u_radius, v_positionEC);\r\n}\r\n\r\nfloat ellipsoidSurfaceFunction(czm_ellipsoid ellipsoid, vec3 point)\r\n{\r\n    vec3 scaled = ellipsoid.inverseRadii * point;\r\n    return dot(scaled, scaled) - 1.0;\r\n}\r\n\r\nvoid main()\r\n{\r\n    vec3 sensorVertexWC = czm_model[3].xyz;      // (0.0, 0.0, 0.0) in model coordinates\r\n    vec3 sensorVertexEC = czm_modelView[3].xyz;  // (0.0, 0.0, 0.0) in model coordinates\r\n\r\n    //vec3 pixDir = normalize(v_position);\r\n    float positionX = v_position.x;\r\n    float positionY = v_position.y;\r\n    float positionZ = v_position.z;\r\n\r\n    vec3 zDir = vec3(0.0, 0.0, 1.0);\r\n    vec3 lineX = vec3(positionX, 0 ,positionZ);\r\n    vec3 lineY = vec3(0, positionY, positionZ);\r\n    float resX = dot(normalize(lineX), zDir);\r\n    if(resX < cos(u_xHalfAngle) - 0.0001){\r\n        discard;\r\n    }\r\n    float resY = dot(normalize(lineY), zDir);\r\n    if(resY < cos(u_yHalfAngle)- 0.0001){\r\n        discard;\r\n    }\r\n\r\n\r\n    czm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\r\n    float ellipsoidValue = ellipsoidSurfaceFunction(ellipsoid, v_positionWC);\r\n\r\n    // Occluded by the ellipsoid?\r\n\tif (!u_showThroughEllipsoid)\r\n\t{\r\n\t    // Discard if in the ellipsoid\r\n\t    // PERFORMANCE_IDEA: A coarse check for ellipsoid intersection could be done on the CPU first.\r\n\t    if (ellipsoidValue < 0.0)\r\n\t    {\r\n            discard;\r\n\t    }\r\n\r\n\t    // Discard if in the sensor\'s shadow\r\n\t    if (inSensorShadow(sensorVertexWC, ellipsoid, v_positionWC))\r\n\t    {\r\n\t        discard;\r\n\t    }\r\n    }\r\n\r\n    // Notes: Each surface functions should have an associated tolerance based on the floating point error.\r\n    bool isOnEllipsoid = isOnBoundary(ellipsoidValue, czm_epsilon3);\r\n    gl_FragColor = shade(isOnEllipsoid);\r\n\r\n}'},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RectangularSensorVisualizer=void 0;var n,r=i(0),b=(n=r)&&n.__esModule?n:{default:n},C=i(44),c=i(112);function o(e,t){if(!E(e))throw new M("scene is required.");if(!E(t))throw new M("entityCollection is required.");t.collectionChanged.addEventListener(o.prototype._onCollectionChanged,this),this._scene=e,this._primitives=e.primitives,this._entityCollection=t,this._hash={},this._entitiesToVisualize=new a,this._onCollectionChanged(t,t.values,[],[])}var a=b.AssociativeArray,x=b.Cartesian3,P=b.Color,E=b.defined,s=b.destroyObject,M=b.DeveloperError,S=b.Matrix3,T=b.Matrix4,D=b.Quaternion,O=b.MaterialProperty,A=b.Property,k=new S,L=new x,R=new x,F=new D,I=new x,N=new D;o.prototype.update=function(e){if(!E(e))throw new M("time is required.");for(var t=this._entitiesToVisualize.values,i=this._hash,n=this._primitives,r=0,o=t.length;r<o;r++){var a,s,l,c,u=t[r],h=u._rectangularSensor,d=i[u.id],p=u.isShowing&&u.isAvailable(e)&&A.getValueOrDefault(h._show,e,!0);if(p&&(a=A.getValueOrUndefined(u._position,e,L),w=A.getValueOrUndefined(u._orientation,e,F),s=A.getValueOrUndefined(h._radius,e),l=A.getValueOrUndefined(h._xHalfAngle,e),c=A.getValueOrUndefined(h._yHalfAngle,e),p=E(a)&&E(l)&&E(c)),p){var f=E(d)?d.primitive:void 0;E(f)||((f=new C.RectangularSensorPrimitive).id=u,n.add(f),d={primitive:f,position:void 0,orientation:void 0},i[u.id]=d);var m=A.getValueOrUndefined(h._gaze,e);if(E(m)){var g=A.getValueOrUndefined(m._position,e,R);if(!E(a)||!E(g))continue;var v=x.subtract(a,g,I),y=x.angleBetween(b.Cartesian3.UNIT_Z,v),_=x.cross(b.Cartesian3.UNIT_Z,v,I),w=D.fromAxisAngle(_,y-Math.PI,N);s=x.distance(a,g),f.modelMatrix=T.fromRotationTranslation(S.fromQuaternion(w,k),a,f.modelMatrix)}else x.equals(a,d.position)&&D.equals(w,d.orientation)||(E(w)?(f.modelMatrix=T.fromRotationTranslation(S.fromQuaternion(w,k),a,f.modelMatrix),d.position=x.clone(a,d.position),d.orientation=D.clone(w,d.orientation)):(f.modelMatrix=b.Transforms.eastNorthUpToFixedFrame(a),d.position=x.clone(a,d.position)));f.show=!0,f.gaze=m,f.radius=s,f.xHalfAngle=l,f.yHalfAngle=c,f.lineColor=A.getValueOrDefault(h._lineColor,e,P.WHITE),f.showSectorLines=A.getValueOrDefault(h._showSectorLines,e,!0),f.showSectorSegmentLines=A.getValueOrDefault(h._showSectorSegmentLines,e,!0),f.showLateralSurfaces=A.getValueOrDefault(h._showLateralSurfaces,e,!0),f.material=O.getValue(e,h._material,f.material),f.showDomeSurfaces=A.getValueOrDefault(h._showDomeSurfaces,e,!0),f.showDomeLines=A.getValueOrDefault(h._showDomeLines,e,!0),f.showIntersection=A.getValueOrDefault(h._showIntersection,e,!0),f.intersectionColor=A.getValueOrDefault(h._intersectionColor,e,P.WHITE),f.intersectionWidth=A.getValueOrDefault(h._intersectionWidth,e,1),f.showThroughEllipsoid=A.getValueOrDefault(h._showThroughEllipsoid,e,!0),f.scanPlaneMode=A.getValueOrDefault(h._scanPlaneMode,e),f.scanPlaneColor=A.getValueOrDefault(h._scanPlaneColor,e,P.WHITE),f.showScanPlane=A.getValueOrDefault(h._showScanPlane,e,!0),f.scanPlaneRate=A.getValueOrDefault(h._scanPlaneRate,e,1)}else E(d)&&(d.primitive.show=!1)}return!0},o.prototype.isDestroyed=function(){return!1},o.prototype.destroy=function(){for(var e=this._entitiesToVisualize.values,t=this._hash,i=this._primitives,n=e.length-1;-1<n;n--)(0,c.removePrimitive)(e[n],t,i);return s(this)},o.prototype._onCollectionChanged=function(e,t,i,n){var r,o,a=this._entitiesToVisualize,s=this._hash,l=this._primitives;for(r=t.length-1;-1<r;r--)o=t[r],E(o._rectangularSensor)&&E(o._position)&&a.set(o.id,o);for(r=n.length-1;-1<r;r--)o=n[r],E(o._rectangularSensor)&&E(o._position)?a.set(o.id,o):((0,c.removePrimitive)(o,s,l),a.remove(o.id));for(r=i.length-1;-1<r;r--)o=i[r],(0,c.removePrimitive)(o,s,l),a.remove(o.id)},t.RectangularSensorVisualizer=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removePrimitive=function(e,t,i){var n=t[e.id];if(o.defined(n)){var r=n.primitive;try{i.remove(r)}catch(e){}r.isDestroyed&&!r.isDestroyed()&&r.destroy(),delete t[e.id]}};var n,r=i(0),o=(n=r)&&n.__esModule?n:{default:n}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TerrainClipPlan=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),g=(o=a)&&o.__esModule?o:{default:o};t.TerrainClipPlan=(n(s,[{key:"updateData",value:function(e){this.clear();var t=[],i=e.length,n=new g.Cartesian3,r=g.Cartesian3.subtract(e[0],e[1],n);r=0<r.x,this.excavateMinHeight=9999;for(var o=0;o<i;++o){var a=(o+1)%i,s=g.Cartesian3.midpoint(e[o],e[a],new g.Cartesian3),l=g.Cartographic.fromCartesian(e[o]),c=viewer.scene.globe.getHeight(l)||l.height;c<this.excavateMinHeight&&(this.excavateMinHeight=c);var u,h=g.Cartesian3.normalize(s,new g.Cartesian3);u=r?g.Cartesian3.subtract(e[o],s,new g.Cartesian3):g.Cartesian3.subtract(e[a],s,new g.Cartesian3),u=g.Cartesian3.normalize(u,u);var d=g.Cartesian3.cross(u,h,new g.Cartesian3);d=g.Cartesian3.normalize(d,d);var p=new g.Plane(d,0),f=g.Plane.getPointDistance(p,s);t.push(new g.ClippingPlane(d,f))}this.viewer.scene.globe.clippingPlanes=new g.ClippingPlaneCollection({planes:t,edgeWidth:1,edgeColor:g.Color.WHITE,enabled:!0}),this._prepareWell(e),this._createWell(this.wellData)}},{key:"clear",value:function(){this.viewer.scene.globe.clippingPlanes&&(this.viewer.scene.globe.clippingPlanes.enabled=!1,this.viewer.scene.globe.clippingPlanes.removeAll(),this.viewer.scene.globe.clippingPlanes.isDestroyed()||this.viewer.scene.globe.clippingPlanes.destroy()),this.viewer.scene.globe.clippingPlanes=void 0,this.bottomSurface&&this.viewer.scene.primitives.remove(this.bottomSurface),this.wellWall&&this.viewer.scene.primitives.remove(this.wellWall),delete this.bottomSurface,delete this.wellWall,delete this.wellData,this.viewer.scene.render()}},{key:"_prepareWell",value:function(e){var t=this.splitNum,i=e.length;if(0!=i){for(var n=this.excavateMinHeight-this.height,r=[],o=[],a=[],s=0;s<i;s++){var l=s==i-1?0:s+1,c=g.Cartographic.fromCartesian(e[s]),u=g.Cartographic.fromCartesian(e[l]),h=[c.longitude,c.latitude],d=[u.longitude,u.latitude];0==s&&(a.push(new g.Cartographic(h[0],h[1])),o.push(g.Cartesian3.fromRadians(h[0],h[1],n)),r.push(g.Cartesian3.fromRadians(h[0],h[1],0)));for(var p=1;p<=t;p++){var f=g.Math.lerp(h[0],d[0],p/t),m=g.Math.lerp(h[1],d[1],p/t);s==i-1&&p==t||(a.push(new g.Cartographic(f,m)),o.push(g.Cartesian3.fromRadians(f,m,n)),r.push(g.Cartesian3.fromRadians(f,m,0)))}}this.wellData={lerp_pos:a,bottom_pos:o,no_height_top:r}}}},{key:"_createWell",value:function(o){if(Boolean(this.viewer.terrainProvider._layers)){var a=this;this._createBottomSurface(o.bottom_pos);var e=g.sampleTerrainMostDetailed(viewer.terrainProvider,o.lerp_pos);g.when(e,function(e){for(var t=e.length,i=[],n=0;n<t;n++){var r=g.Cartesian3.fromRadians(e[n].longitude,e[n].latitude,e[n].height);i.push(r)}a._createWellWall(o.bottom_pos,i)})}else this._createBottomSurface(o.bottom_pos),this._createWellWall(o.bottom_pos,o.no_height_top)}},{key:"_createWellWall",value:function(e,t){var i=new g.WellNoBottom({minimumArr:e,maximumArr:t});i=g.WellNoBottom.createGeometry(i);var n=new g.Material({fabric:{type:"Image",uniforms:{image:this.wallImg}}}),r=new g.MaterialAppearance({translucent:!1,flat:!0,material:n});this.wellWall=new g.Primitive({geometryInstances:new g.GeometryInstance({geometry:i,attributes:{color:g.ColorGeometryInstanceAttribute.fromColor(g.Color.GREY)},id:"PitWall"}),appearance:r,asynchronous:!1}),this.viewer.scene.primitives.add(this.wellWall)}},{key:"_createBottomSurface",value:function(e){if(e.length){var t=new g.CustomPlaneGeometry({pos_arr:e});t=g.CustomPlaneGeometry.createGeometry(t);var i=new g.Material({fabric:{type:"Image",uniforms:{image:this.bottomImg}}}),n=new g.MaterialAppearance({translucent:!1,flat:!0,material:i});this.bottomSurface=new g.Primitive({geometryInstances:new g.GeometryInstance({geometry:t}),appearance:n,asynchronous:!1}),this.viewer.scene.primitives.add(this.bottomSurface)}}},{key:"_switchExcavate",value:function(e){e?(this.viewer.scene.globe.material=g.Material.fromType("WaJue"),this.wellWall&&(this.wellWall.show=!0),this.bottomSurface&&(this.bottomSurface.show=!0)):(this.viewer.scene.globe.material=null,this.wellWall&&(this.wellWall.show=!1),this.bottomSurface&&(this.bottomSurface.show=!1))}},{key:"_updateExcavateDepth",value:function(e){if(this.wellData){this.bottomSurface&&this.viewer.scene.primitives.remove(this.bottomSurface),this.wellWall&&this.viewer.scene.primitives.remove(this.wellWall);for(var t=this.wellData.lerp_pos,i=[],n=t.length,r=0;r<n;r++)i.push(g.Cartesian3.fromRadians(t[r].longitude,t[r].latitude,this.excavateMinHeight-e));this.wellData.bottom_pos=i,this._createWell(this.wellData),this.viewer.scene.primitives.add(this.bottomSurface),this.viewer.scene.primitives.add(this.wellWall)}}},{key:"show",get:function(){return this._show},set:function(e){this._show=e,this.viewer.scene.globe.clippingPlanes&&(this.viewer.scene.globe.clippingPlanes.enabled=e),this._switchExcavate(e)}},{key:"height",get:function(){return this._height},set:function(e){this._height=e,this._updateExcavateDepth(e)}}]),s);function s(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.viewer=e,this.options=t||{},this._positions=t.positions,this._height=this.options.height||0,this.bottomImg=t.bottomImg,this.wallImg=t.wallImg,this.splitNum=g.defaultValue(t.splitNum,50),this._positions&&0<this._positions.length&&this.updateData(this._positions)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TilesetClipPlan=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),s=(o=a)&&o.__esModule?o:{default:o};function l(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),this.tileset=e,this.options=t||{},this.options.type&&(this.type=this.options.type),this.options.distance&&(this.distance=this.options.distance)}(t.TilesetClipPlan=(n(l,[{key:"createPlane",value:function(e){var t;switch(this.clear(),e){case l.Type.Z:t=[new s.ClippingPlane(new s.Cartesian3(0,0,1),1)];break;default:case l.Type.ZR:t=[new s.ClippingPlane(new s.Cartesian3(0,0,-1),1)];break;case l.Type.X:t=[new s.ClippingPlane(new s.Cartesian3(1,0,0),1)];break;case l.Type.XR:t=[new s.ClippingPlane(new s.Cartesian3(-1,0,0),1)];break;case l.Type.Y:t=[new s.ClippingPlane(new s.Cartesian3(0,1,0),1)];break;case l.Type.YR:t=[new s.ClippingPlane(new s.Cartesian3(0,-1,0),1)]}var i=new s.ClippingPlaneCollection({planes:t,edgeWidth:this.options.edgeWidth||0});this.clippingPlanes=i,this.tileset.clippingPlanes=i}},{key:"updateDistance",value:function(e){if(null!=this.clippingPlanes)for(var t=0;t<this.clippingPlanes.length;t++)this.clippingPlanes.get(t).distance=e}},{key:"clear",value:function(){this.tileset.clippingPlanes&&(this.tileset.clippingPlanes.enabled=!1),this.clippingPlanes&&(this.clippingPlanes.destroy(),delete this.clippingPlanes)}},{key:"planes",get:function(){return this.clippingPlanes}},{key:"type",get:function(){return this._type},set:function(e){this._type=e,this.createPlane(e)}},{key:"distance",get:function(){return this._distance||0},set:function(e){this._distance=e,this.updateDistance(e)}}]),l)).Type={Z:1,ZR:2,X:3,XR:4,Y:5,YR:6}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FloodByEntity=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),s=(o=a)&&o.__esModule?o:{default:o},l=i(1),c=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(11));t.FloodByEntity=(n(u,[{key:"start",value:function(e,t){this.stop(),this.entity=e,this.options=t;var i=this;this._last_depthTestAgainstTerrain=this.viewer.scene.globe.depthTestAgainstTerrain,this.viewer.scene.globe.depthTestAgainstTerrain=!0,this.extrudedHeight=t.height,this.entity.polygon.extrudedHeight=new s.CallbackProperty(function(e){return i.extrudedHeight},!1);var n=c.getPositions(this.entity);n=(0,l.setPositionsHeight)(n,t.height),this.entity.polygon.hierarchy=new s.PolygonHierarchy(n),this.timeIdx=setInterval(function(){if(i.extrudedHeight>i.options.maxHeight)return t.onStop&&t.onStop(),void i.stop();i.extrudedHeight+=i.options.speed/10,t.onChange&&t.onChange(i.extrudedHeight)},100)}},{key:"stop",value:function(){clearInterval(this.timeIdx)}},{key:"clear",value:function(){this.stop(),null!==this._last_depthTestAgainstTerrain&&(this.viewer.scene.globe.depthTestAgainstTerrain=this._last_depthTestAgainstTerrain),this.entity=null}},{key:"updateHeight",value:function(e){this.extrudedHeight=e}},{key:"height",get:function(){return this.extrudedHeight},set:function(e){this.extrudedHeight=e}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),this.viewer=e}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addDefine=function(e,t){if(!e)return;var i=e.scene.globe,n=[],r=a.defined(i._material)&&(i._material.shaderSource.match(/slope/)||i._material.shaderSource.match("normalEC")),o=[s.default];!a.defined(i._material)||r&&!i._terrainProvider.requestVertexNormals?i._surface._tileProvider.uniformMap=void 0:(o.push(i._material.shaderSource),i._surface._tileProvider.uniformMap=i._material._uniforms);n.push(t),o.push(c.default),i._surfaceShaderSet.baseVertexShaderSource=new a.ShaderSource({sources:[s.default,l.default],defines:n}),i._surfaceShaderSet.baseFragmentShaderSource=new a.ShaderSource({sources:o,defines:n}),i._surfaceShaderSet.material=i._material};var a=n(i(0)),s=n(i(117)),l=n(i(118)),c=n(i(119));function n(e){return e&&e.__esModule?e:{default:e}}},function(e,t){e.exports="/*!\r\n * Atmosphere code:\r\n *\r\n * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions\r\n * are met:\r\n *\r\n * * Redistributions of source code must retain the above copyright notice,\r\n *   this list of conditions and the following disclaimer.\r\n * * Redistributions in binary form must reproduce the above copyright notice,\r\n *   this list of conditions and the following disclaimer in the documentation\r\n *   and/or other materials provided with the distribution.\r\n * * Neither the name of the project nor the names of its contributors may be\r\n *   used to endorse or promote products derived from this software without\r\n *   specific prior written permission.\r\n *\r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\r\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\r\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\r\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\r\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\r\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\r\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\r\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\r\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *\r\n * Modifications made by Analytical Graphics, Inc.\r\n */\r\n\r\n // Atmosphere:\r\n //   Code:  http://sponeil.net/\r\n //   GPU Gems 2 Article:  http://http.developer.nvidia.com/GPUGems2/gpugems2_chapter16.html\r\n\r\nconst float fInnerRadius = 6378137.0;\r\nconst float fOuterRadius = 6378137.0 * 1.025;\r\nconst float fOuterRadius2 = fOuterRadius * fOuterRadius;\r\n\r\nconst float Kr = 0.0025;\r\nconst float Km = 0.0015;\r\nconst float ESun = 15.0;\r\n\r\nconst float fKrESun = Kr * ESun;\r\nconst float fKmESun = Km * ESun;\r\nconst float fKr4PI = Kr * 4.0 * czm_pi;\r\nconst float fKm4PI = Km * 4.0 * czm_pi;\r\n\r\nconst float fScale = 1.0 / (fOuterRadius - fInnerRadius);\r\nconst float fScaleDepth = 0.25;\r\nconst float fScaleOverScaleDepth = fScale / fScaleDepth;\r\n\r\nstruct AtmosphereColor\r\n{\r\n    vec3 mie;\r\n    vec3 rayleigh;\r\n};\r\n\r\nconst int nSamples = 2;\r\nconst float fSamples = 2.0;\r\n\r\nfloat scale(float fCos)\r\n{\r\n    float x = 1.0 - fCos;\r\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\r\n}\r\n\r\nAtmosphereColor computeGroundAtmosphereFromSpace(vec3 v3Pos, bool useSunLighting)\r\n{\r\n\tvec3 v3InvWavelength = vec3(1.0 / pow(0.650, 4.0), 1.0 / pow(0.570, 4.0), 1.0 / pow(0.475, 4.0));\r\n\r\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\r\n    vec3 v3Ray = v3Pos - czm_viewerPositionWC;\r\n    float fFar = length(v3Ray);\r\n    v3Ray /= fFar;\r\n\r\n    float fCameraHeight = length(czm_viewerPositionWC);\r\n    float fCameraHeight2 = fCameraHeight * fCameraHeight;\r\n\r\n    // This next line is an ANGLE workaround. It is equivalent to B = 2.0 * dot(czm_viewerPositionWC, v3Ray),\r\n    // which is what it should be, but there are problems at the poles.\r\n    float B = 2.0 * length(czm_viewerPositionWC) * dot(normalize(czm_viewerPositionWC), v3Ray);\r\n    float C = fCameraHeight2 - fOuterRadius2;\r\n    float fDet = max(0.0, B*B - 4.0 * C);\r\n    float fNear = 0.5 * (-B - sqrt(fDet));\r\n\r\n    // Calculate the ray's starting position, then calculate its scattering offset\r\n    vec3 v3Start = czm_viewerPositionWC + v3Ray * fNear;\r\n    fFar -= fNear;\r\n    float fDepth = exp((fInnerRadius - fOuterRadius) / fScaleDepth);\r\n\r\n    // The light angle based on the sun position would be:\r\n    //    dot(czm_sunDirectionWC, v3Pos) / length(v3Pos);\r\n    // When we want the atmosphere to be uniform over the globe so it is set to 1.0.\r\n\r\n    float fLightAngle = czm_branchFreeTernary(useSunLighting, dot(czm_sunDirectionWC, v3Pos) / length(v3Pos), 1.0);\r\n    float fCameraAngle = dot(-v3Ray, v3Pos) / length(v3Pos);\r\n    float fCameraScale = scale(fCameraAngle);\r\n    float fLightScale = scale(fLightAngle);\r\n    float fCameraOffset = fDepth*fCameraScale;\r\n    float fTemp = (fLightScale + fCameraScale);\r\n\r\n    // Initialize the scattering loop variables\r\n    float fSampleLength = fFar / fSamples;\r\n    float fScaledLength = fSampleLength * fScale;\r\n    vec3 v3SampleRay = v3Ray * fSampleLength;\r\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\r\n\r\n    // Now loop through the sample rays\r\n    vec3 v3FrontColor = vec3(0.0);\r\n    vec3 v3Attenuate = vec3(0.0);\r\n    for(int i=0; i<nSamples; i++)\r\n    {\r\n        float fHeight = length(v3SamplePoint);\r\n        float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\r\n        float fScatter = fDepth*fTemp - fCameraOffset;\r\n        v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\r\n        v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\r\n        v3SamplePoint += v3SampleRay;\r\n    }\r\n\r\n    AtmosphereColor color;\r\n    color.mie = v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);\r\n    color.rayleigh = v3Attenuate; // Calculate the attenuation factor for the ground\r\n\r\n    return color;\r\n}\r\n\r\n"},function(e,t){e.exports="#ifdef QUANTIZATION_BITS12\r\nattribute vec4 compressed0;\r\nattribute float compressed1;\r\n#else\r\nattribute vec4 position3DAndHeight;\r\nattribute vec4 textureCoordAndEncodedNormals;\r\n#endif\r\n\r\nuniform vec3 u_center3D;\r\nuniform mat4 u_modifiedModelView;\r\nuniform mat4 u_modifiedModelViewProjection;\r\nuniform vec4 u_tileRectangle;\r\n\r\n// Uniforms for 2D Mercator projection\r\nuniform vec2 u_southAndNorthLatitude;\r\nuniform vec2 u_southMercatorYAndOneOverHeight;\r\n\r\nvarying vec3 v_positionMC;\r\nvarying vec3 v_positionEC;\r\n\r\nvarying vec3 v_textureCoordinates;\r\nvarying vec3 v_normalMC;\r\nvarying vec3 v_normalEC;\r\n\r\n#ifdef APPLY_MATERIAL\r\nvarying float v_slope;\r\nvarying float v_aspect;\r\nvarying float v_height;\r\n#endif\r\n\r\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\r\nvarying float v_distance;\r\nvarying vec3 v_fogMieColor;\r\nvarying vec3 v_fogRayleighColor;\r\n#endif\r\n\r\n// These functions are generated at runtime.\r\nvec4 getPosition(vec3 position, float height, vec2 textureCoordinates);\r\nfloat get2DYPositionFraction(vec2 textureCoordinates);\r\n\r\nvec4 getPosition3DMode(vec3 position, float height, vec2 textureCoordinates)\r\n{\r\n    return u_modifiedModelViewProjection * vec4(position, 1.0);\r\n}\r\n\r\nfloat get2DMercatorYPositionFraction(vec2 textureCoordinates)\r\n{\r\n    // The width of a tile at level 11, in radians and assuming a single root tile, is\r\n    //   2.0 * czm_pi / pow(2.0, 11.0)\r\n    // We want to just linearly interpolate the 2D position from the texture coordinates\r\n    // when we're at this level or higher.  The constant below is the expression\r\n    // above evaluated and then rounded up at the 4th significant digit.\r\n    const float maxTileWidth = 0.003068;\r\n    float positionFraction = textureCoordinates.y;\r\n    float southLatitude = u_southAndNorthLatitude.x;\r\n    float northLatitude = u_southAndNorthLatitude.y;\r\n    if (northLatitude - southLatitude > maxTileWidth)\r\n    {\r\n        float southMercatorY = u_southMercatorYAndOneOverHeight.x;\r\n        float oneOverMercatorHeight = u_southMercatorYAndOneOverHeight.y;\r\n\r\n        float currentLatitude = mix(southLatitude, northLatitude, textureCoordinates.y);\r\n        currentLatitude = clamp(currentLatitude, -czm_webMercatorMaxLatitude, czm_webMercatorMaxLatitude);\r\n        positionFraction = czm_latitudeToWebMercatorFraction(currentLatitude, southMercatorY, oneOverMercatorHeight);\r\n    }\r\n    return positionFraction;\r\n}\r\n\r\nfloat get2DGeographicYPositionFraction(vec2 textureCoordinates)\r\n{\r\n    return textureCoordinates.y;\r\n}\r\n\r\nvec4 getPositionPlanarEarth(vec3 position, float height, vec2 textureCoordinates)\r\n{\r\n    float yPositionFraction = get2DYPositionFraction(textureCoordinates);\r\n    vec4 rtcPosition2D = vec4(height, mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);\r\n    return u_modifiedModelViewProjection * rtcPosition2D;\r\n}\r\n\r\nvec4 getPosition2DMode(vec3 position, float height, vec2 textureCoordinates)\r\n{\r\n    return getPositionPlanarEarth(position, 0.0, textureCoordinates);\r\n}\r\n\r\nvec4 getPositionColumbusViewMode(vec3 position, float height, vec2 textureCoordinates)\r\n{\r\n    return getPositionPlanarEarth(position, height, textureCoordinates);\r\n}\r\n\r\nvec4 getPositionMorphingMode(vec3 position, float height, vec2 textureCoordinates)\r\n{\r\n    // We do not do RTC while morphing, so there is potential for jitter.\r\n    // This is unlikely to be noticeable, though.\r\n    vec3 position3DWC = position + u_center3D;\r\n    float yPositionFraction = get2DYPositionFraction(textureCoordinates);\r\n    vec4 position2DWC = vec4(height, mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);\r\n    vec4 morphPosition = czm_columbusViewMorph(position2DWC, vec4(position3DWC, 1.0), czm_morphTime);\r\n    return czm_modelViewProjection * morphPosition;\r\n}\r\n\r\n#ifdef QUANTIZATION_BITS12\r\nuniform vec2 u_minMaxHeight;\r\nuniform mat4 u_scaleAndBias;\r\n#endif\r\n\r\nvoid main()\r\n{\r\n#ifdef QUANTIZATION_BITS12\r\n    vec2 xy = czm_decompressTextureCoordinates(compressed0.x);\r\n    vec2 zh = czm_decompressTextureCoordinates(compressed0.y);\r\n    vec3 position = vec3(xy, zh.x);\r\n    float height = zh.y;\r\n    vec2 textureCoordinates = czm_decompressTextureCoordinates(compressed0.z);\r\n\r\n    height = height * (u_minMaxHeight.y - u_minMaxHeight.x) + u_minMaxHeight.x;\r\n    position = (u_scaleAndBias * vec4(position, 1.0)).xyz;\r\n\r\n#if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)) && defined(INCLUDE_WEB_MERCATOR_Y)\r\n    float webMercatorT = czm_decompressTextureCoordinates(compressed0.w).x;\r\n    float encodedNormal = compressed1;\r\n#elif defined(INCLUDE_WEB_MERCATOR_Y)\r\n    float webMercatorT = czm_decompressTextureCoordinates(compressed0.w).x;\r\n    float encodedNormal = 0.0;\r\n#elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)\r\n    float webMercatorT = textureCoordinates.y;\r\n    float encodedNormal = compressed0.w;\r\n#else\r\n    float webMercatorT = textureCoordinates.y;\r\n    float encodedNormal = 0.0;\r\n#endif\r\n\r\n#else\r\n    // A single float per element\r\n    vec3 position = position3DAndHeight.xyz;\r\n    float height = position3DAndHeight.w;\r\n    vec2 textureCoordinates = textureCoordAndEncodedNormals.xy;\r\n\r\n#if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)) && defined(INCLUDE_WEB_MERCATOR_Y)\r\n    float webMercatorT = textureCoordAndEncodedNormals.z;\r\n    float encodedNormal = textureCoordAndEncodedNormals.w;\r\n#elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)\r\n    float webMercatorT = textureCoordinates.y;\r\n    float encodedNormal = textureCoordAndEncodedNormals.z;\r\n#elif defined(INCLUDE_WEB_MERCATOR_Y)\r\n    float webMercatorT = textureCoordAndEncodedNormals.z;\r\n    float encodedNormal = 0.0;\r\n#else\r\n    float webMercatorT = textureCoordinates.y;\r\n    float encodedNormal = 0.0;\r\n#endif\r\n\r\n#endif\r\n\r\n    vec3 position3DWC = position + u_center3D;\r\n    gl_Position = getPosition(position, height, textureCoordinates);\r\n\r\n    v_textureCoordinates = vec3(textureCoordinates, webMercatorT);\r\n\r\n#if defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)\r\n    v_positionEC = (u_modifiedModelView * vec4(position, 1.0)).xyz;\r\n    v_positionMC = position3DWC;  // position in model coordinates\r\n    vec3 normalMC = czm_octDecode(encodedNormal);\r\n    v_normalMC = normalMC;\r\n    v_normalEC = czm_normal3D * v_normalMC;\r\n#elif defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(GENERATE_POSITION) || defined(HDR)\r\n    v_positionEC = (u_modifiedModelView * vec4(position, 1.0)).xyz;\r\n    v_positionMC = position3DWC;  // position in model coordinates\r\n#endif\r\n\r\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\r\n    AtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(position3DWC, false);\r\n    v_fogMieColor = atmosFogColor.mie;\r\n    v_fogRayleighColor = atmosFogColor.rayleigh;\r\n    v_distance = length((czm_modelView3D * vec4(position3DWC, 1.0)).xyz);\r\n#endif\r\n\r\n#ifdef APPLY_MATERIAL\r\n    float northPoleZ = czm_getWgs84EllipsoidEC().radii.z;\r\n    vec3 northPolePositionMC = vec3(0.0, 0.0, northPoleZ);\r\n    vec3 ellipsoidNormal = normalize(v_positionMC); // For a sphere this is correct, but not generally for an ellipsoid.\r\n    vec3 vectorEastMC = normalize(cross(northPolePositionMC - v_positionMC, ellipsoidNormal));\r\n    float dotProd = abs(dot(ellipsoidNormal, v_normalMC));\r\n    v_slope = acos(dotProd);\r\n    vec3 normalRejected = ellipsoidNormal * dotProd;\r\n    vec3 normalProjected = v_normalMC - normalRejected;\r\n    vec3 aspectVector = normalize(normalProjected);\r\n    v_aspect = acos(dot(aspectVector, vectorEastMC));\r\n    float determ = dot(cross(vectorEastMC, aspectVector), ellipsoidNormal);\r\n    v_aspect = czm_branchFreeTernary(determ < 0.0, 2.0 * czm_pi - v_aspect, v_aspect);\r\n    v_height = height;\r\n#endif\r\n}\r\n"},function(e,t){e.exports="uniform vec4 u_initialColor;\r\n\r\n#ifdef WAJUE\r\n//淹没与挖掘分析  史廷春\r\nuniform bool excavateDig;\r\nuniform mat4 dig_pos_x;\r\nuniform mat4 dig_pos_y;\r\nuniform mat4 dig_pos_z;\r\nuniform int dig_max_index;\r\nuniform bool showSelfOnly;\r\n#endif\r\n\r\n#if TEXTURE_UNITS > 0\r\nuniform sampler2D u_dayTextures[TEXTURE_UNITS];\r\nuniform vec4 u_dayTextureTranslationAndScale[TEXTURE_UNITS];\r\nuniform bool u_dayTextureUseWebMercatorT[TEXTURE_UNITS];\r\n\r\n#ifdef APPLY_ALPHA\r\nuniform float u_dayTextureAlpha[TEXTURE_UNITS];\r\n#endif\r\n\r\n#ifdef APPLY_SPLIT\r\nuniform float u_dayTextureSplit[TEXTURE_UNITS];\r\n#endif\r\n\r\n#ifdef APPLY_BRIGHTNESS\r\nuniform float u_dayTextureBrightness[TEXTURE_UNITS];\r\n#endif\r\n\r\n#ifdef APPLY_CONTRAST\r\nuniform float u_dayTextureContrast[TEXTURE_UNITS];\r\n#endif\r\n\r\n#ifdef APPLY_HUE\r\nuniform float u_dayTextureHue[TEXTURE_UNITS];\r\n#endif\r\n\r\n#ifdef APPLY_SATURATION\r\nuniform float u_dayTextureSaturation[TEXTURE_UNITS];\r\n#endif\r\n\r\n#ifdef APPLY_GAMMA\r\nuniform float u_dayTextureOneOverGamma[TEXTURE_UNITS];\r\n#endif\r\n\r\n#ifdef APPLY_IMAGERY_CUTOUT\r\nuniform vec4 u_dayTextureCutoutRectangles[TEXTURE_UNITS];\r\n#endif\r\n\r\n#ifdef APPLY_COLOR_TO_ALPHA\r\nuniform vec4 u_colorsToAlpha[TEXTURE_UNITS];\r\n#endif\r\n\r\nuniform vec4 u_dayTextureTexCoordsRectangle[TEXTURE_UNITS];\r\n#endif\r\n\r\n#ifdef SHOW_REFLECTIVE_OCEAN\r\nuniform sampler2D u_waterMask;\r\nuniform vec4 u_waterMaskTranslationAndScale;\r\nuniform float u_zoomedOutOceanSpecularIntensity;\r\n#endif\r\n\r\n#ifdef SHOW_OCEAN_WAVES\r\nuniform sampler2D u_oceanNormalMap;\r\n#endif\r\n\r\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\r\nuniform vec2 u_lightingFadeDistance;\r\n#endif\r\n\r\n#ifdef TILE_LIMIT_RECTANGLE\r\nuniform vec4 u_cartographicLimitRectangle;\r\n#endif\r\n\r\n#ifdef GROUND_ATMOSPHERE\r\nuniform vec2 u_nightFadeDistance;\r\n#endif\r\n\r\n#ifdef ENABLE_CLIPPING_PLANES\r\nuniform sampler2D u_clippingPlanes;\r\nuniform mat4 u_clippingPlanesMatrix;\r\nuniform vec4 u_clippingPlanesEdgeStyle;\r\n#endif\r\n\r\n#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE)\r\nuniform float u_minimumBrightness;\r\n#endif\r\n\r\n#ifdef COLOR_CORRECT\r\nuniform vec3 u_hsbShift; // Hue, saturation, brightness\r\n#endif\r\n\r\n#ifdef HIGHLIGHT_FILL_TILE\r\nuniform vec4 u_fillHighlightColor;\r\n#endif\r\n\r\nvarying vec3 v_positionMC;\r\nvarying vec3 v_positionEC;\r\nvarying vec3 v_textureCoordinates;\r\nvarying vec3 v_normalMC;\r\nvarying vec3 v_normalEC;\r\n\r\n\r\n\r\n\r\n#ifdef APPLY_MATERIAL\r\n//淹没与挖掘分析  史廷春\r\nuniform mat4 ym_pos_x;\r\nuniform mat4 ym_pos_y;\r\nuniform mat4 ym_pos_z;\r\nuniform int ym_max_index;\r\nuniform bool globe;\r\nuniform bool showElseArea;\r\n\r\n\r\nvarying float v_height;\r\nvarying float v_slope;\r\nvarying float v_aspect;\r\n#endif\r\n\r\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\r\nvarying float v_distance;\r\nvarying vec3 v_fogRayleighColor;\r\nvarying vec3 v_fogMieColor;\r\n#endif\r\n\r\n#ifdef GROUND_ATMOSPHERE\r\nvarying vec3 v_rayleighColor;\r\nvarying vec3 v_mieColor;\r\n#endif\r\n\r\nvec4 sampleAndBlend(\r\n    vec4 previousColor,\r\n    sampler2D textureToSample,\r\n    vec2 tileTextureCoordinates,\r\n    vec4 textureCoordinateRectangle,\r\n    vec4 textureCoordinateTranslationAndScale,\r\n    float textureAlpha,\r\n    float textureBrightness,\r\n    float textureContrast,\r\n    float textureHue,\r\n    float textureSaturation,\r\n    float textureOneOverGamma,\r\n    float split,\r\n    vec4 colorToAlpha)\r\n{\r\n    // This crazy step stuff sets the alpha to 0.0 if this following condition is true:\r\n    //    tileTextureCoordinates.s < textureCoordinateRectangle.s ||\r\n    //    tileTextureCoordinates.s > textureCoordinateRectangle.p ||\r\n    //    tileTextureCoordinates.t < textureCoordinateRectangle.t ||\r\n    //    tileTextureCoordinates.t > textureCoordinateRectangle.q\r\n    // In other words, the alpha is zero if the fragment is outside the rectangle\r\n    // covered by this texture.  Would an actual 'if' yield better performance?\r\n    vec2 alphaMultiplier = step(textureCoordinateRectangle.st, tileTextureCoordinates);\r\n    textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\r\n\r\n    alphaMultiplier = step(vec2(0.0), textureCoordinateRectangle.pq - tileTextureCoordinates);\r\n    textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\r\n\r\n    vec2 translation = textureCoordinateTranslationAndScale.xy;\r\n    vec2 scale = textureCoordinateTranslationAndScale.zw;\r\n    vec2 textureCoordinates = tileTextureCoordinates * scale + translation;\r\n    vec4 value = texture2D(textureToSample, textureCoordinates);\r\n    vec3 color = value.rgb;\r\n    float alpha = value.a;\r\n\r\n#ifdef APPLY_COLOR_TO_ALPHA\r\n    vec3 colorDiff = abs(color.rgb - colorToAlpha.rgb);\r\n    colorDiff.r = max(max(colorDiff.r, colorDiff.g), colorDiff.b);\r\n    alpha = czm_branchFreeTernary(colorDiff.r < colorToAlpha.a, 0.0, alpha);\r\n#endif\r\n\r\n#if !defined(APPLY_GAMMA)\r\n    vec4 tempColor = czm_gammaCorrect(vec4(color, alpha));\r\n    color = tempColor.rgb;\r\n    alpha = tempColor.a;\r\n#else\r\n    color = pow(color, vec3(textureOneOverGamma));\r\n#endif\r\n\r\n#ifdef APPLY_SPLIT\r\n    float splitPosition = czm_imagerySplitPosition;\r\n    // Split to the left\r\n    if (split < 0.0 && gl_FragCoord.x > splitPosition) {\r\n       alpha = 0.0;\r\n    }\r\n    // Split to the right\r\n    else if (split > 0.0 && gl_FragCoord.x < splitPosition) {\r\n       alpha = 0.0;\r\n    }\r\n#endif\r\n\r\n#ifdef APPLY_BRIGHTNESS\r\n    color = mix(vec3(0.0), color, textureBrightness);\r\n#endif\r\n\r\n#ifdef APPLY_CONTRAST\r\n    color = mix(vec3(0.5), color, textureContrast);\r\n#endif\r\n\r\n#ifdef APPLY_HUE\r\n    color = czm_hue(color, textureHue);\r\n#endif\r\n\r\n#ifdef APPLY_SATURATION\r\n    color = czm_saturation(color, textureSaturation);\r\n#endif\r\n\r\n    float sourceAlpha = alpha * textureAlpha;\r\n    float outAlpha = mix(previousColor.a, 1.0, sourceAlpha);\r\n    outAlpha += sign(outAlpha) - 1.0;\r\n\r\n    vec3 outColor = mix(previousColor.rgb * previousColor.a, color, sourceAlpha) / outAlpha;\r\n\r\n    // When rendering imagery for a tile in multiple passes,\r\n    // some GPU/WebGL implementation combinations will not blend fragments in\r\n    // additional passes correctly if their computation includes an unmasked\r\n    // divide-by-zero operation,\r\n    // even if it's not in the output or if the output has alpha zero.\r\n    //\r\n    // For example, without sanitization for outAlpha,\r\n    // this renders without artifacts:\r\n    //   if (outAlpha == 0.0) { outColor = vec3(0.0); }\r\n    //\r\n    // but using czm_branchFreeTernary will cause portions of the tile that are\r\n    // alpha-zero in the additional pass to render as black instead of blending\r\n    // with the previous pass:\r\n    //   outColor = czm_branchFreeTernary(outAlpha == 0.0, vec3(0.0), outColor);\r\n    //\r\n    // So instead, sanitize against divide-by-zero,\r\n    // store this state on the sign of outAlpha, and correct on return.\r\n\r\n    return vec4(outColor, max(outAlpha, 0.0));\r\n}\r\n\r\nvec3 colorCorrect(vec3 rgb) {\r\n#ifdef COLOR_CORRECT\r\n    // Convert rgb color to hsb\r\n    vec3 hsb = czm_RGBToHSB(rgb);\r\n    // Perform hsb shift\r\n    hsb.x += u_hsbShift.x; // hue\r\n    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation\r\n    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness\r\n    // Convert shifted hsb back to rgb\r\n    rgb = czm_HSBToRGB(hsb);\r\n#endif\r\n    return rgb;\r\n}\r\n\r\nvec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates);\r\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float specularMapValue, float fade);\r\n\r\nvoid main()\r\n{\r\n#ifdef TILE_LIMIT_RECTANGLE\r\n    if (v_textureCoordinates.x < u_cartographicLimitRectangle.x || u_cartographicLimitRectangle.z < v_textureCoordinates.x ||\r\n        v_textureCoordinates.y < u_cartographicLimitRectangle.y || u_cartographicLimitRectangle.w < v_textureCoordinates.y)\r\n        {\r\n            discard;\r\n        }\r\n#endif\r\n\r\n#ifdef ENABLE_CLIPPING_PLANES\r\n    float clipDistance = clip(gl_FragCoord, u_clippingPlanes, u_clippingPlanesMatrix);\r\n#endif\r\n\r\n    // The clamp below works around an apparent bug in Chrome Canary v23.0.1241.0\r\n    // where the fragment shader sees textures coordinates < 0.0 and > 1.0 for the\r\n    // fragments on the edges of tiles even though the vertex shader is outputting\r\n    // coordinates strictly in the 0-1 range.\r\n    vec4 color = computeDayColor(u_initialColor, clamp(v_textureCoordinates, 0.0, 1.0));\r\n\r\n#ifdef SHOW_TILE_BOUNDARIES\r\n    if (v_textureCoordinates.x < (1.0/256.0) || v_textureCoordinates.x > (255.0/256.0) ||\r\n        v_textureCoordinates.y < (1.0/256.0) || v_textureCoordinates.y > (255.0/256.0))\r\n    {\r\n        color = vec4(1.0, 0.0, 0.0, 1.0);\r\n    }\r\n#endif\r\n\r\n#if defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(HDR)\r\n    vec3 normalMC = czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0));   // normalized surface normal in model coordinates\r\n    vec3 normalEC = czm_normal3D * normalMC;                                         // normalized surface normal in eye coordiantes\r\n#endif\r\n\r\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\r\n    float cameraDist;\r\n    if (czm_sceneMode == czm_sceneMode2D)\r\n    {\r\n        cameraDist = max(czm_frustumPlanes.x - czm_frustumPlanes.y, czm_frustumPlanes.w - czm_frustumPlanes.z) * 0.5;\r\n    }\r\n    else if (czm_sceneMode == czm_sceneModeColumbusView)\r\n    {\r\n        cameraDist = -czm_view[3].z;\r\n    }\r\n    else\r\n    {\r\n        cameraDist = length(czm_view[3]);\r\n    }\r\n    float fadeOutDist = u_lightingFadeDistance.x;\r\n    float fadeInDist = u_lightingFadeDistance.y;\r\n    if (czm_sceneMode != czm_sceneMode3D) {\r\n        vec3 radii = czm_getWgs84EllipsoidEC().radii;\r\n        float maxRadii = max(radii.x, max(radii.y, radii.z));\r\n        fadeOutDist -= maxRadii;\r\n        fadeInDist -= maxRadii;\r\n    }\r\n    float fade = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\r\n#else\r\n    float fade = 0.0;\r\n#endif\r\n\r\n#ifdef SHOW_REFLECTIVE_OCEAN\r\n    vec2 waterMaskTranslation = u_waterMaskTranslationAndScale.xy;\r\n    vec2 waterMaskScale = u_waterMaskTranslationAndScale.zw;\r\n    vec2 waterMaskTextureCoordinates = v_textureCoordinates.xy * waterMaskScale + waterMaskTranslation;\r\n    waterMaskTextureCoordinates.y = 1.0 - waterMaskTextureCoordinates.y;\r\n\r\n    float mask = texture2D(u_waterMask, waterMaskTextureCoordinates).r;\r\n\r\n    if (mask > 0.0)\r\n    {\r\n        mat3 enuToEye = czm_eastNorthUpToEyeCoordinates(v_positionMC, normalEC);\r\n\r\n        vec2 ellipsoidTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC);\r\n        vec2 ellipsoidFlippedTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC.zyx);\r\n\r\n        vec2 textureCoordinates = mix(ellipsoidTextureCoordinates, ellipsoidFlippedTextureCoordinates, czm_morphTime * smoothstep(0.9, 0.95, normalMC.z));\r\n\r\n        color = computeWaterColor(v_positionEC, textureCoordinates, enuToEye, color, mask, fade);\r\n    }\r\n#endif\r\n\r\n#ifdef APPLY_MATERIAL\r\n    czm_materialInput materialInput;\r\n    materialInput.st = v_textureCoordinates.st;\r\n    materialInput.normalEC = normalize(v_normalEC);\r\n    materialInput.slope = v_slope;\r\n    materialInput.height = v_height;\r\n    materialInput.aspect = v_aspect;\r\n    czm_material material = czm_getMaterial(materialInput);\r\n    // color.xyz = mix(color.xyz, material.diffuse, material.alpha);\r\n    if(ym_pos_x[0][0]!=0.0){\r\n        int ym_max_index = ym_max_index;\r\n        mat3 rect = czm_HXgetFloodRect(ym_pos_x,ym_pos_y,ym_pos_z,999999999999999.0,999999999999999.0,999999999999999.0,-999999999999999.0,-999999999999999.0,-999999999999999.0,ym_max_index);\r\n        bool stc_isIn = czm_HXisInEllipsoid (v_positionMC,ym_pos_x,ym_pos_y,ym_pos_z,rect,ym_max_index);\r\n        if(globe){\r\n            color.xyz = mix(color.xyz, material.diffuse, material.alpha);\r\n        }else{\r\n            if(stc_isIn){\r\n                color.xyz = mix(color.xyz, material.diffuse, material.alpha);\r\n            }else{\r\n                if(!showElseArea){\r\n                    color.xyz = vec3(209.0/255.0,209.0/255.0,209.0/255.0);\r\n                }\r\n            }\r\n        }\r\n    }\r\n#endif\r\n\r\n#ifdef ENABLE_VERTEX_LIGHTING\r\n    float diffuseIntensity = clamp(czm_getLambertDiffuse(czm_sunDirectionEC, normalize(v_normalEC)) * 0.9 + 0.3, 0.0, 1.0);\r\n    vec4 finalColor = vec4(color.rgb * diffuseIntensity, color.a);\r\n#elif defined(ENABLE_DAYNIGHT_SHADING)\r\n    float diffuseIntensity = clamp(czm_getLambertDiffuse(czm_sunDirectionEC, normalEC) * 5.0 + 0.3, 0.0, 1.0);\r\n    diffuseIntensity = mix(1.0, diffuseIntensity, fade);\r\n    vec4 finalColor = vec4(color.rgb * diffuseIntensity, color.a);\r\n#else\r\n    vec4 finalColor = color;\r\n#endif\r\n\r\n#ifdef ENABLE_CLIPPING_PLANES\r\n    vec4 clippingPlanesEdgeColor = vec4(1.0);\r\n    clippingPlanesEdgeColor.rgb = u_clippingPlanesEdgeStyle.rgb;\r\n    float clippingPlanesEdgeWidth = u_clippingPlanesEdgeStyle.a;\r\n\r\n    if (clipDistance < clippingPlanesEdgeWidth)\r\n    {\r\n        finalColor = clippingPlanesEdgeColor;\r\n    }\r\n#endif\r\n\r\n#ifdef HIGHLIGHT_FILL_TILE\r\n    finalColor = vec4(mix(finalColor.rgb, u_fillHighlightColor.rgb, u_fillHighlightColor.a), finalColor.a);\r\n#endif\r\n\r\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\r\n    vec3 fogColor = colorCorrect(v_fogMieColor) + finalColor.rgb * colorCorrect(v_fogRayleighColor);\r\n#ifndef HDR\r\n    const float fExposure = 2.0;\r\n    fogColor = vec3(1.0) - exp(-fExposure * fogColor);\r\n#endif\r\n#endif\r\n\r\n#ifdef FOG\r\n#if defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)\r\n    float darken = clamp(dot(normalize(czm_viewerPositionWC), normalize(czm_sunPositionWC)), u_minimumBrightness, 1.0);\r\n    fogColor *= darken;\r\n#endif\r\n\r\n#ifdef HDR\r\n    const float modifier = 0.15;\r\n    finalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor, modifier), finalColor.a);\r\n#else\r\n    finalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor), finalColor.a);\r\n#endif\r\n#endif\r\n\r\n#ifdef GROUND_ATMOSPHERE\r\n    if (czm_sceneMode != czm_sceneMode3D)\r\n    {\r\n        gl_FragColor = finalColor;\r\n        return;\r\n    }\r\n\r\n#if defined(PER_FRAGMENT_GROUND_ATMOSPHERE) && (defined(ENABLE_DAYNIGHT_SHADING) || defined(ENABLE_VERTEX_LIGHTING))\r\n    czm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\r\n\r\n    float mpp = czm_metersPerPixel(vec4(0.0, 0.0, -czm_currentFrustum.x, 1.0));\r\n    vec2 xy = gl_FragCoord.xy / czm_viewport.zw * 2.0 - vec2(1.0);\r\n    xy *= czm_viewport.zw * mpp * 0.5;\r\n\r\n    vec3 direction = normalize(vec3(xy, -czm_currentFrustum.x));\r\n    czm_ray ray = czm_ray(vec3(0.0), direction);\r\n\r\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid);\r\n\r\n    vec3 ellipsoidPosition = czm_pointAlongRay(ray, intersection.start);\r\n    ellipsoidPosition = (czm_inverseView * vec4(ellipsoidPosition, 1.0)).xyz;\r\n    AtmosphereColor atmosColor = computeGroundAtmosphereFromSpace(ellipsoidPosition, true);\r\n\r\n    vec3 groundAtmosphereColor = colorCorrect(atmosColor.mie) + finalColor.rgb * colorCorrect(atmosColor.rayleigh);\r\n#ifndef HDR\r\n    groundAtmosphereColor = vec3(1.0) - exp(-fExposure * groundAtmosphereColor);\r\n#endif\r\n\r\n    fadeInDist = u_nightFadeDistance.x;\r\n    fadeOutDist = u_nightFadeDistance.y;\r\n\r\n    float sunlitAtmosphereIntensity = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\r\n\r\n#ifdef HDR\r\n    // Some tweaking to make HDR look better\r\n    sunlitAtmosphereIntensity = max(sunlitAtmosphereIntensity * sunlitAtmosphereIntensity, 0.03);\r\n#endif\r\n\r\n    groundAtmosphereColor = mix(groundAtmosphereColor, fogColor, sunlitAtmosphereIntensity);\r\n#else\r\n    vec3 groundAtmosphereColor = fogColor;\r\n#endif\r\n\r\n#ifdef HDR\r\n    // Some tweaking to make HDR look better\r\n    groundAtmosphereColor = czm_saturation(groundAtmosphereColor, 1.6);\r\n#endif\r\n\r\n    finalColor = vec4(mix(finalColor.rgb, groundAtmosphereColor, fade), finalColor.a);\r\n#endif\r\n\r\n\r\n    //地形挖掘  史廷春\r\n#ifdef WAJUE\r\n    mat3 rect_dig = czm_HXgetFloodRect(dig_pos_x,dig_pos_y,dig_pos_z,999999999999999.0,999999999999999.0,999999999999999.0,-999999999999999.0,-999999999999999.0,-999999999999999.0,dig_max_index);\r\n    bool dig_isIn = czm_HXisInEllipsoid (v_positionMC,dig_pos_x,dig_pos_y,dig_pos_z,rect_dig,dig_max_index);\r\n    if(dig_isIn){\r\n        if(!showSelfOnly){\r\n            discard;\r\n        }\r\n    }else{\r\n        if(showSelfOnly){\r\n            // finalColor = vec4(209.0/255.0,209.0/255.0,209.0/255.0,1.0);\r\n            discard;\r\n        }\r\n    }\r\n#endif \r\n\r\n\r\n    gl_FragColor = vec4(finalColor.xyz,0.5);\r\n}\r\n\r\n#ifdef SHOW_REFLECTIVE_OCEAN\r\n\r\nfloat waveFade(float edge0, float edge1, float x)\r\n{\r\n    float y = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\r\n    return pow(1.0 - y, 5.0);\r\n}\r\n\r\nfloat linearFade(float edge0, float edge1, float x)\r\n{\r\n    return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\r\n}\r\n\r\n// Based on water rendering by Jonas Wagner:\r\n// http://29a.ch/2012/7/19/webgl-terrain-rendering-water-fog\r\n\r\n// low altitude wave settings\r\nconst float oceanFrequencyLowAltitude = 825000.0;\r\nconst float oceanAnimationSpeedLowAltitude = 0.004;\r\nconst float oceanOneOverAmplitudeLowAltitude = 1.0 / 2.0;\r\nconst float oceanSpecularIntensity = 0.5;\r\n\r\n// high altitude wave settings\r\nconst float oceanFrequencyHighAltitude = 125000.0;\r\nconst float oceanAnimationSpeedHighAltitude = 0.008;\r\nconst float oceanOneOverAmplitudeHighAltitude = 1.0 / 2.0;\r\n\r\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float maskValue, float fade)\r\n{\r\n    vec3 positionToEyeEC = -positionEyeCoordinates;\r\n    float positionToEyeECLength = length(positionToEyeEC);\r\n\r\n    // The double normalize below works around a bug in Firefox on Android devices.\r\n    vec3 normalizedpositionToEyeEC = normalize(normalize(positionToEyeEC));\r\n\r\n    // Fade out the waves as the camera moves far from the surface.\r\n    float waveIntensity = waveFade(70000.0, 1000000.0, positionToEyeECLength);\r\n\r\n#ifdef SHOW_OCEAN_WAVES\r\n    // high altitude waves\r\n    float time = czm_frameNumber * oceanAnimationSpeedHighAltitude;\r\n    vec4 noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyHighAltitude, time, 0.0);\r\n    vec3 normalTangentSpaceHighAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeHighAltitude);\r\n\r\n    // low altitude waves\r\n    time = czm_frameNumber * oceanAnimationSpeedLowAltitude;\r\n    noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyLowAltitude, time, 0.0);\r\n    vec3 normalTangentSpaceLowAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeLowAltitude);\r\n\r\n    // blend the 2 wave layers based on distance to surface\r\n    float highAltitudeFade = linearFade(0.0, 60000.0, positionToEyeECLength);\r\n    float lowAltitudeFade = 1.0 - linearFade(20000.0, 60000.0, positionToEyeECLength);\r\n    vec3 normalTangentSpace =\r\n        (highAltitudeFade * normalTangentSpaceHighAltitude) +\r\n        (lowAltitudeFade * normalTangentSpaceLowAltitude);\r\n    normalTangentSpace = normalize(normalTangentSpace);\r\n\r\n    // fade out the normal perturbation as we move farther from the water surface\r\n    normalTangentSpace.xy *= waveIntensity;\r\n    normalTangentSpace = normalize(normalTangentSpace);\r\n#else\r\n    vec3 normalTangentSpace = vec3(0.0, 0.0, 1.0);\r\n#endif\r\n\r\n    vec3 normalEC = enuToEye * normalTangentSpace;\r\n\r\n    const vec3 waveHighlightColor = vec3(0.3, 0.45, 0.6);\r\n\r\n    // Use diffuse light to highlight the waves\r\n    float diffuseIntensity = czm_getLambertDiffuse(czm_sunDirectionEC, normalEC) * maskValue;\r\n    vec3 diffuseHighlight = waveHighlightColor * diffuseIntensity * (1.0 - fade);\r\n\r\n#ifdef SHOW_OCEAN_WAVES\r\n    // Where diffuse light is low or non-existent, use wave highlights based solely on\r\n    // the wave bumpiness and no particular light direction.\r\n    float tsPerturbationRatio = normalTangentSpace.z;\r\n    vec3 nonDiffuseHighlight = mix(waveHighlightColor * 5.0 * (1.0 - tsPerturbationRatio), vec3(0.0), diffuseIntensity);\r\n#else\r\n    vec3 nonDiffuseHighlight = vec3(0.0);\r\n#endif\r\n\r\n    // Add specular highlights in 3D, and in all modes when zoomed in.\r\n    float specularIntensity = czm_getSpecular(czm_sunDirectionEC, normalizedpositionToEyeEC, normalEC, 10.0) + 0.25 * czm_getSpecular(czm_moonDirectionEC, normalizedpositionToEyeEC, normalEC, 10.0);\r\n    float surfaceReflectance = mix(0.0, mix(u_zoomedOutOceanSpecularIntensity, oceanSpecularIntensity, waveIntensity), maskValue);\r\n    float specular = specularIntensity * surfaceReflectance;\r\n\r\n#ifdef HDR\r\n    specular *= 1.4;\r\n\r\n    float e = 0.2;\r\n    float d = 3.3;\r\n    float c = 1.7;\r\n\r\n    vec3 color = imageryColor.rgb + (c * (vec3(e) + imageryColor.rgb * d) * (diffuseHighlight + nonDiffuseHighlight + specular));\r\n#else\r\n    vec3 color = imageryColor.rgb + diffuseHighlight + nonDiffuseHighlight + specular;\r\n#endif\r\n\r\n    return vec4(color, imageryColor.a);\r\n}\r\n\r\n#endif // #ifdef SHOW_REFLECTIVE_OCEAN\r\n"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ViewShed3D=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var u=s(i(0)),o=s(i(121)),a=i(45);function s(e){return e&&e.__esModule?e:{default:e}}var l={cameraPosition:null,viewPosition:null,horizontalAngle:120,verticalAngle:90,visibleAreaColor:new u.Color(0,1,0),hiddenAreaColor:new u.Color(1,0,0),alpha:.5,distance:100,frustum:!0,show:!0};t.ViewShed3D=(n(c,[{key:"_bindMourseEvent",value:function(){var n=this,r=this.viewer,e=new u.ScreenSpaceEventHandler(this.viewer.scene.canvas);e.setInputAction(function(e){var t=gsp3d.point.getCurrentMousePosition(r.scene,e.position);t&&(n.cameraPosition?n.cameraPosition&&!n.viewPosition&&(n.viewPosition=t,n._addToScene(),n._unbindMourseEvent(),n.calback&&n.calback()):n.cameraPosition=t)},u.ScreenSpaceEventType.LEFT_CLICK),e.setInputAction(function(e){var t=gsp3d.point.getCurrentMousePosition(r.scene,e.endPosition);if(t){var i=n.cameraPosition;i&&(n.frustumQuaternion=n.getFrustumQuaternion(i,t),n.distance=Number(u.Cartesian3.distance(i,t).toFixed(1)))}},u.ScreenSpaceEventType.MOUSE_MOVE),this._handler=e}},{key:"_unbindMourseEvent",value:function(){null!=this._handler&&(this._handler.destroy(),delete this._handler)}},{key:"_addToScene",value:function(){this.frustumQuaternion=this.getFrustumQuaternion(this.cameraPosition,this.viewPosition),this._createShadowMap(this.cameraPosition,this.viewPosition),this._addPostProcess(),this.radar||this.addRadar(this.cameraPosition,this.frustumQuaternion),this.viewer.scene.primitives.add(this)}},{key:"_createShadowMap",value:function(e,t){var i=e,n=t,r=this.viewer.scene,o=new u.Camera(r);o.position=i,o.direction=u.Cartesian3.subtract(n,i,new u.Cartesian3(0,0,0)),o.up=u.Cartesian3.normalize(i,new u.Cartesian3(0,0,0));var a=Number(u.Cartesian3.distance(n,i).toFixed(1));this.distance=a,o.frustum=new u.PerspectiveFrustum({fov:u.Math.toRadians(120),aspectRatio:r.canvas.clientWidth/r.canvas.clientHeight,near:.1,far:5e3}),this.viewShadowMap=new u.ShadowMap({lightCamera:o,enable:!1,isPointLight:!1,isSpotLight:!0,cascadesEnabled:!1,context:r.context,pointLightRadius:a})}},{key:"getFrustumQuaternion",value:function(e,t){var i=u.Cartesian3.normalize(u.Cartesian3.subtract(t,e,new u.Cartesian3),new u.Cartesian3),n=u.Cartesian3.normalize(e,new u.Cartesian3),r=new u.Camera(this.viewer.scene);r.position=e,r.direction=i,r.up=n,i=r.directionWC,n=r.upWC;var o=r.rightWC,a=new u.Cartesian3,s=new u.Matrix3,l=new u.Quaternion;o=u.Cartesian3.negate(o,a);var c=s;return u.Matrix3.setColumn(c,0,o,c),u.Matrix3.setColumn(c,1,n,c),u.Matrix3.setColumn(c,2,i,c),u.Quaternion.fromRotationMatrix(c,l)}},{key:"_addPostProcess",value:function(){var e=this,t=o.default,i=this,n=i.viewShadowMap._isPointLight?i.viewShadowMap._pointBias:i.viewShadowMap._primitiveBias;this.postProcess=new u.PostProcessStage({fragmentShader:t,uniforms:{czzj:function(){return e.verticalAngle},dis:function(){return e.distance},spzj:function(){return e.horizontalAngle},visibleColor:function(){return e.visibleAreaColor},disVisibleColor:function(){return e.hiddenAreaColor},mixNum:function(){return e.alpha},stcshadow:function(){return i.viewShadowMap._shadowMapTexture},_shadowMap_matrix:function(){return i.viewShadowMap._shadowMapMatrix},shadowMap_lightPositionEC:function(){return i.viewShadowMap._lightPositionEC},shadowMap_lightDirectionEC:function(){return i.viewShadowMap._lightDirectionEC},shadowMap_lightUp:function(){return i.viewShadowMap._lightCamera.up},shadowMap_lightDir:function(){return i.viewShadowMap._lightCamera.direction},shadowMap_lightRight:function(){return i.viewShadowMap._lightCamera.right},shadowMap_texelSizeDepthBiasAndNormalShadingSmooth:function(){var e=new u.Cartesian2;return e.x=1/i.viewShadowMap._textureSize.x,e.y=1/i.viewShadowMap._textureSize.y,u.Cartesian4.fromElements(e.x,e.y,n.depthBias,n.normalShadingSmooth,this.combinedUniforms1)},shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness:function(){return u.Cartesian4.fromElements(n.normalOffsetScale,i.viewShadowMap._distance,i.viewShadowMap.maximumDistance,i.viewShadowMap._darkness,this.combinedUniforms2)}}}),this.show&&this.viewer.scene.postProcessStages.add(this.postProcess)}},{key:"removeRadar",value:function(){this.viewer.entities.remove(this.radar)}},{key:"resetRadar",value:function(){this.removeRadar(),this.addRadar(this.cameraPosition,this.frustumQuaternion)}},{key:"addRadar",value:function(e,t){var i=e;this.radar=this.viewer.entities.add({position:i,orientation:t,show:this.show,rectangularSensor:new a.RectangularSensorGraphics({radius:this.distance,xHalfAngle:u.Math.toRadians(this.horizontalAngle/2),yHalfAngle:u.Math.toRadians(this.verticalAngle/2),material:new u.Color(0,1,1,.4),lineColor:new u.Color(1,1,1,1),slice:8,showScanPlane:!1,scanPlaneColor:new u.Color(0,1,1,1),scanPlaneMode:"vertical",scanPlaneRate:3,showThroughEllipsoid:!1,showLateralSurfaces:!1,showDomeSurfaces:!1})})}},{key:"update",value:function(e){this.viewShadowMap&&e.shadowMaps.push(this.viewShadowMap)}},{key:"_switchShow",value:function(){this.show?this.postProcess||this._addPostProcess():(this.viewer.scene.postProcessStages.remove(this.postProcess),delete this.postProcess,this.postProcess=null),this.radar.show=this.show}},{key:"destroy",value:function(){this._unbindMourseEvent(),this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer.entities.remove(this.radar),delete this.radar,delete this.postProcess,delete this.viewShadowMap,delete this.verticalAngle,delete this.viewer,delete this.horizontalAngle,delete this.visibleAreaColor,delete this.hiddenAreaColor,delete this.distance,delete this.frustumQuaternion,delete this.cameraPosition,delete this.viewPosition,delete this.alpha}},{key:"horizontalAngle",get:function(){return this._horizontalAngle},set:function(e){this._horizontalAngle=e,this.resetRadar()}},{key:"verticalAngle",get:function(){return this._verticalAngle},set:function(e){this._verticalAngle=e,this.resetRadar()}},{key:"distance",get:function(){return this._distance},set:function(e){this._distance=e,this.resetRadar()}},{key:"visibleAreaColor",get:function(){return this._visibleAreaColor},set:function(e){this._visibleAreaColor=e}},{key:"hiddenAreaColor",get:function(){return this._hiddenAreaColor},set:function(e){this._hiddenAreaColor=e}},{key:"alpha",get:function(){return this._alpha},set:function(e){this._alpha=e}},{key:"show",get:function(){return this.defaultShow},set:function(e){this.defaultShow=Boolean(e),this._switchShow()}}]),c);function c(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),e&&(t=t||{},this.viewer=e,this.cameraPosition=u.defaultValue(t.cameraPosition,l.cameraPosition),this.viewPosition=u.defaultValue(t.viewPosition,l.viewPosition),this._horizontalAngle=u.defaultValue(t.horizontalAngle,l.horizontalAngle),this._verticalAngle=u.defaultValue(t.verticalAngle,l.verticalAngle),this._visibleAreaColor=u.defaultValue(t.visibleAreaColor,l.visibleAreaColor),this._hiddenAreaColor=u.defaultValue(t.hiddenAreaColor,l.hiddenAreaColor),this._alpha=u.defaultValue(t.alpha,l.alpha),this._distance=u.defaultValue(t.distance,l.distance),this._frustum=u.defaultValue(t.frustum,l.frustum),this.calback=t.calback,this.defaultShow=u.defaultValue(t.show,!0),this.cameraPosition&&this.viewPosition?(this._addToScene(),this.calback&&this.calback()):this._bindMourseEvent())}},function(e,t){e.exports="uniform float czzj;\r\nuniform float dis;\r\nuniform float spzj;\r\nuniform vec3 visibleColor;\r\nuniform vec3 disVisibleColor;\r\nuniform float mixNum;\r\nuniform sampler2D colorTexture;\r\nuniform sampler2D stcshadow; \r\nuniform sampler2D depthTexture;\r\nuniform mat4 _shadowMap_matrix; \r\nuniform vec4 shadowMap_lightPositionEC; \r\nuniform vec4 shadowMap_lightDirectionEC;\r\nuniform vec3 shadowMap_lightUp;\r\nuniform vec3 shadowMap_lightDir;\r\nuniform vec3 shadowMap_lightRight;\r\nuniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness; \r\nuniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth; \r\nvarying vec2 v_textureCoordinates;\r\nvec4 toEye(in vec2 uv, in float depth){\r\n    vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));\r\n    vec4 posInCamera =czm_inverseProjection * vec4(xy, depth, 1.0);\r\n    posInCamera =posInCamera / posInCamera.w;\r\n    return posInCamera;\r\n}\r\nfloat getDepth(in vec4 depth){\r\n    float z_window = czm_unpackDepth(depth);\r\n    z_window = czm_reverseLogDepth(z_window);\r\n    float n_range = czm_depthRange.near;\r\n    float f_range = czm_depthRange.far;\r\n    return (2.0 * z_window - n_range - f_range) / (f_range - n_range);\r\n}\r\nfloat _czm_sampleShadowMap(sampler2D shadowMap, vec2 uv){\r\n    return texture2D(shadowMap, uv).r;\r\n}\r\nfloat _czm_shadowDepthCompare(sampler2D shadowMap, vec2 uv, float depth){\r\n    return step(depth, _czm_sampleShadowMap(shadowMap, uv));\r\n}\r\nfloat _czm_shadowVisibility(sampler2D shadowMap, czm_shadowParameters shadowParameters){\r\n    float depthBias = shadowParameters.depthBias;\r\n    float depth = shadowParameters.depth;\r\n    float nDotL = shadowParameters.nDotL;\r\n    float normalShadingSmooth = shadowParameters.normalShadingSmooth;\r\n    float darkness = shadowParameters.darkness;\r\n    vec2 uv = shadowParameters.texCoords;\r\n    depth -= depthBias;\r\n    vec2 texelStepSize = shadowParameters.texelStepSize;\r\n    float radius = 1.0;\r\n    float dx0 = -texelStepSize.x * radius;\r\n    float dy0 = -texelStepSize.y * radius;\r\n    float dx1 = texelStepSize.x * radius;\r\n    float dy1 = texelStepSize.y * radius;\r\n    float visibility = \r\n    (\r\n    _czm_shadowDepthCompare(shadowMap, uv, depth)\r\n    +_czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy0), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy0), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy0), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, 0.0), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, 0.0), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy1), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy1), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy1), depth)\r\n    ) * (1.0 / 9.0)\r\n    ;\r\n    return visibility;\r\n}\r\nvec3 pointProjectOnPlane(in vec3 planeNormal, in vec3 planeOrigin, in vec3 point){\r\n    vec3 v01 = point -planeOrigin;\r\n    float d = dot(planeNormal, v01) ;\r\n    return (point - planeNormal * d);\r\n}\r\nfloat ptm(vec3 pt){\r\n    return sqrt(pt.x*pt.x + pt.y*pt.y + pt.z*pt.z);\r\n}\r\nvoid main() \r\n{ \r\n    const float PI = 3.141592653589793;\r\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\r\n    vec4 currD = texture2D(depthTexture, v_textureCoordinates);\r\n\r\n    // vec4 stcc = texture2D(stcshadow, v_textureCoordinates);\r\n    // gl_FragColor = stcc;\r\n    // return;\r\n    if(currD.r>=1.0){\r\n        gl_FragColor = color;\r\n        return;\r\n    }\r\n    \r\n    float depth = getDepth(currD);\r\n    vec4 positionEC = toEye(v_textureCoordinates, depth);\r\n    vec3 normalEC = vec3(1.0);\r\n    czm_shadowParameters shadowParameters; \r\n    shadowParameters.texelStepSize = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy; \r\n    shadowParameters.depthBias = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z; \r\n    shadowParameters.normalShadingSmooth = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w; \r\n    shadowParameters.darkness = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w; \r\n    shadowParameters.depthBias *= max(depth * 0.01, 1.0); \r\n    vec3 directionEC = normalize(positionEC.xyz - shadowMap_lightPositionEC.xyz); \r\n    float nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \r\n    vec4 shadowPosition = _shadowMap_matrix * positionEC; \r\n    shadowPosition /= shadowPosition.w; \r\n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \r\n    { \r\n        gl_FragColor = color;\r\n        return;\r\n    }\r\n\r\n    //坐标与视点位置距离，大于最大距离则舍弃阴影效果\r\n    vec4 lw = czm_inverseView*  vec4(shadowMap_lightPositionEC.xyz, 1.0);\r\n    vec4 vw = czm_inverseView* vec4(positionEC.xyz, 1.0);\r\n    if(distance(lw.xyz,vw.xyz)>dis){\r\n        gl_FragColor = color;\r\n        return;\r\n    }\r\n\r\n\r\n    //水平夹角限制\r\n    vec3 ptOnSP = pointProjectOnPlane(shadowMap_lightUp,lw.xyz,vw.xyz);\r\n    directionEC = ptOnSP - lw.xyz;\r\n    float directionECMO = ptm(directionEC.xyz);\r\n    float shadowMap_lightDirMO = ptm(shadowMap_lightDir.xyz);\r\n    float cosJJ = dot(directionEC,shadowMap_lightDir)/(directionECMO*shadowMap_lightDirMO);\r\n    float degJJ = acos(cosJJ)*(180.0 / PI);\r\n    degJJ = abs(degJJ);\r\n    if(degJJ>spzj/2.0){\r\n        gl_FragColor = color;\r\n        return;\r\n    }\r\n\r\n    //垂直夹角限制\r\n    vec3 ptOnCZ = pointProjectOnPlane(shadowMap_lightRight,lw.xyz,vw.xyz);\r\n    vec3 dirOnCZ = ptOnCZ - lw.xyz;\r\n    float dirOnCZMO = ptm(dirOnCZ);\r\n    float cosJJCZ = dot(dirOnCZ,shadowMap_lightDir)/(dirOnCZMO*shadowMap_lightDirMO);\r\n    float degJJCZ = acos(cosJJCZ)*(180.0 / PI);\r\n    degJJCZ = abs(degJJCZ);\r\n    if(degJJCZ>czzj/2.0){\r\n        gl_FragColor = color;\r\n        return;\r\n    }\r\n\r\n    shadowParameters.texCoords = shadowPosition.xy; \r\n    shadowParameters.depth = shadowPosition.z; \r\n    shadowParameters.nDotL = nDotL; \r\n    float visibility = _czm_shadowVisibility(stcshadow, shadowParameters); \r\n    if(visibility==1.0){\r\n        gl_FragColor = mix(color,vec4(visibleColor,1.0),mixNum);\r\n    }else{\r\n        // if(abs(shadowPosition.z-0.0)<0.01){\r\n        //     return;\r\n        // }\r\n        gl_FragColor = mix(color,vec4(disVisibleColor,1.0),mixNum);\r\n    }\r\n} "},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VideoShed3D=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var v=a(i(0)),o=a(i(123));function a(e){return e&&e.__esModule?e:{default:e}}var y="Z",_="-Z",w="Y",b="-Y",C="X",x="-X",s={font:"50px 楷体",fill:!0,fillColor:new v.Color(1,1,0,1),stroke:!0,strokeWidth:2,strokeColor:new v.Color(1,1,1,.8),backgroundColor:new v.Color(1,1,1,.1),textBaseline:"top",padding:40};t.VideoShed3D=(n(l,[{key:"rotateCamera",value:function(e,t){var i=v.defaultValue(t,this._rotateDeg);switch(e){case y:break;case _:i*=-1;break;case w:break;case b:i*=-1;break;case C:break;case x:i*=-1}var n=this._computedNewViewDir(e,i);this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer.scene.primitives.remove(this.cameraFrustum),this.viewShadowMap.destroy(),this.cameraFrustum.destroy(),this._resetCameraDir(n),this._getOrientation(),this._addCameraFrustum(),this._addPostProcess()}},{key:"_resetCameraDir",value:function(e){e&&e.up&&e.right&&e.direction&&(this._dirObj=e,this._createShadowMap())}},{key:"_computedNewViewDir",value:function(e,t){t=v.Math.toRadians(t);var i=this.viewShadowMap._lightCamera,n=v.clone(i.direction),r=v.clone(i.right),o=v.clone(i.up),a=new v.Matrix3;switch(e){case y:case _:v.Matrix3.fromRotationZ(t,a);break;case w:case b:v.Matrix3.fromRotationY(t,a);break;case C:case x:v.Matrix3.fromRotationX(t,a)}var s=v.Transforms.eastNorthUpToFixedFrame(i.position),l=v.Matrix4.inverse(s,new v.Matrix4),c=v.Matrix4.multiplyByPointAsVector(l,n,new v.Cartesian3),u=v.Matrix3.multiplyByVector(a,c,new v.Cartesian3),h=v.Matrix4.multiplyByPointAsVector(s,u,new v.Cartesian3),d=v.Matrix4.multiplyByPointAsVector(l,r,new v.Cartesian3),p=v.Matrix3.multiplyByVector(a,d,new v.Cartesian3),f=v.Matrix4.multiplyByPointAsVector(s,p,new v.Cartesian3),m=v.Matrix4.multiplyByPointAsVector(l,o,new v.Cartesian3),g=v.Matrix3.multiplyByVector(a,m,new v.Cartesian3);return{direction:h,right:f,up:v.Matrix4.multiplyByPointAsVector(s,g,new v.Cartesian3)}}},{key:"getPercentagePoint",value:function(e){if(e){var t=this.viewShadowMap._lightCamera._viewMatrix,i=this.viewShadowMap._lightCamera.frustum.projectionMatrix,n=new v.Cartesian4(e.x,e.y,e.z,1),r=v.Matrix4.multiply(i,t,new v.Matrix4),o=v.Matrix4.multiplyByVector(r,n,new v.Cartesian4),a=new v.Cartesian2(o.x/o.w,o.y/o.w);return new v.Cartesian2(a.x/2+.5,a.y/2+.5)}}},{key:"_changeCameraFov",value:function(){this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer.scene.primitives.remove(this.cameraFrustum),this._createShadowMap(),this._getOrientation(),this._addCameraFrustum(),this._addPostProcess()}},{key:"_changeVideoWidHei",value:function(){this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer.scene.primitives.remove(this.cameraFrustum),this._createShadowMap(),this._getOrientation(),this._addCameraFrustum(),this._addPostProcess()}},{key:"_changeCameraPos",value:function(){this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer.scene.primitives.remove(this.cameraFrustum),this.viewShadowMap.destroy(),this.cameraFrustum.destroy(),this._createShadowMap(),this._getOrientation(),this._addCameraFrustum(),this._addPostProcess()}},{key:"_changeViewPos",value:function(){this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer.scene.primitives.remove(this.cameraFrustum),this.viewShadowMap.destroy(),this.cameraFrustum.destroy(),this._createShadowMap(),this._getOrientation(),this._addCameraFrustum(),this._addPostProcess()}},{key:"_switchShow",value:function(){this.show?this.postProcess||this._addPostProcess():(this.viewer.scene.postProcessStages.remove(this.postProcess),delete this.postProcess,this.postProcess=null)}},{key:"activeVideo",value:function(e){var t=this._createVideoEle(e),i=this;if(t){this.type=l.Type.Video;var n=this.viewer;this.activeVideoListener||(this.activeVideoListener=function(){i.videoTexture&&i.videoTexture.destroy(),i.videoTexture=new v.Texture({context:n.scene.context,source:t,pixelFormat:v.PixelFormat.RGBA,pixelDatatype:v.PixelDatatype.UNSIGNED_BYTE})}),n.clock.onTick.addEventListener(this.activeVideoListener)}}},{key:"deActiveVideo",value:function(){this.viewer.clock.onTick.removeEventListener(this.activeVideoListener),delete this.activeVideoListener}},{key:"activePicture",value:function(e){this.videoTexture=this.texture;var t=this,i=new Image;i.onload=function(){t.type=l.Type.Image,t.videoTexture=new v.Texture({context:t.viewer.scene.context,source:i})},i.onerror=function(){console.log("图片加载失败："+e)},i.src=e}},{key:"activeColor",value:function(e){var t,i,n,r;this.type=l.Type.Color,r=e?(t=255*e.red,i=255*e.green,n=255*e.blue,255*e.alpha):(t=255*Math.random(),i=255*Math.random(),n=255*Math.random(),255*Math.random()),this.videoTexture=new v.Texture({context:this.viewer.scene.context,source:{width:1,height:1,arrayBufferView:new Uint8Array([t,i,n,r])},flipY:!1})}},{key:"activeText",value:function(e,t){this.type=l.Type.Text,e&&((t=t||{}).textBaseline="top",this.textCanvas=v.writeTextToCanvas(e,t),this.videoTexture=new v.Texture({context:this.viewer.scene.context,source:this.textCanvas,flipY:!0}))}},{key:"locate",value:function(){var e=v.clone(this.cameraPosition),t=v.clone(this.position);if(this.viewer.camera.position=e,this._dirObj)return this.viewer.camera.direction=v.clone(this._dirObj.direction),this.viewer.camera.right=v.clone(this._dirObj.right),void(this.viewer.camera.up=v.clone(this._dirObj.up));this.viewer.camera.direction=v.Cartesian3.subtract(t,e,new v.Cartesian3(0,0,0)),this.viewer.camera.up=v.Cartesian3.normalize(e,new v.Cartesian3(0,0,0))}},{key:"_getOrientation",value:function(){var e=this.cameraPosition,t=this.position,i=v.Cartesian3.normalize(v.Cartesian3.subtract(t,e,new v.Cartesian3),new v.Cartesian3),n=v.Cartesian3.normalize(e,new v.Cartesian3),r=new v.Camera(this.viewer.scene);r.position=e,r.direction=i,r.up=n,i=r.directionWC,n=r.upWC;var o=r.rightWC,a=new v.Cartesian3,s=new v.Matrix3,l=new v.Quaternion;o=v.Cartesian3.negate(o,a);var c=s;v.Matrix3.setColumn(c,0,o,c),v.Matrix3.setColumn(c,1,n,c),v.Matrix3.setColumn(c,2,i,c);var u=v.Quaternion.fromRotationMatrix(c,l);return this.orientation=u}},{key:"_createVideoEle",value:function(e){this.videoId="visualDomId";var t=document.createElement("SOURCE");t.type="video/mp4",t.src=e;var i=document.createElement("SOURCE");i.type="video/quicktime",i.src=e;var n=document.createElement("VIDEO");return n.setAttribute("autoplay",!0),n.setAttribute("loop",!0),n.setAttribute("crossorigin",!0),n.appendChild(t),n.appendChild(i),document.body.appendChild(n),this._videoEle=n}},{key:"_getWinWidHei",value:function(){var e=this.viewer.scene;return e.canvas.clientWidth/e.canvas.clientHeight}},{key:"_createShadowMap",value:function(){var e=this.cameraPosition,t=this.position,i=this.viewer.scene,n=new v.Camera(i);n.position=e,this._dirObj?(n.direction=this._dirObj.direction,n.right=this._dirObj.right,n.up=this._dirObj.up):(n.direction=v.Cartesian3.subtract(t,e,new v.Cartesian3(0,0,0)),n.up=v.Cartesian3.normalize(e,new v.Cartesian3(0,0,0)));var r=v.Cartesian3.distance(t,e);this.viewDis=r,n.frustum=new v.PerspectiveFrustum({fov:this.fov,aspectRatio:this.aspectRatio,near:.1,far:2*r}),this.viewShadowMap=new v.ShadowMap({lightCamera:n,enable:!1,isPointLight:!1,isSpotLight:!0,cascadesEnabled:!1,context:i.context,pointLightRadius:r})}},{key:"_addCameraFrustum",value:function(){this.cameraFrustum=new v.Primitive({geometryInstances:new v.GeometryInstance({geometry:new v.FrustumOutlineGeometry({origin:this.cameraPosition,orientation:this.orientation,frustum:this.viewShadowMap._lightCamera.frustum,_drawNearPlane:!0}),attributes:{color:v.ColorGeometryInstanceAttribute.fromColor(new v.Color(0,.5,.5))}}),appearance:new v.PerInstanceColorAppearance({translucent:!1,flat:!0}),asynchronous:!1,show:this.debugFrustum&&this.show}),this.viewer.scene.primitives.add(this.cameraFrustum)}},{key:"_addPostProcess",value:function(){var t=this,e=o.default,i=t.viewShadowMap._isPointLight?t.viewShadowMap._pointBias:t.viewShadowMap._primitiveBias;this.show&&(this.postProcess=new v.PostProcessStage({fragmentShader:e,uniforms:{mixNum:function(){return t.alpha},stcshadow:function(){return t.viewShadowMap._shadowMapTexture},videoTexture:function(){return t.videoTexture},_shadowMap_matrix:function(){return t.viewShadowMap._shadowMapMatrix},shadowMap_lightPositionEC:function(){return t.viewShadowMap._lightPositionEC},shadowMap_texelSizeDepthBiasAndNormalShadingSmooth:function(){var e=new v.Cartesian2;return e.x=1/t.viewShadowMap._textureSize.x,e.y=1/t.viewShadowMap._textureSize.y,v.Cartesian4.fromElements(e.x,e.y,i.depthBias,i.normalShadingSmooth,this.combinedUniforms1)},shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness:function(){return v.Cartesian4.fromElements(i.normalOffsetScale,t.viewShadowMap._distance,t.viewShadowMap.maximumDistance,t.viewShadowMap._darkness,this.combinedUniforms2)},disViewColor:function(){return t._disViewColor}}}),this.viewer.scene.postProcessStages.add(this.postProcess))}},{key:"update",value:function(e){this.viewShadowMap&&e.shadowMaps.push(this.viewShadowMap)}},{key:"destroy",value:function(){this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer.scene.primitives.remove(this.cameraFrustum),this._videoEle&&this._videoEle.parentNode.removeChild(this._videoEle),this.viewer.clock.onTick.removeEventListener(this.activeVideoListener),delete this.activeVideoListener,delete this.postProcess,delete this.viewShadowMap,delete this.color,delete this.viewDis,delete this.cameraPosition,delete this.position,delete this.alpha,delete this._camerafov,delete this._cameraPosition,delete this.videoTexture,delete this.cameraFrustum,delete this._videoEle,delete this._debugFrustum,delete this._position,delete this._aspectRatio,delete this.url,delete this.orientation,delete this.texture,delete this.videoId,delete this.type,delete this.videoTexture,delete this.url,this.viewer.scene.primitives.remove(this),delete this.viewer}},{key:"alpha",get:function(){return this._alpha},set:function(e){this._alpha=e}},{key:"aspectRatio",get:function(){return this._aspectRatio},set:function(e){this._aspectRatio=e,this._changeVideoWidHei()}},{key:"debugFrustum",get:function(){return this._debugFrustum},set:function(e){this._debugFrustum=e,this.cameraFrustum.show=e}},{key:"fov",get:function(){return this._camerafov},set:function(e){this._camerafov=v.Math.toRadians(e),this._changeCameraFov()}},{key:"cameraPosition",get:function(){return this._cameraPosition},set:function(e){e&&(this._cameraPosition=e,this._changeCameraPos())}},{key:"position",get:function(){return this._position},set:function(e){e&&(this._position=e,this._changeViewPos())}},{key:"videoPlay",get:function(){return this._videoPlay},set:function(e){this._videoPlay=Boolean(e),this._videoEle&&(this.videoPlay?this._videoEle.play():this._videoEle.pause())}},{key:"params",get:function(){var e={};return e.type=this.type,this.type==l.Type.Color?e.color=this.color:e.url=this.url,e.position=this.position,e.cameraPosition=this.cameraPosition,e.fov=v.Math.toDegrees(this.fov),e.aspectRatio=this.aspectRatio,e.alpha=this.alpha,e.debugFrustum=this.debugFrustum,e.dirObj=this._dirObj,e}},{key:"show",get:function(){return this.defaultShow},set:function(e){this.defaultShow=Boolean(e),this._switchShow()}},{key:"camera",get:function(){return this.viewShadowMap._lightCamera}},{key:"disViewColor",get:function(){return this._disViewColor},set:function(e){e&&((this._disViewColor=e).a||0==e.a||(this._disViewColor.a=1))}}]),l);function l(e,t){if(!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),e){t=t||{},this.viewer=e,this._cameraPosition=t.cameraPosition,this._position=t.position,this.type=t.type,this.alpha=t.alpha||1,this.url=t.url,this.color=t.color,this._debugFrustum=v.defaultValue(t.debugFrustum,!0),this._aspectRatio=t.aspectRatio||this._getWinWidHei();var i=t.fov&&v.Math.toRadians(t.fov);if(this._camerafov=i||this.viewer.scene.camera.frustum.fov,this.texture=t.texture||new v.Texture({context:this.viewer.scene.context,source:{width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])},flipY:!1}),this._videoPlay=v.defaultValue(t.videoPlay,!0),this.defaultShow=v.defaultValue(t.show,!0),this._rotateDeg=1,this._dirObj=v.defaultValue(t.dirObj,void 0),this.text=v.defaultValue(t.text,void 0),this.textStyles=v.defaultValue(t.textStyles,s),this._disViewColor=v.defaultValue(t.disViewColor,new v.Color(0,0,0,.5)),this.cameraPosition&&this.cameraPosition){switch(l.Type={Color:1,Image:2,Video:3,Text:4},this.type){default:case l.Type.Video:this.activeVideo(this.url);break;case l.Type.Image:this.activePicture(this.url),this.deActiveVideo();break;case l.Type.Color:this.activeColor(this.color),this.deActiveVideo();break;case l.Type.Text:this.activeText(this.text,this.textStyles),this.deActiveVideo()}this._createShadowMap(),this._getOrientation(),this._addCameraFrustum(),this._addPostProcess(),this.viewer.scene.primitives.add(this)}else console.log("初始化失败：请确认相机位置与视点位置正确！")}}},function(e,t){e.exports="\r\n\r\n\r\n\r\nuniform float mixNum;\r\nuniform sampler2D colorTexture;\r\nuniform sampler2D stcshadow; \r\nuniform sampler2D videoTexture;\r\nuniform sampler2D depthTexture;\r\nuniform mat4 _shadowMap_matrix; \r\nuniform vec4 shadowMap_lightPositionEC; \r\nuniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness; \r\nuniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth; \r\nuniform vec4 disViewColor;\r\nvarying vec2 v_textureCoordinates;\r\nvec4 toEye(in vec2 uv, in float depth){\r\n    vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));\r\n    vec4 posInCamera =czm_inverseProjection * vec4(xy, depth, 1.0);\r\n    posInCamera =posInCamera / posInCamera.w;\r\n    return posInCamera;\r\n}\r\nfloat getDepth(in vec4 depth){\r\n    float z_window = czm_unpackDepth(depth);\r\n    z_window = czm_reverseLogDepth(z_window);\r\n    float n_range = czm_depthRange.near;\r\n    float f_range = czm_depthRange.far;\r\n    return (2.0 * z_window - n_range - f_range) / (f_range - n_range);\r\n}\r\nfloat _czm_sampleShadowMap(sampler2D shadowMap, vec2 uv){\r\n    return texture2D(shadowMap, uv).r;\r\n}\r\nfloat _czm_shadowDepthCompare(sampler2D shadowMap, vec2 uv, float depth){\r\n    return step(depth, _czm_sampleShadowMap(shadowMap, uv));\r\n}\r\nfloat _czm_shadowVisibility(sampler2D shadowMap, czm_shadowParameters shadowParameters){\r\n    float depthBias = shadowParameters.depthBias;\r\n    float depth = shadowParameters.depth;\r\n    float nDotL = shadowParameters.nDotL;\r\n    float normalShadingSmooth = shadowParameters.normalShadingSmooth;\r\n    float darkness = shadowParameters.darkness;\r\n    vec2 uv = shadowParameters.texCoords;\r\n    depth -= depthBias;\r\n    vec2 texelStepSize = shadowParameters.texelStepSize;\r\n    float radius = 1.0;\r\n    float dx0 = -texelStepSize.x * radius;\r\n    float dy0 = -texelStepSize.y * radius;\r\n    float dx1 = texelStepSize.x * radius;\r\n    float dy1 = texelStepSize.y * radius;\r\n    float visibility = \r\n    (\r\n    _czm_shadowDepthCompare(shadowMap, uv, depth)\r\n    +_czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy0), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy0), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy0), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, 0.0), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, 0.0), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy1), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy1), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy1), depth)\r\n    ) * (1.0 / 9.0)\r\n    ;\r\n    return visibility;\r\n}\r\nvec3 pointProjectOnPlane(in vec3 planeNormal, in vec3 planeOrigin, in vec3 point){\r\n    vec3 v01 = point -planeOrigin;\r\n    float d = dot(planeNormal, v01) ;\r\n    return (point - planeNormal * d);\r\n}\r\nfloat ptm(vec3 pt){\r\n    return sqrt(pt.x*pt.x + pt.y*pt.y + pt.z*pt.z);\r\n}\r\nvoid main() \r\n{ \r\n    const float PI = 3.141592653589793;\r\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\r\n    vec4 currD = texture2D(depthTexture, v_textureCoordinates);\r\n    if(currD.r>=1.0){\r\n        gl_FragColor = color;\r\n        return;\r\n    }\r\n    \r\n    float depth = getDepth(currD);\r\n    vec4 positionEC = toEye(v_textureCoordinates, depth);\r\n    vec3 normalEC = vec3(1.0);\r\n    czm_shadowParameters shadowParameters; \r\n    shadowParameters.texelStepSize = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy; \r\n    shadowParameters.depthBias = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z; \r\n    shadowParameters.normalShadingSmooth = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w; \r\n    shadowParameters.darkness = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w; \r\n    shadowParameters.depthBias *= max(depth * 0.01, 1.0); \r\n    vec3 directionEC = normalize(positionEC.xyz - shadowMap_lightPositionEC.xyz); \r\n    float nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \r\n    vec4 shadowPosition = _shadowMap_matrix * positionEC; \r\n    shadowPosition /= shadowPosition.w; \r\n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \r\n    { \r\n        gl_FragColor = color;\r\n        return;\r\n    }\r\n\r\n    shadowParameters.texCoords = shadowPosition.xy; \r\n    shadowParameters.depth = shadowPosition.z; \r\n    shadowParameters.nDotL = nDotL; \r\n    float visibility = _czm_shadowVisibility(stcshadow, shadowParameters); \r\n\r\n    vec4 videoColor = texture2D(videoTexture,shadowPosition.xy);\r\n    if(visibility==1.0){\r\n        gl_FragColor = mix(color,vec4(videoColor.xyz,1.0),mixNum*videoColor.a);\r\n    }else{\r\n        if(abs(shadowPosition.z-0.0)<0.01){\r\n            return;\r\n        }\r\n        gl_FragColor = vec4(mix(color.rgb,disViewColor.rgb,disViewColor.a),disViewColor.a);\r\n    }\r\n} "},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TerrainFlood=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),s=(o=a)&&o.__esModule?o:{default:o};var l=s.clone(s.ExpandByMars._defaultFloodAnalysis);t.TerrainFlood=(n(c,[{key:"_checkArgs",value:function(){if(null==this.minHeight||null==this.maxHeight)return console.log("请确认高度值为数值！"),!1;if(this.minHeight>this.maxHeight){var e=this.minHeight;this.minHeight=this.maxHeight,this.maxHeight=e}return!0}},{key:"_init",value:function(){this._positions&&0!=this._positions.length&&(this._prepareFlood(this._positions),this._setFloodVar(),this._startFlood(),this._activeFloodSpeed())}},{key:"setPositions",value:function(e){e&&0!=e.length&&(this._prepareFlood(e),this._setFloodVar(),this._startFlood(),this._activeFloodSpeed())}},{key:"_activeFloodSpeed",value:function(){var e=this;this.activeFlooding||(this.activeFlooding=function(){e.floodVar[1]+=e.speed/50,e.floodVar[1]>=e.floodVar[2]&&(e.floodVar[1]=e.floodVar[2]),e.floodVar[1]<=e.floodVar[0]&&(e.floodVar[1]=e.floodVar[0]),s.ExpandByMars.floodAnalysis.floodVar[1]=e.floodVar[1]},this.viewer.clock.onTick.addEventListener(this.activeFlooding))}},{key:"cancelFloodSpeed",value:function(){this.viewer.clock.onTick.removeEventListener(this.activeFlooding),this.activeFlooding=null}},{key:"reFlood",value:function(){this.floodVar[1]=this.floodVar[0],this._activeFloodSpeed()}},{key:"_switchShow",value:function(){this.show?this.viewer.scene.globe.material=s.Material.fromType("YanMo"):this.viewer.scene.globe.material=null}},{key:"_prepareFlood",value:function(e){var t=(this.ym_pos_arr=e).length;if(0!=t){this.ym_max_index=t;for(var i=99999999,n=99999999,r=99999999,o=-99999999,a=-99999999,s=-99999999,l=0;l<t;l++)e[l]?(this.ym_pos_x[l]=e[l].x,this.ym_pos_y[l]=e[l].y,this.ym_pos_z[l]=e[l].z,e[l].x>o&&(o=e[l].x),e[l].x<i&&(i=e[l].x),e[l].y>a&&(a=e[l].y),e[l].y<n&&(n=e[l].y),e[l].z>s&&(s=e[l].z),e[l].z<r&&(r=e[l].z)):(this.ym_pos_x[l]=0,this.ym_pos_y[l]=0,this.ym_pos_z[l]=0);var c=this.boundingSwell;this._base_rect=this.rect_flood=[i-c,n-c,r-c,o+c,a+c,s+c,0,0,0]}}},{key:"_setFloodVar",value:function(){this.floodVar=[this.minHeight,this.minHeight,this.maxHeight,this.maxHeight-this.minHeight]}},{key:"_startFlood",value:function(){s.ExpandByMars.floodAnalysis.floodVar[0]=this.floodVar[0],s.ExpandByMars.floodAnalysis.floodVar[1]=this.floodVar[1],s.ExpandByMars.floodAnalysis.ym_pos_x=this.ym_pos_x,s.ExpandByMars.floodAnalysis.ym_pos_y=this.ym_pos_y,s.ExpandByMars.floodAnalysis.ym_pos_z=this.ym_pos_z,s.ExpandByMars.floodAnalysis.rect_flood=this.rect_flood,s.ExpandByMars.floodAnalysis.ym_pos_arr=this.ym_pos_arr,s.ExpandByMars.floodAnalysis.floodSpeed=this.speed,s.ExpandByMars.floodAnalysis.ym_max_index=this.ym_max_index,s.ExpandByMars.floodAnalysis.globe=this.globe=!1,s.ExpandByMars.floodAnalysis.showElseArea=this.visibleOutArea,this.viewer.scene.globe.material=s.Material.fromType("YanMo")}},{key:"destroy",value:function(){this.viewer&&(this.viewer.scene.globe.material=null,this.cancelFloodSpeed()),s.ExpandByMars.resetFloodAnalysis(),delete this.activeFlooding,delete this.viewer,delete this.ym_max_height,delete this.ym_pos_x,delete this.ym_pos_y,delete this.ym_pos_z,delete this.ym_pos_arr,delete this.speed,delete this.ym_max_index,delete this.globe,delete this.maxDepthOfWater,delete this.rect_flood}},{key:"visibleOutArea",get:function(){return this._visibleOutArea},set:function(e){this._visibleOutArea=e,s.ExpandByMars.floodAnalysis.showElseArea=e}},{key:"globe",get:function(){return this._globe},set:function(e){this._globe=e,s.ExpandByMars.floodAnalysis.globe=e}},{key:"speed",get:function(){return this._speed},set:function(e){this._speed=Number(e)}},{key:"boundingSwell",get:function(){return this._boundingSwell},set:function(e){var t=this._base_rect;this._boundingSwell=Number(e),this.rect_flood=[t[0]-this.boundingSwell,t[1]-this.boundingSwell,t[2]-this.boundingSwell,t[3]-this.boundingSwell,t[4]-this.boundingSwell,t[5]-this.boundingSwell,0,0,0],s.ExpandByMars.floodAnalysis.rect_flood=this.rect_flood}},{key:"show",get:function(){return this.defaultShow},set:function(e){this.defaultShow=Boolean(e),this._switchShow()}}]),c);function c(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),e&&(this.viewer=e,t=t||{},this.minHeight=s.defaultValue(t.minHeight,s.clone(l.minHeight)),this.maxHeight=s.defaultValue(t.maxHeight,s.clone(l.maxHeight)),this._positions=s.defaultValue(t.positions,s.clone(l.positions)),this._checkArgs()&&(this.floodVar=s.defaultValue(t.floodVar,s.clone(l.floodVar)),this.ym_pos_x=s.defaultValue(t.ym_pos_x,s.clone(l.ym_pos_x)),this.ym_pos_y=s.defaultValue(t.ym_pos_y,s.clone(l.ym_pos_y)),this.ym_pos_z=s.defaultValue(t.ym_pos_z,s.clone(l.ym_pos_z)),this.rect_flood=s.defaultValue(t.rect_flood,s.clone(l.rect_flood)),this.ym_max_index=s.defaultValue(t.ym_max_index,s.clone(l.ym_max_index)),this._globe=s.defaultValue(t.globe,s.clone(l.globe)),this._speed=s.defaultValue(t.speed,s.clone(l.floodSpeed)),this._visibleOutArea=s.defaultValue(t.visibleOutArea,s.clone(l.showElseArea)),this._boundingSwell=s.defaultValue(t.boundingSwell,20),this.defaultShow=s.defaultValue(t.show,!0),this._init()))}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TerrainExcavate=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),g=(o=a)&&o.__esModule?o:{default:o};var s=g.clone(g.ExpandByMars._defaultExcavateAnalysis);t.TerrainExcavate=(n(l,[{key:"_init",value:function(){this._positions&&0!=this._positions.length&&(this._startExcavate(this._positions),this._viewer.scene.globe.material=g.Material.fromType("WaJue"),this._viewer.scene.globe.depthTestAgainstTerrain=!0,this._effectExcavate())}},{key:"setPositions",value:function(e){e&&0!=e.length&&(this._startExcavate(e),this._viewer.scene.globe.material=g.Material.fromType("WaJue"),this._viewer.scene.globe.depthTestAgainstTerrain=!0,this._effectExcavate())}},{key:"_prepareWell",value:function(e){var t=this.splitNum,i=e.length;if(0!=i){for(var n=this.excavateMinHeight-this.excavateHeight,r=[],o=[],a=[],s=0;s<i;s++){var l=s==i-1?0:s+1,c=g.Cartographic.fromCartesian(e[s]),u=g.Cartographic.fromCartesian(e[l]),h=[c.longitude,c.latitude],d=[u.longitude,u.latitude];0==s&&(a.push(new g.Cartographic(h[0],h[1])),o.push(g.Cartesian3.fromRadians(h[0],h[1],n)),r.push(g.Cartesian3.fromRadians(h[0],h[1],0)));for(var p=1;p<=t;p++){var f=g.Math.lerp(h[0],d[0],p/t),m=g.Math.lerp(h[1],d[1],p/t);s==i-1&&p==t||(a.push(new g.Cartographic(f,m)),o.push(g.Cartesian3.fromRadians(f,m,n)),r.push(g.Cartesian3.fromRadians(f,m,0)))}}this.wellData={lerp_pos:a,bottom_pos:o,no_height_top:r}}}},{key:"_createWell",value:function(o){if(Boolean(this._viewer.terrainProvider._layers)){var a=this;this._createBottomSurface(o.bottom_pos);var e=g.sampleTerrainMostDetailed(viewer.terrainProvider,o.lerp_pos);g.when(e,function(e){for(var t=e.length,i=[],n=0;n<t;n++){var r=g.Cartesian3.fromRadians(e[n].longitude,e[n].latitude,e[n].height);i.push(r)}a._createWellWall(o.bottom_pos,i),a._viewer.scene.primitives.add(a.wellWall)})}else this._createBottomSurface(o.bottom_pos),this._createWellWall(o.bottom_pos,o.no_height_top)}},{key:"_createWellWall",value:function(e,t){var i=new g.WellNoBottom({minimumArr:e,maximumArr:t});i=g.WellNoBottom.createGeometry(i);var n=new g.Material({fabric:{type:"Image",uniforms:{image:this.wallImg}}}),r=new g.MaterialAppearance({translucent:!1,flat:!0,material:n});this.wellWall=new g.Primitive({geometryInstances:new g.GeometryInstance({geometry:i,attributes:{color:g.ColorGeometryInstanceAttribute.fromColor(g.Color.GREY)},id:"PitWall"}),appearance:r,asynchronous:!1})}},{key:"_createBottomSurface",value:function(e){if(e.length){var t=new g.CustomPlaneGeometry({pos_arr:e});t=g.CustomPlaneGeometry.createGeometry(t);var i=new g.Material({fabric:{type:"Image",uniforms:{image:this.bottomImg}}}),n=new g.MaterialAppearance({translucent:!1,flat:!0,material:i});this.bottomSurface=new g.Primitive({geometryInstances:new g.GeometryInstance({geometry:t}),appearance:n,asynchronous:!1})}}},{key:"_prepareExcavate",value:function(e){var t=e.length;if(0!=t){this.dig_max_index=t;for(var i=99999999,n=99999999,r=99999999,o=-99999999,a=-99999999,s=-99999999,l=0;l<t;l++)if(e[l]){this.dig_pos_x[l]=e[l].x,this.dig_pos_y[l]=e[l].y,this.dig_pos_z[l]=e[l].z;var c=g.Cartographic.fromCartesian(e[l]);this.excavateMinHeight=this.excavateMinHeight>c.height?c.height:this.excavateMinHeight,e[l].x>o&&(o=e[l].x),e[l].x<i&&(i=e[l].x),e[l].y>a&&(a=e[l].y),e[l].y<n&&(n=e[l].y),e[l].z>s&&(s=e[l].z),e[l].z<r&&(r=e[l].z)}else this.dig_pos_x[l]=0,this.dig_pos_y[l]=0,this.dig_pos_z[l]=0;var u=this.boundingSwell;this._base_rect=this.rect_dig=[i-u,n-u,r-u,o+u,a+u,s+u,0,0,0]}}},{key:"_startExcavate",value:function(e){this._viewer.scene.globe.material=g.Material.fromType("WaJue"),this._prepareExcavate(e),this._prepareWell(e),this.wellData&&this._createWell(this.wellData)}},{key:"_updateExcavateDepth",value:function(e){if(null!=e&&null!=e){this.bottomSurface&&this._viewer.scene.primitives.remove(this.bottomSurface),this.wellWall&&this._viewer.scene.primitives.remove(this.wellWall);for(var t=this.wellData.lerp_pos,i=[],n=t.length,r=0;r<n;r++)i.push(g.Cartesian3.fromRadians(t[r].longitude,t[r].latitude,this.excavateMinHeight-e));this.wellData.bottom_pos=i,this._createWell(this.wellData),this._viewer.scene.primitives.add(this.bottomSurface),this._viewer.scene.primitives.add(this.wellWall)}}},{key:"_effectExcavate",value:function(){g.ExpandByMars.excavateAnalysis.dig_pos_x=this.dig_pos_x,g.ExpandByMars.excavateAnalysis.dig_pos_y=this.dig_pos_y,g.ExpandByMars.excavateAnalysis.dig_pos_z=this.dig_pos_z,g.ExpandByMars.excavateAnalysis.excavateDig=this.excavateDig,g.ExpandByMars.excavateAnalysis.dig_max_index=this.dig_max_index,g.ExpandByMars.excavateAnalysis.showSelfOnly=this.showSelfOnly,g.ExpandByMars.excavateAnalysis.rect_dig=this.rect_dig,this._viewer.scene.primitives.add(this.bottomSurface)}},{key:"_switchShow",value:function(e){e?(this._viewer.scene.globe.material=g.Material.fromType("WaJue"),this.wellWall.show=!0,this.bottomSurface.show=!0):(this._viewer.scene.globe.material=null,this.wellWall.show=!1,this.bottomSurface.show=!1)}},{key:"destroy",value:function(){this._viewer.scene.globe.material=null,g.ExpandByMars.resetExcavateAnalysis(),this._viewer.scene.primitives.remove(this.bottomSurface),this.wellWall&&this._viewer.scene.primitives.remove(this.wellWall),delete this._viewer,delete this._positions,delete this.bottomImg,delete this.wallImg,delete this.dig_pos_x,delete this.dig_pos_y,delete this.dig_pos_z,delete this.dig_max_index,delete this.excavateHeight,delete this.excavatePerPoint,delete this.splitNum,delete this.excavateDig,delete this.bottomSurface,delete this.wellWall,delete this.rect_dig,delete this.defaultExcavateHeight,delete this.defaultShow,delete this.defaultShowSelfOnly,delete this.excavateMinHeight,delete this.wellData,delete this._base_rect}},{key:"getshowSelfOnly",get:function(){return this.defaultShowSelfOnly}},{key:"showSelfOnly",set:function(e){this.defaultShowSelfOnly=e,g.ExpandByMars.excavateAnalysis.showSelfOnly=e}},{key:"excavateHeight",get:function(){return this.defaultExcavateHeight},set:function(e){this.defaultExcavateHeight=e,this._updateExcavateDepth(e)}},{key:"show",get:function(){return this.defaultShow},set:function(e){this.defaultShow=Boolean(e),this._switchShow(Boolean(e))}},{key:"boundingSwell",get:function(){return this.defaultBoundingSwell},set:function(e){var t=this._base_rect;this.defaultBoundingSwell=Number(e),this.rect_dig=[t[0]-this.boundingSwell,t[1]-this.boundingSwell,t[2]-this.boundingSwell,t[3]+this.boundingSwell,t[4]+this.boundingSwell,t[5]+this.boundingSwell,0,0,0],g.ExpandByMars.excavateAnalysis.rect_dig=this.rect_dig}}]),l);function l(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),e&&(this._viewer=e,t=t||{},this._positions=g.defaultValue(t.positions,g.clone(s.positions)),this.bottomImg=g.defaultValue(t.bottomImg,g.clone(s.bottomImg)),this.wallImg=g.defaultValue(t.wallImg,g.clone(s.wallImg)),this.splitNum=g.defaultValue(t.splitNum,g.clone(s.splitNum)),this.excavateDig=g.defaultValue(t.excavateDig,g.clone(s.excavateDig)),this.dig_pos_x=g.defaultValue(t.dig_pos_x,g.clone(s.dig_pos_x)),this.dig_pos_y=g.defaultValue(t.dig_pos_y,g.clone(s.dig_pos_y)),this.dig_pos_z=g.defaultValue(t.dig_pos_z,g.clone(s.dig_pos_z)),this.rect_dig=g.defaultValue(t.rect_dig,g.clone(s.rect_dig)),this.excavateMinHeight=g.defaultValue(t.excavateMinHeight,g.clone(s.excavateMinHeight)),this.excavatePerPoint=g.defaultValue(t.excavatePerPoint,g.clone(s.excavatePerPoint)),this.dig_max_index=g.defaultValue(t.dig_max_index,g.clone(s.dig_max_index)),this.defaultShowSelfOnly=g.defaultValue(t.showSelfOnly,g.clone(s.showSelfOnly)),this.defaultExcavateHeight=g.defaultValue(t.excavateHeight,g.clone(s.excavateHeight)),this.defaultShow=g.defaultValue(t.show,!0),this.defaultBoundingSwell=g.defaultValue(t.boundingSwell,20),this._init())}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TilesetClip=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),s=(o=a)&&o.__esModule?o:{default:o},l=i(29);var c=s.clone(s.ExpandByMars._defaultTilesEditor);t.TilesetClip=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof2(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,l.TilesetBase),n(u,[{key:"clip",value:function(e){e&&e.positions&&(this.yp_show_InOrOut[0]=!0,this.yp_show_InOrOut[1]=e.hideInSide,this.yp_show_InOrOut[2]=e.hideOutSide,(e.hideInSide&&e.hideOutSide||!e.hideInSide&&!e.hideOutSide)&&(this.yp_show_InOrOut[2]=!1),this._preparePos(e.positions),this.setUpAxis(e.axis),this._activeVar())}},{key:"_activeVar",value:function(){s.ExpandByMars.tilesEditor.flatRect=this.flatRect,s.ExpandByMars.tilesEditor.yp_mat_x=this.yp_mat_x,s.ExpandByMars.tilesEditor.yp_mat_y=this.yp_mat_y,s.ExpandByMars.tilesEditor.yp_mat_z=this.yp_mat_z,s.ExpandByMars.tilesEditor.yp_max_index=this.yp_max_index,s.ExpandByMars.tilesEditor.yp_show_InOrOut=this.yp_show_InOrOut}},{key:"_switchShow",value:function(){this.yp_show_InOrOut[0]=this.show,s.ExpandByMars.tilesEditor.yp_show_InOrOut=this.yp_show_InOrOut}},{key:"destroy",value:function(){(function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0})(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"destroy",this).call(this),delete this.flatRect,delete this.yp_mat_x,delete this.yp_mat_y,delete this.yp_mat_z,delete this.yp_max_index,delete this.yp_show_InOrOut}},{key:"outside",get:function(){return this._outside},set:function(e){(this._outside=e)?(this.yp_show_InOrOut[0]=!0,this.yp_show_InOrOut[1]=!1,this.yp_show_InOrOut[2]=!0):(this.yp_show_InOrOut[0]=!0,this.yp_show_InOrOut[1]=!0,this.yp_show_InOrOut[2]=!1)}},{key:"show",get:function(){return this.defaultShow},set:function(e){this.defaultShow=Boolean(e),this._switchShow()}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==_typeof2(t)&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,e));return t.flatRect=s.defaultValue(e.flatRect,s.clone(c.flatRect)),t.yp_mat_x=s.defaultValue(e.yp_mat_x,s.clone(c.yp_mat_x)),t.yp_mat_y=s.defaultValue(e.yp_mat_y,s.clone(c.yp_mat_y)),t.yp_mat_z=s.defaultValue(e.yp_mat_z,s.clone(c.yp_mat_z)),t.yp_max_index=s.defaultValue(e.yp_max_index,s.clone(c.yp_max_index)),t.yp_show_InOrOut=s.defaultValue(e.yp_show_InOrOut,s.clone(c.yp_show_InOrOut)),t.defaultShow=s.defaultValue(e.show,!0),t.outside=s.defaultValue(e.outside,!1),t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TilesetFlat=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),s=(o=a)&&o.__esModule?o:{default:o},l=i(29);var c=s.clone(s.ExpandByMars._defaultTilesEditor);t.TilesetFlat=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof2(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,l.TilesetBase),n(u,[{key:"flat",value:function(e){this.IsYaPing[0]=!0,this._preparePos(e.positions),this.setUpAxis(e.axis),e.animate&&(this.animate=e.animate),e.url&&(this.url=e.url),this.height=e.height,this._activeVar()}},{key:"_activeVar",value:function(){s.ExpandByMars.tilesEditor.IsYaPing=this.IsYaPing,s.ExpandByMars.tilesEditor.flatRect=this.flatRect,s.ExpandByMars.tilesEditor.yp_mat_x=this.yp_mat_x,s.ExpandByMars.tilesEditor.yp_mat_y=this.yp_mat_y,s.ExpandByMars.tilesEditor.yp_mat_z=this.yp_mat_z,s.ExpandByMars.tilesEditor.yp_max_index=this.yp_max_index,s.ExpandByMars.tilesEditor.yp_show_InOrOut=this.yp_show_InOrOut,s.ExpandByMars.tilesEditor.yp_black_texture=this.yp_black_texture=new s.Texture({context:this.viewer.scene.context,source:{width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])},flipY:!1}),s.ExpandByMars.tilesEditor.hm_dh_attr=this.hm_dh_attr,s.ExpandByMars.tilesEditor.model_min_height=this.model_min_height,s.ExpandByMars.tilesEditor.times=(new Date).getTime()}},{key:"_switchShow",value:function(){this.IsYaPing[0]=this.show,s.ExpandByMars.tilesEditor.IsYaPing=this.IsYaPing,this.yp_show_InOrOut[3]=this.show,s.ExpandByMars.tilesEditor.yp_show_InOrOut=this.yp_show_InOrOut}},{key:"destroy",value:function(){(function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0})(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"destroy",this).call(this),delete this.flatRect,delete this.yp_mat_x,delete this.yp_mat_y,delete this.yp_mat_z,delete this.yp_max_index,delete this.model_min_height,delete this.IsYaPing,delete this.yp_show_InOrOut,delete this.yp_black_texture,delete this.hm_dh_attr,delete this.base_height,delete this.defaultImg}},{key:"height",get:function(){return this._defaultFlatDepth},set:function(e){this._defaultFlatDepth=e,this.model_min_height=this.base_height+e,s.ExpandByMars.tilesEditor.model_min_height=this.model_min_height}},{key:"animate",get:function(){return this._animate},set:function(e){this._animate=e,this.IsYaPing[1]=e}},{key:"url",get:function(){return this._url},set:function(e){if(this._url=e){var t=this,i=new Image;i.src=e,i.onload=function(){t.viewer.scene.context._us._yp_black_texture=new s.Texture({context:t.viewer.scene.context,source:i,width:100,height:100,pixelFormat:s.PixelFormat.RGBA,pixelDatatype:s.PixelDatatype.UNSIGNED_BYTE}),t.yp_show_InOrOut[3]=!0},i.onerror=function(e){t.yp_show_InOrOut[3]=!1,console.log(e)}}else this.yp_show_InOrOut[3]=!1}},{key:"show",get:function(){return this.defaultShow},set:function(e){this.defaultShow=Boolean(e),this._switchShow()}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==_typeof2(t)&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,e));return t.flatRect=s.defaultValue(e.flatRect,s.clone(c.flatRect)),t.yp_mat_x=s.defaultValue(e.yp_mat_x,s.clone(c.yp_mat_x)),t.yp_mat_y=s.defaultValue(e.yp_mat_y,s.clone(c.yp_mat_y)),t.yp_mat_z=s.defaultValue(e.yp_mat_z,s.clone(c.yp_mat_z)),t.yp_max_index=s.defaultValue(e.yp_max_index,s.clone(c.yp_max_index)),t.model_min_height=s.defaultValue(e.model_min_height,s.clone(c.model_min_height)),t.IsYaPing=s.defaultValue(e.IsYaPing,s.clone(c.IsYaPing)),t.yp_show_InOrOut=s.defaultValue(e.yp_show_InOrOut,s.clone(c.yp_show_InOrOut)),t.yp_black_texture=s.defaultValue(e.yp_black_texture,s.clone(c.yp_black_texture)),t.hm_dh_attr=s.defaultValue(e.hm_dh_attr,s.clone(c.hm_dh_attr)),t.base_height=s.defaultValue(e.base_height,s.clone(c.base_height)),t.defaultImg=s.defaultValue(e.defaultImg,s.clone(c.defaultImg)),t.defaultShow=s.defaultValue(e.show,!0),t._defaultFlatDepth=0,t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TilesetFlood=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),s=(o=a)&&o.__esModule?o:{default:o},l=i(29);var c=s.clone(s.ExpandByMars._defaultTilesEditor);t.TilesetFlood=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof2(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,l.TilesetBase),n(u,[{key:"start",value:function(e){this.stop(),e&&(e.minHeight>=e.maxHeight||(this.IsYaPing[2]=!0,this.floodVar[0]=e.minHeight,this.floodVar[1]=e.minHeight,this.floodVar[2]=e.maxHeight,this.floodVar[3]=e.maxHeight-e.minHeight,this.alpha=e.alpha,this._addFloodAnimate(e.speed),this._activeVar()))}},{key:"resetFlood3Dtiles",value:function(){s.ExpandByMars.tilesEditor.floodVar[1]=this.floodVar[0]}},{key:"stop",value:function(){this._delFloodAnimate(),this.clear()}},{key:"_addFloodAnimate",value:function(e){if(!this._floodAnimate){this.speed=e||5;var t=this;this._floodAnimate=this.viewer.clock.onTick.addEventListener(function(){t.floodVar[1]+=t.speed/50,t.floodVar[1]>t.floodVar[2]?t._delFloodAnimate():s.ExpandByMars.tilesEditor.floodVar=t.floodVar})}}},{key:"_useCustomColor",value:function(){s.ExpandByMars.tilesEditor.floodColor=this._defaultFloodColor}},{key:"_changeFloodMixNum",value:function(e){this._defaultFloodColor[3]=Number(e),this._defaultFloodColor[3]<.3&&(this._defaultFloodColor[3]=.3),.7<this._defaultFloodColor[3]&&(this._defaultFloodColor[3]=.7)}},{key:"_delFloodAnimate",value:function(){this._floodAnimate&&(this.viewer.clock.onTick.addEventListener(this._floodAnimate),delete this._floodAnimate)}},{key:"_activeVar",value:function(){s.ExpandByMars.tilesEditor.IsYaPing=this.IsYaPing,s.ExpandByMars.tilesEditor.model_min_height=this.model_min_height,s.ExpandByMars.tilesEditor.times=(new Date).getTime(),s.ExpandByMars.tilesEditor.floodVar=this.floodVar,s.ExpandByMars.tilesEditor.floodColor=this._defaultFloodColor}},{key:"_switchShow",value:function(){this.IsYaPing[2]=this.show,s.ExpandByMars.tilesEditor.IsYaPing=this.IsYaPing}},{key:"destroy",value:function(){(function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0})(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"destroy",this).call(this),delete this.floodVar,delete this.model_min_height,delete this.IsYaPing,delete this._defaultFloodColor}},{key:"speed",get:function(){return this._defaultFloodSpeed},set:function(e){this._defaultFloodSpeed=Number(e)}},{key:"alpha",get:function(){return this._defaultFloodMixNum},set:function(e){this._defaultFloodMixNum=Number(e),this._changeFloodMixNum(Number(e))}},{key:"color",get:function(){return this._defaultFloodColor[2]},set:function(e){this._defaultFloodColor[2]=e,this._useCustomColor()}},{key:"show",get:function(){return this.defaultShow},set:function(e){this.defaultShow=Boolean(e),this._switchShow()}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==_typeof2(t)&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,e));return t.floodVar=s.defaultValue(e.floodVar,s.clone(c.floodVar)),t.IsYaPing=s.defaultValue(e.IsYaPing,s.clone(c.IsYaPing)),t._defaultFloodColor=s.defaultValue(e.floodColor,s.clone(c.floodColor)),t.defaultShow=s.defaultValue(e.show,!0),t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Underground=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),s=(o=a)&&o.__esModule?o:{default:o};t.Underground=(n(l,[{key:"_updateImageryLayersAlpha",value:function(e){for(var t=this._viewer.imageryLayers._layers,i=0,n=t.length;i<n;i++)t[i].alpha=e}},{key:"_historyOpts",value:function(){var e={};e.alpha=s.clone(this._viewer.imageryLayers._layers[0]&&this._viewer.imageryLayers._layers[0].alpha),e.highDynamicRange=s.clone(this._viewer.scene.highDynamicRange),e.skyShow=s.clone(this._viewer.scene.skyAtmosphere.show),e.skyBoxShow=s.clone(this._viewer.scene.skyBox.show),e.depthTest=s.clone(this._viewer.scene.globe.depthTestAgainstTerrain),this._viewer.scene.globe._surface&&this._viewer.scene.globe._surface._tileProvider&&this._viewer.scene.globe._surface._tileProvider._renderState&&(e.blending=s.clone(this._viewer.scene.globe._surface._tileProvider._renderState.blending)),this._oldViewOpts=e}},{key:"activate",value:function(){if(!this._enable){this._enable=!0,this._historyOpts(),this._updateImageryLayersAlpha(this._alpha);var e=this._viewer;s.ExpandByMars.underEarth.cullFace=!1,s.ExpandByMars.underEarth.enable=!0,s.ExpandByMars.underEarth.enableDepth=this._depth,s.ExpandByMars.underEarth.enableSkirt=!0,e.scene.globe.depthTestAgainstTerrain=!0,e.scene.highDynamicRange=!1,e.scene.skyAtmosphere.show=!1,e.scene.skyBox.show=!1,e.scene.globe._surface._tileProvider&&e.scene.globe._surface._tileProvider._renderState&&e.scene.globe._surface._tileProvider._renderState.blending&&(e.scene.globe._surface._tileProvider._renderState.blending.enabled=!0,e.scene.globe._surface._tileProvider._renderState.blending.equationRgb=s.BlendEquation.ADD,e.scene.globe._surface._tileProvider._renderState.blending.equationAlpha=s.BlendEquation.ADD,e.scene.globe._surface._tileProvider._renderState.blending.functionSourceAlpha=s.BlendFunction.ONE,e.scene.globe._surface._tileProvider._renderState.blending.functionSourceRgb=s.BlendFunction.ONE,e.scene.globe._surface._tileProvider._renderState.blending.functionDestinationAlpha=s.BlendFunction.ZERO,e.scene.globe._surface._tileProvider._renderState.blending.functionDestinationRgb=s.BlendFunction.ZERO)}}},{key:"disable",value:function(){if(this._enable){this._enable=!1,this._updateImageryLayersAlpha(this._oldViewOpts.alpha);var e=this._viewer;s.ExpandByMars.underEarth.cullFace=void 0,s.ExpandByMars.underEarth.enable=!1,s.ExpandByMars.underEarth.enableDepth=0,s.ExpandByMars.underEarth.enableSkirt=!1,e.scene.globe.depthTestAgainstTerrain=this._oldViewOpts.depthTest,e.scene.skyBox.show=this._oldViewOpts.skyBoxShow,e.scene.highDynamicRange=this._oldViewOpts.highDynamicRange,e.scene.skyAtmosphere.show=this._oldViewOpts.skyShow,null!=this._oldViewOpts.blending&&(e.scene.globe._surface._tileProvider._renderState.blending=this._oldViewOpts.blending)}}},{key:"destroy",value:function(){delete this._viewer,delete this._alpha,delete this._depth,delete this._enable,delete this._oldViewOpts}},{key:"alpha",get:function(){return this._alpha},set:function(e){this._alpha=Number(e),this._enable&&this._updateImageryLayersAlpha(this._alpha)}},{key:"depth",get:function(){return this._depth},set:function(e){this._depth=Number(e),this._enable&&(s.ExpandByMars.underEarth.enableDepth=this._depth)}},{key:"enable",get:function(){return this._enable},set:function(e){e?this.activate():this.disable()}}]),l);function l(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),this._viewer=e;var i=s.defaultValue(t,{});this._depth=s.defaultValue(i.depth,500),this._alpha=s.defaultValue(i.alpha,.5),this.enable=s.defaultValue(i.enable,!1)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FuseTileAndBG=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),s=(o=a)&&o.__esModule?o:{default:o};t.FuseTileAndBG=(n(l,[{key:"init",value:function(){s.ExpandByMars.ableTilesFbo=!0,s.ExpandByMars.tilesCD=[],this.createFbo(),this.createClearFbo(),this.createRenderToScreenDC(),this.addPostStage(),this.createEvent(),this.addEvent(),this.renderToScreen()}},{key:"renderToScreen",value:function(){this._rtcCommand.execute(this.viewer.scene.context)}},{key:"createRenderToScreenDC",value:function(){var e=this.viewer.scene.context;this._rtcCommand||(this._rtcCommand=e.createViewportQuadCommand("uniform sampler2D u_texture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    gl_FragColor = texture2D(u_texture, v_textureCoordinates);\n}\n",{renderState:s.RenderState.fromCache(),uniformMap:{u_texture:function(){return s.ExpandByMars.tilesFbo._colorTextures[0]}},framebuffer:this.copyFbo}))}},{key:"executeCD",value:function(e){s.ExpandByMars.tilesCD&&s.ExpandByMars.tilesCD.execute(e.viewer.scene.context)}},{key:"createFbo",value:function(){var e=this.viewer,t=e.scene.context,i=e.scene.drawingBufferWidth,n=e.scene.drawingBufferHeight,r=new s.Texture({context:t,width:i,height:n,pixelFormat:s.PixelFormat.RGBA,pixelDatatype:s.PixelDatatype.FLOAT,sampler:new s.Sampler({wrapS:s.TextureWrap.CLAMP_TO_EDGE,wrapT:s.TextureWrap.CLAMP_TO_EDGE,minificationFilter:s.TextureMinificationFilter.NEAREST,magnificationFilter:s.TextureMagnificationFilter.NEAREST})}),o=new s.Texture({context:t,width:i,height:n,pixelFormat:s.PixelFormat.DEPTH_STENCIL,pixelDatatype:s.PixelDatatype.UNSIGNED_INT_24_8});new s.Texture({context:t,width:i,height:n,pixelFormat:s.PixelFormat.RGBA,pixelDatatype:s.PixelDatatype.UNSIGNED_BYTE,sampler:new s.Sampler({wrapS:s.TextureWrap.CLAMP_TO_EDGE,wrapT:s.TextureWrap.CLAMP_TO_EDGE,minificationFilter:s.TextureMinificationFilter.NEAREST,magnificationFilter:s.TextureMagnificationFilter.NEAREST})}),s.ExpandByMars.tilesFbo=new s.Framebuffer({context:t,colorTextures:[r],depthStencilTexture:o,destroyAttachments:!1});var a=new s.Texture({context:t,width:i,height:n});this.copyFbo=new s.Framebuffer({context:t,colorTextures:[a]})}},{key:"createClearFbo",value:function(){s.ExpandByMars.tilesFboClear=new s.ClearCommand({color:new s.Color(0,0,0,0),framebuffer:s.ExpandByMars.tilesFbo,depth:2,stencil:2})}},{key:"addPostStage",value:function(){var e=this.viewer,t=this;this.postProcess=new s.PostProcessStage({fragmentShader:"\n        uniform sampler2D colorTexture;\n        uniform sampler2D mergeTexture; \n        uniform float alpha;\n        varying vec2 v_textureCoordinates;\n        void main(){\n            vec4 color = texture2D(colorTexture, v_textureCoordinates);\n            vec4 mergeColor =  texture2D(mergeTexture, v_textureCoordinates);\n            if(mergeColor.a>0.01){\n                gl_FragColor = mix(color,mergeColor,alpha);\n            }else{\n                gl_FragColor = color;\n            }\n        }\n        ",uniforms:{mergeTexture:function(){return t.copyFbo._colorTextures[0]},alpha:function(){return t.alpha}}}),e.scene.postProcessStages.add(this.postProcess)}},{key:"listenSize",value:function(){var e=this.viewer.scene.drawingBufferWidth,t=this.viewer.scene.drawingBufferHeight;e===this._initWidth&&t==this._initHeight||(s.ExpandByMars.tilesFbo&&s.ExpandByMars.tilesFbo.destroy(),this.copyFbo&&this.copyFbo.destroy(),this.createFbo(),this.createClearFbo(),this._initWidth=e,this._initHeight=t)}},{key:"createEvent",value:function(){var i=this;this.event=function(){s.ExpandByMars.tilesCD=[],s.ExpandByMars.tilesFboClear.execute(i.viewer.scene.context)},this.CDEvent=function(){var e=s.ExpandByMars.tilesCD.length;if(e)for(var t=0;t<e;t++)i.viewer.scene.context.draw(s.ExpandByMars.tilesCD[t]);i.renderToScreen()}}},{key:"addEvent",value:function(){this.viewer.scene._preUpdate.addEventListener(this.event),this.viewer.scene._postRender.addEventListener(this.CDEvent)}},{key:"destroy",value:function(){this.viewer.scene._preUpdate.removeEventListener(this.event),this.viewer.scene.postProcessStages.remove(this.postProcess),s.ExpandByMars.ableTilesFbo=!1,s.ExpandByMars.tilesFbo.destroy(),delete this.event,delete this.viewer,delete this._initHeight,delete this._initWidth}},{key:"alpha",get:function(){return this._alpha},set:function(e){this._alpha=e}}]),l);function l(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),e&&(t=t||{},this._alpha=s.defaultValue(t.alpha,3),this.viewer=e,this._initWidth=s.clone(e.scene.drawingBufferWidth),this._initHeight=s.clone(e.scene.drawingBufferHeight),this.init())}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PrimitiveBloom=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),s=(o=a)&&o.__esModule?o:{default:o};t.PrimitiveBloom=(n(l,[{key:"init",value:function(){s.ExpandByMars.ableBright=!0,this.createFbo(),this.createClearFbo(),this.createRenderToScreenDC(),this.addPostStage(),this.createEvent(),this.addEvent()}},{key:"renderToScreen",value:function(){this._rtcCommand.execute(this.viewer.scene.context)}},{key:"createRenderToScreenDC",value:function(){var e=this,t=this.viewer.scene.context;this._rtcCommand||(this._rtcCommand=t.createViewportQuadCommand("uniform sampler2D u_texture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    gl_FragColor = texture2D(u_texture, v_textureCoordinates);\n}\n",{renderState:s.RenderState.fromCache(),uniformMap:{u_texture:function(){return e.brightFbo._colorTextures[0]}},framebuffer:e.copyFbo}))}},{key:"createFbo",value:function(){var e=this.viewer,t=new s.Texture({context:e.scene.context,width:e.scene.drawingBufferWidth,height:e.scene.drawingBufferHeight,pixelFormat:s.PixelFormat.RGBA,pixelDatatype:s.PixelDatatype.FLOAT,flipY:!1});this.brightFbo=new s.Framebuffer({context:e.scene.context,colorTextures:[t]}),s.ExpandByMars.brightCD=[];var i=new s.Texture({context:e.scene.context,width:e.scene.drawingBufferWidth,height:e.scene.drawingBufferHeight,pixelFormat:s.PixelFormat.RGBA,pixelDatatype:s.PixelDatatype.FLOAT,flipY:!1});this.copyFbo=new s.Framebuffer({context:e.scene.context,colorTextures:[i]})}},{key:"createClearFbo",value:function(){this.brightFboClear=new s.ClearCommand({color:new s.Color(0,0,0,0),framebuffer:this.brightFbo}),this.copyFboClear=new s.ClearCommand({color:new s.Color(0,0,0,0),framebuffer:this.copyFbo})}},{key:"addPostStage",value:function(){var e=this.viewer,t=this;this.postProcess=new s.PostProcessStage({fragmentShader:"\n        uniform sampler2D colorTexture;\n        uniform sampler2D mergeTexture;\n        uniform float radius;\n        uniform vec2 dir;\n        varying vec2 v_textureCoordinates;\n        void main(){\n            vec4 sum = vec4(0.0);\n            vec2 tc = v_textureCoordinates;\n            float blur = radius/1024.0;\n            float hstep = dir.x;\n            float vstep = dir.y;\n            sum += texture2D(mergeTexture, vec2(tc.x - 4.0*blur*hstep, tc.y - 4.0*blur*vstep)) * 0.0162162162;\n            sum += texture2D(mergeTexture, vec2(tc.x - 3.0*blur*hstep, tc.y - 3.0*blur*vstep)) * 0.0540540541;\n            sum += texture2D(mergeTexture, vec2(tc.x - 2.0*blur*hstep, tc.y - 2.0*blur*vstep)) * 0.1216216216;\n            sum += texture2D(mergeTexture, vec2(tc.x - 1.0*blur*hstep, tc.y - 1.0*blur*vstep)) * 0.1945945946;\n            sum += texture2D(mergeTexture, vec2(tc.x, tc.y));\n            sum += texture2D(mergeTexture, vec2(tc.x + 1.0*blur*hstep, tc.y + 1.0*blur*vstep)) * 0.1945945946;\n            sum += texture2D(mergeTexture, vec2(tc.x + 2.0*blur*hstep, tc.y + 2.0*blur*vstep)) * 0.1216216216;\n            sum += texture2D(mergeTexture, vec2(tc.x + 3.0*blur*hstep, tc.y + 3.0*blur*vstep)) * 0.0540540541;\n            sum += texture2D(mergeTexture, vec2(tc.x + 4.0*blur*hstep, tc.y + 4.0*blur*vstep)) * 0.0162162162;\n            vec4 cc = texture2D(mergeTexture,v_textureCoordinates);\n            vec4 oc = texture2D(colorTexture,v_textureCoordinates);\n            vec4 nc = vec4(sum.rgb, sum.a);\n            float alp = clamp(nc.a,0.3,1.0);\n            gl_FragColor = vec4(mix(oc.rgb,nc.rgb,nc.a),1.0);\n        }",uniforms:{mergeTexture:function(){return t.copyFbo._colorTextures[0]},radius:function(){return t.radius},dir:function(){return t.blurDir}}}),e.scene.postProcessStages.add(this.postProcess)}},{key:"listenSize",value:function(){var e=this.viewer.scene.drawingBufferWidth,t=this.viewer.scene.drawingBufferHeight;e===this._initWidth&&t==this._initHeight||(this.brightFbo&&this.brightFbo.destroy(),this.createFbo(),this.createClearFbo())}},{key:"createEvent",value:function(){var i=this;this.event=function(){i.listenSize(),s.ExpandByMars.brightCD=[],i.brightFboClear.execute(i.viewer.scene.context)},this.CDEvent=function(){i.copyFboClear.execute(i.viewer.scene.context);var e=s.ExpandByMars.brightCD.length;if(e)for(var t=0;t<e;t++)s.ExpandByMars.brightCD[t].framebuffer=i.brightFbo,i.viewer.scene.context.draw(s.ExpandByMars.brightCD[t]);i.renderToScreen()}}},{key:"addEvent",value:function(){this.viewer.scene._preUpdate.addEventListener(this.event),this.viewer.scene._postRender.addEventListener(this.CDEvent)}},{key:"destroy",value:function(){this.viewer.scene._preUpdate.removeEventListener(this.event),this.viewer.scene.postProcessStages.remove(this.postProcess),s.ExpandByMars.ableBright=!1,this.brightFbo.destroy(),delete this.event,delete this.viewer,delete this._initHeight,delete this._initWidth}},{key:"alpha",get:function(){return this._alpha},set:function(e){this._alpha=e}}]),l);function l(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),e&&t&&(i=i||{},this._alpha=s.defaultValue(i.alpha,.5),this.radius=s.defaultValue(i.radius,5),this.blurDir=s.defaultValue(i.blurDir,new s.Cartesian2(5,5)),this.viewer=e,this._initWidth=s.clone(e.scene.drawingBufferWidth),this._initHeight=s.clone(e.scene.drawingBufferHeight),this.init())}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FogEffect=void 0;var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=i(0),s=(o=a)&&o.__esModule?o:{default:o};t.FogEffect=(n(l,[{key:"init",value:function(){var e=this;this.FogStage=new s.PostProcessStage({name:"MarsFog",fragmentShader:"  uniform sampler2D colorTexture;\n  uniform sampler2D depthTexture;\n  uniform float trength;\n  uniform vec4 fogcolor;\n  varying vec2 v_textureCoordinates;\n  void main(void)\n  {\n      vec4 origcolor=texture2D(colorTexture, v_textureCoordinates);\n\n      float depth = czm_readDepth(depthTexture, v_textureCoordinates);\n      vec4 depthcolor=texture2D(depthTexture, v_textureCoordinates);\n\n      float f=trength*(depthcolor.r-0.3)/0.2;\n      if(f<0.0) f=0.0;\n      else if(f>1.0) f=1.0;\n      gl_FragColor = mix(origcolor,fogcolor,f);\n   }",uniforms:{trength:function(){return e.trength},fogcolor:function(){return e.color}}}),this.viewer.scene.postProcessStages.add(this.FogStage)}},{key:"destroy",value:function(){this.viewer.scene.postProcessStages.remove(this.FogStage),delete this.trength,delete this.color,delete this.viewer}},{key:"show",get:function(){return this._show},set:function(e){this._show=Boolean(e),this.FogStage.enabled=this._show}}]),l);function l(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),e&&(t=t||{},this.trength=s.defaultValue(t.trength,.1),this.color=s.defaultValue(t.color,new s.Color(.8,.8,.8,.5)),this._show=s.defaultValue(t.show,!0),this.viewer=e,this.init())}}],k={},l.m=j,l.c=k,l.d=function(e,t,i){l.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="",l(l.s=46);function l(e){if(k[e])return k[e].exports;var t=k[e]={i:e,l:!1,exports:{}};return j[e].call(t.exports,t,t.exports,l),t.l=!0,t.exports}var j,k});